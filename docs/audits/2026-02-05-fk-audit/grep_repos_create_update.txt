apps/clawcontrol/app/api/receipts/route.ts:103:    const data = await repos.receipts.create(input)
apps/clawcontrol/app/api/receipts/route.ts:106:    await repos.activities.create({
apps/clawcontrol/app/api/receipts/[id]/finalize/route.ts:63:    await repos.activities.create({
apps/clawcontrol/app/api/stations/route.ts:124:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/stations/route.ts:134:    const station = await repos.stations.create({
apps/clawcontrol/app/api/stations/route.ts:149:    await repos.activities.create({
apps/clawcontrol/app/api/stations/[id]/route.ts:84:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/stations/[id]/route.ts:94:    const updated = await repos.stations.update(id, {
apps/clawcontrol/app/api/stations/[id]/route.ts:113:    await repos.activities.create({
apps/clawcontrol/app/api/stations/[id]/route.ts:172:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/stations/[id]/route.ts:194:    await repos.activities.create({
apps/clawcontrol/app/api/work-orders/route.ts:83:    const data = await repos.workOrders.create({
apps/clawcontrol/app/api/work-orders/route.ts:91:    await repos.activities.create({
apps/clawcontrol/app/api/work-orders/[id]/route.ts:137:        const updated = await repos.workOrders.update(id, {
apps/clawcontrol/app/api/work-orders/[id]/route.ts:151:    const data = await repos.workOrders.update(id, {
apps/clawcontrol/app/api/openclaw/agents/sync/route.ts:97:      await repos.agents.create({
apps/clawcontrol/app/api/openclaw/agents/sync/route.ts:107:      await repos.agents.update(existing.id, {
apps/clawcontrol/app/api/openclaw/console/agent/turn/route.ts:137:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/openclaw/console/agent/turn/route.ts:149:  await repos.activities.create({
apps/clawcontrol/app/api/openclaw/console/agent/turn/route.ts:197:        await repos.activities.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/chat/route.ts:125:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/chat/route.ts:141:  await repos.activities.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/chat/route.ts:264:        await repos.activities.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/send/route.ts:123:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/send/route.ts:137:  await repos.activities.create({
apps/clawcontrol/app/api/openclaw/console/sessions/[id]/send/route.ts:197:        await repos.activities.create({
apps/clawcontrol/app/api/security/audit/route.ts:130:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/security/audit/route.ts:192:    await repos.activities.create({
apps/clawcontrol/app/api/plugins/restart/route.ts:50:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/plugins/restart/route.ts:76:    await repos.activities.create({
apps/clawcontrol/app/api/plugins/route.ts:161:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/plugins/route.ts:194:    await repos.activities.create({
apps/clawcontrol/app/api/plugins/[id]/config/route.ts:97:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/plugins/[id]/config/route.ts:109:    const { data: updatedPlugin, meta } = await repos.plugins.update(id, { config })
apps/clawcontrol/app/api/plugins/[id]/config/route.ts:137:    await repos.activities.create({
apps/clawcontrol/app/api/plugins/[id]/doctor/route.ts:48:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/plugins/[id]/doctor/route.ts:76:    await repos.activities.create({
apps/clawcontrol/app/api/plugins/[id]/route.ts:69:    const { data: updatedPlugin, meta } = await repos.plugins.update(id, { enabled })
apps/clawcontrol/app/api/plugins/[id]/route.ts:76:      await repos.activities.create({
apps/clawcontrol/app/api/plugins/[id]/route.ts:153:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/plugins/[id]/route.ts:204:    await repos.activities.create({
apps/clawcontrol/app/api/agents/create-from-template/route.ts:113:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agents/create-from-template/route.ts:136:    const agent = await repos.agents.create({
apps/clawcontrol/app/api/agents/create-from-template/route.ts:159:    await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/provision/route.ts:56:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agents/[id]/provision/route.ts:102:      await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/provision/route.ts:182:    await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/test/route.ts:38:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agents/[id]/test/route.ts:99:      await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/test/route.ts:160:    await repos.agents.update(id, { status: agent.status })
apps/clawcontrol/app/api/agents/[id]/test/route.ts:162:    await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/test/route.ts:199:    await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/route.ts:114:      await repos.activities.create({
apps/clawcontrol/app/api/agents/[id]/route.ts:128:    const data = await repos.agents.update(id, {
apps/clawcontrol/app/api/agents/[id]/avatar/route.ts:162:    await repos.agents.update(id, { avatarPath })
apps/clawcontrol/app/api/agents/[id]/avatar/route.ts:228:    await repos.agents.update(id, { avatarPath: null })
apps/clawcontrol/app/api/agents/create/route.ts:88:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agents/create/route.ts:149:    const agent = await repos.agents.create({
apps/clawcontrol/app/api/agents/create/route.ts:182:    await repos.activities.create({
apps/clawcontrol/app/api/playbooks/[id]/run/route.ts:74:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/operations/route.ts:92:    const data = await repos.operations.create(input)
apps/clawcontrol/app/api/operations/route.ts:95:    await repos.activities.create({
apps/clawcontrol/app/api/operations/[id]/route.ts:109:        const updated = await repos.operations.update(id, {
apps/clawcontrol/app/api/operations/[id]/route.ts:120:    const data = await repos.operations.update(id, {
apps/clawcontrol/app/api/maintenance/[action]/route.ts:137:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/maintenance/[action]/route.ts:194:    await repos.activities.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:74:  const parentReceipt = await repos.receipts.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:136:      await repos.activities.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:172:      await repos.activities.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:192:    const doctorReceipt = await repos.receipts.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:236:      const fixReceipt = await repos.receipts.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:275:    const restartReceipt = await repos.receipts.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:359:    await repos.activities.create({
apps/clawcontrol/app/api/maintenance/recover/route.ts:386:    await repos.activities.create({
apps/clawcontrol/app/api/skills/[scope]/[id]/duplicate/route.ts:99:  await repos.activities.create({
apps/clawcontrol/app/api/skills/[scope]/[id]/route.ts:98:    const updatedSkill = await repos.skills.update(scope as SkillScope, id, {
apps/clawcontrol/app/api/skills/[scope]/[id]/route.ts:110:      await repos.activities.create({
apps/clawcontrol/app/api/skills/[scope]/[id]/route.ts:125:      await repos.activities.create({
apps/clawcontrol/app/api/skills/[scope]/[id]/route.ts:206:    await repos.activities.create({
apps/clawcontrol/app/api/skills/route.ts:82:    const newSkill = await repos.skills.create({
apps/clawcontrol/app/api/skills/route.ts:91:    await repos.activities.create({
apps/clawcontrol/app/api/approvals/batch/route.ts:59:        const result = await repos.approvals.update(id, {
apps/clawcontrol/app/api/approvals/route.ts:115:    const data = await repos.approvals.create(input)
apps/clawcontrol/app/api/approvals/route.ts:118:    await repos.activities.create({
apps/clawcontrol/app/api/approvals/route.ts:132:    await repos.activities.create({
apps/clawcontrol/app/api/approvals/[id]/route.ts:89:    const data = await repos.approvals.update(id, {
apps/clawcontrol/app/api/approvals/[id]/route.ts:102:    await repos.activities.create({
apps/clawcontrol/app/api/approvals/[id]/route.ts:118:    await repos.activities.create({
apps/clawcontrol/app/api/agent-templates/route.ts:82:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agent-templates/route.ts:121:    await repos.activities.create({
apps/clawcontrol/app/api/agent-templates/[id]/route.ts:86:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agent-templates/[id]/route.ts:144:    await repos.activities.create({
apps/clawcontrol/app/api/agent-templates/[id]/export/route.ts:45:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agent-templates/[id]/export/route.ts:76:    await repos.activities.create({
apps/clawcontrol/app/api/agent-templates/import/route.ts:153:  const receipt = await repos.receipts.create({
apps/clawcontrol/app/api/agent-templates/import/route.ts:257:    await repos.activities.create({
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:219:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/with-governor */ \"(rsc)/./lib/with-governor.ts\");\n/* harmony import */ var _lib_stations_icon_map__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/stations/icon-map */ \"(rsc)/./lib/stations/icon-map.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nfunction normalizeName(name) {\n    if (typeof name !== 'string') return null;\n    const trimmed = name.trim();\n    return trimmed.length > 0 ? trimmed : null;\n}\nfunction normalizeOptionalString(value) {\n    if (value === undefined) return undefined;\n    if (value === null) return null;\n    if (typeof value !== 'string') return undefined;\n    const trimmed = value.trim();\n    return trimmed.length === 0 ? null : trimmed;\n}\nfunction normalizeColor(value) {\n    const normalized = normalizeOptionalString(value);\n    if (normalized === undefined) return undefined;\n    if (normalized === null) return null;\n    const hex = normalized.startsWith('#') ? normalized : `#${normalized}`;\n    if (!/^#[0-9a-fA-F]{6}$/.test(hex)) return undefined;\n    return hex;\n}\nfunction slugifyStationId(name) {\n    const base = name.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-+/g, '-').replace(/^-+|-+$/g, '');\n    const fallback = base.length > 0 ? base : 'station';\n    const truncated = fallback.slice(0, 48).replace(/-+$/g, '').replace(/^-+/g, '');\n    return truncated.length > 0 ? truncated : 'station';\n}\nasync function generateAvailableStationId(name) {\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const base = slugifyStationId(name);\n    const existingBase = await repos.stations.getById(base);\n    if (!existingBase) return base;\n    for(let i = 2; i <= 50; i++){\n        const suffix = `-${i}`;\n        const maxBaseLen = 48 - suffix.length;\n        const prefix = base.slice(0, maxBaseLen).replace(/-+$/g, '').replace(/^-+/g, '') || 'station';\n        const candidate = `${prefix}${suffix}`;\n        const existing = await repos.stations.getById(candidate);\n        if (!existing) return candidate;\n    }\n    return {\n        error: 'STATION_ID_TAKEN'\n    };\n}\n/**\n * GET /api/stations\n * List stations\n */ async function GET() {\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const stations = await repos.stations.list();\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        data: stations\n    });\n}\n/**\n * POST /api/stations\n * Create a station (slug id, typed confirm, receipt + activity)\n */ async function POST(request) {\n    const body = await request.json().catch(()=>({}));\n    const typedConfirmText = typeof body?.typedConfirmText === 'string' ? body.typedConfirmText : undefined;\n    const enforcement = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_2__.enforceTypedConfirm)({\n        actionKind: 'station.create',\n        typedConfirmText\n    });\n    if (!enforcement.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: enforcement.errorType,\n            policy: enforcement.policy\n        }, {\n            status: enforcement.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    const name = normalizeName(body?.name);\n    if (!name) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'NAME_REQUIRED'\n        }, {\n            status: 400\n        });\n    }\n    const icon = body?.icon;\n    if (typeof icon !== 'string' || !_lib_stations_icon_map__WEBPACK_IMPORTED_MODULE_3__.STATION_ICON_SET.has(icon)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_ICON'\n        }, {\n            status: 400\n        });\n    }\n    const description = normalizeOptionalString(body?.description);\n    const color = normalizeColor(body?.color);\n    if (color === undefined && body?.color !== undefined) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_COLOR'\n        }, {\n            status: 400\n        });\n    }\n    const sortOrderRaw = body?.sortOrder;\n    const sortOrder = sortOrderRaw === undefined ? undefined : Number(sortOrderRaw);\n    if (sortOrderRaw !== undefined && (!Number.isFinite(sortOrder) || !Number.isInteger(sortOrder))) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_SORT_ORDER'\n        }, {\n            status: 400\n        });\n    }\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const existingByName = await repos.stations.getByName(name);\n    if (existingByName) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'STATION_NAME_TAKEN'\n        }, {\n            status: 409\n        });\n    }\n    const idResult = await generateAvailableStationId(name);\n    if (typeof idResult !== 'string') {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: idResult.error\n        }, {\n            status: 409\n        });\n    }\n    const receipt = await repos.receipts.create({\n        workOrderId: 'system',\n        kind: 'manual',\n        commandName: 'station.create',\n        commandArgs: {\n            name,\n            icon,\n            description,\n            color,\n            sortOrder,\n            stationId: idResult\n        }\n    });\n    try {\n        await repos.receipts.append(receipt.id, {\n            stream: 'stdout',\n            chunk: `Creating station \"${name}\"...\\n`\n        });\n        const station = await repos.stations.create({\n            id: idResult,\n            name,\n            icon,\n            description: description ?? null,\n            color: color ?? null,\n            sortOrder: sortOrder ?? 0\n        });\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 0,\n            durationMs: 0,\n            parsedJson: {\n                station\n            }\n        });\n        await repos.activities.create({\n            type: 'station.created',\n            actor: 'user',\n            entityType: 'station',\n            entityId: station.id,\n            summary: `Created station: ${station.name}`,\n            payloadJson: {\n                receiptId: receipt.id,\n                before: null,\n                after: station\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: station,\n            receiptId: receipt.id\n        }, {\n            status: 201\n        });\n    } catch (err) {\n        const message = err instanceof Error ? err.message : 'Failed to create station';\n        await repos.receipts.append(receipt.id, {\n            stream: 'stderr',\n            chunk: `Error: ${message}\\n`\n        });\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 1,\n            durationMs: 0,\n            parsedJson: {\n                error: message\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'CREATE_FAILED',\n            message,\n            receiptId: receipt.id\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUo7WUFBUTtRQUN4QjtRQUVBLE1BQU1sRCxNQUFNdUQsVUFBVSxDQUFDZixNQUFNLENBQUM7WUFDNUJnQixNQUFNO1lBQ05DLE9BQU87WUFDUEMsWUFBWTtZQUNaQyxVQUFVVCxRQUFRSCxFQUFFO1lBQ3BCYSxTQUFTLENBQUMsaUJBQWlCLEVBQUVWLFFBQVF0RSxJQUFJLEVBQUU7WUFDM0NpRixhQUFhO2dCQUNYQyxXQUFXeEIsUUFBUVMsRUFBRTtnQkFDckJnQixRQUFRO2dCQUNSQyxPQUFPZDtZQUNUO1FBQ0Y7UUFFQSxPQUFPM0UscURBQVlBLENBQUNzQyxJQUFJLENBQUM7WUFBRUMsTUFBTW9DO1lBQVNZLFdBQVd4QixRQUFRUyxFQUFFO1FBQUMsR0FBRztZQUFFdEIsUUFBUTtRQUFJO0lBQ25GLEVBQUUsT0FBT3dDLEtBQUs7UUFDWixNQUFNQyxVQUFVRCxlQUFlRSxRQUFRRixJQUFJQyxPQUFPLEdBQUc7UUFDckQsTUFBTWxFLE1BQU11QyxRQUFRLENBQUNPLE1BQU0sQ0FBQ1IsUUFBUVMsRUFBRSxFQUFFO1lBQUVDLFFBQVE7WUFBVUMsT0FBTyxDQUFDLE9BQU8sRUFBRWlCLFFBQVEsRUFBRSxDQUFDO1FBQUM7UUFDekYsTUFBTWxFLE1BQU11QyxRQUFRLENBQUNZLFFBQVEsQ0FBQ2IsUUFBUVMsRUFBRSxFQUFFO1lBQ3hDSyxVQUFVO1lBQ1ZDLFlBQVk7WUFDWkMsWUFBWTtnQkFBRTVDLE9BQU93RDtZQUFRO1FBQy9CO1FBQ0EsT0FBTzNGLHFEQUFZQSxDQUFDc0MsSUFBSSxDQUFDO1lBQUVILE9BQU87WUFBaUJ3RDtZQUFTSixXQUFXeEIsUUFBUVMsRUFBRTtRQUFDLEdBQUc7WUFBRXRCLFFBQVE7UUFBSTtJQUNyRztBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2FwcC9hcGkvc3RhdGlvbnMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICdAL2xpYi9yZXBvJ1xuaW1wb3J0IHsgZW5mb3JjZVR5cGVkQ29uZmlybSB9IGZyb20gJ0AvbGliL3dpdGgtZ292ZXJub3InXG5pbXBvcnQgeyBTVEFUSU9OX0lDT05fU0VUIH0gZnJvbSAnQC9saWIvc3RhdGlvbnMvaWNvbi1tYXAnXG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZU5hbWUobmFtZTogdW5rbm93bik6IHN0cmluZyB8IG51bGwge1xuICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSByZXR1cm4gbnVsbFxuICBjb25zdCB0cmltbWVkID0gbmFtZS50cmltKClcbiAgcmV0dXJuIHRyaW1tZWQubGVuZ3RoID4gMCA/IHRyaW1tZWQgOiBudWxsXG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZU9wdGlvbmFsU3RyaW5nKHZhbHVlOiB1bmtub3duKTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCB7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdW5kZWZpbmVkXG4gIGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuIG51bGxcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHJldHVybiB1bmRlZmluZWRcbiAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKVxuICByZXR1cm4gdHJpbW1lZC5sZW5ndGggPT09IDAgPyBudWxsIDogdHJpbW1lZFxufVxuXG5mdW5jdGlvbiBub3JtYWxpemVDb2xvcih2YWx1ZTogdW5rbm93bik6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQge1xuICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplT3B0aW9uYWxTdHJpbmcodmFsdWUpXG4gIGlmIChub3JtYWxpemVkID09PSB1bmRlZmluZWQpIHJldHVybiB1bmRlZmluZWRcbiAgaWYgKG5vcm1hbGl6ZWQgPT09IG51bGwpIHJldHVybiBudWxsXG4gIGNvbnN0IGhleCA9IG5vcm1hbGl6ZWQuc3RhcnRzV2l0aCgnIycpID8gbm9ybWFsaXplZCA6IGAjJHtub3JtYWxpemVkfWBcbiAgaWYgKCEvXiNbMC05YS1mQS1GXXs2fSQvLnRlc3QoaGV4KSkgcmV0dXJuIHVuZGVmaW5lZFxuICByZXR1cm4gaGV4XG59XG5cbmZ1bmN0aW9uIHNsdWdpZnlTdGF0aW9uSWQobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgYmFzZSA9IG5hbWVcbiAgICAudHJpbSgpXG4gICAgLnRvTG93ZXJDYXNlKClcbiAgICAucmVwbGFjZSgvW15hLXowLTldKy9nLCAnLScpXG4gICAgLnJlcGxhY2UoLy0rL2csICctJylcbiAgICAucmVwbGFjZSgvXi0rfC0rJC9nLCAnJylcblxuICBjb25zdCBmYWxsYmFjayA9IGJhc2UubGVuZ3RoID4gMCA/IGJhc2UgOiAnc3RhdGlvbidcbiAgY29uc3QgdHJ1bmNhdGVkID0gZmFsbGJhY2suc2xpY2UoMCwgNDgpLnJlcGxhY2UoLy0rJC9nLCAnJykucmVwbGFjZSgvXi0rL2csICcnKVxuICByZXR1cm4gdHJ1bmNhdGVkLmxlbmd0aCA+IDAgPyB0cnVuY2F0ZWQgOiAnc3RhdGlvbidcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVBdmFpbGFibGVTdGF0aW9uSWQobmFtZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCB7IGVycm9yOiAnU1RBVElPTl9JRF9UQUtFTicgfT4ge1xuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgY29uc3QgYmFzZSA9IHNsdWdpZnlTdGF0aW9uSWQobmFtZSlcblxuICBjb25zdCBleGlzdGluZ0Jhc2UgPSBhd2FpdCByZXBvcy5zdGF0aW9ucy5nZXRCeUlkKGJhc2UpXG4gIGlmICghZXhpc3RpbmdCYXNlKSByZXR1cm4gYmFzZVxuXG4gIGZvciAobGV0IGkgPSAyOyBpIDw9IDUwOyBpKyspIHtcbiAgICBjb25zdCBzdWZmaXggPSBgLSR7aX1gXG4gICAgY29uc3QgbWF4QmFzZUxlbiA9IDQ4IC0gc3VmZml4Lmxlbmd0aFxuICAgIGNvbnN0IHByZWZpeCA9IGJhc2Uuc2xpY2UoMCwgbWF4QmFzZUxlbikucmVwbGFjZSgvLSskL2csICcnKS5yZXBsYWNlKC9eLSsvZywgJycpIHx8ICdzdGF0aW9uJ1xuICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGAke3ByZWZpeH0ke3N1ZmZpeH1gXG4gICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCByZXBvcy5zdGF0aW9ucy5nZXRCeUlkKGNhbmRpZGF0ZSlcbiAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gY2FuZGlkYXRlXG4gIH1cblxuICByZXR1cm4geyBlcnJvcjogJ1NUQVRJT05fSURfVEFLRU4nIH1cbn1cblxuLyoqXG4gKiBHRVQgL2FwaS9zdGF0aW9uc1xuICogTGlzdCBzdGF0aW9uc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKCkge1xuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgY29uc3Qgc3RhdGlvbnMgPSBhd2FpdCByZXBvcy5zdGF0aW9ucy5saXN0KClcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGF0YTogc3RhdGlvbnMgfSlcbn1cblxuLyoqXG4gKiBQT1NUIC9hcGkvc3RhdGlvbnNcbiAqIENyZWF0ZSBhIHN0YXRpb24gKHNsdWcgaWQsIHR5cGVkIGNvbmZpcm0sIHJlY2VpcHQgKyBhY3Rpdml0eSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpLmNhdGNoKCgpID0+ICh7fSkpXG4gIGNvbnN0IHR5cGVkQ29uZmlybVRleHQgPSB0eXBlb2YgYm9keT8udHlwZWRDb25maXJtVGV4dCA9PT0gJ3N0cmluZycgPyBib2R5LnR5cGVkQ29uZmlybVRleHQgOiB1bmRlZmluZWRcblxuICBjb25zdCBlbmZvcmNlbWVudCA9IGF3YWl0IGVuZm9yY2VUeXBlZENvbmZpcm0oe1xuICAgIGFjdGlvbktpbmQ6ICdzdGF0aW9uLmNyZWF0ZScsXG4gICAgdHlwZWRDb25maXJtVGV4dCxcbiAgfSlcbiAgaWYgKCFlbmZvcmNlbWVudC5hbGxvd2VkKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogZW5mb3JjZW1lbnQuZXJyb3JUeXBlLCBwb2xpY3k6IGVuZm9yY2VtZW50LnBvbGljeSB9LFxuICAgICAgeyBzdGF0dXM6IGVuZm9yY2VtZW50LmVycm9yVHlwZSA9PT0gJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnID8gNDI4IDogNDAzIH1cbiAgICApXG4gIH1cblxuICBjb25zdCBuYW1lID0gbm9ybWFsaXplTmFtZShib2R5Py5uYW1lKVxuICBpZiAoIW5hbWUpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05BTUVfUkVRVUlSRUQnIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgfVxuXG4gIGNvbnN0IGljb24gPSBib2R5Py5pY29uXG4gIGlmICh0eXBlb2YgaWNvbiAhPT0gJ3N0cmluZycgfHwgIVNUQVRJT05fSUNPTl9TRVQuaGFzKGljb24pKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJTlZBTElEX0lDT04nIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgfVxuXG4gIGNvbnN0IGRlc2NyaXB0aW9uID0gbm9ybWFsaXplT3B0aW9uYWxTdHJpbmcoYm9keT8uZGVzY3JpcHRpb24pXG4gIGNvbnN0IGNvbG9yID0gbm9ybWFsaXplQ29sb3IoYm9keT8uY29sb3IpXG4gIGlmIChjb2xvciA9PT0gdW5kZWZpbmVkICYmIGJvZHk/LmNvbG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0lOVkFMSURfQ09MT1InIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgfVxuXG4gIGNvbnN0IHNvcnRPcmRlclJhdyA9IGJvZHk/LnNvcnRPcmRlclxuICBjb25zdCBzb3J0T3JkZXIgPSBzb3J0T3JkZXJSYXcgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IE51bWJlcihzb3J0T3JkZXJSYXcpXG4gIGlmIChzb3J0T3JkZXJSYXcgIT09IHVuZGVmaW5lZCAmJiAoIU51bWJlci5pc0Zpbml0ZShzb3J0T3JkZXIpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKHNvcnRPcmRlcikpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJTlZBTElEX1NPUlRfT1JERVInIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgfVxuXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIGNvbnN0IGV4aXN0aW5nQnlOYW1lID0gYXdhaXQgcmVwb3Muc3RhdGlvbnMuZ2V0QnlOYW1lKG5hbWUpXG4gIGlmIChleGlzdGluZ0J5TmFtZSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnU1RBVElPTl9OQU1FX1RBS0VOJyB9LCB7IHN0YXR1czogNDA5IH0pXG4gIH1cblxuICBjb25zdCBpZFJlc3VsdCA9IGF3YWl0IGdlbmVyYXRlQXZhaWxhYmxlU3RhdGlvbklkKG5hbWUpXG4gIGlmICh0eXBlb2YgaWRSZXN1bHQgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGlkUmVzdWx0LmVycm9yIH0sIHsgc3RhdHVzOiA0MDkgfSlcbiAgfVxuXG4gIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCByZXBvcy5yZWNlaXB0cy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkOiAnc3lzdGVtJyxcbiAgICBraW5kOiAnbWFudWFsJyxcbiAgICBjb21tYW5kTmFtZTogJ3N0YXRpb24uY3JlYXRlJyxcbiAgICBjb21tYW5kQXJnczogeyBuYW1lLCBpY29uLCBkZXNjcmlwdGlvbiwgY29sb3IsIHNvcnRPcmRlciwgc3RhdGlvbklkOiBpZFJlc3VsdCB9LFxuICB9KVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuYXBwZW5kKHJlY2VpcHQuaWQsIHsgc3RyZWFtOiAnc3Rkb3V0JywgY2h1bms6IGBDcmVhdGluZyBzdGF0aW9uIFwiJHtuYW1lfVwiLi4uXFxuYCB9KVxuXG4gICAgY29uc3Qgc3RhdGlvbiA9IGF3YWl0IHJlcG9zLnN0YXRpb25zLmNyZWF0ZSh7XG4gICAgICBpZDogaWRSZXN1bHQsXG4gICAgICBuYW1lLFxuICAgICAgaWNvbixcbiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgY29sb3I6IGNvbG9yID8/IG51bGwsXG4gICAgICBzb3J0T3JkZXI6IHNvcnRPcmRlciA/PyAwLFxuICAgIH0pXG5cbiAgICBhd2FpdCByZXBvcy5yZWNlaXB0cy5maW5hbGl6ZShyZWNlaXB0LmlkLCB7XG4gICAgICBleGl0Q29kZTogMCxcbiAgICAgIGR1cmF0aW9uTXM6IDAsXG4gICAgICBwYXJzZWRKc29uOiB7IHN0YXRpb24gfSxcbiAgICB9KVxuXG4gICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgdHlwZTogJ3N0YXRpb24uY3JlYXRlZCcsXG4gICAgICBhY3RvcjogJ3VzZXInLFxuICAgICAgZW50aXR5VHlwZTogJ3N0YXRpb24nLFxuICAgICAgZW50aXR5SWQ6IHN0YXRpb24uaWQsXG4gICAgICBzdW1tYXJ5OiBgQ3JlYXRlZCBzdGF0aW9uOiAke3N0YXRpb24ubmFtZX1gLFxuICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgcmVjZWlwdElkOiByZWNlaXB0LmlkLFxuICAgICAgICBiZWZvcmU6IG51bGwsXG4gICAgICAgIGFmdGVyOiBzdGF0aW9uLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGF0YTogc3RhdGlvbiwgcmVjZWlwdElkOiByZWNlaXB0LmlkIH0sIHsgc3RhdHVzOiAyMDEgfSlcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBzdGF0aW9uJ1xuICAgIGF3YWl0IHJlcG9zLnJlY2VpcHRzLmFwcGVuZChyZWNlaXB0LmlkLCB7IHN0cmVhbTogJ3N0ZGVycicsIGNodW5rOiBgRXJyb3I6ICR7bWVzc2FnZX1cXG5gIH0pXG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuZmluYWxpemUocmVjZWlwdC5pZCwge1xuICAgICAgZXhpdENvZGU6IDEsXG4gICAgICBkdXJhdGlvbk1zOiAwLFxuICAgICAgcGFyc2VkSnNvbjogeyBlcnJvcjogbWVzc2FnZSB9LFxuICAgIH0pXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdDUkVBVEVfRkFJTEVEJywgbWVzc2FnZSwgcmVjZWlwdElkOiByZWNlaXB0LmlkIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0UmVwb3MiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiU1RBVElPTl9JQ09OX1NFVCIsIm5vcm1hbGl6ZU5hbWUiLCJuYW1lIiwidHJpbW1lZCIsInRyaW0iLCJsZW5ndGgiLCJub3JtYWxpemVPcHRpb25hbFN0cmluZyIsInZhbHVlIiwidW5kZWZpbmVkIiwibm9ybWFsaXplQ29sb3IiLCJub3JtYWxpemVkIiwiaGV4Iiwic3RhcnRzV2l0aCIsInRlc3QiLCJzbHVnaWZ5U3RhdGlvbklkIiwiYmFzZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsImZhbGxiYWNrIiwidHJ1bmNhdGVkIiwic2xpY2UiLCJnZW5lcmF0ZUF2YWlsYWJsZVN0YXRpb25JZCIsInJlcG9zIiwiZXhpc3RpbmdCYXNlIiwic3RhdGlvbnMiLCJnZXRCeUlkIiwiaSIsInN1ZmZpeCIsIm1heEJhc2VMZW4iLCJwcmVmaXgiLCJjYW5kaWRhdGUiLCJleGlzdGluZyIsImVycm9yIiwiR0VUIiwibGlzdCIsImpzb24iLCJkYXRhIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwiY2F0Y2giLCJ0eXBlZENvbmZpcm1UZXh0IiwiZW5mb3JjZW1lbnQiLCJhY3Rpb25LaW5kIiwiYWxsb3dlZCIsImVycm9yVHlwZSIsInBvbGljeSIsInN0YXR1cyIsImljb24iLCJoYXMiLCJkZXNjcmlwdGlvbiIsImNvbG9yIiwic29ydE9yZGVyUmF3Iiwic29ydE9yZGVyIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJpc0ludGVnZXIiLCJleGlzdGluZ0J5TmFtZSIsImdldEJ5TmFtZSIsImlkUmVzdWx0IiwicmVjZWlwdCIsInJlY2VpcHRzIiwiY3JlYXRlIiwid29ya09yZGVySWQiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJncyIsInN0YXRpb25JZCIsImFwcGVuZCIsImlkIiwic3RyZWFtIiwiY2h1bmsiLCJzdGF0aW9uIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwiYWN0aXZpdGllcyIsInR5cGUiLCJhY3RvciIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJwYXlsb2FkSnNvbiIsInJlY2VpcHRJZCIsImJlZm9yZSIsImFmdGVyIiwiZXJyIiwibWVzc2FnZSIsIkVycm9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/stations/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:230:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:494:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:219:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   PATCH: () => (/* binding */ PATCH)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/with-governor */ \"(rsc)/./lib/with-governor.ts\");\n/* harmony import */ var _lib_stations_icon_map__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/stations/icon-map */ \"(rsc)/./lib/stations/icon-map.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nfunction normalizeOptionalString(value) {\n    if (value === undefined) return undefined;\n    if (value === null) return null;\n    if (typeof value !== 'string') return undefined;\n    const trimmed = value.trim();\n    return trimmed.length === 0 ? null : trimmed;\n}\nfunction normalizeName(value) {\n    const normalized = normalizeOptionalString(value);\n    if (normalized === undefined) return undefined;\n    if (normalized === null) return null;\n    return normalized;\n}\nfunction normalizeColor(value) {\n    const normalized = normalizeOptionalString(value);\n    if (normalized === undefined) return undefined;\n    if (normalized === null) return null;\n    const hex = normalized.startsWith('#') ? normalized : `#${normalized}`;\n    if (!/^#[0-9a-fA-F]{6}$/.test(hex)) return undefined;\n    return hex;\n}\nasync function PATCH(request, context) {\n    const { id } = await context.params;\n    const body = await request.json().catch(()=>({}));\n    const typedConfirmText = typeof body?.typedConfirmText === 'string' ? body.typedConfirmText : undefined;\n    const enforcement = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_2__.enforceTypedConfirm)({\n        actionKind: 'station.update',\n        typedConfirmText\n    });\n    if (!enforcement.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: enforcement.errorType,\n            policy: enforcement.policy\n        }, {\n            status: enforcement.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    const iconRaw = body?.icon;\n    if (iconRaw !== undefined && (typeof iconRaw !== 'string' || !_lib_stations_icon_map__WEBPACK_IMPORTED_MODULE_3__.STATION_ICON_SET.has(iconRaw))) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_ICON'\n        }, {\n            status: 400\n        });\n    }\n    const name = normalizeName(body?.name);\n    if (name === null) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'NAME_REQUIRED'\n        }, {\n            status: 400\n        });\n    }\n    const description = normalizeOptionalString(body?.description);\n    const color = normalizeColor(body?.color);\n    if (color === undefined && body?.color !== undefined) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_COLOR'\n        }, {\n            status: 400\n        });\n    }\n    const sortOrderRaw = body?.sortOrder;\n    const sortOrder = sortOrderRaw === undefined ? undefined : Number(sortOrderRaw);\n    if (sortOrderRaw !== undefined && (!Number.isFinite(sortOrder) || !Number.isInteger(sortOrder))) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'INVALID_SORT_ORDER'\n        }, {\n            status: 400\n        });\n    }\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const before = await repos.stations.getById(id);\n    if (!before) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'NOT_FOUND'\n        }, {\n            status: 404\n        });\n    }\n    if (typeof name === 'string' && name !== before.name) {\n        const existingByName = await repos.stations.getByName(name);\n        if (existingByName && existingByName.id !== id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'STATION_NAME_TAKEN'\n            }, {\n                status: 409\n            });\n        }\n    }\n    const receipt = await repos.receipts.create({\n        workOrderId: 'system',\n        kind: 'manual',\n        commandName: 'station.update',\n        commandArgs: {\n            stationId: id,\n            patch: {\n                name,\n                icon: iconRaw,\n                description,\n                color,\n                sortOrder\n            }\n        }\n    });\n    try {\n        await repos.receipts.append(receipt.id, {\n            stream: 'stdout',\n            chunk: `Updating station \"${id}\"...\\n`\n        });\n        const updated = await repos.stations.update(id, {\n            ...typeof name === 'string' ? {\n                name\n            } : {},\n            ...typeof iconRaw === 'string' ? {\n                icon: iconRaw\n            } : {},\n            ...description !== undefined ? {\n                description\n            } : {},\n            ...color !== undefined ? {\n                color\n            } : {},\n            ...sortOrder !== undefined ? {\n                sortOrder\n            } : {}\n        });\n        if (!updated) {\n            await repos.receipts.finalize(receipt.id, {\n                exitCode: 1,\n                durationMs: 0,\n                parsedJson: {\n                    error: 'NOT_FOUND'\n                }\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'NOT_FOUND'\n            }, {\n                status: 404\n            });\n        }\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 0,\n            durationMs: 0,\n            parsedJson: {\n                station: updated\n            }\n        });\n        await repos.activities.create({\n            type: 'station.updated',\n            actor: 'user',\n            entityType: 'station',\n            entityId: updated.id,\n            summary: `Updated station: ${updated.name}`,\n            payloadJson: {\n                receiptId: receipt.id,\n                before,\n                after: updated\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: updated,\n            receiptId: receipt.id\n        });\n    } catch (err) {\n        const message = err instanceof Error ? err.message : 'Failed to update station';\n        await repos.receipts.append(receipt.id, {\n            stream: 'stderr',\n            chunk: `Error: ${message}\\n`\n        });\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 1,\n            durationMs: 0,\n            parsedJson: {\n                error: message\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'UPDATE_FAILED',\n            message,\n            receiptId: receipt.id\n        }, {\n            status: 500\n        });\n    }\n}\nasync function DELETE(request, context) {\n    const { id } = await context.params;\n    const body = await request.json().catch(()=>({}));\n    const typedConfirmText = typeof body?.typedConfirmText === 'string' ? body.typedConfirmText : undefined;\n    const enforcement = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_2__.enforceTypedConfirm)({\n        actionKind: 'station.delete',\n        typedConfirmText\n    });\n    if (!enforcement.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: enforcement.errorType,\n            policy: enforcement.policy\n        }, {\n            status: enforcement.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const existing = await repos.stations.getById(id);\n    if (!existing) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'NOT_FOUND'\n        }, {\n            status: 404\n        });\n    }\n    const assignedAgents = await repos.agents.list({\n        station: id\n    });\n    if (assignedAgents.length > 0) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'STATION_IN_USE',\n            details: {\n                agentCount: assignedAgents.length\n            }\n        }, {\n            status: 409\n        });\n    }\n    const receipt = await repos.receipts.create({\n        workOrderId: 'system',\n        kind: 'manual',\n        commandName: 'station.delete',\n        commandArgs: {\n            stationId: id\n        }\n    });\n    try {\n        await repos.receipts.append(receipt.id, {\n            stream: 'stdout',\n            chunk: `Deleting station \"${id}\"...\\n`\n        });\n        const ok = await repos.stations.delete(id);\n        if (!ok) {\n            await repos.receipts.finalize(receipt.id, {\n                exitCode: 1,\n                durationMs: 0,\n                parsedJson: {\n                    error: 'NOT_FOUND'\n                }\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'NOT_FOUND'\n            }, {\n                status: 404\n            });\n        }\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 0,\n            durationMs: 0,\n            parsedJson: {\n                deleted: true,\n                stationId: id\n            }\n        });\n        await repos.activities.create({\n            type: 'station.deleted',\n            actor: 'user',\n            entityType: 'station',\n            entityId: id,\n            summary: `Deleted station: ${existing.name}`,\n            payloadJson: {\n                receiptId: receipt.id,\n                before: existing,\n                after: null\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            receiptId: receipt.id\n        });\n    } catch (err) {\n        const message = err instanceof Error ? err.message : 'Failed to delete station';\n        await repos.receipts.append(receipt.id, {\n            stream: 'stderr',\n            chunk: `Error: ${message}\\n`\n        });\n        await repos.receipts.finalize(receipt.id, {\n            exitCode: 1,\n            durationMs: 0,\n            parsedJson: {\n                error: message\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'DELETE_FAILED',\n            message,\n            receiptId: receipt.id\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UTlCLEVBQUUsRUFBRTtZQUN4QzZDLFVBQVU7WUFDVkMsWUFBWTtZQUNaQyxZQUFZO2dCQUFFd0IsU0FBUztnQkFBTWxDLFdBQVdyQztZQUFHO1FBQzdDO1FBRUEsTUFBTXdCLE1BQU15QixVQUFVLENBQUNqQixNQUFNLENBQUM7WUFDNUJrQixNQUFNO1lBQ05DLE9BQU87WUFDUEMsWUFBWTtZQUNaQyxVQUFVckQ7WUFDVnNELFNBQVMsQ0FBQyxpQkFBaUIsRUFBRVMsU0FBUy9DLElBQUksRUFBRTtZQUM1Q3VDLGFBQWE7Z0JBQ1hDLFdBQVcxQixRQUFROUIsRUFBRTtnQkFDckJ5QixRQUFRc0M7Z0JBQ1JOLE9BQU87WUFDVDtRQUNGO1FBRUEsT0FBTzVFLHFEQUFZQSxDQUFDc0IsSUFBSSxDQUFDO1lBQUVrRSxJQUFJO1lBQU1iLFdBQVcxQixRQUFROUIsRUFBRTtRQUFDO0lBQzdELEVBQUUsT0FBTzJELEtBQUs7UUFDWixNQUFNQyxVQUFVRCxlQUFlRSxRQUFRRixJQUFJQyxPQUFPLEdBQUc7UUFDckQsTUFBTXBDLE1BQU1PLFFBQVEsQ0FBQ1EsTUFBTSxDQUFDVCxRQUFROUIsRUFBRSxFQUFFO1lBQUV3QyxRQUFRO1lBQVVDLE9BQU8sQ0FBQyxPQUFPLEVBQUVtQixRQUFRLEVBQUUsQ0FBQztRQUFDO1FBQ3pGLE1BQU1wQyxNQUFNTyxRQUFRLENBQUNhLFFBQVEsQ0FBQ2QsUUFBUTlCLEVBQUUsRUFBRTtZQUN4QzZDLFVBQVU7WUFDVkMsWUFBWTtZQUNaQyxZQUFZO2dCQUFFdEMsT0FBT21EO1lBQVE7UUFDL0I7UUFDQSxPQUFPL0UscURBQVlBLENBQUNzQixJQUFJLENBQUM7WUFBRU0sT0FBTztZQUFpQm1EO1lBQVNKLFdBQVcxQixRQUFROUIsRUFBRTtRQUFDLEdBQUc7WUFBRVksUUFBUTtRQUFJO0lBQ3JHO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvYXBwL2FwaS9zdGF0aW9ucy9baWRdL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGdldFJlcG9zIH0gZnJvbSAnQC9saWIvcmVwbydcbmltcG9ydCB7IGVuZm9yY2VUeXBlZENvbmZpcm0gfSBmcm9tICdAL2xpYi93aXRoLWdvdmVybm9yJ1xuaW1wb3J0IHsgU1RBVElPTl9JQ09OX1NFVCB9IGZyb20gJ0AvbGliL3N0YXRpb25zL2ljb24tbWFwJ1xuXG5mdW5jdGlvbiBub3JtYWxpemVPcHRpb25hbFN0cmluZyh2YWx1ZTogdW5rbm93bik6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZFxuICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsXG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSByZXR1cm4gdW5kZWZpbmVkXG4gIGNvbnN0IHRyaW1tZWQgPSB2YWx1ZS50cmltKClcbiAgcmV0dXJuIHRyaW1tZWQubGVuZ3RoID09PSAwID8gbnVsbCA6IHRyaW1tZWRcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplTmFtZSh2YWx1ZTogdW5rbm93bik6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQge1xuICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplT3B0aW9uYWxTdHJpbmcodmFsdWUpXG4gIGlmIChub3JtYWxpemVkID09PSB1bmRlZmluZWQpIHJldHVybiB1bmRlZmluZWRcbiAgaWYgKG5vcm1hbGl6ZWQgPT09IG51bGwpIHJldHVybiBudWxsXG4gIHJldHVybiBub3JtYWxpemVkXG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUNvbG9yKHZhbHVlOiB1bmtub3duKTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVPcHRpb25hbFN0cmluZyh2YWx1ZSlcbiAgaWYgKG5vcm1hbGl6ZWQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZFxuICBpZiAobm9ybWFsaXplZCA9PT0gbnVsbCkgcmV0dXJuIG51bGxcbiAgY29uc3QgaGV4ID0gbm9ybWFsaXplZC5zdGFydHNXaXRoKCcjJykgPyBub3JtYWxpemVkIDogYCMke25vcm1hbGl6ZWR9YFxuICBpZiAoIS9eI1swLTlhLWZBLUZdezZ9JC8udGVzdChoZXgpKSByZXR1cm4gdW5kZWZpbmVkXG4gIHJldHVybiBoZXhcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBBVENIKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCxcbiAgY29udGV4dDogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH1cbikge1xuICBjb25zdCB7IGlkIH0gPSBhd2FpdCBjb250ZXh0LnBhcmFtc1xuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSlcbiAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5Py50eXBlZENvbmZpcm1UZXh0ID09PSAnc3RyaW5nJyA/IGJvZHkudHlwZWRDb25maXJtVGV4dCA6IHVuZGVmaW5lZFxuXG4gIGNvbnN0IGVuZm9yY2VtZW50ID0gYXdhaXQgZW5mb3JjZVR5cGVkQ29uZmlybSh7XG4gICAgYWN0aW9uS2luZDogJ3N0YXRpb24udXBkYXRlJyxcbiAgICB0eXBlZENvbmZpcm1UZXh0LFxuICB9KVxuICBpZiAoIWVuZm9yY2VtZW50LmFsbG93ZWQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBlbmZvcmNlbWVudC5lcnJvclR5cGUsIHBvbGljeTogZW5mb3JjZW1lbnQucG9saWN5IH0sXG4gICAgICB7IHN0YXR1czogZW5mb3JjZW1lbnQuZXJyb3JUeXBlID09PSAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcgPyA0MjggOiA0MDMgfVxuICAgIClcbiAgfVxuXG4gIGNvbnN0IGljb25SYXcgPSBib2R5Py5pY29uXG4gIGlmIChpY29uUmF3ICE9PSB1bmRlZmluZWQgJiYgKHR5cGVvZiBpY29uUmF3ICE9PSAnc3RyaW5nJyB8fCAhU1RBVElPTl9JQ09OX1NFVC5oYXMoaWNvblJhdykpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJTlZBTElEX0lDT04nIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgfVxuXG4gIGNvbnN0IG5hbWUgPSBub3JtYWxpemVOYW1lKGJvZHk/Lm5hbWUpXG4gIGlmIChuYW1lID09PSBudWxsKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOQU1FX1JFUVVJUkVEJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cblxuICBjb25zdCBkZXNjcmlwdGlvbiA9IG5vcm1hbGl6ZU9wdGlvbmFsU3RyaW5nKGJvZHk/LmRlc2NyaXB0aW9uKVxuICBjb25zdCBjb2xvciA9IG5vcm1hbGl6ZUNvbG9yKGJvZHk/LmNvbG9yKVxuICBpZiAoY29sb3IgPT09IHVuZGVmaW5lZCAmJiBib2R5Py5jb2xvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJTlZBTElEX0NPTE9SJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cblxuICBjb25zdCBzb3J0T3JkZXJSYXcgPSBib2R5Py5zb3J0T3JkZXJcbiAgY29uc3Qgc29ydE9yZGVyID0gc29ydE9yZGVyUmF3ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBOdW1iZXIoc29ydE9yZGVyUmF3KVxuICBpZiAoc29ydE9yZGVyUmF3ICE9PSB1bmRlZmluZWQgJiYgKCFOdW1iZXIuaXNGaW5pdGUoc29ydE9yZGVyKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihzb3J0T3JkZXIpKSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSU5WQUxJRF9TT1JUX09SREVSJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cblxuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgY29uc3QgYmVmb3JlID0gYXdhaXQgcmVwb3Muc3RhdGlvbnMuZ2V0QnlJZChpZClcbiAgaWYgKCFiZWZvcmUpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05PVF9GT1VORCcgfSwgeyBzdGF0dXM6IDQwNCB9KVxuICB9XG5cbiAgaWYgKHR5cGVvZiBuYW1lID09PSAnc3RyaW5nJyAmJiBuYW1lICE9PSBiZWZvcmUubmFtZSkge1xuICAgIGNvbnN0IGV4aXN0aW5nQnlOYW1lID0gYXdhaXQgcmVwb3Muc3RhdGlvbnMuZ2V0QnlOYW1lKG5hbWUpXG4gICAgaWYgKGV4aXN0aW5nQnlOYW1lICYmIGV4aXN0aW5nQnlOYW1lLmlkICE9PSBpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdTVEFUSU9OX05BTUVfVEFLRU4nIH0sIHsgc3RhdHVzOiA0MDkgfSlcbiAgICB9XG4gIH1cblxuICBjb25zdCByZWNlaXB0ID0gYXdhaXQgcmVwb3MucmVjZWlwdHMuY3JlYXRlKHtcbiAgICB3b3JrT3JkZXJJZDogJ3N5c3RlbScsXG4gICAga2luZDogJ21hbnVhbCcsXG4gICAgY29tbWFuZE5hbWU6ICdzdGF0aW9uLnVwZGF0ZScsXG4gICAgY29tbWFuZEFyZ3M6IHsgc3RhdGlvbklkOiBpZCwgcGF0Y2g6IHsgbmFtZSwgaWNvbjogaWNvblJhdywgZGVzY3JpcHRpb24sIGNvbG9yLCBzb3J0T3JkZXIgfSB9LFxuICB9KVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuYXBwZW5kKHJlY2VpcHQuaWQsIHsgc3RyZWFtOiAnc3Rkb3V0JywgY2h1bms6IGBVcGRhdGluZyBzdGF0aW9uIFwiJHtpZH1cIi4uLlxcbmAgfSlcblxuICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCByZXBvcy5zdGF0aW9ucy51cGRhdGUoaWQsIHtcbiAgICAgIC4uLih0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycgPyB7IG5hbWUgfSA6IHt9KSxcbiAgICAgIC4uLih0eXBlb2YgaWNvblJhdyA9PT0gJ3N0cmluZycgPyB7IGljb246IGljb25SYXcgfSA6IHt9KSxcbiAgICAgIC4uLihkZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkID8geyBkZXNjcmlwdGlvbiB9IDoge30pLFxuICAgICAgLi4uKGNvbG9yICE9PSB1bmRlZmluZWQgPyB7IGNvbG9yIH0gOiB7fSksXG4gICAgICAuLi4oc29ydE9yZGVyICE9PSB1bmRlZmluZWQgPyB7IHNvcnRPcmRlciB9IDoge30pLFxuICAgIH0pXG5cbiAgICBpZiAoIXVwZGF0ZWQpIHtcbiAgICAgIGF3YWl0IHJlcG9zLnJlY2VpcHRzLmZpbmFsaXplKHJlY2VpcHQuaWQsIHsgZXhpdENvZGU6IDEsIGR1cmF0aW9uTXM6IDAsIHBhcnNlZEpzb246IHsgZXJyb3I6ICdOT1RfRk9VTkQnIH0gfSlcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTk9UX0ZPVU5EJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgfVxuXG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuZmluYWxpemUocmVjZWlwdC5pZCwge1xuICAgICAgZXhpdENvZGU6IDAsXG4gICAgICBkdXJhdGlvbk1zOiAwLFxuICAgICAgcGFyc2VkSnNvbjogeyBzdGF0aW9uOiB1cGRhdGVkIH0sXG4gICAgfSlcblxuICAgIGF3YWl0IHJlcG9zLmFjdGl2aXRpZXMuY3JlYXRlKHtcbiAgICAgIHR5cGU6ICdzdGF0aW9uLnVwZGF0ZWQnLFxuICAgICAgYWN0b3I6ICd1c2VyJyxcbiAgICAgIGVudGl0eVR5cGU6ICdzdGF0aW9uJyxcbiAgICAgIGVudGl0eUlkOiB1cGRhdGVkLmlkLFxuICAgICAgc3VtbWFyeTogYFVwZGF0ZWQgc3RhdGlvbjogJHt1cGRhdGVkLm5hbWV9YCxcbiAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgIHJlY2VpcHRJZDogcmVjZWlwdC5pZCxcbiAgICAgICAgYmVmb3JlLFxuICAgICAgICBhZnRlcjogdXBkYXRlZCxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGRhdGE6IHVwZGF0ZWQsIHJlY2VpcHRJZDogcmVjZWlwdC5pZCB9KVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIHN0YXRpb24nXG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuYXBwZW5kKHJlY2VpcHQuaWQsIHsgc3RyZWFtOiAnc3RkZXJyJywgY2h1bms6IGBFcnJvcjogJHttZXNzYWdlfVxcbmAgfSlcbiAgICBhd2FpdCByZXBvcy5yZWNlaXB0cy5maW5hbGl6ZShyZWNlaXB0LmlkLCB7XG4gICAgICBleGl0Q29kZTogMSxcbiAgICAgIGR1cmF0aW9uTXM6IDAsXG4gICAgICBwYXJzZWRKc29uOiB7IGVycm9yOiBtZXNzYWdlIH0sXG4gICAgfSlcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VQREFURV9GQUlMRUQnLCBtZXNzYWdlLCByZWNlaXB0SWQ6IHJlY2VpcHQuaWQgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIGNvbnN0IHsgaWQgfSA9IGF3YWl0IGNvbnRleHQucGFyYW1zXG4gIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKVxuICBjb25zdCB0eXBlZENvbmZpcm1UZXh0ID0gdHlwZW9mIGJvZHk/LnR5cGVkQ29uZmlybVRleHQgPT09ICdzdHJpbmcnID8gYm9keS50eXBlZENvbmZpcm1UZXh0IDogdW5kZWZpbmVkXG5cbiAgY29uc3QgZW5mb3JjZW1lbnQgPSBhd2FpdCBlbmZvcmNlVHlwZWRDb25maXJtKHtcbiAgICBhY3Rpb25LaW5kOiAnc3RhdGlvbi5kZWxldGUnLFxuICAgIHR5cGVkQ29uZmlybVRleHQsXG4gIH0pXG4gIGlmICghZW5mb3JjZW1lbnQuYWxsb3dlZCkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IGVuZm9yY2VtZW50LmVycm9yVHlwZSwgcG9saWN5OiBlbmZvcmNlbWVudC5wb2xpY3kgfSxcbiAgICAgIHsgc3RhdHVzOiBlbmZvcmNlbWVudC5lcnJvclR5cGUgPT09ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyA/IDQyOCA6IDQwMyB9XG4gICAgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG4gIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcmVwb3Muc3RhdGlvbnMuZ2V0QnlJZChpZClcbiAgaWYgKCFleGlzdGluZykge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTk9UX0ZPVU5EJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gIH1cblxuICBjb25zdCBhc3NpZ25lZEFnZW50cyA9IGF3YWl0IHJlcG9zLmFnZW50cy5saXN0KHsgc3RhdGlvbjogaWQgfSlcbiAgaWYgKGFzc2lnbmVkQWdlbnRzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnU1RBVElPTl9JTl9VU0UnLCBkZXRhaWxzOiB7IGFnZW50Q291bnQ6IGFzc2lnbmVkQWdlbnRzLmxlbmd0aCB9IH0sXG4gICAgICB7IHN0YXR1czogNDA5IH1cbiAgICApXG4gIH1cblxuICBjb25zdCByZWNlaXB0ID0gYXdhaXQgcmVwb3MucmVjZWlwdHMuY3JlYXRlKHtcbiAgICB3b3JrT3JkZXJJZDogJ3N5c3RlbScsXG4gICAga2luZDogJ21hbnVhbCcsXG4gICAgY29tbWFuZE5hbWU6ICdzdGF0aW9uLmRlbGV0ZScsXG4gICAgY29tbWFuZEFyZ3M6IHsgc3RhdGlvbklkOiBpZCB9LFxuICB9KVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuYXBwZW5kKHJlY2VpcHQuaWQsIHsgc3RyZWFtOiAnc3Rkb3V0JywgY2h1bms6IGBEZWxldGluZyBzdGF0aW9uIFwiJHtpZH1cIi4uLlxcbmAgfSlcblxuICAgIGNvbnN0IG9rID0gYXdhaXQgcmVwb3Muc3RhdGlvbnMuZGVsZXRlKGlkKVxuICAgIGlmICghb2spIHtcbiAgICAgIGF3YWl0IHJlcG9zLnJlY2VpcHRzLmZpbmFsaXplKHJlY2VpcHQuaWQsIHsgZXhpdENvZGU6IDEsIGR1cmF0aW9uTXM6IDAsIHBhcnNlZEpzb246IHsgZXJyb3I6ICdOT1RfRk9VTkQnIH0gfSlcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTk9UX0ZPVU5EJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgfVxuXG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuZmluYWxpemUocmVjZWlwdC5pZCwge1xuICAgICAgZXhpdENvZGU6IDAsXG4gICAgICBkdXJhdGlvbk1zOiAwLFxuICAgICAgcGFyc2VkSnNvbjogeyBkZWxldGVkOiB0cnVlLCBzdGF0aW9uSWQ6IGlkIH0sXG4gICAgfSlcblxuICAgIGF3YWl0IHJlcG9zLmFjdGl2aXRpZXMuY3JlYXRlKHtcbiAgICAgIHR5cGU6ICdzdGF0aW9uLmRlbGV0ZWQnLFxuICAgICAgYWN0b3I6ICd1c2VyJyxcbiAgICAgIGVudGl0eVR5cGU6ICdzdGF0aW9uJyxcbiAgICAgIGVudGl0eUlkOiBpZCxcbiAgICAgIHN1bW1hcnk6IGBEZWxldGVkIHN0YXRpb246ICR7ZXhpc3RpbmcubmFtZX1gLFxuICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgcmVjZWlwdElkOiByZWNlaXB0LmlkLFxuICAgICAgICBiZWZvcmU6IGV4aXN0aW5nLFxuICAgICAgICBhZnRlcjogbnVsbCxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCByZWNlaXB0SWQ6IHJlY2VpcHQuaWQgfSlcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBzdGF0aW9uJ1xuICAgIGF3YWl0IHJlcG9zLnJlY2VpcHRzLmFwcGVuZChyZWNlaXB0LmlkLCB7IHN0cmVhbTogJ3N0ZGVycicsIGNodW5rOiBgRXJyb3I6ICR7bWVzc2FnZX1cXG5gIH0pXG4gICAgYXdhaXQgcmVwb3MucmVjZWlwdHMuZmluYWxpemUocmVjZWlwdC5pZCwge1xuICAgICAgZXhpdENvZGU6IDEsXG4gICAgICBkdXJhdGlvbk1zOiAwLFxuICAgICAgcGFyc2VkSnNvbjogeyBlcnJvcjogbWVzc2FnZSB9LFxuICAgIH0pXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdERUxFVEVfRkFJTEVEJywgbWVzc2FnZSwgcmVjZWlwdElkOiByZWNlaXB0LmlkIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFJlcG9zIiwiZW5mb3JjZVR5cGVkQ29uZmlybSIsIlNUQVRJT05fSUNPTl9TRVQiLCJub3JtYWxpemVPcHRpb25hbFN0cmluZyIsInZhbHVlIiwidW5kZWZpbmVkIiwidHJpbW1lZCIsInRyaW0iLCJsZW5ndGgiLCJub3JtYWxpemVOYW1lIiwibm9ybWFsaXplZCIsIm5vcm1hbGl6ZUNvbG9yIiwiaGV4Iiwic3RhcnRzV2l0aCIsInRlc3QiLCJQQVRDSCIsInJlcXVlc3QiLCJjb250ZXh0IiwiaWQiLCJwYXJhbXMiLCJib2R5IiwianNvbiIsImNhdGNoIiwidHlwZWRDb25maXJtVGV4dCIsImVuZm9yY2VtZW50IiwiYWN0aW9uS2luZCIsImFsbG93ZWQiLCJlcnJvciIsImVycm9yVHlwZSIsInBvbGljeSIsInN0YXR1cyIsImljb25SYXciLCJpY29uIiwiaGFzIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY29sb3IiLCJzb3J0T3JkZXJSYXciLCJzb3J0T3JkZXIiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsImlzSW50ZWdlciIsInJlcG9zIiwiYmVmb3JlIiwic3RhdGlvbnMiLCJnZXRCeUlkIiwiZXhpc3RpbmdCeU5hbWUiLCJnZXRCeU5hbWUiLCJyZWNlaXB0IiwicmVjZWlwdHMiLCJjcmVhdGUiLCJ3b3JrT3JkZXJJZCIsImtpbmQiLCJjb21tYW5kTmFtZSIsImNvbW1hbmRBcmdzIiwic3RhdGlvbklkIiwicGF0Y2giLCJhcHBlbmQiLCJzdHJlYW0iLCJjaHVuayIsInVwZGF0ZWQiLCJ1cGRhdGUiLCJmaW5hbGl6ZSIsImV4aXRDb2RlIiwiZHVyYXRpb25NcyIsInBhcnNlZEpzb24iLCJzdGF0aW9uIiwiYWN0aXZpdGllcyIsInR5cGUiLCJhY3RvciIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJwYXlsb2FkSnNvbiIsInJlY2VpcHRJZCIsImFmdGVyIiwiZGF0YSIsImVyciIsIm1lc3NhZ2UiLCJFcnJvciIsIkRFTEVURSIsImV4aXN0aW5nIiwiYXNzaWduZWRBZ2VudHMiLCJhZ2VudHMiLCJsaXN0IiwiZGV0YWlscyIsImFnZW50Q291bnQiLCJvayIsImRlbGV0ZSIsImRlbGV0ZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/stations/[id]/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:230:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXBwcm92YWwtZ2F0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7OztDQU1DLEdBRWdDO0FBT1A7QUEyQjFCLCtFQUErRTtBQUMvRSxVQUFVO0FBQ1YsK0VBQStFO0FBRS9FOztDQUVDLEdBQ00sU0FBU0UsZ0JBQWdCQyxVQUFzQjtJQUNwRCxPQUFPRiw4REFBZSxDQUFDRSxXQUFXO0FBQ3BDO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxpQkFBaUJELFVBQXNCO0lBQ3JELE1BQU1FLFNBQVNKLDhEQUFlLENBQUNFLFdBQVc7SUFDMUMsT0FBT0UsT0FBT0QsZ0JBQWdCO0FBQ2hDO0FBRUE7O0NBRUMsR0FDTSxTQUFTRSxnQkFBZ0JILFVBQXNCO0lBQ3BELE1BQU1FLFNBQVNKLDhEQUFlLENBQUNFLFdBQVc7SUFDMUMsT0FBT0UsT0FBT0UsWUFBWTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSwwQkFBMEI7QUFDMUIsK0VBQStFO0FBRS9FOzs7OztDQUtDLEdBQ00sZUFBZUMscUJBQ3BCQyxLQUE0QjtJQUU1QixNQUFNLEVBQUVOLFVBQVUsRUFBRU8sV0FBVyxFQUFFQyxXQUFXLEVBQUUsR0FBR0Y7SUFDakQsTUFBTUosU0FBU0osOERBQWUsQ0FBQ0UsV0FBVztJQUUxQyw2Q0FBNkM7SUFDN0MsSUFBSSxDQUFDRSxPQUFPRCxnQkFBZ0IsSUFBSSxDQUFDQyxPQUFPRSxZQUFZLEVBQUU7UUFDcEQsT0FBTztZQUNMSyxTQUFTO1lBQ1RDLFFBQVE7WUFDUlI7UUFDRjtJQUNGO0lBRUEsTUFBTVMsUUFBUWQsK0NBQVFBO0lBRXRCLDhDQUE4QztJQUM5QyxNQUFNZSxZQUFZLE1BQU1ELE1BQU1DLFNBQVMsQ0FBQ0MsSUFBSSxDQUFDO1FBQzNDTjtRQUNBTyxNQUFNWixPQUFPRSxZQUFZO0lBQzNCO0lBRUEsK0RBQStEO0lBQy9ELE1BQU1XLG1CQUFtQkgsVUFBVUksSUFBSSxDQUFDLENBQUNDO1FBQ3ZDLElBQUlULGFBQWE7WUFDZixPQUFPUyxFQUFFVCxXQUFXLEtBQUtBO1FBQzNCO1FBQ0EsMkRBQTJEO1FBQzNELE9BQU9TLEVBQUVULFdBQVcsS0FBSztJQUMzQjtJQUVBLElBQUksQ0FBQ08sa0JBQWtCO1FBQ3JCLE9BQU87WUFDTE4sU0FBUztZQUNUQyxRQUFRO1lBQ1JSO1FBQ0Y7SUFDRjtJQUVBLElBQUlhLGlCQUFpQkcsTUFBTSxLQUFLLFdBQVc7UUFDekMsT0FBTztZQUNMVCxTQUFTO1lBQ1RDLFFBQVE7WUFDUlMsVUFBVUo7WUFDVmI7UUFDRjtJQUNGO0lBRUEsSUFBSWEsaUJBQWlCRyxNQUFNLEtBQUssWUFBWTtRQUMxQyxPQUFPO1lBQ0xULFNBQVM7WUFDVEMsUUFBUTtZQUNSUyxVQUFVSjtZQUNWYjtRQUNGO0lBQ0Y7SUFFQSx1QkFBdUI7SUFDdkIsT0FBTztRQUNMTyxTQUFTO1FBQ1RDLFFBQVE7UUFDUlMsVUFBVUo7UUFDVmI7SUFDRjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sZUFBZWtCLHNCQUNwQmQsS0FBOEI7SUFFOUIsTUFBTSxFQUFFTixVQUFVLEVBQUVPLFdBQVcsRUFBRUMsV0FBVyxFQUFFYSxVQUFVLEVBQUVDLEtBQUssRUFBRSxHQUFHaEI7SUFDcEUsTUFBTUosU0FBU0osOERBQWUsQ0FBQ0UsV0FBVztJQUUxQyxJQUFJLENBQUNFLE9BQU9FLFlBQVksRUFBRTtRQUN4QixNQUFNLElBQUltQixNQUFNLENBQUMsT0FBTyxFQUFFdkIsV0FBVywwQ0FBMEMsQ0FBQztJQUNsRjtJQUVBLE1BQU1XLFFBQVFkLCtDQUFRQTtJQUV0QixvREFBb0Q7SUFDcEQsTUFBTTJCLG9CQUFvQixNQUFNYixNQUFNQyxTQUFTLENBQUNDLElBQUksQ0FBQztRQUNuRE47UUFDQU8sTUFBTVosT0FBT0UsWUFBWTtRQUN6QmMsUUFBUTtJQUNWO0lBRUEsTUFBTU8sa0JBQWtCRCxrQkFBa0JSLElBQUksQ0FDNUMsQ0FBQ0MsSUFBTUEsRUFBRVQsV0FBVyxLQUFNQSxDQUFBQSxlQUFlLElBQUc7SUFHOUMsSUFBSWlCLGlCQUFpQjtRQUNuQixPQUFPO1lBQUVOLFVBQVVNO1lBQWlCQyxTQUFTO1FBQU07SUFDckQ7SUFFQSw4QkFBOEI7SUFDOUIsTUFBTVAsV0FBVyxNQUFNUixNQUFNQyxTQUFTLENBQUNlLE1BQU0sQ0FBQztRQUM1Q3BCO1FBQ0FDLGFBQWFBLGVBQWU7UUFDNUJNLE1BQU1aLE9BQU9FLFlBQVk7UUFDekJpQjtJQUNGO0lBRUEsZUFBZTtJQUNmLE1BQU1WLE1BQU1pQixVQUFVLENBQUNELE1BQU0sQ0FBQztRQUM1QmIsTUFBTTtRQUNOUSxPQUFPQSxTQUFTO1FBQ2hCTyxZQUFZO1FBQ1pDLFVBQVVYLFNBQVNZLEVBQUU7UUFDckJDLFNBQVMsQ0FBQyxvQkFBb0IsRUFBRTlCLE9BQU8rQixXQUFXLEVBQUU7UUFDcERDLGFBQWE7WUFDWGxDO1lBQ0FPO1lBQ0FDO1lBQ0FKLGNBQWNGLE9BQU9FLFlBQVk7WUFDakMrQixXQUFXakMsT0FBT2lDLFNBQVM7UUFDN0I7SUFDRjtJQUVBLE9BQU87UUFBRWhCO1FBQVVPLFNBQVM7SUFBSztBQUNuQztBQUVBOzs7OztDQUtDLEdBQ00sZUFBZVUsbUJBQ3BCOUIsS0FBOEI7SUFFOUIsTUFBTSxFQUFFTixVQUFVLEVBQUVPLFdBQVcsRUFBRUMsV0FBVyxFQUFFYSxVQUFVLEVBQUVDLEtBQUssRUFBRSxHQUFHaEI7SUFFcEUsaUNBQWlDO0lBQ2pDLE1BQU0rQixhQUFhLE1BQU1oQyxxQkFBcUI7UUFDNUNMO1FBQ0FPO1FBQ0FDO0lBQ0Y7SUFFQSx5RUFBeUU7SUFDekUsSUFBSTZCLFdBQVczQixNQUFNLEtBQUssV0FBVztRQUNuQyxPQUFPMkI7SUFDVDtJQUVBLDhCQUE4QjtJQUM5QixNQUFNLEVBQUVsQixRQUFRLEVBQUUsR0FBRyxNQUFNQyxzQkFBc0I7UUFDL0NwQjtRQUNBTztRQUNBQztRQUNBYTtRQUNBQztJQUNGO0lBRUEsT0FBTztRQUNMYixTQUFTO1FBQ1RDLFFBQVE7UUFDUlM7UUFDQWpCLFFBQVFtQyxXQUFXbkMsTUFBTTtJQUMzQjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:494:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:208:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_repo__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n/**\n * GET /api/work-orders\n *\n * List work orders with optional filters\n */ async function GET(request) {\n    const searchParams = request.nextUrl.searchParams;\n    const filters = {};\n    // State filter (can be comma-separated)\n    const state = searchParams.get('state');\n    if (state) {\n        filters.state = state.includes(',') ? state.split(',') : state;\n    }\n    // Priority filter (can be comma-separated)\n    const priority = searchParams.get('priority');\n    if (priority) {\n        filters.priority = priority.includes(',') ? priority.split(',') : priority;\n    }\n    // Owner filter\n    const owner = searchParams.get('owner');\n    if (owner) {\n        filters.owner = owner;\n    }\n    // Limit (for cursor pagination)\n    const limitStr = searchParams.get('limit');\n    const limit = limitStr ? parseInt(limitStr, 10) : 50;\n    try {\n        const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n        let data = await repos.workOrders.listWithOps(filters);\n        // Apply limit\n        const hasMore = data.length > limit;\n        data = data.slice(0, limit);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data,\n            meta: {\n                hasMore,\n                total: data.length\n            }\n        });\n    } catch (error) {\n        console.error('[api/work-orders] GET error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to fetch work orders'\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * POST /api/work-orders\n *\n * Create a new work order\n *\n * Security: All work order creation is logged to the activity stream\n * for audit trail purposes.\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { title, goalMd, priority = 'P2', owner = 'user' } = body;\n        if (!title || !goalMd) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing required fields: title, goalMd'\n            }, {\n                status: 400\n            });\n        }\n        const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n        const data = await repos.workOrders.create({\n            title,\n            goalMd,\n            priority,\n            owner\n        });\n        // Log work order creation for audit trail (P0 Security Fix)\n        await repos.activities.create({\n            type: 'work_order.created',\n            actor: owner === 'clawcontrolceo' ? 'agent:clawcontrolceo' : 'user',\n            entityType: 'work_order',\n            entityId: data.id,\n            summary: `Work order ${data.code} created: ${title}`,\n            payloadJson: {\n                code: data.code,\n                title,\n                priority,\n                owner,\n                state: data.state\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error('[api/work-orders] POST error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to create work order'\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE9BQU9GLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBTzFCLHFEQUFZQSxDQUFDdUIsSUFBSSxDQUN0QjtZQUFFRyxPQUFPO1FBQThCLEdBQ3ZDO1lBQUVFLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2FwcC9hcGkvd29yay1vcmRlcnMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICdAL2xpYi9yZXBvJ1xuaW1wb3J0IHR5cGUgeyBXb3JrT3JkZXJGaWx0ZXJzIH0gZnJvbSAnQC9saWIvcmVwbydcblxuLyoqXG4gKiBHRVQgL2FwaS93b3JrLW9yZGVyc1xuICpcbiAqIExpc3Qgd29yayBvcmRlcnMgd2l0aCBvcHRpb25hbCBmaWx0ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3Qgc2VhcmNoUGFyYW1zID0gcmVxdWVzdC5uZXh0VXJsLnNlYXJjaFBhcmFtc1xuXG4gIGNvbnN0IGZpbHRlcnM6IFdvcmtPcmRlckZpbHRlcnMgPSB7fVxuXG4gIC8vIFN0YXRlIGZpbHRlciAoY2FuIGJlIGNvbW1hLXNlcGFyYXRlZClcbiAgY29uc3Qgc3RhdGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0ZScpXG4gIGlmIChzdGF0ZSkge1xuICAgIGZpbHRlcnMuc3RhdGUgPSBzdGF0ZS5pbmNsdWRlcygnLCcpID8gc3RhdGUuc3BsaXQoJywnKSA6IHN0YXRlXG4gIH1cblxuICAvLyBQcmlvcml0eSBmaWx0ZXIgKGNhbiBiZSBjb21tYS1zZXBhcmF0ZWQpXG4gIGNvbnN0IHByaW9yaXR5ID0gc2VhcmNoUGFyYW1zLmdldCgncHJpb3JpdHknKVxuICBpZiAocHJpb3JpdHkpIHtcbiAgICBmaWx0ZXJzLnByaW9yaXR5ID0gcHJpb3JpdHkuaW5jbHVkZXMoJywnKSA/IHByaW9yaXR5LnNwbGl0KCcsJykgOiBwcmlvcml0eVxuICB9XG5cbiAgLy8gT3duZXIgZmlsdGVyXG4gIGNvbnN0IG93bmVyID0gc2VhcmNoUGFyYW1zLmdldCgnb3duZXInKVxuICBpZiAob3duZXIpIHtcbiAgICBmaWx0ZXJzLm93bmVyID0gb3duZXJcbiAgfVxuXG4gIC8vIExpbWl0IChmb3IgY3Vyc29yIHBhZ2luYXRpb24pXG4gIGNvbnN0IGxpbWl0U3RyID0gc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKVxuICBjb25zdCBsaW1pdCA9IGxpbWl0U3RyID8gcGFyc2VJbnQobGltaXRTdHIsIDEwKSA6IDUwXG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICBsZXQgZGF0YSA9IGF3YWl0IHJlcG9zLndvcmtPcmRlcnMubGlzdFdpdGhPcHMoZmlsdGVycylcblxuICAgIC8vIEFwcGx5IGxpbWl0XG4gICAgY29uc3QgaGFzTW9yZSA9IGRhdGEubGVuZ3RoID4gbGltaXRcbiAgICBkYXRhID0gZGF0YS5zbGljZSgwLCBsaW1pdClcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBkYXRhLFxuICAgICAgbWV0YToge1xuICAgICAgICBoYXNNb3JlLFxuICAgICAgICB0b3RhbDogZGF0YS5sZW5ndGgsXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW2FwaS93b3JrLW9yZGVyc10gR0VUIGVycm9yOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggd29yayBvcmRlcnMnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiBQT1NUIC9hcGkvd29yay1vcmRlcnNcbiAqXG4gKiBDcmVhdGUgYSBuZXcgd29yayBvcmRlclxuICpcbiAqIFNlY3VyaXR5OiBBbGwgd29yayBvcmRlciBjcmVhdGlvbiBpcyBsb2dnZWQgdG8gdGhlIGFjdGl2aXR5IHN0cmVhbVxuICogZm9yIGF1ZGl0IHRyYWlsIHB1cnBvc2VzLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuXG4gICAgY29uc3QgeyB0aXRsZSwgZ29hbE1kLCBwcmlvcml0eSA9ICdQMicsIG93bmVyID0gJ3VzZXInIH0gPSBib2R5XG5cbiAgICBpZiAoIXRpdGxlIHx8ICFnb2FsTWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiB0aXRsZSwgZ29hbE1kJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVwb3Mud29ya09yZGVycy5jcmVhdGUoe1xuICAgICAgdGl0bGUsXG4gICAgICBnb2FsTWQsXG4gICAgICBwcmlvcml0eSxcbiAgICAgIG93bmVyLFxuICAgIH0pXG5cbiAgICAvLyBMb2cgd29yayBvcmRlciBjcmVhdGlvbiBmb3IgYXVkaXQgdHJhaWwgKFAwIFNlY3VyaXR5IEZpeClcbiAgICBhd2FpdCByZXBvcy5hY3Rpdml0aWVzLmNyZWF0ZSh7XG4gICAgICB0eXBlOiAnd29ya19vcmRlci5jcmVhdGVkJyxcbiAgICAgIGFjdG9yOiBvd25lciA9PT0gJ2NsYXdjb250cm9sY2VvJyA/ICdhZ2VudDpjbGF3Y29udHJvbGNlbycgOiAndXNlcicsXG4gICAgICBlbnRpdHlUeXBlOiAnd29ya19vcmRlcicsXG4gICAgICBlbnRpdHlJZDogZGF0YS5pZCxcbiAgICAgIHN1bW1hcnk6IGBXb3JrIG9yZGVyICR7ZGF0YS5jb2RlfSBjcmVhdGVkOiAke3RpdGxlfWAsXG4gICAgICBwYXlsb2FkSnNvbjoge1xuICAgICAgICBjb2RlOiBkYXRhLmNvZGUsXG4gICAgICAgIHRpdGxlLFxuICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgb3duZXIsXG4gICAgICAgIHN0YXRlOiBkYXRhLnN0YXRlLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGF0YSB9LCB7IHN0YXR1czogMjAxIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW2FwaS93b3JrLW9yZGVyc10gUE9TVCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSB3b3JrIG9yZGVyJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0UmVwb3MiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwibmV4dFVybCIsImZpbHRlcnMiLCJzdGF0ZSIsImdldCIsImluY2x1ZGVzIiwic3BsaXQiLCJwcmlvcml0eSIsIm93bmVyIiwibGltaXRTdHIiLCJsaW1pdCIsInBhcnNlSW50IiwicmVwb3MiLCJkYXRhIiwid29ya09yZGVycyIsImxpc3RXaXRoT3BzIiwiaGFzTW9yZSIsImxlbmd0aCIsInNsaWNlIiwianNvbiIsIm1ldGEiLCJ0b3RhbCIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyIsIlBPU1QiLCJib2R5IiwidGl0bGUiLCJnb2FsTWQiLCJjcmVhdGUiLCJhY3Rpdml0aWVzIiwidHlwZSIsImFjdG9yIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiaWQiLCJzdW1tYXJ5IiwiY29kZSIsInBheWxvYWRKc29uIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/work-orders/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:230:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:483:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:230:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:483:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:208:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _lib_avatar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/avatar */ \"(rsc)/./lib/avatar.ts\");\n/* harmony import */ var _lib_with_governor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/with-governor */ \"(rsc)/./lib/with-governor.ts\");\n/* harmony import */ var _lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/fs/path-policy */ \"(rsc)/./lib/fs/path-policy.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_3__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_5__]);\n([_lib_repo__WEBPACK_IMPORTED_MODULE_3__, _lib_with_governor__WEBPACK_IMPORTED_MODULE_5__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nconst AVATAR_ACTION = 'agent.edit';\nconst MAX_FILE_SIZE = 2 * 1024 * 1024 // 2MB\n;\nconst _MAX_DIMENSION = 512 // Reserved for future image resizing\n;\nconst AVATARS_DIR = 'agents/avatars';\nfunction getAvatarsRoot() {\n    return (0,node_path__WEBPACK_IMPORTED_MODULE_2__.join)((0,_lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__.getWorkspaceRoot)(), AVATARS_DIR);\n}\n/**\n * GET /api/agents/:id/avatar\n *\n * Return the agent's avatar as SVG (default identicon) or PNG (custom upload).\n */ async function GET(_request, { params }) {\n    const { id } = await params;\n    // Get agent\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.getRepos)();\n    const agent = await repos.agents.getById(id);\n    if (!agent) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Agent not found'\n        }, {\n            status: 404\n        });\n    }\n    // If custom avatar exists, serve it\n    if (agent.avatarPath && !(0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.useMockData)()) {\n        try {\n            const avatarAbs = (0,node_path__WEBPACK_IMPORTED_MODULE_2__.join)((0,_lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__.getWorkspaceRoot)(), agent.avatarPath);\n            const data = await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.readFile(avatarAbs);\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(data, {\n                status: 200,\n                headers: {\n                    'Content-Type': 'image/png',\n                    'Cache-Control': 'public, max-age=3600'\n                }\n            });\n        } catch  {\n        // Fall through to identicon if file not found\n        }\n    }\n    // Generate identicon SVG\n    const svg = (0,_lib_avatar__WEBPACK_IMPORTED_MODULE_4__.generateIdenticonSvg)(agent.name, {\n        size: 128\n    });\n    return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(svg, {\n        status: 200,\n        headers: {\n            'Content-Type': 'image/svg+xml',\n            'Cache-Control': 'public, max-age=3600'\n        }\n    });\n}\n/**\n * POST /api/agents/:id/avatar\n *\n * Upload a custom avatar image. Accepts data URL (base64).\n * Validates size and dimensions, converts to PNG.\n */ async function POST(request, { params }) {\n    const { id } = await params;\n    // Get agent\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.getRepos)();\n    const agent = await repos.agents.getById(id);\n    if (!agent) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Agent not found'\n        }, {\n            status: 404\n        });\n    }\n    const body = await request.json();\n    const { dataUrl, typedConfirmText } = body;\n    if (!dataUrl || !dataUrl.startsWith('data:image/')) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Invalid image data. Must be a data URL.'\n        }, {\n            status: 400\n        });\n    }\n    // Enforce typed confirmation\n    const result = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_5__.enforceTypedConfirm)({\n        actionKind: AVATAR_ACTION,\n        typedConfirmText\n    });\n    if (!result.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: result.errorType,\n            policy: result.policy\n        }, {\n            status: result.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    // Parse the data URL\n    const matches = dataUrl.match(/^data:image\\/(png|jpeg|webp);base64,(.+)$/);\n    if (!matches) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Invalid image format. Must be PNG, JPEG, or WebP.'\n        }, {\n            status: 400\n        });\n    }\n    const base64Data = matches[2];\n    const buffer = Buffer.from(base64Data, 'base64');\n    // Check file size\n    if (buffer.length > MAX_FILE_SIZE) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: `Image too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB.`\n        }, {\n            status: 400\n        });\n    }\n    if ((0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.useMockData)()) {\n        // In mock mode, just return success without writing\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: {\n                avatarPath: `${AVATARS_DIR}/${agent.id}.png`,\n                message: 'Avatar uploaded (mock mode)'\n            }\n        });\n    }\n    try {\n        // Ensure avatars directory exists\n        const avatarsRoot = getAvatarsRoot();\n        await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.mkdir(avatarsRoot, {\n            recursive: true\n        });\n        // Write the file as PNG\n        const avatarPath = `${AVATARS_DIR}/${agent.id}.png`;\n        const avatarAbs = (0,node_path__WEBPACK_IMPORTED_MODULE_2__.join)((0,_lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__.getWorkspaceRoot)(), avatarPath);\n        // Validate the path\n        (0,_lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__.validateWorkspacePath)(avatarAbs);\n        // Write file directly (we accept any valid image format)\n        await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.writeFile(avatarAbs, buffer);\n        // Update agent record\n        await repos.agents.update(id, {\n            avatarPath\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: {\n                avatarPath,\n                message: 'Avatar uploaded successfully'\n            }\n        });\n    } catch (err) {\n        const msg = err instanceof Error ? err.message : 'Failed to upload avatar';\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: msg\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * DELETE /api/agents/:id/avatar\n *\n * Reset avatar to default identicon.\n */ async function DELETE(request, { params }) {\n    const { id } = await params;\n    // Get agent\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.getRepos)();\n    const agent = await repos.agents.getById(id);\n    if (!agent) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Agent not found'\n        }, {\n            status: 404\n        });\n    }\n    const body = await request.json().catch(()=>({}));\n    const { typedConfirmText } = body;\n    // Enforce typed confirmation\n    const result = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_5__.enforceTypedConfirm)({\n        actionKind: AVATAR_ACTION,\n        typedConfirmText\n    });\n    if (!result.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: result.errorType,\n            policy: result.policy\n        }, {\n            status: result.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    if ((0,_lib_repo__WEBPACK_IMPORTED_MODULE_3__.useMockData)()) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: {\n                message: 'Avatar reset (mock mode)'\n            }\n        });\n    }\n    try {\n        // Try to delete the file (best effort)\n        if (agent.avatarPath) {\n            const avatarAbs = (0,node_path__WEBPACK_IMPORTED_MODULE_2__.join)((0,_lib_fs_path_policy__WEBPACK_IMPORTED_MODULE_6__.getWorkspaceRoot)(), agent.avatarPath);\n            await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.unlink(avatarAbs).catch(()=>{});\n        }\n        // Clear avatar path in database\n        await repos.agents.update(id, {\n            avatarPath: null\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: {\n                message: 'Avatar reset to default'\n            }\n        });\n    } catch (err) {\n        const msg = err instanceof Error ? err.message : 'Failed to reset avatar';\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: msg\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2FnZW50cy9baWRdL2F2YXRhci9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDZDtBQUNUO0FBQ2tCO0FBQ0M7QUFDTTtBQUNxQjtBQUc5RSxNQUFNVSxnQkFBNEI7QUFDbEMsTUFBTUMsZ0JBQWdCLElBQUksT0FBTyxLQUFLLE1BQU07O0FBQzVDLE1BQU1DLGlCQUFpQixJQUFJLHFDQUFxQzs7QUFDaEUsTUFBTUMsY0FBYztBQUVwQixTQUFTQztJQUNQLE9BQU9YLCtDQUFJQSxDQUFDSyxxRUFBZ0JBLElBQUlLO0FBQ2xDO0FBRUE7Ozs7Q0FJQyxHQUNNLGVBQWVFLElBQ3BCQyxRQUFxQixFQUNyQixFQUFFQyxNQUFNLEVBQXVDO0lBRS9DLE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUcsTUFBTUQ7SUFFckIsWUFBWTtJQUNaLE1BQU1FLFFBQVFmLG1EQUFRQTtJQUN0QixNQUFNZ0IsUUFBUSxNQUFNRCxNQUFNRSxNQUFNLENBQUNDLE9BQU8sQ0FBQ0o7SUFFekMsSUFBSSxDQUFDRSxPQUFPO1FBQ1YsT0FBT3BCLHFEQUFZQSxDQUFDdUIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBa0IsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDdkU7SUFFQSxvQ0FBb0M7SUFDcEMsSUFBSUwsTUFBTU0sVUFBVSxJQUFJLENBQUNyQixzREFBV0EsSUFBSTtRQUN0QyxJQUFJO1lBQ0YsTUFBTXNCLFlBQVl4QiwrQ0FBSUEsQ0FBQ0sscUVBQWdCQSxJQUFJWSxNQUFNTSxVQUFVO1lBQzNELE1BQU1FLE9BQU8sTUFBTTFCLDZDQUFHQSxDQUFDMkIsUUFBUSxDQUFDRjtZQUNoQyxPQUFPLElBQUkzQixxREFBWUEsQ0FBQzRCLE1BQU07Z0JBQzVCSCxRQUFRO2dCQUNSSyxTQUFTO29CQUNQLGdCQUFnQjtvQkFDaEIsaUJBQWlCO2dCQUNuQjtZQUNGO1FBQ0YsRUFBRSxPQUFNO1FBQ04sOENBQThDO1FBQ2hEO0lBQ0Y7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UUosT0FBT0ksTUFBTTtRQUN2QixHQUNBO1lBQUVuQixRQUFRZSxPQUFPRyxTQUFTLEtBQUssMkJBQTJCLE1BQU07UUFBSTtJQUV4RTtJQUVBLElBQUl0QyxzREFBV0EsSUFBSTtRQUNqQixPQUFPTCxxREFBWUEsQ0FBQ3VCLElBQUksQ0FBQztZQUN2QkssTUFBTTtnQkFBRXdCLFNBQVM7WUFBMkI7UUFDOUM7SUFDRjtJQUVBLElBQUk7UUFDRix1Q0FBdUM7UUFDdkMsSUFBSWhDLE1BQU1NLFVBQVUsRUFBRTtZQUNwQixNQUFNQyxZQUFZeEIsK0NBQUlBLENBQUNLLHFFQUFnQkEsSUFBSVksTUFBTU0sVUFBVTtZQUMzRCxNQUFNeEIsNkNBQUdBLENBQUM2RCxNQUFNLENBQUNwQyxXQUFXbUMsS0FBSyxDQUFDLEtBQU87UUFDM0M7UUFFQSxnQ0FBZ0M7UUFDaEMsTUFBTTNDLE1BQU1FLE1BQU0sQ0FBQ29DLE1BQU0sQ0FBQ3ZDLElBQUk7WUFBRVEsWUFBWTtRQUFLO1FBRWpELE9BQU8xQixxREFBWUEsQ0FBQ3VCLElBQUksQ0FBQztZQUN2QkssTUFBTTtnQkFBRXdCLFNBQVM7WUFBMEI7UUFDN0M7SUFDRixFQUFFLE9BQU9NLEtBQUs7UUFDWixNQUFNQyxNQUFNRCxlQUFlRSxRQUFRRixJQUFJTixPQUFPLEdBQUc7UUFDakQsT0FBT3BELHFEQUFZQSxDQUFDdUIsSUFBSSxDQUFDO1lBQUVDLE9BQU9tQztRQUFJLEdBQUc7WUFBRWxDLFFBQVE7UUFBSTtJQUN6RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2FwcC9hcGkvYWdlbnRzL1tpZF0vYXZhdGFyL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IHByb21pc2VzIGFzIGZzcCB9IGZyb20gJ25vZGU6ZnMnXG5pbXBvcnQgeyBqb2luIH0gZnJvbSAnbm9kZTpwYXRoJ1xuaW1wb3J0IHsgZ2V0UmVwb3MsIHVzZU1vY2tEYXRhIH0gZnJvbSAnQC9saWIvcmVwbydcbmltcG9ydCB7IGdlbmVyYXRlSWRlbnRpY29uU3ZnIH0gZnJvbSAnQC9saWIvYXZhdGFyJ1xuaW1wb3J0IHsgZW5mb3JjZVR5cGVkQ29uZmlybSB9IGZyb20gJ0AvbGliL3dpdGgtZ292ZXJub3InXG5pbXBvcnQgeyBnZXRXb3Jrc3BhY2VSb290LCB2YWxpZGF0ZVdvcmtzcGFjZVBhdGggfSBmcm9tICdAL2xpYi9mcy9wYXRoLXBvbGljeSdcbmltcG9ydCB0eXBlIHsgQWN0aW9uS2luZCB9IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuXG5jb25zdCBBVkFUQVJfQUNUSU9OOiBBY3Rpb25LaW5kID0gJ2FnZW50LmVkaXQnXG5jb25zdCBNQVhfRklMRV9TSVpFID0gMiAqIDEwMjQgKiAxMDI0IC8vIDJNQlxuY29uc3QgX01BWF9ESU1FTlNJT04gPSA1MTIgLy8gUmVzZXJ2ZWQgZm9yIGZ1dHVyZSBpbWFnZSByZXNpemluZ1xuY29uc3QgQVZBVEFSU19ESVIgPSAnYWdlbnRzL2F2YXRhcnMnXG5cbmZ1bmN0aW9uIGdldEF2YXRhcnNSb290KCk6IHN0cmluZyB7XG4gIHJldHVybiBqb2luKGdldFdvcmtzcGFjZVJvb3QoKSwgQVZBVEFSU19ESVIpXG59XG5cbi8qKlxuICogR0VUIC9hcGkvYWdlbnRzLzppZC9hdmF0YXJcbiAqXG4gKiBSZXR1cm4gdGhlIGFnZW50J3MgYXZhdGFyIGFzIFNWRyAoZGVmYXVsdCBpZGVudGljb24pIG9yIFBORyAoY3VzdG9tIHVwbG9hZCkuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIF9yZXF1ZXN0OiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH1cbikge1xuICBjb25zdCB7IGlkIH0gPSBhd2FpdCBwYXJhbXNcblxuICAvLyBHZXQgYWdlbnRcbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG4gIGNvbnN0IGFnZW50ID0gYXdhaXQgcmVwb3MuYWdlbnRzLmdldEJ5SWQoaWQpXG5cbiAgaWYgKCFhZ2VudCkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnQWdlbnQgbm90IGZvdW5kJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gIH1cblxuICAvLyBJZiBjdXN0b20gYXZhdGFyIGV4aXN0cywgc2VydmUgaXRcbiAgaWYgKGFnZW50LmF2YXRhclBhdGggJiYgIXVzZU1vY2tEYXRhKCkpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXZhdGFyQWJzID0gam9pbihnZXRXb3Jrc3BhY2VSb290KCksIGFnZW50LmF2YXRhclBhdGgpXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZnNwLnJlYWRGaWxlKGF2YXRhckFicylcbiAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKGRhdGEsIHtcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAncHVibGljLCBtYXgtYWdlPTM2MDAnLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIEZhbGwgdGhyb3VnaCB0byBpZGVudGljb24gaWYgZmlsZSBub3QgZm91bmRcbiAgICB9XG4gIH1cblxuICAvLyBHZW5lcmF0ZSBpZGVudGljb24gU1ZHXG4gIGNvbnN0IHN2ZyA9IGdlbmVyYXRlSWRlbnRpY29uU3ZnKGFnZW50Lm5hbWUsIHsgc2l6ZTogMTI4IH0pXG5cbiAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2Uoc3ZnLCB7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdpbWFnZS9zdmcreG1sJyxcbiAgICAgICdDYWNoZS1Db250cm9sJzogJ3B1YmxpYywgbWF4LWFnZT0zNjAwJyxcbiAgICB9LFxuICB9KVxufVxuXG4vKipcbiAqIFBPU1QgL2FwaS9hZ2VudHMvOmlkL2F2YXRhclxuICpcbiAqIFVwbG9hZCBhIGN1c3RvbSBhdmF0YXIgaW1hZ2UuIEFjY2VwdHMgZGF0YSBVUkwgKGJhc2U2NCkuXG4gKiBWYWxpZGF0ZXMgc2l6ZSBhbmQgZGltZW5zaW9ucywgY29udmVydHMgdG8gUE5HLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgY29uc3QgeyBpZCB9ID0gYXdhaXQgcGFyYW1zXG5cbiAgLy8gR2V0IGFnZW50XG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICBjb25zdCBhZ2VudCA9IGF3YWl0IHJlcG9zLmFnZW50cy5nZXRCeUlkKGlkKVxuXG4gIGlmICghYWdlbnQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0FnZW50IG5vdCBmb3VuZCcgfSwgeyBzdGF0dXM6IDQwNCB9KVxuICB9XG5cbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gIGNvbnN0IHsgZGF0YVVybCwgdHlwZWRDb25maXJtVGV4dCB9ID0gYm9keSBhcyB7XG4gICAgZGF0YVVybDogc3RyaW5nXG4gICAgdHlwZWRDb25maXJtVGV4dD86IHN0cmluZ1xuICB9XG5cbiAgaWYgKCFkYXRhVXJsIHx8ICFkYXRhVXJsLnN0YXJ0c1dpdGgoJ2RhdGE6aW1hZ2UvJykpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW52YWxpZCBpbWFnZSBkYXRhLiBNdXN0IGJlIGEgZGF0YSBVUkwuJyB9LFxuICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgKVxuICB9XG5cbiAgLy8gRW5mb3JjZSB0eXBlZCBjb25maXJtYXRpb25cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZW5mb3JjZVR5cGVkQ29uZmlybSh7XG4gICAgYWN0aW9uS2luZDogQVZBVEFSX0FDVElPTixcbiAgICB0eXBlZENvbmZpcm1UZXh0LFxuICB9KVxuXG4gIGlmICghcmVzdWx0LmFsbG93ZWQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIGVycm9yOiByZXN1bHQuZXJyb3JUeXBlLFxuICAgICAgICBwb2xpY3k6IHJlc3VsdC5wb2xpY3ksXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IHJlc3VsdC5lcnJvclR5cGUgPT09ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyA/IDQyOCA6IDQwMyB9XG4gICAgKVxuICB9XG5cbiAgLy8gUGFyc2UgdGhlIGRhdGEgVVJMXG4gIGNvbnN0IG1hdGNoZXMgPSBkYXRhVXJsLm1hdGNoKC9eZGF0YTppbWFnZVxcLyhwbmd8anBlZ3x3ZWJwKTtiYXNlNjQsKC4rKSQvKVxuICBpZiAoIW1hdGNoZXMpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW52YWxpZCBpbWFnZSBmb3JtYXQuIE11c3QgYmUgUE5HLCBKUEVHLCBvciBXZWJQLicgfSxcbiAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgIClcbiAgfVxuXG4gIGNvbnN0IGJhc2U2NERhdGEgPSBtYXRjaGVzWzJdXG4gIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKVxuXG4gIC8vIENoZWNrIGZpbGUgc2l6ZVxuICBpZiAoYnVmZmVyLmxlbmd0aCA+IE1BWF9GSUxFX1NJWkUpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBgSW1hZ2UgdG9vIGxhcmdlLiBNYXhpbXVtIHNpemUgaXMgJHtNQVhfRklMRV9TSVpFIC8gMTAyNCAvIDEwMjR9TUIuYCB9LFxuICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgKVxuICB9XG5cbiAgaWYgKHVzZU1vY2tEYXRhKCkpIHtcbiAgICAvLyBJbiBtb2NrIG1vZGUsIGp1c3QgcmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCB3cml0aW5nXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgYXZhdGFyUGF0aDogYCR7QVZBVEFSU19ESVJ9LyR7YWdlbnQuaWR9LnBuZ2AsXG4gICAgICAgIG1lc3NhZ2U6ICdBdmF0YXIgdXBsb2FkZWQgKG1vY2sgbW9kZSknLFxuICAgICAgfSxcbiAgICB9KVxuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBFbnN1cmUgYXZhdGFycyBkaXJlY3RvcnkgZXhpc3RzXG4gICAgY29uc3QgYXZhdGFyc1Jvb3QgPSBnZXRBdmF0YXJzUm9vdCgpXG4gICAgYXdhaXQgZnNwLm1rZGlyKGF2YXRhcnNSb290LCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KVxuXG4gICAgLy8gV3JpdGUgdGhlIGZpbGUgYXMgUE5HXG4gICAgY29uc3QgYXZhdGFyUGF0aCA9IGAke0FWQVRBUlNfRElSfS8ke2FnZW50LmlkfS5wbmdgXG4gICAgY29uc3QgYXZhdGFyQWJzID0gam9pbihnZXRXb3Jrc3BhY2VSb290KCksIGF2YXRhclBhdGgpXG5cbiAgICAvLyBWYWxpZGF0ZSB0aGUgcGF0aFxuICAgIHZhbGlkYXRlV29ya3NwYWNlUGF0aChhdmF0YXJBYnMpXG5cbiAgICAvLyBXcml0ZSBmaWxlIGRpcmVjdGx5ICh3ZSBhY2NlcHQgYW55IHZhbGlkIGltYWdlIGZvcm1hdClcbiAgICBhd2FpdCBmc3Aud3JpdGVGaWxlKGF2YXRhckFicywgYnVmZmVyKVxuXG4gICAgLy8gVXBkYXRlIGFnZW50IHJlY29yZFxuICAgIGF3YWl0IHJlcG9zLmFnZW50cy51cGRhdGUoaWQsIHsgYXZhdGFyUGF0aCB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgYXZhdGFyUGF0aCxcbiAgICAgICAgbWVzc2FnZTogJ0F2YXRhciB1cGxvYWRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zdCBtc2cgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgYXZhdGFyJ1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBtc2cgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbi8qKlxuICogREVMRVRFIC9hcGkvYWdlbnRzLzppZC9hdmF0YXJcbiAqXG4gKiBSZXNldCBhdmF0YXIgdG8gZGVmYXVsdCBpZGVudGljb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHBhcmFtc1xuXG4gIC8vIEdldCBhZ2VudFxuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgY29uc3QgYWdlbnQgPSBhd2FpdCByZXBvcy5hZ2VudHMuZ2V0QnlJZChpZClcblxuICBpZiAoIWFnZW50KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdBZ2VudCBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDQgfSlcbiAgfVxuXG4gIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKVxuICBjb25zdCB7IHR5cGVkQ29uZmlybVRleHQgfSA9IGJvZHkgYXMgeyB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nIH1cblxuICAvLyBFbmZvcmNlIHR5cGVkIGNvbmZpcm1hdGlvblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBlbmZvcmNlVHlwZWRDb25maXJtKHtcbiAgICBhY3Rpb25LaW5kOiBBVkFUQVJfQUNUSU9OLFxuICAgIHR5cGVkQ29uZmlybVRleHQsXG4gIH0pXG5cbiAgaWYgKCFyZXN1bHQuYWxsb3dlZCkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvclR5cGUsXG4gICAgICAgIHBvbGljeTogcmVzdWx0LnBvbGljeSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogcmVzdWx0LmVycm9yVHlwZSA9PT0gJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnID8gNDI4IDogNDAzIH1cbiAgICApXG4gIH1cblxuICBpZiAodXNlTW9ja0RhdGEoKSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBkYXRhOiB7IG1lc3NhZ2U6ICdBdmF0YXIgcmVzZXQgKG1vY2sgbW9kZSknIH0sXG4gICAgfSlcbiAgfVxuXG4gIHRyeSB7XG4gICAgLy8gVHJ5IHRvIGRlbGV0ZSB0aGUgZmlsZSAoYmVzdCBlZmZvcnQpXG4gICAgaWYgKGFnZW50LmF2YXRhclBhdGgpIHtcbiAgICAgIGNvbnN0IGF2YXRhckFicyA9IGpvaW4oZ2V0V29ya3NwYWNlUm9vdCgpLCBhZ2VudC5hdmF0YXJQYXRoKVxuICAgICAgYXdhaXQgZnNwLnVubGluayhhdmF0YXJBYnMpLmNhdGNoKCgpID0+IHt9KVxuICAgIH1cblxuICAgIC8vIENsZWFyIGF2YXRhciBwYXRoIGluIGRhdGFiYXNlXG4gICAgYXdhaXQgcmVwb3MuYWdlbnRzLnVwZGF0ZShpZCwgeyBhdmF0YXJQYXRoOiBudWxsIH0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgZGF0YTogeyBtZXNzYWdlOiAnQXZhdGFyIHJlc2V0IHRvIGRlZmF1bHQnIH0sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc3QgbXNnID0gZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICdGYWlsZWQgdG8gcmVzZXQgYXZhdGFyJ1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBtc2cgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwicHJvbWlzZXMiLCJmc3AiLCJqb2luIiwiZ2V0UmVwb3MiLCJ1c2VNb2NrRGF0YSIsImdlbmVyYXRlSWRlbnRpY29uU3ZnIiwiZW5mb3JjZVR5cGVkQ29uZmlybSIsImdldFdvcmtzcGFjZVJvb3QiLCJ2YWxpZGF0ZVdvcmtzcGFjZVBhdGgiLCJBVkFUQVJfQUNUSU9OIiwiTUFYX0ZJTEVfU0laRSIsIl9NQVhfRElNRU5TSU9OIiwiQVZBVEFSU19ESVIiLCJnZXRBdmF0YXJzUm9vdCIsIkdFVCIsIl9yZXF1ZXN0IiwicGFyYW1zIiwiaWQiLCJyZXBvcyIsImFnZW50IiwiYWdlbnRzIiwiZ2V0QnlJZCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImF2YXRhclBhdGgiLCJhdmF0YXJBYnMiLCJkYXRhIiwicmVhZEZpbGUiLCJoZWFkZXJzIiwic3ZnIiwibmFtZSIsInNpemUiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJkYXRhVXJsIiwidHlwZWRDb25maXJtVGV4dCIsInN0YXJ0c1dpdGgiLCJyZXN1bHQiLCJhY3Rpb25LaW5kIiwiYWxsb3dlZCIsImVycm9yVHlwZSIsInBvbGljeSIsIm1hdGNoZXMiLCJtYXRjaCIsImJhc2U2NERhdGEiLCJidWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwibGVuZ3RoIiwibWVzc2FnZSIsImF2YXRhcnNSb290IiwibWtkaXIiLCJyZWN1cnNpdmUiLCJ3cml0ZUZpbGUiLCJ1cGRhdGUiLCJlcnIiLCJtc2ciLCJFcnJvciIsIkRFTEVURSIsImNhdGNoIiwidW5saW5rIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/agents/[id]/avatar/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:219:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:483:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:219:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_repo__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n/**\n * GET /api/operations\n *\n * List operations with optional filters\n */ async function GET(request) {\n    const searchParams = request.nextUrl.searchParams;\n    const filters = {};\n    // Work order filter\n    const workOrderId = searchParams.get('workOrderId');\n    if (workOrderId) {\n        filters.workOrderId = workOrderId;\n    }\n    // Station filter (can be comma-separated)\n    const station = searchParams.get('station');\n    if (station) {\n        filters.station = station.includes(',') ? station.split(',') : station;\n    }\n    // Status filter (can be comma-separated)\n    const status = searchParams.get('status');\n    if (status) {\n        filters.status = status.includes(',') ? status.split(',') : status;\n    }\n    // Limit\n    const limitStr = searchParams.get('limit');\n    const limit = limitStr ? parseInt(limitStr, 10) : 100;\n    try {\n        const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n        let data = await repos.operations.list(filters);\n        // Apply limit\n        data = data.slice(0, limit);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data\n        });\n    } catch (error) {\n        console.error('[api/operations] GET error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to fetch operations'\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * POST /api/operations\n *\n * Create a new operation\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { workOrderId, station, title, notes, dependsOnOperationIds, wipClass } = body;\n        // Validate required fields\n        if (!workOrderId || !station || !title) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing required fields: workOrderId, station, title'\n            }, {\n                status: 400\n            });\n        }\n        const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n        // Verify work order exists\n        const workOrder = await repos.workOrders.getById(workOrderId);\n        if (!workOrder) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order not found'\n            }, {\n                status: 404\n            });\n        }\n        const input = {\n            workOrderId,\n            station,\n            title,\n            notes,\n            dependsOnOperationIds,\n            wipClass\n        };\n        const data = await repos.operations.create(input);\n        // Write activity record\n        await repos.activities.create({\n            type: 'operation.created',\n            actor: 'system',\n            entityType: 'operation',\n            entityId: data.id,\n            summary: `Operation \"${title}\" created for ${workOrder.code}`,\n            payloadJson: {\n                workOrderId,\n                station,\n                title\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error('[api/operations] POST error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to create operation'\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ0Y7UUFFQSxPQUFPMUIscURBQVlBLENBQUNxQixJQUFJLENBQUM7WUFBRUo7UUFBSyxHQUFHO1lBQUVMLFFBQVE7UUFBSTtJQUNuRCxFQUFFLE9BQU9VLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLGdDQUFnQ0E7UUFDOUMsT0FBT3RCLHFEQUFZQSxDQUFDcUIsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQTZCLEdBQ3RDO1lBQUVWLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2FwcC9hcGkvb3BlcmF0aW9ucy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRSZXBvcyB9IGZyb20gJ0AvbGliL3JlcG8nXG5pbXBvcnQgdHlwZSB7IE9wZXJhdGlvbkZpbHRlcnMsIENyZWF0ZU9wZXJhdGlvbklucHV0IH0gZnJvbSAnQC9saWIvcmVwbydcblxuLyoqXG4gKiBHRVQgL2FwaS9vcGVyYXRpb25zXG4gKlxuICogTGlzdCBvcGVyYXRpb25zIHdpdGggb3B0aW9uYWwgZmlsdGVyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXNcblxuICBjb25zdCBmaWx0ZXJzOiBPcGVyYXRpb25GaWx0ZXJzID0ge31cblxuICAvLyBXb3JrIG9yZGVyIGZpbHRlclxuICBjb25zdCB3b3JrT3JkZXJJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3dvcmtPcmRlcklkJylcbiAgaWYgKHdvcmtPcmRlcklkKSB7XG4gICAgZmlsdGVycy53b3JrT3JkZXJJZCA9IHdvcmtPcmRlcklkXG4gIH1cblxuICAvLyBTdGF0aW9uIGZpbHRlciAoY2FuIGJlIGNvbW1hLXNlcGFyYXRlZClcbiAgY29uc3Qgc3RhdGlvbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXRpb24nKVxuICBpZiAoc3RhdGlvbikge1xuICAgIGZpbHRlcnMuc3RhdGlvbiA9IHN0YXRpb24uaW5jbHVkZXMoJywnKSA/IHN0YXRpb24uc3BsaXQoJywnKSA6IHN0YXRpb25cbiAgfVxuXG4gIC8vIFN0YXR1cyBmaWx0ZXIgKGNhbiBiZSBjb21tYS1zZXBhcmF0ZWQpXG4gIGNvbnN0IHN0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpXG4gIGlmIChzdGF0dXMpIHtcbiAgICBmaWx0ZXJzLnN0YXR1cyA9IHN0YXR1cy5pbmNsdWRlcygnLCcpID8gc3RhdHVzLnNwbGl0KCcsJykgOiBzdGF0dXNcbiAgfVxuXG4gIC8vIExpbWl0XG4gIGNvbnN0IGxpbWl0U3RyID0gc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKVxuICBjb25zdCBsaW1pdCA9IGxpbWl0U3RyID8gcGFyc2VJbnQobGltaXRTdHIsIDEwKSA6IDEwMFxuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG4gICAgbGV0IGRhdGEgPSBhd2FpdCByZXBvcy5vcGVyYXRpb25zLmxpc3QoZmlsdGVycylcblxuICAgIC8vIEFwcGx5IGxpbWl0XG4gICAgZGF0YSA9IGRhdGEuc2xpY2UoMCwgbGltaXQpXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBkYXRhIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW2FwaS9vcGVyYXRpb25zXSBHRVQgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBvcGVyYXRpb25zJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbi8qKlxuICogUE9TVCAvYXBpL29wZXJhdGlvbnNcbiAqXG4gKiBDcmVhdGUgYSBuZXcgb3BlcmF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyB3b3JrT3JkZXJJZCwgc3RhdGlvbiwgdGl0bGUsIG5vdGVzLCBkZXBlbmRzT25PcGVyYXRpb25JZHMsIHdpcENsYXNzIH0gPSBib2R5XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIXdvcmtPcmRlcklkIHx8ICFzdGF0aW9uIHx8ICF0aXRsZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZHM6IHdvcmtPcmRlcklkLCBzdGF0aW9uLCB0aXRsZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgICAvLyBWZXJpZnkgd29yayBvcmRlciBleGlzdHNcbiAgICBjb25zdCB3b3JrT3JkZXIgPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgaWYgKCF3b3JrT3JkZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1dvcmsgb3JkZXIgbm90IGZvdW5kJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBpbnB1dDogQ3JlYXRlT3BlcmF0aW9uSW5wdXQgPSB7XG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIHN0YXRpb24sXG4gICAgICB0aXRsZSxcbiAgICAgIG5vdGVzLFxuICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzLFxuICAgICAgd2lwQ2xhc3MsXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcG9zLm9wZXJhdGlvbnMuY3JlYXRlKGlucHV0KVxuXG4gICAgLy8gV3JpdGUgYWN0aXZpdHkgcmVjb3JkXG4gICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgdHlwZTogJ29wZXJhdGlvbi5jcmVhdGVkJyxcbiAgICAgIGFjdG9yOiAnc3lzdGVtJyxcbiAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgZW50aXR5SWQ6IGRhdGEuaWQsXG4gICAgICBzdW1tYXJ5OiBgT3BlcmF0aW9uIFwiJHt0aXRsZX1cIiBjcmVhdGVkIGZvciAke3dvcmtPcmRlci5jb2RlfWAsXG4gICAgICBwYXlsb2FkSnNvbjoge1xuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgc3RhdGlvbixcbiAgICAgICAgdGl0bGUsXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBkYXRhIH0sIHsgc3RhdHVzOiAyMDEgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbYXBpL29wZXJhdGlvbnNdIFBPU1QgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgb3BlcmF0aW9uJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0UmVwb3MiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwibmV4dFVybCIsImZpbHRlcnMiLCJ3b3JrT3JkZXJJZCIsImdldCIsInN0YXRpb24iLCJpbmNsdWRlcyIsInNwbGl0Iiwic3RhdHVzIiwibGltaXRTdHIiLCJsaW1pdCIsInBhcnNlSW50IiwicmVwb3MiLCJkYXRhIiwib3BlcmF0aW9ucyIsImxpc3QiLCJzbGljZSIsImpzb24iLCJlcnJvciIsImNvbnNvbGUiLCJQT1NUIiwiYm9keSIsInRpdGxlIiwibm90ZXMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJ3aXBDbGFzcyIsIndvcmtPcmRlciIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwiaW5wdXQiLCJjcmVhdGUiLCJhY3Rpdml0aWVzIiwidHlwZSIsImFjdG9yIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiaWQiLCJzdW1tYXJ5IiwiY29kZSIsInBheWxvYWRKc29uIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/operations/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:208:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_with_governor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/with-governor */ \"(rsc)/./lib/with-governor.ts\");\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/repo */ \"(rsc)/./lib/repo/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_with_governor__WEBPACK_IMPORTED_MODULE_1__, _lib_repo__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_with_governor__WEBPACK_IMPORTED_MODULE_1__, _lib_repo__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n/**\n * GET /api/skills\n * List all skills (global + agent-scoped)\n */ async function GET(request) {\n    const { searchParams } = new URL(request.url);\n    const scope = searchParams.get('scope');\n    const agentId = searchParams.get('agentId');\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_2__.getRepos)();\n    const skills = await repos.skills.list({\n        scope: scope ?? undefined,\n        agentId: agentId ?? undefined\n    });\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        data: skills\n    });\n}\n/**\n * POST /api/skills\n * Install a new skill (with Governor gating)\n */ async function POST(request) {\n    const body = await request.json();\n    const { name, description, scope, agentId, skillMd, typedConfirmText } = body;\n    // Validate required fields\n    if (!name || typeof name !== 'string') {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Skill name is required'\n        }, {\n            status: 400\n        });\n    }\n    if (!scope || ![\n        'global',\n        'agent'\n    ].includes(scope)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Valid scope (global/agent) is required'\n        }, {\n            status: 400\n        });\n    }\n    if (scope === 'agent' && !agentId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Agent ID is required for agent-scoped skills'\n        }, {\n            status: 400\n        });\n    }\n    // Validate skill name (path safety)\n    const safeNameRegex = /^[a-z0-9][a-z0-9-]*[a-z0-9]$/;\n    if (name.length < 2 || !safeNameRegex.test(name) && !/^[a-z0-9]$/.test(name) || name.includes('..')) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Invalid skill name. Use lowercase letters, numbers, and hyphens only.'\n        }, {\n            status: 400\n        });\n    }\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_2__.getRepos)();\n    // Check for existing skill with same name\n    const existing = await repos.skills.getByName(scope, name, agentId);\n    if (existing) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Skill with this name already exists'\n        }, {\n            status: 409\n        });\n    }\n    // Enforce Governor - skill.install is danger level\n    const ACTION_KIND = 'skill.install';\n    const result = await (0,_lib_with_governor__WEBPACK_IMPORTED_MODULE_1__.enforceTypedConfirm)({\n        actionKind: ACTION_KIND,\n        typedConfirmText\n    });\n    if (!result.allowed) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: result.errorType,\n            policy: result.policy\n        }, {\n            status: result.errorType === 'TYPED_CONFIRM_REQUIRED' ? 428 : 403\n        });\n    }\n    try {\n        // Create new skill via repo\n        const newSkill = await repos.skills.create({\n            name,\n            description: description || '',\n            scope: scope,\n            agentId: scope === 'agent' ? agentId : undefined,\n            skillMd: skillMd || `# ${name}\\n\\nSkill description goes here.`\n        });\n        // Log activity\n        await repos.activities.create({\n            type: 'skill.installed',\n            actor: 'user',\n            entityType: 'skill',\n            entityId: newSkill.id,\n            summary: `Installed skill: ${name}`,\n            payloadJson: {\n                scope,\n                agentId: scope === 'agent' ? agentId : null,\n                version: newSkill.version\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            data: newSkill\n        }, {\n            status: 201\n        });\n    } catch (err) {\n        const message = err instanceof Error ? err.message : 'Failed to create skill';\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: message\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFVRSxVQUFVSTtZQUN2Q08sU0FBU0EsV0FBVyxDQUFDLEVBQUUsRUFBRUYsS0FBSyxnQ0FBZ0MsQ0FBQztRQUNqRTtRQUVBLGVBQWU7UUFDZixNQUFNUixNQUFNNEIsVUFBVSxDQUFDRCxNQUFNLENBQUM7WUFDNUJFLE1BQU07WUFDTkMsT0FBTztZQUNQQyxZQUFZO1lBQ1pDLFVBQVVOLFNBQVNPLEVBQUU7WUFDckJDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRTFCLE1BQU07WUFDbkMyQixhQUFhO2dCQUNYdEM7Z0JBQ0FFLFNBQVNGLFVBQVUsVUFBVUUsVUFBVTtnQkFDdkNxQyxTQUFTVixTQUFTVSxPQUFPO1lBQzNCO1FBQ0Y7UUFFQSxPQUFPL0MscURBQVlBLENBQUNlLElBQUksQ0FBQztZQUFFQyxNQUFNcUI7UUFBUyxHQUFHO1lBQUViLFFBQVE7UUFBSTtJQUM3RCxFQUFFLE9BQU93QixLQUFLO1FBQ1osTUFBTUMsVUFBVUQsZUFBZUUsUUFBUUYsSUFBSUMsT0FBTyxHQUFHO1FBQ3JELE9BQU9qRCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO1lBQUVRLE9BQU8wQjtRQUFRLEdBQUc7WUFBRXpCLFFBQVE7UUFBSTtJQUM3RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2FwcC9hcGkvc2tpbGxzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGVuZm9yY2VUeXBlZENvbmZpcm0gfSBmcm9tICdAL2xpYi93aXRoLWdvdmVybm9yJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICdAL2xpYi9yZXBvJ1xuaW1wb3J0IHR5cGUgeyBBY3Rpb25LaW5kIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IFNraWxsU2NvcGUgfSBmcm9tICdAL2xpYi9yZXBvJ1xuXG4vKipcbiAqIEdFVCAvYXBpL3NraWxsc1xuICogTGlzdCBhbGwgc2tpbGxzIChnbG9iYWwgKyBhZ2VudC1zY29wZWQpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpXG4gIGNvbnN0IHNjb3BlID0gc2VhcmNoUGFyYW1zLmdldCgnc2NvcGUnKSBhcyBTa2lsbFNjb3BlIHwgbnVsbFxuICBjb25zdCBhZ2VudElkID0gc2VhcmNoUGFyYW1zLmdldCgnYWdlbnRJZCcpXG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG4gIGNvbnN0IHNraWxscyA9IGF3YWl0IHJlcG9zLnNraWxscy5saXN0KHtcbiAgICBzY29wZTogc2NvcGUgPz8gdW5kZWZpbmVkLFxuICAgIGFnZW50SWQ6IGFnZW50SWQgPz8gdW5kZWZpbmVkLFxuICB9KVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGRhdGE6IHNraWxscyB9KVxufVxuXG4vKipcbiAqIFBPU1QgL2FwaS9za2lsbHNcbiAqIEluc3RhbGwgYSBuZXcgc2tpbGwgKHdpdGggR292ZXJub3IgZ2F0aW5nKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgc2NvcGUsIGFnZW50SWQsIHNraWxsTWQsIHR5cGVkQ29uZmlybVRleHQgfSA9IGJvZHlcblxuICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgaWYgKCFuYW1lIHx8IHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnU2tpbGwgbmFtZSBpcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICB9XG5cbiAgaWYgKCFzY29wZSB8fCAhWydnbG9iYWwnLCAnYWdlbnQnXS5pbmNsdWRlcyhzY29wZSkpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1ZhbGlkIHNjb3BlIChnbG9iYWwvYWdlbnQpIGlzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cblxuICBpZiAoc2NvcGUgPT09ICdhZ2VudCcgJiYgIWFnZW50SWQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0FnZW50IElEIGlzIHJlcXVpcmVkIGZvciBhZ2VudC1zY29wZWQgc2tpbGxzJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cblxuICAvLyBWYWxpZGF0ZSBza2lsbCBuYW1lIChwYXRoIHNhZmV0eSlcbiAgY29uc3Qgc2FmZU5hbWVSZWdleCA9IC9eW2EtejAtOV1bYS16MC05LV0qW2EtejAtOV0kL1xuICBpZiAobmFtZS5sZW5ndGggPCAyIHx8ICghc2FmZU5hbWVSZWdleC50ZXN0KG5hbWUpICYmICEvXlthLXowLTldJC8udGVzdChuYW1lKSkgfHwgbmFtZS5pbmNsdWRlcygnLi4nKSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnZhbGlkIHNraWxsIG5hbWUuIFVzZSBsb3dlcmNhc2UgbGV0dGVycywgbnVtYmVycywgYW5kIGh5cGhlbnMgb25seS4nIH0sXG4gICAgICB7IHN0YXR1czogNDAwIH1cbiAgICApXG4gIH1cblxuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAvLyBDaGVjayBmb3IgZXhpc3Rpbmcgc2tpbGwgd2l0aCBzYW1lIG5hbWVcbiAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCByZXBvcy5za2lsbHMuZ2V0QnlOYW1lKHNjb3BlLCBuYW1lLCBhZ2VudElkKVxuICBpZiAoZXhpc3RpbmcpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1NraWxsIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzJyB9LCB7IHN0YXR1czogNDA5IH0pXG4gIH1cblxuICAvLyBFbmZvcmNlIEdvdmVybm9yIC0gc2tpbGwuaW5zdGFsbCBpcyBkYW5nZXIgbGV2ZWxcbiAgY29uc3QgQUNUSU9OX0tJTkQ6IEFjdGlvbktpbmQgPSAnc2tpbGwuaW5zdGFsbCdcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZW5mb3JjZVR5cGVkQ29uZmlybSh7XG4gICAgYWN0aW9uS2luZDogQUNUSU9OX0tJTkQsXG4gICAgdHlwZWRDb25maXJtVGV4dCxcbiAgfSlcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yVHlwZSxcbiAgICAgICAgcG9saWN5OiByZXN1bHQucG9saWN5LFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiByZXN1bHQuZXJyb3JUeXBlID09PSAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcgPyA0MjggOiA0MDMgfVxuICAgIClcbiAgfVxuXG4gIHRyeSB7XG4gICAgLy8gQ3JlYXRlIG5ldyBza2lsbCB2aWEgcmVwb1xuICAgIGNvbnN0IG5ld1NraWxsID0gYXdhaXQgcmVwb3Muc2tpbGxzLmNyZWF0ZSh7XG4gICAgICBuYW1lLFxuICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgc2NvcGU6IHNjb3BlIGFzIFNraWxsU2NvcGUsXG4gICAgICBhZ2VudElkOiBzY29wZSA9PT0gJ2FnZW50JyA/IGFnZW50SWQgOiB1bmRlZmluZWQsXG4gICAgICBza2lsbE1kOiBza2lsbE1kIHx8IGAjICR7bmFtZX1cXG5cXG5Ta2lsbCBkZXNjcmlwdGlvbiBnb2VzIGhlcmUuYCxcbiAgICB9KVxuXG4gICAgLy8gTG9nIGFjdGl2aXR5XG4gICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgdHlwZTogJ3NraWxsLmluc3RhbGxlZCcsXG4gICAgICBhY3RvcjogJ3VzZXInLFxuICAgICAgZW50aXR5VHlwZTogJ3NraWxsJyxcbiAgICAgIGVudGl0eUlkOiBuZXdTa2lsbC5pZCxcbiAgICAgIHN1bW1hcnk6IGBJbnN0YWxsZWQgc2tpbGw6ICR7bmFtZX1gLFxuICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgc2NvcGUsXG4gICAgICAgIGFnZW50SWQ6IHNjb3BlID09PSAnYWdlbnQnID8gYWdlbnRJZCA6IG51bGwsXG4gICAgICAgIHZlcnNpb246IG5ld1NraWxsLnZlcnNpb24sXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBkYXRhOiBuZXdTa2lsbCB9LCB7IHN0YXR1czogMjAxIH0pXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBjcmVhdGUgc2tpbGwnXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IG1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZW5mb3JjZVR5cGVkQ29uZmlybSIsImdldFJlcG9zIiwiR0VUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInNjb3BlIiwiZ2V0IiwiYWdlbnRJZCIsInJlcG9zIiwic2tpbGxzIiwibGlzdCIsInVuZGVmaW5lZCIsImpzb24iLCJkYXRhIiwiUE9TVCIsImJvZHkiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJza2lsbE1kIiwidHlwZWRDb25maXJtVGV4dCIsImVycm9yIiwic3RhdHVzIiwiaW5jbHVkZXMiLCJzYWZlTmFtZVJlZ2V4IiwibGVuZ3RoIiwidGVzdCIsImV4aXN0aW5nIiwiZ2V0QnlOYW1lIiwiQUNUSU9OX0tJTkQiLCJyZXN1bHQiLCJhY3Rpb25LaW5kIiwiYWxsb3dlZCIsImVycm9yVHlwZSIsInBvbGljeSIsIm5ld1NraWxsIiwiY3JlYXRlIiwiYWN0aXZpdGllcyIsInR5cGUiLCJhY3RvciIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsImlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwidmVyc2lvbiIsImVyciIsIm1lc3NhZ2UiLCJFcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/skills/route.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:219:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApprovalGateError: () => (/* binding */ ApprovalGateError),\n/* harmony export */   assertApprovalGate: () => (/* binding */ assertApprovalGate),\n/* harmony export */   createApprovalRequest: () => (/* binding */ createApprovalRequest),\n/* harmony export */   ensureApprovalGate: () => (/* binding */ ensureApprovalGate),\n/* harmony export */   getActionPolicy: () => (/* binding */ getActionPolicy),\n/* harmony export */   getApprovalType: () => (/* binding */ getApprovalType),\n/* harmony export */   requiresApproval: () => (/* binding */ requiresApproval),\n/* harmony export */   validateApprovalGate: () => (/* binding */ validateApprovalGate)\n/* harmony export */ });\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_0__]);\n_repo__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * Server-side Approval Gate\n *\n * Enforces approval requirements based on Governor policy.\n * This module provides helpers to check, create, and validate approvals\n * before executing protected actions.\n */ \n\n// ============================================================================\n// HELPERS\n// ============================================================================\n/**\n * Get the policy for an action kind\n */ function getActionPolicy(actionKind) {\n    return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n}\n/**\n * Check if an action requires approval based on Governor policy\n */ function requiresApproval(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.requiresApproval;\n}\n/**\n * Get the approval type for an action kind\n */ function getApprovalType(actionKind) {\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    return policy.approvalType;\n}\n// ============================================================================\n// APPROVAL GATE FUNCTIONS\n// ============================================================================\n/**\n * Validate that an action is allowed based on approval status.\n * Returns the gate result with approval status and policy.\n *\n * Use this before executing protected actions to ensure approvals exist.\n */ async function validateApprovalGate(input) {\n    const { actionKind, workOrderId, operationId } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    // If no approval required, allow immediately\n    if (!policy.requiresApproval || !policy.approvalType) {\n        return {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Look for existing approvals for this action\n    const approvals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType\n    });\n    // Find matching approval (considering operationId if provided)\n    const matchingApproval = approvals.find((a)=>{\n        if (operationId) {\n            return a.operationId === operationId;\n        }\n        // For work order level actions, operationId should be null\n        return a.operationId === null;\n    });\n    if (!matchingApproval) {\n        return {\n            allowed: false,\n            reason: 'missing',\n            policy\n        };\n    }\n    if (matchingApproval.status === 'pending') {\n        return {\n            allowed: false,\n            reason: 'pending',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    if (matchingApproval.status === 'rejected') {\n        return {\n            allowed: false,\n            reason: 'rejected',\n            approval: matchingApproval,\n            policy\n        };\n    }\n    // Status is 'approved'\n    return {\n        allowed: true,\n        reason: 'approved',\n        approval: matchingApproval,\n        policy\n    };\n}\n/**\n * Create an approval request for a protected action.\n * Returns the existing approval if one already exists (idempotent).\n */ async function createApprovalRequest(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.ACTION_POLICIES[actionKind];\n    if (!policy.approvalType) {\n        throw new Error(`Action ${actionKind} does not have an approval type configured`);\n    }\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_0__.getRepos)();\n    // Check for existing pending approval (idempotency)\n    const existingApprovals = await repos.approvals.list({\n        workOrderId,\n        type: policy.approvalType,\n        status: 'pending'\n    });\n    const existingPending = existingApprovals.find((a)=>a.operationId === (operationId || null));\n    if (existingPending) {\n        return {\n            approval: existingPending,\n            created: false\n        };\n    }\n    // Create new approval request\n    const approval = await repos.approvals.create({\n        workOrderId,\n        operationId: operationId || null,\n        type: policy.approvalType,\n        questionMd\n    });\n    // Log activity\n    await repos.activities.create({\n        type: 'approval.requested',\n        actor: actor || 'system',\n        entityType: 'approval',\n        entityId: approval.id,\n        summary: `Approval requested: ${policy.description}`,\n        payloadJson: {\n            actionKind,\n            workOrderId,\n            operationId,\n            approvalType: policy.approvalType,\n            riskLevel: policy.riskLevel\n        }\n    });\n    return {\n        approval,\n        created: true\n    };\n}\n/**\n * Ensure an approval exists for an action. Creates one if missing.\n * This is a convenience wrapper around validateApprovalGate and createApprovalRequest.\n *\n * Returns the gate result. If approval was missing and created, reason will be 'pending'.\n */ async function ensureApprovalGate(input) {\n    const { actionKind, workOrderId, operationId, questionMd, actor } = input;\n    // First, validate current status\n    const gateResult = await validateApprovalGate({\n        actionKind,\n        workOrderId,\n        operationId\n    });\n    // If already allowed or has existing approval (any status), return as-is\n    if (gateResult.reason !== 'missing') {\n        return gateResult;\n    }\n    // Create the approval request\n    const { approval } = await createApprovalRequest({\n        actionKind,\n        workOrderId,\n        operationId,\n        questionMd,\n        actor\n    });\n    return {\n        allowed: false,\n        reason: 'pending',\n        approval,\n        policy: gateResult.policy\n    };\n}\n/**\n * Assert that an action is allowed. Throws if not allowed.\n * Use this as a guard before executing protected actions.\n */ async function assertApprovalGate(input) {\n    const result = await validateApprovalGate(input);\n    if (!result.allowed) {\n        const policy = result.policy;\n        // When allowed is false, reason can only be 'pending', 'rejected', or 'missing'\n        const reason = result.reason;\n        throw new ApprovalGateError(reason, input.actionKind, policy.description, result.approval);\n    }\n    return result.approval || null;\n}\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\nclass ApprovalGateError extends Error {\n    constructor(reason, actionKind, actionDescription, approval){\n        const message = reason === 'pending' ? `Action \"${actionDescription}\" is awaiting approval` : reason === 'rejected' ? `Action \"${actionDescription}\" was rejected` : `Action \"${actionDescription}\" requires approval`;\n        super(message), this.reason = reason, this.actionKind = actionKind, this.actionDescription = actionDescription, this.approval = approval;\n        this.name = 'ApprovalGateError';\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFBZW9DLG1CQUNwQmhDLEtBQTRCO0lBRTVCLE1BQU1pQyxTQUFTLE1BQU1sQyxxQkFBcUJDO0lBRTFDLElBQUksQ0FBQ2lDLE9BQU85QixPQUFPLEVBQUU7UUFDbkIsTUFBTVAsU0FBU3FDLE9BQU9yQyxNQUFNO1FBQzVCLGdGQUFnRjtRQUNoRixNQUFNUSxTQUFTNkIsT0FBTzdCLE1BQU07UUFDNUIsTUFBTSxJQUFJOEIsa0JBQ1I5QixRQUNBSixNQUFNTixVQUFVLEVBQ2hCRSxPQUFPK0IsV0FBVyxFQUNsQk0sT0FBT3BCLFFBQVE7SUFFbkI7SUFFQSxPQUFPb0IsT0FBT3BCLFFBQVEsSUFBSTtBQUM1QjtBQUVBLCtFQUErRTtBQUMvRSxjQUFjO0FBQ2QsK0VBQStFO0FBRXhFLE1BQU1xQiwwQkFBMEJqQjtJQUNyQyxZQUNFLE1BQWlELEVBQ2pELFVBQTZCLEVBQzdCLGlCQUFnQyxFQUNoQyxRQUE2QixDQUM3QjtRQUNBLE1BQU1tQixVQUNKaEMsV0FBVyxZQUNQLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLHNCQUFzQixDQUFDLEdBQ3BEL0IsV0FBVyxhQUNYLENBQUMsUUFBUSxFQUFFK0Isa0JBQWtCLGNBQWMsQ0FBQyxHQUM1QyxDQUFDLFFBQVEsRUFBRUEsa0JBQWtCLG1CQUFtQixDQUFDO1FBQ3ZELEtBQUssQ0FBQ0MsZUFYQ2hDLFNBQUFBLGFBQ0FWLGFBQUFBLGlCQUNBeUMsb0JBQUFBLHdCQUNBdEIsV0FBQUE7UUFTUCxJQUFJLENBQUN3QixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9hcHByb3ZhbC1nYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmVyLXNpZGUgQXBwcm92YWwgR2F0ZVxuICpcbiAqIEVuZm9yY2VzIGFwcHJvdmFsIHJlcXVpcmVtZW50cyBiYXNlZCBvbiBHb3Zlcm5vciBwb2xpY3kuXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBoZWxwZXJzIHRvIGNoZWNrLCBjcmVhdGUsIGFuZCB2YWxpZGF0ZSBhcHByb3ZhbHNcbiAqIGJlZm9yZSBleGVjdXRpbmcgcHJvdGVjdGVkIGFjdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPIH0gZnJvbSAnLi9yZXBvJ1xuaW1wb3J0IHtcbiAgQUNUSU9OX1BPTElDSUVTLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQWN0aW9uUG9saWN5LFxuICB0eXBlIEFwcHJvdmFsVHlwZSxcbn0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxHYXRlUmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhblxuICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcgfCAnYXBwcm92ZWQnIHwgJ3BlbmRpbmcnIHwgJ3JlamVjdGVkJyB8ICdtaXNzaW5nJ1xuICBhcHByb3ZhbD86IEFwcHJvdmFsRFRPXG4gIHBvbGljeTogQWN0aW9uUG9saWN5XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXQge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xuICBhY3Rvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRlQXBwcm92YWxJbnB1dCB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCB0aGUgcG9saWN5IGZvciBhbiBhY3Rpb24ga2luZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aW9uUG9saWN5KGFjdGlvbktpbmQ6IEFjdGlvbktpbmQpOiBBY3Rpb25Qb2xpY3kge1xuICByZXR1cm4gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gYWN0aW9uIHJlcXVpcmVzIGFwcHJvdmFsIGJhc2VkIG9uIEdvdmVybm9yIHBvbGljeVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZXNBcHByb3ZhbChhY3Rpb25LaW5kOiBBY3Rpb25LaW5kKTogYm9vbGVhbiB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LnJlcXVpcmVzQXBwcm92YWxcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFwcHJvdmFsIHR5cGUgZm9yIGFuIGFjdGlvbiBraW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHByb3ZhbFR5cGUoYWN0aW9uS2luZDogQWN0aW9uS2luZCk6IEFwcHJvdmFsVHlwZSB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuICByZXR1cm4gcG9saWN5LmFwcHJvdmFsVHlwZVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUFBST1ZBTCBHQVRFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gYWN0aW9uIGlzIGFsbG93ZWQgYmFzZWQgb24gYXBwcm92YWwgc3RhdHVzLlxuICogUmV0dXJucyB0aGUgZ2F0ZSByZXN1bHQgd2l0aCBhcHByb3ZhbCBzdGF0dXMgYW5kIHBvbGljeS5cbiAqXG4gKiBVc2UgdGhpcyBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zIHRvIGVuc3VyZSBhcHByb3ZhbHMgZXhpc3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IFZhbGlkYXRlQXBwcm92YWxJbnB1dFxuKTogUHJvbWlzZTxBcHByb3ZhbEdhdGVSZXN1bHQ+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIC8vIElmIG5vIGFwcHJvdmFsIHJlcXVpcmVkLCBhbGxvdyBpbW1lZGlhdGVseVxuICBpZiAoIXBvbGljeS5yZXF1aXJlc0FwcHJvdmFsIHx8ICFwb2xpY3kuYXBwcm92YWxUeXBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICByZWFzb246ICdub19hcHByb3ZhbF9yZXF1aXJlZCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gTG9vayBmb3IgZXhpc3RpbmcgYXBwcm92YWxzIGZvciB0aGlzIGFjdGlvblxuICBjb25zdCBhcHByb3ZhbHMgPSBhd2FpdCByZXBvcy5hcHByb3ZhbHMubGlzdCh7XG4gICAgd29ya09yZGVySWQsXG4gICAgdHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgfSlcblxuICAvLyBGaW5kIG1hdGNoaW5nIGFwcHJvdmFsIChjb25zaWRlcmluZyBvcGVyYXRpb25JZCBpZiBwcm92aWRlZClcbiAgY29uc3QgbWF0Y2hpbmdBcHByb3ZhbCA9IGFwcHJvdmFscy5maW5kKChhKSA9PiB7XG4gICAgaWYgKG9wZXJhdGlvbklkKSB7XG4gICAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWRcbiAgICB9XG4gICAgLy8gRm9yIHdvcmsgb3JkZXIgbGV2ZWwgYWN0aW9ucywgb3BlcmF0aW9uSWQgc2hvdWxkIGJlIG51bGxcbiAgICByZXR1cm4gYS5vcGVyYXRpb25JZCA9PT0gbnVsbFxuICB9KVxuXG4gIGlmICghbWF0Y2hpbmdBcHByb3ZhbCkge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ21pc3NpbmcnLFxuICAgICAgcG9saWN5LFxuICAgIH1cbiAgfVxuXG4gIGlmIChtYXRjaGluZ0FwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uOiAncGVuZGluZycsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICBpZiAobWF0Y2hpbmdBcHByb3ZhbC5zdGF0dXMgPT09ICdyZWplY3RlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246ICdyZWplY3RlZCcsXG4gICAgICBhcHByb3ZhbDogbWF0Y2hpbmdBcHByb3ZhbCxcbiAgICAgIHBvbGljeSxcbiAgICB9XG4gIH1cblxuICAvLyBTdGF0dXMgaXMgJ2FwcHJvdmVkJ1xuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVhc29uOiAnYXBwcm92ZWQnLFxuICAgIGFwcHJvdmFsOiBtYXRjaGluZ0FwcHJvdmFsLFxuICAgIHBvbGljeSxcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhcHByb3ZhbCByZXF1ZXN0IGZvciBhIHByb3RlY3RlZCBhY3Rpb24uXG4gKiBSZXR1cm5zIHRoZSBleGlzdGluZyBhcHByb3ZhbCBpZiBvbmUgYWxyZWFkeSBleGlzdHMgKGlkZW1wb3RlbnQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwcm92YWxSZXF1ZXN0KFxuICBpbnB1dDogQ3JlYXRlQXBwcm92YWxHYXRlSW5wdXRcbik6IFByb21pc2U8eyBhcHByb3ZhbDogQXBwcm92YWxEVE87IGNyZWF0ZWQ6IGJvb2xlYW4gfT4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG4gIGNvbnN0IHBvbGljeSA9IEFDVElPTl9QT0xJQ0lFU1thY3Rpb25LaW5kXVxuXG4gIGlmICghcG9saWN5LmFwcHJvdmFsVHlwZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQWN0aW9uICR7YWN0aW9uS2luZH0gZG9lcyBub3QgaGF2ZSBhbiBhcHByb3ZhbCB0eXBlIGNvbmZpZ3VyZWRgKVxuICB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgYXBwcm92YWwgKGlkZW1wb3RlbmN5KVxuICBjb25zdCBleGlzdGluZ0FwcHJvdmFscyA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5saXN0KHtcbiAgICB3b3JrT3JkZXJJZCxcbiAgICB0eXBlOiBwb2xpY3kuYXBwcm92YWxUeXBlLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICB9KVxuXG4gIGNvbnN0IGV4aXN0aW5nUGVuZGluZyA9IGV4aXN0aW5nQXBwcm92YWxzLmZpbmQoXG4gICAgKGEpID0+IGEub3BlcmF0aW9uSWQgPT09IChvcGVyYXRpb25JZCB8fCBudWxsKVxuICApXG5cbiAgaWYgKGV4aXN0aW5nUGVuZGluZykge1xuICAgIHJldHVybiB7IGFwcHJvdmFsOiBleGlzdGluZ1BlbmRpbmcsIGNyZWF0ZWQ6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBuZXcgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IHJlcG9zLmFwcHJvdmFscy5jcmVhdGUoe1xuICAgIHdvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb25JZCB8fCBudWxsLFxuICAgIHR5cGU6IHBvbGljeS5hcHByb3ZhbFR5cGUsXG4gICAgcXVlc3Rpb25NZCxcbiAgfSlcblxuICAvLyBMb2cgYWN0aXZpdHlcbiAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgIHR5cGU6ICdhcHByb3ZhbC5yZXF1ZXN0ZWQnLFxuICAgIGFjdG9yOiBhY3RvciB8fCAnc3lzdGVtJyxcbiAgICBlbnRpdHlUeXBlOiAnYXBwcm92YWwnLFxuICAgIGVudGl0eUlkOiBhcHByb3ZhbC5pZCxcbiAgICBzdW1tYXJ5OiBgQXBwcm92YWwgcmVxdWVzdGVkOiAke3BvbGljeS5kZXNjcmlwdGlvbn1gLFxuICAgIHBheWxvYWRKc29uOiB7XG4gICAgICBhY3Rpb25LaW5kLFxuICAgICAgd29ya09yZGVySWQsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFwcHJvdmFsVHlwZTogcG9saWN5LmFwcHJvdmFsVHlwZSxcbiAgICAgIHJpc2tMZXZlbDogcG9saWN5LnJpc2tMZXZlbCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiB7IGFwcHJvdmFsLCBjcmVhdGVkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBFbnN1cmUgYW4gYXBwcm92YWwgZXhpc3RzIGZvciBhbiBhY3Rpb24uIENyZWF0ZXMgb25lIGlmIG1pc3NpbmcuXG4gKiBUaGlzIGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdmFsaWRhdGVBcHByb3ZhbEdhdGUgYW5kIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdC5cbiAqXG4gKiBSZXR1cm5zIHRoZSBnYXRlIHJlc3VsdC4gSWYgYXBwcm92YWwgd2FzIG1pc3NpbmcgYW5kIGNyZWF0ZWQsIHJlYXNvbiB3aWxsIGJlICdwZW5kaW5nJy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUFwcHJvdmFsR2F0ZShcbiAgaW5wdXQ6IENyZWF0ZUFwcHJvdmFsR2F0ZUlucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsR2F0ZVJlc3VsdD4ge1xuICBjb25zdCB7IGFjdGlvbktpbmQsIHdvcmtPcmRlcklkLCBvcGVyYXRpb25JZCwgcXVlc3Rpb25NZCwgYWN0b3IgfSA9IGlucHV0XG5cbiAgLy8gRmlyc3QsIHZhbGlkYXRlIGN1cnJlbnQgc3RhdHVzXG4gIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgYWN0aW9uS2luZCxcbiAgICB3b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZCxcbiAgfSlcblxuICAvLyBJZiBhbHJlYWR5IGFsbG93ZWQgb3IgaGFzIGV4aXN0aW5nIGFwcHJvdmFsIChhbnkgc3RhdHVzKSwgcmV0dXJuIGFzLWlzXG4gIGlmIChnYXRlUmVzdWx0LnJlYXNvbiAhPT0gJ21pc3NpbmcnKSB7XG4gICAgcmV0dXJuIGdhdGVSZXN1bHRcbiAgfVxuXG4gIC8vIENyZWF0ZSB0aGUgYXBwcm92YWwgcmVxdWVzdFxuICBjb25zdCB7IGFwcHJvdmFsIH0gPSBhd2FpdCBjcmVhdGVBcHByb3ZhbFJlcXVlc3Qoe1xuICAgIGFjdGlvbktpbmQsXG4gICAgd29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQsXG4gICAgcXVlc3Rpb25NZCxcbiAgICBhY3RvcixcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgIHJlYXNvbjogJ3BlbmRpbmcnLFxuICAgIGFwcHJvdmFsLFxuICAgIHBvbGljeTogZ2F0ZVJlc3VsdC5wb2xpY3ksXG4gIH1cbn1cblxuLyoqXG4gKiBBc3NlcnQgdGhhdCBhbiBhY3Rpb24gaXMgYWxsb3dlZC4gVGhyb3dzIGlmIG5vdCBhbGxvd2VkLlxuICogVXNlIHRoaXMgYXMgYSBndWFyZCBiZWZvcmUgZXhlY3V0aW5nIHByb3RlY3RlZCBhY3Rpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzZXJ0QXBwcm92YWxHYXRlKFxuICBpbnB1dDogVmFsaWRhdGVBcHByb3ZhbElucHV0XG4pOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZShpbnB1dClcblxuICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgY29uc3QgcG9saWN5ID0gcmVzdWx0LnBvbGljeVxuICAgIC8vIFdoZW4gYWxsb3dlZCBpcyBmYWxzZSwgcmVhc29uIGNhbiBvbmx5IGJlICdwZW5kaW5nJywgJ3JlamVjdGVkJywgb3IgJ21pc3NpbmcnXG4gICAgY29uc3QgcmVhc29uID0gcmVzdWx0LnJlYXNvbiBhcyAncGVuZGluZycgfCAncmVqZWN0ZWQnIHwgJ21pc3NpbmcnXG4gICAgdGhyb3cgbmV3IEFwcHJvdmFsR2F0ZUVycm9yKFxuICAgICAgcmVhc29uLFxuICAgICAgaW5wdXQuYWN0aW9uS2luZCxcbiAgICAgIHBvbGljeS5kZXNjcmlwdGlvbixcbiAgICAgIHJlc3VsdC5hcHByb3ZhbFxuICAgIClcbiAgfVxuXG4gIHJldHVybiByZXN1bHQuYXBwcm92YWwgfHwgbnVsbFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFUlJPUiBDTEFTU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQXBwcm92YWxHYXRlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFzb246ICdwZW5kaW5nJyB8ICdyZWplY3RlZCcgfCAnbWlzc2luZycsXG4gICAgcHVibGljIGFjdGlvbktpbmQ6IEFjdGlvbktpbmQsXG4gICAgcHVibGljIGFjdGlvbkRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgcHVibGljIGFwcHJvdmFsPzogQXBwcm92YWxEVE9cbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICByZWFzb24gPT09ICdwZW5kaW5nJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIGlzIGF3YWl0aW5nIGFwcHJvdmFsYFxuICAgICAgICA6IHJlYXNvbiA9PT0gJ3JlamVjdGVkJ1xuICAgICAgICA/IGBBY3Rpb24gXCIke2FjdGlvbkRlc2NyaXB0aW9ufVwiIHdhcyByZWplY3RlZGBcbiAgICAgICAgOiBgQWN0aW9uIFwiJHthY3Rpb25EZXNjcmlwdGlvbn1cIiByZXF1aXJlcyBhcHByb3ZhbGBcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdBcHByb3ZhbEdhdGVFcnJvcidcbiAgfVxufVxuIl0sIm5hbWVzIjpbImdldFJlcG9zIiwiQUNUSU9OX1BPTElDSUVTIiwiZ2V0QWN0aW9uUG9saWN5IiwiYWN0aW9uS2luZCIsInJlcXVpcmVzQXBwcm92YWwiLCJwb2xpY3kiLCJnZXRBcHByb3ZhbFR5cGUiLCJhcHByb3ZhbFR5cGUiLCJ2YWxpZGF0ZUFwcHJvdmFsR2F0ZSIsImlucHV0Iiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZXBvcyIsImFwcHJvdmFscyIsImxpc3QiLCJ0eXBlIiwibWF0Y2hpbmdBcHByb3ZhbCIsImZpbmQiLCJhIiwic3RhdHVzIiwiYXBwcm92YWwiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJxdWVzdGlvbk1kIiwiYWN0b3IiLCJFcnJvciIsImV4aXN0aW5nQXBwcm92YWxzIiwiZXhpc3RpbmdQZW5kaW5nIiwiY3JlYXRlZCIsImNyZWF0ZSIsImFjdGl2aXRpZXMiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwicmlza0xldmVsIiwiZW5zdXJlQXBwcm92YWxHYXRlIiwiZ2F0ZVJlc3VsdCIsImFzc2VydEFwcHJvdmFsR2F0ZSIsInJlc3VsdCIsIkFwcHJvdmFsR2F0ZUVycm9yIiwiYWN0aW9uRGVzY3JpcHRpb24iLCJtZXNzYWdlIiwibmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/approval-gate.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:472:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceGovernor: () => (/* binding */ enforceGovernor),\n/* harmony export */   enforceTypedConfirm: () => (/* binding */ enforceTypedConfirm),\n/* harmony export */   withGovernor: () => (/* binding */ withGovernor)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repo */ \"(rsc)/./lib/repo/index.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _approval_gate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./approval-gate */ \"(rsc)/./lib/approval-gate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__]);\n([_repo__WEBPACK_IMPORTED_MODULE_1__, _approval_gate__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n/**\n * withGovernor - Route Handler Wrapper for Governor Enforcement\n *\n * Wraps API route handlers to enforce Governor policy at the server level.\n * This ensures that protected actions cannot bypass approval gates.\n */ \n\n\n\n// ============================================================================\n// WRAPPER\n// ============================================================================\n/**\n * Wrap a route handler with Governor enforcement.\n *\n * This ensures:\n * 1. Approval gate is checked (if action requires approval)\n * 2. Typed confirmation is validated server-side\n * 3. Activity is logged on execution\n *\n * @example\n * export const PATCH = withGovernor(\n *   {\n *     actionKind: 'work_order.ship',\n *     getWorkOrderId: (_, body) => body.workOrderId,\n *   },\n *   async (request, context, governorContext) => {\n *     // Handler runs only if approval + typed confirm pass\n *     return NextResponse.json({ success: true })\n *   }\n * )\n */ function withGovernor(config, handler) {\n    return async (request, context)=>{\n        const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[config.actionKind];\n        // Parse body for POST/PATCH/PUT/DELETE requests\n        let body = undefined;\n        if ([\n            'POST',\n            'PATCH',\n            'PUT',\n            'DELETE'\n        ].includes(request.method)) {\n            try {\n                body = await request.clone().json();\n            } catch  {\n            // Body might be empty or not JSON\n            }\n        }\n        // Extract identifiers\n        const workOrderId = config.getWorkOrderId(request, body);\n        if (!workOrderId && policy.requiresApproval) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Work order ID is required for this action',\n                code: 'APPROVAL_REQUIRED',\n                details: {\n                    actionKind: config.actionKind\n                }\n            }, {\n                status: 400\n            });\n        }\n        const operationId = config.getOperationId?.(request, body) ?? null;\n        const actor = config.getActor?.(request, body) ?? 'user';\n        // Extract typed confirm text from body\n        const typedConfirmText = typeof body === 'object' && body !== null ? body.typedConfirmText : undefined;\n        // 1. Check approval gate (if required)\n        let gateResult = {\n            allowed: true,\n            reason: 'no_approval_required',\n            policy\n        };\n        if (workOrderId && policy.requiresApproval && !config.skipApprovalGate) {\n            gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n                actionKind: config.actionKind,\n                workOrderId,\n                operationId\n            });\n            if (!gateResult.allowed) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                // Log denied attempt\n                await repos.activities.create({\n                    type: 'governor.denied',\n                    actor,\n                    entityType: 'work_order',\n                    entityId: workOrderId,\n                    summary: `Action denied: ${policy.description}`,\n                    payloadJson: {\n                        actionKind: config.actionKind,\n                        reason: gateResult.reason,\n                        approvalId: gateResult.approval?.id\n                    }\n                });\n                // Return appropriate error\n                if (gateResult.reason === 'missing') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind: config.actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'pending') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n                if (gateResult.reason === 'rejected') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Action \"${policy.description}\" was rejected`,\n                        code: 'APPROVAL_REJECTED',\n                        details: {\n                            actionKind: config.actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n        }\n        // 2. Validate typed confirmation (if required)\n        if (policy.confirmMode !== 'NONE') {\n            // For WO_CODE mode, we need to fetch the work order code\n            let workOrderCode;\n            if (policy.confirmMode === 'WO_CODE' && workOrderId) {\n                const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n                const wo = await repos.workOrders.getById(workOrderId);\n                workOrderCode = wo?.code;\n            }\n            // Check if typed confirm is required but missing\n            if (!typedConfirmText) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n            // Validate the typed confirm value\n            const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n            if (!validation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind: config.actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // 3. Execute the handler\n        const governorContext = {\n            actionKind: config.actionKind,\n            workOrderId: workOrderId,\n            operationId,\n            actor,\n            typedConfirmText,\n            gateResult\n        };\n        const result = await handler(request, context, governorContext);\n        // 4. Log successful execution\n        if (workOrderId) {\n            const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n            await repos.activities.create({\n                type: 'governor.executed',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action executed: ${policy.description}`,\n                payloadJson: {\n                    actionKind: config.actionKind,\n                    approvalId: gateResult.approval?.id,\n                    riskLevel: policy.riskLevel\n                }\n            });\n        }\n        return result;\n    };\n}\n// ============================================================================\n// HELPER: Simple enforcement without full wrapper\n// ============================================================================\n/**\n * Standalone function to enforce Governor policy.\n * Use this when you can't use the wrapper pattern.\n */ async function enforceGovernor(params) {\n    const { actionKind, workOrderId, operationId, actor, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    const repos = (0,_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    // Check approval gate\n    if (policy.requiresApproval) {\n        const gateResult = await (0,_approval_gate__WEBPACK_IMPORTED_MODULE_3__.validateApprovalGate)({\n            actionKind,\n            workOrderId,\n            operationId\n        });\n        if (!gateResult.allowed) {\n            await repos.activities.create({\n                type: 'governor.denied',\n                actor,\n                entityType: 'work_order',\n                entityId: workOrderId,\n                summary: `Action denied: ${policy.description}`,\n                payloadJson: {\n                    actionKind,\n                    reason: gateResult.reason,\n                    approvalId: gateResult.approval?.id\n                }\n            });\n            if (gateResult.reason === 'missing') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" requires approval`,\n                        code: 'APPROVAL_REQUIRED',\n                        details: {\n                            actionKind,\n                            confirmMode: policy.confirmMode\n                        }\n                    },\n                    status: 403\n                };\n            }\n            if (gateResult.reason === 'pending') {\n                return {\n                    allowed: false,\n                    error: {\n                        error: `Action \"${policy.description}\" is awaiting approval`,\n                        code: 'APPROVAL_PENDING',\n                        details: {\n                            actionKind,\n                            approvalId: gateResult.approval?.id\n                        }\n                    },\n                    status: 403\n                };\n            }\n            return {\n                allowed: false,\n                error: {\n                    error: `Action \"${policy.description}\" was rejected`,\n                    code: 'APPROVAL_REJECTED',\n                    details: {\n                        actionKind,\n                        approvalId: gateResult.approval?.id\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    // Check typed confirmation\n    if (policy.confirmMode !== 'NONE') {\n        let workOrderCode;\n        if (policy.confirmMode === 'WO_CODE') {\n            const wo = await repos.workOrders.getById(workOrderId);\n            workOrderCode = wo?.code;\n        }\n        if (!typedConfirmText) {\n            return {\n                allowed: false,\n                error: {\n                    error: `Typed confirmation required for \"${policy.description}\"`,\n                    code: 'TYPED_CONFIRM_REQUIRED',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)(policy.confirmMode, typedConfirmText, workOrderCode);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                error: {\n                    error: validation.error || 'Invalid confirmation',\n                    code: 'TYPED_CONFIRM_INVALID',\n                    details: {\n                        actionKind,\n                        confirmMode: policy.confirmMode,\n                        required: policy.confirmMode === 'WO_CODE' ? workOrderCode : 'CONFIRM'\n                    }\n                },\n                status: 403\n            };\n        }\n    }\n    return {\n        allowed: true,\n        gateResult: {\n            allowed: true,\n            reason: policy.requiresApproval ? 'approved' : 'no_approval_required',\n            policy\n        }\n    };\n}\n// ============================================================================\n// HELPER: Typed Confirm Only (no approval gate)\n// ============================================================================\n/**\n * Simplified enforcement for actions that only need typed confirmation\n * but don't require work order approval gates (e.g., config file edits).\n */ async function enforceTypedConfirm(params) {\n    const { actionKind, typedConfirmText } = params;\n    const policy = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.ACTION_POLICIES[actionKind];\n    // For actions with no confirmation required, allow immediately\n    if (policy.confirmMode === 'NONE') {\n        return {\n            allowed: true,\n            policy\n        };\n    }\n    // Check typed confirmation\n    if (!typedConfirmText) {\n        return {\n            allowed: false,\n            errorType: 'TYPED_CONFIRM_REQUIRED',\n            policy\n        };\n    }\n    // Validate - for CONFIRM mode, just check if it matches\n    if (policy.confirmMode === 'CONFIRM') {\n        const validation = (0,_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.validateTypedConfirm)('CONFIRM', typedConfirmText);\n        if (!validation.valid) {\n            return {\n                allowed: false,\n                errorType: 'TYPED_CONFIRM_INVALID',\n                policy\n            };\n        }\n    }\n    return {\n        allowed: true,\n        policy\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkssVUFBVXpDLE9BQU9vQyxXQUFXLEtBQUssWUFBWUMsZ0JBQWdCO29CQUMvRDtnQkFDRjtnQkFDQXZCLFFBQVE7WUFDVjtRQUNGO0lBQ0Y7SUFFQSxPQUFPO1FBQ0xPLFNBQVM7UUFDVEQsWUFBWTtZQUNWQyxTQUFTO1lBQ1RDLFFBQVF0QixPQUFPVSxnQkFBZ0IsR0FBRyxhQUFhO1lBQy9DVjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxnREFBZ0Q7QUFDaEQsK0VBQStFO0FBRS9FOzs7Q0FHQyxHQUNNLGVBQWVpRCxvQkFBb0JELE1BR3pDO0lBQ0MsTUFBTSxFQUFFL0MsVUFBVSxFQUFFa0IsZ0JBQWdCLEVBQUUsR0FBRzZCO0lBQ3pDLE1BQU1oRCxTQUFTUiw4REFBZSxDQUFDUyxXQUFXO0lBRTFDLCtEQUErRDtJQUMvRCxJQUFJRCxPQUFPb0MsV0FBVyxLQUFLLFFBQVE7UUFDakMsT0FBTztZQUFFZixTQUFTO1lBQU1yQjtRQUFPO0lBQ2pDO0lBRUEsMkJBQTJCO0lBQzNCLElBQUksQ0FBQ21CLGtCQUFrQjtRQUNyQixPQUFPO1lBQ0xFLFNBQVM7WUFDVDZCLFdBQVc7WUFDWGxEO1FBQ0Y7SUFDRjtJQUVBLHdEQUF3RDtJQUN4RCxJQUFJQSxPQUFPb0MsV0FBVyxLQUFLLFdBQVc7UUFDcEMsTUFBTU0sYUFBYWpELHVFQUFvQkEsQ0FBQyxXQUFXMEI7UUFDbkQsSUFBSSxDQUFDdUIsV0FBV0MsS0FBSyxFQUFFO1lBQ3JCLE9BQU87Z0JBQ0x0QixTQUFTO2dCQUNUNkIsV0FBVztnQkFDWGxEO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFcUIsU0FBUztRQUFNckI7SUFBTztBQUNqQyIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvd2l0aC1nb3Zlcm5vci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHdpdGhHb3Zlcm5vciAtIFJvdXRlIEhhbmRsZXIgV3JhcHBlciBmb3IgR292ZXJub3IgRW5mb3JjZW1lbnRcbiAqXG4gKiBXcmFwcyBBUEkgcm91dGUgaGFuZGxlcnMgdG8gZW5mb3JjZSBHb3Zlcm5vciBwb2xpY3kgYXQgdGhlIHNlcnZlciBsZXZlbC5cbiAqIFRoaXMgZW5zdXJlcyB0aGF0IHByb3RlY3RlZCBhY3Rpb25zIGNhbm5vdCBieXBhc3MgYXBwcm92YWwgZ2F0ZXMuXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgZ2V0UmVwb3MgfSBmcm9tICcuL3JlcG8nXG5pbXBvcnQge1xuICBBQ1RJT05fUE9MSUNJRVMsXG4gIHZhbGlkYXRlVHlwZWRDb25maXJtLFxuICB0eXBlIEFjdGlvbktpbmQsXG4gIHR5cGUgQ29uZmlybU1vZGUsXG59IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVBcHByb3ZhbEdhdGUsXG4gIHR5cGUgQXBwcm92YWxHYXRlUmVzdWx0LFxufSBmcm9tICcuL2FwcHJvdmFsLWdhdGUnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRZUEVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JDb250ZXh0IHtcbiAgYWN0aW9uS2luZDogQWN0aW9uS2luZFxuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBhY3Rvcjogc3RyaW5nXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbiAgZ2F0ZVJlc3VsdDogQXBwcm92YWxHYXRlUmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR292ZXJub3JSZXF1ZXN0IHtcbiAgLyoqIFRoZSBhY3Rpb24ga2luZCB0byBlbmZvcmNlICovXG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgLyoqIEV4dHJhY3Qgd29yayBvcmRlciBJRCBmcm9tIHJlcXVlc3QgKHJlcXVpcmVkIGZvciBhcHByb3ZhbCBsb29rdXApICovXG4gIGdldFdvcmtPcmRlcklkOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGJvZHk/OiB1bmtub3duKSA9PiBzdHJpbmcgfCBudWxsXG4gIC8qKiBFeHRyYWN0IG9wZXJhdGlvbiBJRCBmcm9tIHJlcXVlc3QgKG9wdGlvbmFsKSAqL1xuICBnZXRPcGVyYXRpb25JZD86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgYm9keT86IHVua25vd24pID0+IHN0cmluZyB8IG51bGxcbiAgLyoqIEV4dHJhY3QgYWN0b3IgZnJvbSByZXF1ZXN0IChkZWZhdWx0cyB0byAndXNlcicpICovXG4gIGdldEFjdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBib2R5PzogdW5rbm93bikgPT4gc3RyaW5nXG4gIC8qKiBTa2lwIGFwcHJvdmFsIGdhdGUgY2hlY2sgKHVzZWZ1bCBmb3Igc2FmZSBhY3Rpb25zIHRoYXQgc3RpbGwgbmVlZCB0eXBlZCBjb25maXJtKSAqL1xuICBza2lwQXBwcm92YWxHYXRlPzogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdvdmVybm9yRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nXG4gIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgfCAnQVBQUk9WQUxfUEVORElORycgfCAnQVBQUk9WQUxfUkVKRUNURUQnIHwgJ1RZUEVEX0NPTkZJUk1fUkVRVUlSRUQnIHwgJ1RZUEVEX0NPTkZJUk1fSU5WQUxJRCdcbiAgZGV0YWlscz86IHtcbiAgICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gICAgY29uZmlybU1vZGU/OiBDb25maXJtTW9kZVxuICAgIGFwcHJvdmFsSWQ/OiBzdHJpbmdcbiAgICByZXF1aXJlZD86IHN0cmluZ1xuICB9XG59XG5cbnR5cGUgUm91dGVIYW5kbGVyPFQgPSB1bmtub3duPiA9IChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIGNvbnRleHQ6IHsgcGFyYW1zOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IH0sXG4gIGdvdmVybm9yQ29udGV4dDogR292ZXJub3JDb250ZXh0XG4pID0+IFByb21pc2U8TmV4dFJlc3BvbnNlPFQ+PlxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBXUkFQUEVSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcCBhIHJvdXRlIGhhbmRsZXIgd2l0aCBHb3Zlcm5vciBlbmZvcmNlbWVudC5cbiAqXG4gKiBUaGlzIGVuc3VyZXM6XG4gKiAxLiBBcHByb3ZhbCBnYXRlIGlzIGNoZWNrZWQgKGlmIGFjdGlvbiByZXF1aXJlcyBhcHByb3ZhbClcbiAqIDIuIFR5cGVkIGNvbmZpcm1hdGlvbiBpcyB2YWxpZGF0ZWQgc2VydmVyLXNpZGVcbiAqIDMuIEFjdGl2aXR5IGlzIGxvZ2dlZCBvbiBleGVjdXRpb25cbiAqXG4gKiBAZXhhbXBsZVxuICogZXhwb3J0IGNvbnN0IFBBVENIID0gd2l0aEdvdmVybm9yKFxuICogICB7XG4gKiAgICAgYWN0aW9uS2luZDogJ3dvcmtfb3JkZXIuc2hpcCcsXG4gKiAgICAgZ2V0V29ya09yZGVySWQ6IChfLCBib2R5KSA9PiBib2R5LndvcmtPcmRlcklkLFxuICogICB9LFxuICogICBhc3luYyAocmVxdWVzdCwgY29udGV4dCwgZ292ZXJub3JDb250ZXh0KSA9PiB7XG4gKiAgICAgLy8gSGFuZGxlciBydW5zIG9ubHkgaWYgYXBwcm92YWwgKyB0eXBlZCBjb25maXJtIHBhc3NcbiAqICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pXG4gKiAgIH1cbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhHb3Zlcm5vcjxUPihcbiAgY29uZmlnOiBHb3Zlcm5vclJlcXVlc3QsXG4gIGhhbmRsZXI6IFJvdXRlSGFuZGxlcjxUPlxuKTogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiB7IHBhcmFtczogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PiB9KSA9PiBQcm9taXNlPE5leHRSZXNwb25zZTxUIHwgR292ZXJub3JFcnJvcj4+IHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2NvbmZpZy5hY3Rpb25LaW5kXVxuXG4gICAgLy8gUGFyc2UgYm9keSBmb3IgUE9TVC9QQVRDSC9QVVQvREVMRVRFIHJlcXVlc3RzXG4gICAgbGV0IGJvZHk6IHVua25vd24gPSB1bmRlZmluZWRcbiAgICBpZiAoWydQT1NUJywgJ1BBVENIJywgJ1BVVCcsICdERUxFVEUnXS5pbmNsdWRlcyhyZXF1ZXN0Lm1ldGhvZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGJvZHkgPSBhd2FpdCByZXF1ZXN0LmNsb25lKCkuanNvbigpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gQm9keSBtaWdodCBiZSBlbXB0eSBvciBub3QgSlNPTlxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgaWRlbnRpZmllcnNcbiAgICBjb25zdCB3b3JrT3JkZXJJZCA9IGNvbmZpZy5nZXRXb3JrT3JkZXJJZChyZXF1ZXN0LCBib2R5KVxuICAgIGlmICghd29ya09yZGVySWQgJiYgcG9saWN5LnJlcXVpcmVzQXBwcm92YWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnV29yayBvcmRlciBJRCBpcyByZXF1aXJlZCBmb3IgdGhpcyBhY3Rpb24nLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcgYXMgY29uc3QsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNvbmZpZy5nZXRPcGVyYXRpb25JZD8uKHJlcXVlc3QsIGJvZHkpID8/IG51bGxcbiAgICBjb25zdCBhY3RvciA9IGNvbmZpZy5nZXRBY3Rvcj8uKHJlcXVlc3QsIGJvZHkpID8/ICd1c2VyJ1xuXG4gICAgLy8gRXh0cmFjdCB0eXBlZCBjb25maXJtIHRleHQgZnJvbSBib2R5XG4gICAgY29uc3QgdHlwZWRDb25maXJtVGV4dCA9IHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBib2R5ICE9PSBudWxsXG4gICAgICA/IChib2R5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlZENvbmZpcm1UZXh0IGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgOiB1bmRlZmluZWRcblxuICAgIC8vIDEuIENoZWNrIGFwcHJvdmFsIGdhdGUgKGlmIHJlcXVpcmVkKVxuICAgIGxldCBnYXRlUmVzdWx0OiBBcHByb3ZhbEdhdGVSZXN1bHQgPSB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVhc29uOiAnbm9fYXBwcm92YWxfcmVxdWlyZWQnLFxuICAgICAgcG9saWN5LFxuICAgIH1cblxuICAgIGlmICh3b3JrT3JkZXJJZCAmJiBwb2xpY3kucmVxdWlyZXNBcHByb3ZhbCAmJiAhY29uZmlnLnNraXBBcHByb3ZhbEdhdGUpIHtcbiAgICAgIGdhdGVSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUFwcHJvdmFsR2F0ZSh7XG4gICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICB3b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICAgICAgICAvLyBMb2cgZGVuaWVkIGF0dGVtcHRcbiAgICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICAgIHR5cGU6ICdnb3Zlcm5vci5kZW5pZWQnLFxuICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgICAgc3VtbWFyeTogYEFjdGlvbiBkZW5pZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgcmVhc29uOiBnYXRlUmVzdWx0LnJlYXNvbixcbiAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yXG4gICAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhdGVSZXN1bHQucmVhc29uID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgICBjb2RlOiAnQVBQUk9WQUxfUEVORElORycgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgICAgICAgICAgICBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdyZWplY3RlZCcpIHtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgd2FzIHJlamVjdGVkYCxcbiAgICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1JFSkVDVEVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbktpbmQ6IGNvbmZpZy5hY3Rpb25LaW5kLFxuICAgICAgICAgICAgICAgIGFwcHJvdmFsSWQ6IGdhdGVSZXN1bHQuYXBwcm92YWw/LmlkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIFZhbGlkYXRlIHR5cGVkIGNvbmZpcm1hdGlvbiAoaWYgcmVxdWlyZWQpXG4gICAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgICAvLyBGb3IgV09fQ09ERSBtb2RlLCB3ZSBuZWVkIHRvIGZldGNoIHRoZSB3b3JrIG9yZGVyIGNvZGVcbiAgICAgIGxldCB3b3JrT3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyAmJiB3b3JrT3JkZXJJZCkge1xuICAgICAgICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcbiAgICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICAgIHdvcmtPcmRlckNvZGUgPSB3bz8uY29kZVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0eXBlZCBjb25maXJtIGlzIHJlcXVpcmVkIGJ1dCBtaXNzaW5nXG4gICAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX1JFUVVJUkVEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHR5cGVkIGNvbmZpcm0gdmFsdWVcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8ICdJbnZhbGlkIGNvbmZpcm1hdGlvbicsXG4gICAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9JTlZBTElEJyBhcyBjb25zdCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJyA/IHdvcmtPcmRlckNvZGUgOiAnQ09ORklSTScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBFeGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgY29uc3QgZ292ZXJub3JDb250ZXh0OiBHb3Zlcm5vckNvbnRleHQgPSB7XG4gICAgICBhY3Rpb25LaW5kOiBjb25maWcuYWN0aW9uS2luZCxcbiAgICAgIHdvcmtPcmRlcklkOiB3b3JrT3JkZXJJZCEsXG4gICAgICBvcGVyYXRpb25JZCxcbiAgICAgIGFjdG9yLFxuICAgICAgdHlwZWRDb25maXJtVGV4dCxcbiAgICAgIGdhdGVSZXN1bHQsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0LCBnb3Zlcm5vckNvbnRleHQpXG5cbiAgICAvLyA0LiBMb2cgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICBpZiAod29ya09yZGVySWQpIHtcbiAgICAgIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZXhlY3V0ZWQnLFxuICAgICAgICBhY3RvcixcbiAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICBlbnRpdHlJZDogd29ya09yZGVySWQsXG4gICAgICAgIHN1bW1hcnk6IGBBY3Rpb24gZXhlY3V0ZWQ6ICR7cG9saWN5LmRlc2NyaXB0aW9ufWAsXG4gICAgICAgIHBheWxvYWRKc29uOiB7XG4gICAgICAgICAgYWN0aW9uS2luZDogY29uZmlnLmFjdGlvbktpbmQsXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgICAgcmlza0xldmVsOiBwb2xpY3kucmlza0xldmVsLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSOiBTaW1wbGUgZW5mb3JjZW1lbnQgd2l0aG91dCBmdWxsIHdyYXBwZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBTdGFuZGFsb25lIGZ1bmN0aW9uIHRvIGVuZm9yY2UgR292ZXJub3IgcG9saWN5LlxuICogVXNlIHRoaXMgd2hlbiB5b3UgY2FuJ3QgdXNlIHRoZSB3cmFwcGVyIHBhdHRlcm4uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlR292ZXJub3IocGFyYW1zOiB7XG4gIGFjdGlvbktpbmQ6IEFjdGlvbktpbmRcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgYWN0b3I6IHN0cmluZ1xuICB0eXBlZENvbmZpcm1UZXh0Pzogc3RyaW5nXG59KTogUHJvbWlzZTx7IGFsbG93ZWQ6IHRydWU7IGdhdGVSZXN1bHQ6IEFwcHJvdmFsR2F0ZVJlc3VsdCB9IHwgeyBhbGxvd2VkOiBmYWxzZTsgZXJyb3I6IEdvdmVybm9yRXJyb3I7IHN0YXR1czogbnVtYmVyIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB3b3JrT3JkZXJJZCwgb3BlcmF0aW9uSWQsIGFjdG9yLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG4gIGNvbnN0IHJlcG9zID0gZ2V0UmVwb3MoKVxuXG4gIC8vIENoZWNrIGFwcHJvdmFsIGdhdGVcbiAgaWYgKHBvbGljeS5yZXF1aXJlc0FwcHJvdmFsKSB7XG4gICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlQXBwcm92YWxHYXRlKHtcbiAgICAgIGFjdGlvbktpbmQsXG4gICAgICB3b3JrT3JkZXJJZCxcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgIH0pXG5cbiAgICBpZiAoIWdhdGVSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgYXdhaXQgcmVwb3MuYWN0aXZpdGllcy5jcmVhdGUoe1xuICAgICAgICB0eXBlOiAnZ292ZXJub3IuZGVuaWVkJyxcbiAgICAgICAgYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgZW50aXR5SWQ6IHdvcmtPcmRlcklkLFxuICAgICAgICBzdW1tYXJ5OiBgQWN0aW9uIGRlbmllZDogJHtwb2xpY3kuZGVzY3JpcHRpb259YCxcbiAgICAgICAgcGF5bG9hZEpzb246IHtcbiAgICAgICAgICBhY3Rpb25LaW5kLFxuICAgICAgICAgIHJlYXNvbjogZ2F0ZVJlc3VsdC5yZWFzb24sXG4gICAgICAgICAgYXBwcm92YWxJZDogZ2F0ZVJlc3VsdC5hcHByb3ZhbD8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoZ2F0ZVJlc3VsdC5yZWFzb24gPT09ICdtaXNzaW5nJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBlcnJvcjogYEFjdGlvbiBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiIHJlcXVpcmVzIGFwcHJvdmFsYCxcbiAgICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRVFVSVJFRCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB7IGFjdGlvbktpbmQsIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChnYXRlUmVzdWx0LnJlYXNvbiA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGVycm9yOiBgQWN0aW9uIFwiJHtwb2xpY3kuZGVzY3JpcHRpb259XCIgaXMgYXdhaXRpbmcgYXBwcm92YWxgLFxuICAgICAgICAgICAgY29kZTogJ0FQUFJPVkFMX1BFTkRJTkcnLFxuICAgICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RhdHVzOiA0MDMsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgZXJyb3I6IGBBY3Rpb24gXCIke3BvbGljeS5kZXNjcmlwdGlvbn1cIiB3YXMgcmVqZWN0ZWRgLFxuICAgICAgICAgIGNvZGU6ICdBUFBST1ZBTF9SRUpFQ1RFRCcsXG4gICAgICAgICAgZGV0YWlsczogeyBhY3Rpb25LaW5kLCBhcHByb3ZhbElkOiBnYXRlUmVzdWx0LmFwcHJvdmFsPy5pZCB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSAhPT0gJ05PTkUnKSB7XG4gICAgbGV0IHdvcmtPcmRlckNvZGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdXT19DT0RFJykge1xuICAgICAgY29uc3Qgd28gPSBhd2FpdCByZXBvcy53b3JrT3JkZXJzLmdldEJ5SWQod29ya09yZGVySWQpXG4gICAgICB3b3JrT3JkZXJDb2RlID0gd28/LmNvZGVcbiAgICB9XG5cbiAgICBpZiAoIXR5cGVkQ29uZmlybVRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGVycm9yOiBgVHlwZWQgY29uZmlybWF0aW9uIHJlcXVpcmVkIGZvciBcIiR7cG9saWN5LmRlc2NyaXB0aW9ufVwiYCxcbiAgICAgICAgICBjb2RlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgYWN0aW9uS2luZCxcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RlOiBwb2xpY3kuY29uZmlybU1vZGUsXG4gICAgICAgICAgICByZXF1aXJlZDogcG9saWN5LmNvbmZpcm1Nb2RlID09PSAnV09fQ09ERScgPyB3b3JrT3JkZXJDb2RlIDogJ0NPTkZJUk0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czogNDAzLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZVR5cGVkQ29uZmlybShwb2xpY3kuY29uZmlybU1vZGUsIHR5cGVkQ29uZmlybVRleHQsIHdvcmtPcmRlckNvZGUpXG4gICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCAnSW52YWxpZCBjb25maXJtYXRpb24nLFxuICAgICAgICAgIGNvZGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGFjdGlvbktpbmQsXG4gICAgICAgICAgICBjb25maXJtTW9kZTogcG9saWN5LmNvbmZpcm1Nb2RlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ1dPX0NPREUnID8gd29ya09yZGVyQ29kZSA6ICdDT05GSVJNJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgZ2F0ZVJlc3VsdDoge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIHJlYXNvbjogcG9saWN5LnJlcXVpcmVzQXBwcm92YWwgPyAnYXBwcm92ZWQnIDogJ25vX2FwcHJvdmFsX3JlcXVpcmVkJyxcbiAgICAgIHBvbGljeSxcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUjogVHlwZWQgQ29uZmlybSBPbmx5IChubyBhcHByb3ZhbCBnYXRlKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFNpbXBsaWZpZWQgZW5mb3JjZW1lbnQgZm9yIGFjdGlvbnMgdGhhdCBvbmx5IG5lZWQgdHlwZWQgY29uZmlybWF0aW9uXG4gKiBidXQgZG9uJ3QgcmVxdWlyZSB3b3JrIG9yZGVyIGFwcHJvdmFsIGdhdGVzIChlLmcuLCBjb25maWcgZmlsZSBlZGl0cykuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmZvcmNlVHlwZWRDb25maXJtKHBhcmFtczoge1xuICBhY3Rpb25LaW5kOiBBY3Rpb25LaW5kXG4gIHR5cGVkQ29uZmlybVRleHQ/OiBzdHJpbmdcbn0pOiBQcm9taXNlPHsgYWxsb3dlZDogdHJ1ZTsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0gfCB7IGFsbG93ZWQ6IGZhbHNlOyBlcnJvclR5cGU6IHN0cmluZzsgcG9saWN5OiB0eXBlb2YgQUNUSU9OX1BPTElDSUVTW0FjdGlvbktpbmRdIH0+IHtcbiAgY29uc3QgeyBhY3Rpb25LaW5kLCB0eXBlZENvbmZpcm1UZXh0IH0gPSBwYXJhbXNcbiAgY29uc3QgcG9saWN5ID0gQUNUSU9OX1BPTElDSUVTW2FjdGlvbktpbmRdXG5cbiAgLy8gRm9yIGFjdGlvbnMgd2l0aCBubyBjb25maXJtYXRpb24gcmVxdWlyZWQsIGFsbG93IGltbWVkaWF0ZWx5XG4gIGlmIChwb2xpY3kuY29uZmlybU1vZGUgPT09ICdOT05FJykge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUsIHBvbGljeSB9XG4gIH1cblxuICAvLyBDaGVjayB0eXBlZCBjb25maXJtYXRpb25cbiAgaWYgKCF0eXBlZENvbmZpcm1UZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3JUeXBlOiAnVFlQRURfQ09ORklSTV9SRVFVSVJFRCcsXG4gICAgICBwb2xpY3ksXG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgLSBmb3IgQ09ORklSTSBtb2RlLCBqdXN0IGNoZWNrIGlmIGl0IG1hdGNoZXNcbiAgaWYgKHBvbGljeS5jb25maXJtTW9kZSA9PT0gJ0NPTkZJUk0nKSB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlVHlwZWRDb25maXJtKCdDT05GSVJNJywgdHlwZWRDb25maXJtVGV4dClcbiAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvclR5cGU6ICdUWVBFRF9DT05GSVJNX0lOVkFMSUQnLFxuICAgICAgICBwb2xpY3ksXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcG9saWN5IH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRSZXBvcyIsIkFDVElPTl9QT0xJQ0lFUyIsInZhbGlkYXRlVHlwZWRDb25maXJtIiwidmFsaWRhdGVBcHByb3ZhbEdhdGUiLCJ3aXRoR292ZXJub3IiLCJjb25maWciLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJwb2xpY3kiLCJhY3Rpb25LaW5kIiwiYm9keSIsInVuZGVmaW5lZCIsImluY2x1ZGVzIiwibWV0aG9kIiwiY2xvbmUiLCJqc29uIiwid29ya09yZGVySWQiLCJnZXRXb3JrT3JkZXJJZCIsInJlcXVpcmVzQXBwcm92YWwiLCJlcnJvciIsImNvZGUiLCJkZXRhaWxzIiwic3RhdHVzIiwib3BlcmF0aW9uSWQiLCJnZXRPcGVyYXRpb25JZCIsImFjdG9yIiwiZ2V0QWN0b3IiLCJ0eXBlZENvbmZpcm1UZXh0IiwiZ2F0ZVJlc3VsdCIsImFsbG93ZWQiLCJyZWFzb24iLCJza2lwQXBwcm92YWxHYXRlIiwicmVwb3MiLCJhY3Rpdml0aWVzIiwiY3JlYXRlIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJkZXNjcmlwdGlvbiIsInBheWxvYWRKc29uIiwiYXBwcm92YWxJZCIsImFwcHJvdmFsIiwiaWQiLCJjb25maXJtTW9kZSIsIndvcmtPcmRlckNvZGUiLCJ3byIsIndvcmtPcmRlcnMiLCJnZXRCeUlkIiwicmVxdWlyZWQiLCJ2YWxpZGF0aW9uIiwidmFsaWQiLCJnb3Zlcm5vckNvbnRleHQiLCJyZXN1bHQiLCJyaXNrTGV2ZWwiLCJlbmZvcmNlR292ZXJub3IiLCJwYXJhbXMiLCJlbmZvcmNlVHlwZWRDb25maXJtIiwiZXJyb3JUeXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/with-governor.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:410:eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   syncAgentsFromOpenClaw: () => (/* binding */ syncAgentsFromOpenClaw)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(instrument)/../../node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/repo */ \"(instrument)/./lib/repo/index.ts\");\n/* harmony import */ var _lib_openclaw_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/openclaw-client */ \"(instrument)/./lib/openclaw-client.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_openclaw_client__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_repo__WEBPACK_IMPORTED_MODULE_1__, _lib_openclaw_client__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nfunction inferDisplayName(agent) {\n    return agent.identity || agent.id;\n}\nfunction inferSessionKey(agentId) {\n    // Matches OpenClaw session key convention for agent stores.\n    // main is special because it's typically agent:main:main\n    if (agentId === 'main') return 'agent:main:main';\n    return `agent:${agentId}:${agentId}`;\n}\nasync function getDefaultStationId() {\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const ops = await repos.stations.getById('ops');\n    if (ops) return 'ops';\n    const stations = await repos.stations.list();\n    return stations[0]?.id ?? 'ops';\n}\nasync function syncAgentsFromOpenClaw() {\n    const config = await (0,_lib_openclaw_client__WEBPACK_IMPORTED_MODULE_2__.getOpenClawConfig)();\n    if (!config) return {\n        added: 0,\n        updated: 0\n    };\n    const repos = (0,_lib_repo__WEBPACK_IMPORTED_MODULE_1__.getRepos)();\n    const defaultStationId = await getDefaultStationId();\n    let added = 0;\n    let updated = 0;\n    for (const agent of config.agents){\n        if (!agent?.id) continue;\n        const name = inferDisplayName(agent);\n        const sessionKey = inferSessionKey(agent.id);\n        const existing = await repos.agents.getBySessionKey(sessionKey);\n        if (!existing) {\n            await repos.agents.create({\n                name,\n                role: 'agent',\n                station: defaultStationId,\n                sessionKey,\n                capabilities: {\n                    [defaultStationId]: true\n                },\n                wipLimit: agent.id === 'clawbuild' ? 3 : 2\n            });\n            added++;\n        } else {\n            await repos.agents.update(existing.id, {\n                name,\n                ...agent.model ? {\n                    model: agent.model\n                } : {}\n            });\n            updated++;\n        }\n    }\n    return {\n        added,\n        updated\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGluc3RydW1lbnQpLy4vbGliL3N5bmMtYWdlbnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQW9CO0FBRWlCO0FBQ29CO0FBRXpELFNBQVNFLGlCQUFpQkMsS0FBd0M7SUFDaEUsT0FBT0EsTUFBTUMsUUFBUSxJQUFJRCxNQUFNRSxFQUFFO0FBQ25DO0FBRUEsU0FBU0MsZ0JBQWdCQyxPQUFlO0lBQ3RDLDREQUE0RDtJQUM1RCx5REFBeUQ7SUFDekQsSUFBSUEsWUFBWSxRQUFRLE9BQU87SUFDL0IsT0FBTyxDQUFDLE1BQU0sRUFBRUEsUUFBUSxDQUFDLEVBQUVBLFNBQVM7QUFDdEM7QUFFQSxlQUFlQztJQUNiLE1BQU1DLFFBQVFULG1EQUFRQTtJQUV0QixNQUFNVSxNQUFNLE1BQU1ELE1BQU1FLFFBQVEsQ0FBQ0MsT0FBTyxDQUFDO0lBQ3pDLElBQUlGLEtBQUssT0FBTztJQUVoQixNQUFNQyxXQUFXLE1BQU1GLE1BQU1FLFFBQVEsQ0FBQ0UsSUFBSTtJQUMxQyxPQUFPRixRQUFRLENBQUMsRUFBRSxFQUFFTixNQUFNO0FBQzVCO0FBRU8sZUFBZVM7SUFDcEIsTUFBTUMsU0FBUyxNQUFNZCx1RUFBaUJBO0lBQ3RDLElBQUksQ0FBQ2MsUUFBUSxPQUFPO1FBQUVDLE9BQU87UUFBR0MsU0FBUztJQUFFO0lBRTNDLE1BQU1SLFFBQVFULG1EQUFRQTtJQUN0QixNQUFNa0IsbUJBQW1CLE1BQU1WO0lBRS9CLElBQUlRLFFBQVE7SUFDWixJQUFJQyxVQUFVO0lBRWQsS0FBSyxNQUFNZCxTQUFTWSxPQUFPSSxNQUFNLENBQUU7UUFDakMsSUFBSSxDQUFDaEIsT0FBT0UsSUFBSTtRQUVoQixNQUFNZSxPQUFPbEIsaUJBQWlCQztRQUM5QixNQUFNa0IsYUFBYWYsZ0JBQWdCSCxNQUFNRSxFQUFFO1FBQzNDLE1BQU1pQixXQUFXLE1BQU1iLE1BQU1VLE1BQU0sQ0FBQ0ksZUFBZSxDQUFDRjtRQUVwRCxJQUFJLENBQUNDLFVBQVU7WUFDYixNQUFNYixNQUFNVSxNQUFNLENBQUNLLE1BQU0sQ0FBQztnQkFDeEJKO2dCQUNBSyxNQUFNO2dCQUNOQyxTQUFTUjtnQkFDVEc7Z0JBQ0FNLGNBQWM7b0JBQUUsQ0FBQ1QsaUJBQWlCLEVBQUU7Z0JBQUs7Z0JBQ3pDVSxVQUFVekIsTUFBTUUsRUFBRSxLQUFLLGNBQWMsSUFBSTtZQUMzQztZQUNBVztRQUNGLE9BQU87WUFDTCxNQUFNUCxNQUFNVSxNQUFNLENBQUNVLE1BQU0sQ0FBQ1AsU0FBU2pCLEVBQUUsRUFBRTtnQkFDckNlO2dCQUNBLEdBQUlqQixNQUFNMkIsS0FBSyxHQUFHO29CQUFFQSxPQUFPM0IsTUFBTTJCLEtBQUs7Z0JBQUMsSUFBSSxDQUFDLENBQUM7WUFDL0M7WUFDQWI7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUFFRDtRQUFPQztJQUFRO0FBQzFCIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9zeW5jLWFnZW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3NlcnZlci1vbmx5J1xuXG5pbXBvcnQgeyBnZXRSZXBvcyB9IGZyb20gJ0AvbGliL3JlcG8nXG5pbXBvcnQgeyBnZXRPcGVuQ2xhd0NvbmZpZyB9IGZyb20gJ0AvbGliL29wZW5jbGF3LWNsaWVudCdcblxuZnVuY3Rpb24gaW5mZXJEaXNwbGF5TmFtZShhZ2VudDogeyBpZDogc3RyaW5nOyBpZGVudGl0eT86IHN0cmluZyB9KTogc3RyaW5nIHtcbiAgcmV0dXJuIGFnZW50LmlkZW50aXR5IHx8IGFnZW50LmlkXG59XG5cbmZ1bmN0aW9uIGluZmVyU2Vzc2lvbktleShhZ2VudElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBNYXRjaGVzIE9wZW5DbGF3IHNlc3Npb24ga2V5IGNvbnZlbnRpb24gZm9yIGFnZW50IHN0b3Jlcy5cbiAgLy8gbWFpbiBpcyBzcGVjaWFsIGJlY2F1c2UgaXQncyB0eXBpY2FsbHkgYWdlbnQ6bWFpbjptYWluXG4gIGlmIChhZ2VudElkID09PSAnbWFpbicpIHJldHVybiAnYWdlbnQ6bWFpbjptYWluJ1xuICByZXR1cm4gYGFnZW50OiR7YWdlbnRJZH06JHthZ2VudElkfWBcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RGVmYXVsdFN0YXRpb25JZCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCByZXBvcyA9IGdldFJlcG9zKClcblxuICBjb25zdCBvcHMgPSBhd2FpdCByZXBvcy5zdGF0aW9ucy5nZXRCeUlkKCdvcHMnKVxuICBpZiAob3BzKSByZXR1cm4gJ29wcydcblxuICBjb25zdCBzdGF0aW9ucyA9IGF3YWl0IHJlcG9zLnN0YXRpb25zLmxpc3QoKVxuICByZXR1cm4gc3RhdGlvbnNbMF0/LmlkID8/ICdvcHMnXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzeW5jQWdlbnRzRnJvbU9wZW5DbGF3KCk6IFByb21pc2U8eyBhZGRlZDogbnVtYmVyOyB1cGRhdGVkOiBudW1iZXIgfT4ge1xuICBjb25zdCBjb25maWcgPSBhd2FpdCBnZXRPcGVuQ2xhd0NvbmZpZygpXG4gIGlmICghY29uZmlnKSByZXR1cm4geyBhZGRlZDogMCwgdXBkYXRlZDogMCB9XG5cbiAgY29uc3QgcmVwb3MgPSBnZXRSZXBvcygpXG4gIGNvbnN0IGRlZmF1bHRTdGF0aW9uSWQgPSBhd2FpdCBnZXREZWZhdWx0U3RhdGlvbklkKClcblxuICBsZXQgYWRkZWQgPSAwXG4gIGxldCB1cGRhdGVkID0gMFxuXG4gIGZvciAoY29uc3QgYWdlbnQgb2YgY29uZmlnLmFnZW50cykge1xuICAgIGlmICghYWdlbnQ/LmlkKSBjb250aW51ZVxuXG4gICAgY29uc3QgbmFtZSA9IGluZmVyRGlzcGxheU5hbWUoYWdlbnQpXG4gICAgY29uc3Qgc2Vzc2lvbktleSA9IGluZmVyU2Vzc2lvbktleShhZ2VudC5pZClcbiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHJlcG9zLmFnZW50cy5nZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleSlcblxuICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgIGF3YWl0IHJlcG9zLmFnZW50cy5jcmVhdGUoe1xuICAgICAgICBuYW1lLFxuICAgICAgICByb2xlOiAnYWdlbnQnLFxuICAgICAgICBzdGF0aW9uOiBkZWZhdWx0U3RhdGlvbklkLFxuICAgICAgICBzZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IHsgW2RlZmF1bHRTdGF0aW9uSWRdOiB0cnVlIH0sXG4gICAgICAgIHdpcExpbWl0OiBhZ2VudC5pZCA9PT0gJ2NsYXdidWlsZCcgPyAzIDogMixcbiAgICAgIH0pXG4gICAgICBhZGRlZCsrXG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHJlcG9zLmFnZW50cy51cGRhdGUoZXhpc3RpbmcuaWQsIHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgLi4uKGFnZW50Lm1vZGVsID8geyBtb2RlbDogYWdlbnQubW9kZWwgfSA6IHt9KSxcbiAgICAgIH0pXG4gICAgICB1cGRhdGVkKytcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBhZGRlZCwgdXBkYXRlZCB9XG59XG5cbiJdLCJuYW1lcyI6WyJnZXRSZXBvcyIsImdldE9wZW5DbGF3Q29uZmlnIiwiaW5mZXJEaXNwbGF5TmFtZSIsImFnZW50IiwiaWRlbnRpdHkiLCJpZCIsImluZmVyU2Vzc2lvbktleSIsImFnZW50SWQiLCJnZXREZWZhdWx0U3RhdGlvbklkIiwicmVwb3MiLCJvcHMiLCJzdGF0aW9ucyIsImdldEJ5SWQiLCJsaXN0Iiwic3luY0FnZW50c0Zyb21PcGVuQ2xhdyIsImNvbmZpZyIsImFkZGVkIiwidXBkYXRlZCIsImRlZmF1bHRTdGF0aW9uSWQiLCJhZ2VudHMiLCJuYW1lIiwic2Vzc2lvbktleSIsImV4aXN0aW5nIiwiZ2V0QnlTZXNzaW9uS2V5IiwiY3JlYXRlIiwicm9sZSIsInN0YXRpb24iLCJjYXBhYmlsaXRpZXMiLCJ3aXBMaW1pdCIsInVwZGF0ZSIsIm1vZGVsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(instrument)/./lib/sync-agents.ts\n");
apps/clawcontrol/lib/sync-agents.ts:45:      await repos.agents.create({
apps/clawcontrol/lib/sync-agents.ts:55:      await repos.agents.update(existing.id, {
apps/clawcontrol/lib/with-governor.ts:144:        await repos.activities.create({
apps/clawcontrol/lib/with-governor.ts:261:      await repos.activities.create({
apps/clawcontrol/lib/with-governor.ts:307:      await repos.activities.create({
apps/clawcontrol/lib/approval-gate.ts:179:  const approval = await repos.approvals.create({
apps/clawcontrol/lib/approval-gate.ts:187:  await repos.activities.create({
