apps/clawcontrol/app/api/openclaw/sessions/sync/route.ts:56:      await prisma.activity.create({
apps/clawcontrol/app/api/openclaw/sessions/sync/route.ts:105:      await prisma.agentSession.upsert({
apps/clawcontrol/app/api/openclaw/sessions/sync/route.ts:153:      await prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:52:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:66:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:80:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:94:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:108:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:123:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:137:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:152:    prisma.workOrder.create({
apps/clawcontrol/prisma/seed.ts:176:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:190:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:204:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:218:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:232:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:247:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:261:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:275:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:290:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:304:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:319:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:333:    prisma.operation.create({
apps/clawcontrol/prisma/seed.ts:357:    prisma.station.create({
apps/clawcontrol/prisma/seed.ts:368:    prisma.station.create({
apps/clawcontrol/prisma/seed.ts:379:    prisma.station.create({
apps/clawcontrol/prisma/seed.ts:390:    prisma.station.create({
apps/clawcontrol/prisma/seed.ts:410:    prisma.agent.create({
apps/clawcontrol/prisma/seed.ts:426:    prisma.agent.create({
apps/clawcontrol/prisma/seed.ts:442:    prisma.agent.create({
apps/clawcontrol/prisma/seed.ts:458:    prisma.agent.create({
apps/clawcontrol/prisma/seed.ts:483:    prisma.approval.create({
apps/clawcontrol/prisma/seed.ts:494:    prisma.approval.create({
apps/clawcontrol/prisma/seed.ts:505:    prisma.approval.create({
apps/clawcontrol/prisma/seed.ts:525:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:537:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:549:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:561:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:573:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:585:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:597:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:609:    prisma.activity.create({
apps/clawcontrol/prisma/seed.ts:630:    prisma.cronJob.create({
apps/clawcontrol/prisma/seed.ts:643:    prisma.cronJob.create({
apps/clawcontrol/prisma/seed.ts:656:    prisma.cronJob.create({
apps/clawcontrol/prisma/seed.ts:669:    prisma.cronJob.create({
apps/clawcontrol/prisma/seed.ts:690:    prisma.skill.create({
apps/clawcontrol/prisma/seed.ts:702:    prisma.skill.create({
apps/clawcontrol/prisma/seed.ts:714:    prisma.skill.create({
apps/clawcontrol/prisma/seed.ts:726:    prisma.skill.create({
apps/clawcontrol/prisma/seed.ts:747:    prisma.plugin.create({
apps/clawcontrol/prisma/seed.ts:758:    prisma.plugin.create({
apps/clawcontrol/prisma/seed.ts:769:    prisma.plugin.create({
apps/clawcontrol/prisma/seed.ts:789:    prisma.setting.upsert({
apps/clawcontrol/prisma/seed.ts:794:    prisma.setting.upsert({
apps/clawcontrol/prisma/seed.ts:799:    prisma.setting.upsert({
apps/clawcontrol/prisma/init-real.ts:21:    prisma.station.create({ data: { id: 'plan', name: 'Planning', icon: 'clipboard-list', sortOrder: 1 } }),
apps/clawcontrol/prisma/init-real.ts:22:    prisma.station.create({ data: { id: 'build', name: 'Build', icon: 'hammer', sortOrder: 2 } }),
apps/clawcontrol/prisma/init-real.ts:23:    prisma.station.create({ data: { id: 'review', name: 'Review', icon: 'search-check', sortOrder: 3 } }),
apps/clawcontrol/prisma/init-real.ts:24:    prisma.station.create({ data: { id: 'security', name: 'Security', icon: 'shield', sortOrder: 4 } }),
apps/clawcontrol/prisma/init-real.ts:29:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:36:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:43:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:50:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:57:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:64:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:71:    prisma.agent.create({ data: { 
apps/clawcontrol/prisma/init-real.ts:81:  const wo = await prisma.workOrder.create({
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hZ2VudHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0NBSUMsR0FFNkI7QUFDZ0I7QUF5QzlDLCtFQUErRTtBQUMvRSwwQkFBMEI7QUFDMUIsK0VBQStFO0FBRXhFLFNBQVNFO0lBQ2QsT0FBTztRQUNMLE1BQU1DLE1BQUtDLE9BQXNCO1lBQy9CLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVAsdUNBQU1BLENBQUNRLEtBQUssQ0FBQ0MsUUFBUSxDQUFDO2dCQUN2Q0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLE1BQU07Z0JBQU07WUFDekI7WUFDQSxPQUFPSixLQUFLSyxHQUFHLENBQUMsQ0FBQ0MsTUFBUUMsTUFBTUQ7UUFDakM7UUFFQSxNQUFNRSxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1ILE1BQU0sTUFBTWIsdUNBQU1BLENBQUNRLEtBQUssQ0FBQ1MsVUFBVSxDQUFDO2dCQUFFWixPQUFPO29CQUFFVztnQkFBRztZQUFFO1lBQzFELE9BQU9ILE1BQU1DLE1BQU1ELE9BQW9DO1FBQ3pEO1FBRUEsTUFBTUssV0FBVVAsSUFBWTtZQUMxQixNQUFNRSxNQUFNLE1BQU1iLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRU07Z0JBQUs7WUFBRTtZQUM1RCxPQUFPRSxNQUFNQyxNQUFNRCxPQUFvQztRQUN6RDtRQUVBLE1BQU1NLGlCQUFnQkMsVUFBa0I7WUFDdEMsTUFBTVAsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDUyxVQUFVLENBQUM7Z0JBQUVaLE9BQU87b0JBQUVlO2dCQUFXO1lBQUU7WUFDbEUsT0FBT1AsTUFBTUMsTUFBTUQsT0FBb0M7UUFDekQ7UUFFQSxNQUFNUTtZQUNKLE1BQU1DLFNBQVMsTUFBTXRCLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNlLE9BQU8sQ0FBQztnQkFDeENDLElBQUk7b0JBQUM7aUJBQVM7Z0JBQ2RDLFFBQVE7b0JBQUVULElBQUk7Z0JBQUs7WUFDckI7WUFDQSxPQUFPVSxPQUFPQyxXQUFXLENBQ3ZCTCxPQUFPVixHQUFHLENBQUMsQ0FBQ2dCLElBQU07b0JBQUNBLEVBQUVDLE1BQU07b0JBQUVELEVBQUVILE1BQU0sQ0FBQ1QsRUFBRTtpQkFBQztRQUU3QztRQUVBLE1BQU1jLFFBQU9DLEtBQXVCO1lBQ2xDLE1BQU1sQixNQUFNLE1BQU1iLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNzQixNQUFNLENBQUM7Z0JBQ3BDRSxNQUFNO29CQUNKckIsTUFBTW9CLE1BQU1wQixJQUFJO29CQUNoQnNCLE1BQU1GLE1BQU1FLElBQUk7b0JBQ2hCQyxTQUFTSCxNQUFNRyxPQUFPO29CQUN0QkwsUUFBUTtvQkFDUlQsWUFBWVcsTUFBTVgsVUFBVTtvQkFDNUJlLGNBQWNDLEtBQUtDLFNBQVMsQ0FBQ04sTUFBTUksWUFBWTtvQkFDL0NHLFVBQVVQLE1BQU1PLFFBQVEsSUFBSTtnQkFDOUI7WUFDRjtZQUNBLE9BQU94QixNQUFNRDtRQUNmO1FBRUEsTUFBTTBCLFFBQU92QixFQUFVLEVBQUVlLEtBQXVCO1lBQzlDLE1BQU1TLFdBQVcsTUFBTXhDLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVc7Z0JBQUc7WUFBRTtZQUMvRCxJQUFJLENBQUN3QixVQUFVLE9BQU87WUFFdEIsNkVBQTZFO1lBQzdFLE1BQU1DLGFBQXNDO2dCQUMxQ0MsWUFBWSxJQUFJQztZQUNsQjtZQUNBLElBQUlaLE1BQU1GLE1BQU0sS0FBS2UsV0FBV0gsV0FBV1osTUFBTSxHQUFHRSxNQUFNRixNQUFNO1lBQ2hFLElBQUlFLE1BQU1wQixJQUFJLEtBQUtpQyxXQUFXSCxXQUFXOUIsSUFBSSxHQUFHb0IsTUFBTXBCLElBQUk7WUFDMUQsSUFBSW9CLE1BQU1FLElBQUksS0FBS1csV0FBV0gsV0FBV1IsSUFBSSxHQUFHRixNQUFNRSxJQUFJO1lBQzFELElBQUlGLE1BQU1HLE9BQU8sS0FBS1UsV0FBV0gsV0FBV1AsT0FBTyxHQUFHSCxNQUFNRyxPQUFPO1lBQ25FLElBQUlILE1BQU1JLFlBQVksS0FBS1MsV0FBV0gsV0FBV04sWUFBWSxHQUFHQyxLQUFLQyxTQUFTLENBQUNOLE1BQU1JLFlBQVk7WUFDakcsSUFBSUosTUFBTU8sUUFBUSxLQUFLTSxXQUFXSCxXQUFXSCxRQUFRLEdBQUdQLE1BQU1PLFFBQVE7WUFDdEUsSUFBSVAsTUFBTVgsVUFBVSxLQUFLd0IsV0FBV0gsV0FBV3JCLFVBQVUsR0FBR1csTUFBTVgsVUFBVTtZQUM1RSxJQUFJVyxNQUFNYyxVQUFVLEtBQUtELFdBQVdILFdBQVdJLFVBQVUsR0FBR2QsTUFBTWMsVUFBVTtZQUM1RSxJQUFJZCxNQUFNZSxLQUFLLEtBQUtGLFdBQVdILFdBQVdLLEtBQUssR0FBR2YsTUFBTWUsS0FBSztZQUU3RCxNQUFNakMsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDK0IsTUFBTSxDQUFDO2dCQUNwQ2xDLE9BQU87b0JBQUVXO2dCQUFHO2dCQUNaZ0IsTUFBTVM7WUFDUjtZQUVBLE9BQU8zQixNQUFNRDtRQUNmO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNrQztJQUNkLE9BQU87UUFDTCxNQUFNNUMsTUFBS0MsT0FBc0I7WUFDL0IsSUFBSTRDLFNBQVM7bUJBQUkvQyx5REFBVUE7YUFBQztZQUM1QixJQUFJRyxTQUFTeUIsUUFBUTtnQkFDbkIsTUFBTW9CLFdBQVdDLE1BQU1DLE9BQU8sQ0FBQy9DLFFBQVF5QixNQUFNLElBQUl6QixRQUFReUIsTUFBTSxHQUFHO29CQUFDekIsUUFBUXlCLE1BQU07aUJBQUM7Z0JBQ2xGbUIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLElBQU1KLFNBQVNLLFFBQVEsQ0FBQ0QsRUFBRXhCLE1BQU07WUFDMUQ7WUFDQSxJQUFJekIsU0FBUzhCLFNBQVM7Z0JBQ3BCLE1BQU1xQixXQUFXTCxNQUFNQyxPQUFPLENBQUMvQyxRQUFROEIsT0FBTyxJQUFJOUIsUUFBUThCLE9BQU8sR0FBRztvQkFBQzlCLFFBQVE4QixPQUFPO2lCQUFDO2dCQUNyRmMsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLElBQU1FLFNBQVNELFFBQVEsQ0FBQ0QsRUFBRW5CLE9BQU87WUFDM0Q7WUFDQSxPQUFPYyxPQUFPcEMsR0FBRyxDQUFDNEM7UUFDcEI7UUFFQSxNQUFNekMsU0FBUUMsRUFBVTtZQUN0QixNQUFNUixRQUFRUCx5REFBVUEsQ0FBQ3dELElBQUksQ0FBQyxDQUFDSixJQUFNQSxFQUFFckMsRUFBRSxLQUFLQTtZQUM5QyxPQUFPUixRQUFRZ0QsVUFBVWhELFNBQVM7UUFDcEM7UUFFQSxNQUFNVSxXQUFVUCxJQUFZO1lBQzFCLE1BQU1ILFFBQVFQLHlEQUFVQSxDQUFDd0QsSUFBSSxDQUFDLENBQUNKLElBQU1BLEVBQUUxQyxJQUFJLEtBQUtBO1lBQ2hELE9BQU9ILFFBQVFnRCxVQUFVaEQsU0FBUztRQUNwQztRQUVBLE1BQU1XLGlCQUFnQkMsVUFBa0I7WUFDdEMsTUFBTVosUUFBUVAseURBQVVBLENBQUN3RCxJQUFJLENBQUMsQ0FBQ0osSUFBTUEsRUFBRWpDLFVBQVUsS0FBS0E7WUFDdEQsT0FBT1osUUFBUWdELFVBQVVoRCxTQUFTO1FBQ3BDO1FBRUEsTUFBTWE7WUFDSixNQUFNcUMsU0FBaUMsQ0FBQztZQUN4QyxLQUFLLE1BQU1MLEtBQUtwRCx5REFBVUEsQ0FBRTtnQkFDMUJ5RCxNQUFNLENBQUNMLEVBQUV4QixNQUFNLENBQUMsR0FBRyxDQUFDNkIsTUFBTSxDQUFDTCxFQUFFeEIsTUFBTSxDQUFDLElBQUksS0FBSztZQUMvQztZQUNBLE9BQU82QjtRQUNUO1FBRUEsTUFBTTVCLFFBQU9DLEtBQXVCO1lBQ2xDLE1BQU00QixNQUFNLElBQUloQjtZQUNoQixNQUFNM0IsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDZix5REFBVUEsQ0FBQzJELE1BQU0sR0FBRyxHQUFHQyxRQUFRLEdBQUdDLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekUsTUFBTUMsV0FBVztnQkFDZi9DO2dCQUNBTCxNQUFNb0IsTUFBTXBCLElBQUk7Z0JBQ2hCc0IsTUFBTUYsTUFBTUUsSUFBSTtnQkFDaEJDLFNBQVNILE1BQU1HLE9BQU87Z0JBQ3RCTCxRQUFRO2dCQUNSVCxZQUFZVyxNQUFNWCxVQUFVO2dCQUM1QmUsY0FBY0osTUFBTUksWUFBWTtnQkFDaENHLFVBQVVQLE1BQU1PLFFBQVEsSUFBSTtnQkFDNUJJLFlBQVk7Z0JBQ1pzQixpQkFBaUI7Z0JBQ2pCQyxXQUFXTjtnQkFDWE8sV0FBV1A7WUFDYjtZQUVBLHNFQUFzRTtZQUN0RTFELHlEQUFVQSxDQUFDa0UsSUFBSSxDQUFDSjtZQUVoQixPQUFPUCxVQUFVTztRQUNuQjtRQUVBLE1BQU14QixRQUFPdkIsRUFBVSxFQUFFZSxLQUF1QjtZQUM5QyxNQUFNdkIsUUFBUVAseURBQVVBLENBQUN3RCxJQUFJLENBQUMsQ0FBQ0osSUFBTUEsRUFBRXJDLEVBQUUsS0FBS0E7WUFDOUMsSUFBSSxDQUFDUixPQUFPLE9BQU87WUFFbkIsbUVBQW1FO1lBQ25FLE9BQU87Z0JBQ0wsR0FBR2dELFVBQVVoRCxNQUFNO2dCQUNuQixHQUFJdUIsTUFBTUYsTUFBTSxLQUFLZSxhQUFhO29CQUFFZixRQUFRRSxNQUFNRixNQUFNO2dCQUF1QixDQUFDO2dCQUNoRmEsWUFBWSxJQUFJQztnQkFDaEJ1QixXQUFXLElBQUl2QjtZQUNqQjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxVQUFVO0FBQ1YsK0VBQStFO0FBRS9FLFNBQVNyQyxXQUFXRixPQUFzQjtJQUN4QyxJQUFJLENBQUNBLFNBQVMsT0FBTyxDQUFDO0lBQ3RCLE1BQU1DLFFBQWlDLENBQUM7SUFDeEMsSUFBSUQsUUFBUXlCLE1BQU0sRUFBRTtRQUNsQnhCLE1BQU13QixNQUFNLEdBQUdxQixNQUFNQyxPQUFPLENBQUMvQyxRQUFReUIsTUFBTSxJQUFJO1lBQUV1QyxJQUFJaEUsUUFBUXlCLE1BQU07UUFBQyxJQUFJekIsUUFBUXlCLE1BQU07SUFDeEY7SUFDQSxJQUFJekIsUUFBUThCLE9BQU8sRUFBRTtRQUNuQjdCLE1BQU02QixPQUFPLEdBQUdnQixNQUFNQyxPQUFPLENBQUMvQyxRQUFROEIsT0FBTyxJQUFJO1lBQUVrQyxJQUFJaEUsUUFBUThCLE9BQU87UUFBQyxJQUFJOUIsUUFBUThCLE9BQU87SUFDNUY7SUFDQSxPQUFPN0I7QUFDVDtBQW9CQSxTQUFTUyxNQUFNRCxHQUFtQjtJQUNoQyxPQUFPO1FBQ0xHLElBQUlILElBQUlHLEVBQUU7UUFDVkwsTUFBTUUsSUFBSUYsSUFBSTtRQUNkc0IsTUFBTXBCLElBQUlvQixJQUFJO1FBQ2RDLFNBQVNyQixJQUFJcUIsT0FBTztRQUNwQkwsUUFBUWhCLElBQUlnQixNQUFNO1FBQ2xCVCxZQUFZUCxJQUFJTyxVQUFVO1FBQzFCZSxjQUFjQyxLQUFLaUMsS0FBSyxDQUFDeEQsSUFBSXNCLFlBQVk7UUFDekNHLFVBQVV6QixJQUFJeUIsUUFBUTtRQUN0Qk8sWUFBWWhDLElBQUlnQyxVQUFVLElBQUk7UUFDOUJDLE9BQU9qQyxJQUFJaUMsS0FBSyxJQUFJO1FBQ3BCSixZQUFZN0IsSUFBSTZCLFVBQVU7UUFDMUJzQixpQkFBaUJuRCxJQUFJbUQsZUFBZTtRQUNwQ0MsV0FBV3BELElBQUlvRCxTQUFTO1FBQ3hCQyxXQUFXckQsSUFBSXFELFNBQVM7SUFDMUI7QUFDRjtBQUVBLFNBQVNWLFVBQVVoRCxLQUFnQztJQUNqRCxPQUFPO1FBQ0xRLElBQUlSLE1BQU1RLEVBQUU7UUFDWkwsTUFBTUgsTUFBTUcsSUFBSTtRQUNoQnNCLE1BQU16QixNQUFNeUIsSUFBSTtRQUNoQkMsU0FBUzFCLE1BQU0wQixPQUFPO1FBQ3RCTCxRQUFRckIsTUFBTXFCLE1BQU07UUFDcEJULFlBQVlaLE1BQU1ZLFVBQVU7UUFDNUJlLGNBQWMzQixNQUFNMkIsWUFBWTtRQUNoQ0csVUFBVTlCLE1BQU04QixRQUFRO1FBQ3hCTyxZQUFZO1FBQ1pDLE9BQU87UUFDUEosWUFBWWxDLE1BQU1rQyxVQUFVO1FBQzVCc0IsaUJBQWlCeEQsTUFBTXdELGVBQWU7UUFDdENDLFdBQVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:351:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:395:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:428:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9zdGF0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztDQUlDLEdBRTZCO0FBa0M5QiwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTQztJQUNkLE9BQU87UUFDTCxNQUFNQztZQUNKLE1BQU1DLE9BQU8sTUFBTUgsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDO2dCQUN6Q0MsU0FBUztvQkFBQzt3QkFBRUMsV0FBVztvQkFBTTtvQkFBRzt3QkFBRUMsTUFBTTtvQkFBTTtpQkFBRTtZQUNsRDtZQUNBLE9BQU9MLEtBQUtNLEdBQUcsQ0FBQ0M7UUFDbEI7UUFFQSxNQUFNQyxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1DLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFSDtnQkFBRztZQUFFO1lBQzVELE9BQU9DLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNRyxXQUFVUixJQUFZO1lBQzFCLE1BQU1LLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFUDtnQkFBSztZQUFFO1lBQzlELE9BQU9LLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxRQUFPQyxLQUF5QjtZQUNwQyxNQUFNTCxNQUFNLE1BQU1iLHVDQUFNQSxDQUFDSSxPQUFPLENBQUNhLE1BQU0sQ0FBQztnQkFDdENFLE1BQU07b0JBQ0pQLElBQUlNLE1BQU1OLEVBQUU7b0JBQ1pKLE1BQU1VLE1BQU1WLElBQUk7b0JBQ2hCWSxNQUFNRixNQUFNRSxJQUFJO29CQUNoQkMsYUFBYUgsTUFBTUcsV0FBVyxJQUFJO29CQUNsQ0MsT0FBT0osTUFBTUksS0FBSyxJQUFJO29CQUN0QmYsV0FBV1csTUFBTVgsU0FBUyxJQUFJO2dCQUNoQztZQUNGO1lBQ0EsT0FBT0csTUFBTUc7UUFDZjtRQUVBLE1BQU1VLFFBQU9YLEVBQVUsRUFBRU0sS0FBeUI7WUFDaEQsTUFBTU0sV0FBVyxNQUFNeEIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFSDtnQkFBRztZQUFFO1lBQ2pFLElBQUksQ0FBQ1ksVUFBVSxPQUFPO1lBRXRCLE1BQU1YLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ21CLE1BQU0sQ0FBQztnQkFDdENSLE9BQU87b0JBQUVIO2dCQUFHO2dCQUNaTyxNQUFNO29CQUNKLEdBQUlELE1BQU1WLElBQUksS0FBS2lCLGFBQWE7d0JBQUVqQixNQUFNVSxNQUFNVixJQUFJO29CQUFDLENBQUM7b0JBQ3BELEdBQUlVLE1BQU1FLElBQUksS0FBS0ssYUFBYTt3QkFBRUwsTUFBTUYsTUFBTUUsSUFBSTtvQkFBQyxDQUFDO29CQUNwRCxHQUFJRixNQUFNRyxXQUFXLEtBQUtJLGFBQWE7d0JBQUVKLGFBQWFILE1BQU1HLFdBQVc7b0JBQUMsQ0FBQztvQkFDekUsR0FBSUgsTUFBTUksS0FBSyxLQUFLRyxhQUFhO3dCQUFFSCxPQUFPSixNQUFNSSxLQUFLO29CQUFDLENBQUM7b0JBQ3ZELEdBQUlKLE1BQU1YLFNBQVMsS0FBS2tCLGFBQWE7d0JBQUVsQixXQUFXVyxNQUFNWCxTQUFTO29CQUFDLENBQUM7Z0JBQ3JFO1lBQ0Y7WUFFQSxPQUFPRyxNQUFNRztRQUNmO1FBRUEsTUFBTWEsUUFBT2QsRUFBVTtZQUNyQixNQUFNWSxXQUFXLE1BQU14Qix1Q0FBTUEsQ0FBQ0ksT0FBTyxDQUFDVSxVQUFVLENBQUM7Z0JBQUVDLE9BQU87b0JBQUVIO2dCQUFHO1lBQUU7WUFDakUsSUFBSSxDQUFDWSxVQUFVLE9BQU87WUFDdEIsTUFBTXhCLHVDQUFNQSxDQUFDSSxPQUFPLENBQUNzQixNQUFNLENBQUM7Z0JBQUVYLE9BQU87b0JBQUVIO2dCQUFHO1lBQUU7WUFDNUMsT0FBTztRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRS9FLE1BQU1lLG1CQUF1RTtJQUMzRTtRQUNFZixJQUFJO1FBQ0pKLE1BQU07UUFDTlksTUFBTTtRQUNOQyxhQUFhO1FBQ2JDLE9BQU87UUFDUGYsV0FBVztJQUNiO0lBQ0E7UUFDRUssSUFBSTtRQUNKSixNQUFNO1FBQ05ZLE1BQU07UUFDTkMsYUFBYTtRQUNiQyxPQUFPO1FBQ1BmLFdBQVc7SUFDYjtJQUNBO1FBQ0VLLElBQUk7UUFDSkosTUFBTTtRQUNOWSxNQUFNO1FBQ05DLGFBQWE7UUFDYkMsT0FBTztRQUNQZixXQUFXO0lBQ2I7SUFDQTtRQUNFSyxJQUFJO1FBQ0pKLE1BQU07UUFDTlksTUFBTTtRQUNOQyxhQUFhO1FBQ2JDLE9BQU87UUFDUGYsV0FBVztJQUNiO0NBQ0Q7QUFFRCxNQUFNcUIsZUFBNkJELGlCQUFpQmxCLEdBQUcsQ0FBQyxDQUFDb0IsSUFBTztRQUM5RCxHQUFHQSxDQUFDO1FBQ0pDLFdBQVcsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLE1BQU0sS0FBSyxLQUFLLEtBQUs7UUFDdERDLFdBQVcsSUFBSUY7SUFDakI7QUFFTyxTQUFTRztJQUNkLE9BQU87UUFDTCxNQUFNaEM7WUFDSixPQUFPO21CQUFJMEI7YUFBYSxDQUFDTyxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTSxFQUFHOUIsU0FBUyxHQUFHOEIsRUFBRTlCLFNBQVMsSUFBSzZCLEVBQUU1QixJQUFJLENBQUM4QixhQUFhLENBQUNELEVBQUU3QixJQUFJO1FBQ3BHO1FBRUEsTUFBTUcsU0FBUUMsRUFBVTtZQUN0QixPQUFPZ0IsYUFBYVcsSUFBSSxDQUFDLENBQUNWLElBQU1BLEVBQUVqQixFQUFFLEtBQUtBLE9BQU87UUFDbEQ7UUFFQSxNQUFNSSxXQUFVUixJQUFZO1lBQzFCLE9BQU9vQixhQUFhVyxJQUFJLENBQUMsQ0FBQ1YsSUFBTUEsRUFBRXJCLElBQUksS0FBS0EsU0FBUztRQUN0RDtRQUVBLE1BQU1TLFFBQU9DLEtBQXlCO1lBQ3BDLE1BQU1jLE1BQU0sSUFBSUQ7WUFDaEIsTUFBTVMsTUFBa0I7Z0JBQ3RCNUIsSUFBSU0sTUFBTU4sRUFBRTtnQkFDWkosTUFBTVUsTUFBTVYsSUFBSTtnQkFDaEJZLE1BQU1GLE1BQU1FLElBQUk7Z0JBQ2hCQyxhQUFhSCxNQUFNRyxXQUFXLElBQUk7Z0JBQ2xDQyxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQ3RCZixXQUFXVyxNQUFNWCxTQUFTLElBQUk7Z0JBQzlCdUIsV0FBV0U7Z0JBQ1hDLFdBQVdEO1lBQ2I7WUFDQUosYUFBYWEsSUFBSSxDQUFDRDtZQUNsQixPQUFPQTtRQUNUO1FBRUEsTUFBTWpCLFFBQU9YLEVBQVUsRUFBRU0sS0FBeUI7WUFDaEQsTUFBTXdCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QixNQUFNbEIsV0FBV0ksWUFBWSxDQUFDYyxJQUFJO1lBQ2xDLE1BQU1FLFVBQXNCO2dCQUMxQixHQUFHcEIsUUFBUTtnQkFDWCxHQUFJTixNQUFNVixJQUFJLEtBQUtpQixhQUFhO29CQUFFakIsTUFBTVUsTUFBTVYsSUFBSTtnQkFBQyxDQUFDO2dCQUNwRCxHQUFJVSxNQUFNRSxJQUFJLEtBQUtLLGFBQWE7b0JBQUVMLE1BQU1GLE1BQU1FLElBQUk7Z0JBQUMsQ0FBQztnQkFDcEQsR0FBSUYsTUFBTUcsV0FBVyxLQUFLSSxhQUFhO29CQUFFSixhQUFhSCxNQUFNRyxXQUFXLElBQUk7Z0JBQUssQ0FBQztnQkFDakYsR0FBSUgsTUFBTUksS0FBSyxLQUFLRyxhQUFhO29CQUFFSCxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQUssQ0FBQztnQkFDL0QsR0FBSUosTUFBTVgsU0FBUyxLQUFLa0IsYUFBYTtvQkFBRWxCLFdBQVdXLE1BQU1YLFNBQVM7Z0JBQUMsQ0FBQztnQkFDbkUwQixXQUFXLElBQUlGO1lBQ2pCO1lBQ0FILFlBQVksQ0FBQ2MsSUFBSSxHQUFHRTtZQUNwQixPQUFPQTtRQUNUO1FBRUEsTUFBTWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/route.js:472:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:351:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:395:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:428:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stations/[id]/route.js:472:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:307:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:373:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:406:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:439:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9zdGF0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztDQUlDLEdBRTZCO0FBa0M5QiwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTQztJQUNkLE9BQU87UUFDTCxNQUFNQztZQUNKLE1BQU1DLE9BQU8sTUFBTUgsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDO2dCQUN6Q0MsU0FBUztvQkFBQzt3QkFBRUMsV0FBVztvQkFBTTtvQkFBRzt3QkFBRUMsTUFBTTtvQkFBTTtpQkFBRTtZQUNsRDtZQUNBLE9BQU9MLEtBQUtNLEdBQUcsQ0FBQ0M7UUFDbEI7UUFFQSxNQUFNQyxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1DLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFSDtnQkFBRztZQUFFO1lBQzVELE9BQU9DLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNRyxXQUFVUixJQUFZO1lBQzFCLE1BQU1LLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFUDtnQkFBSztZQUFFO1lBQzlELE9BQU9LLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxRQUFPQyxLQUF5QjtZQUNwQyxNQUFNTCxNQUFNLE1BQU1iLHVDQUFNQSxDQUFDSSxPQUFPLENBQUNhLE1BQU0sQ0FBQztnQkFDdENFLE1BQU07b0JBQ0pQLElBQUlNLE1BQU1OLEVBQUU7b0JBQ1pKLE1BQU1VLE1BQU1WLElBQUk7b0JBQ2hCWSxNQUFNRixNQUFNRSxJQUFJO29CQUNoQkMsYUFBYUgsTUFBTUcsV0FBVyxJQUFJO29CQUNsQ0MsT0FBT0osTUFBTUksS0FBSyxJQUFJO29CQUN0QmYsV0FBV1csTUFBTVgsU0FBUyxJQUFJO2dCQUNoQztZQUNGO1lBQ0EsT0FBT0csTUFBTUc7UUFDZjtRQUVBLE1BQU1VLFFBQU9YLEVBQVUsRUFBRU0sS0FBeUI7WUFDaEQsTUFBTU0sV0FBVyxNQUFNeEIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ1UsVUFBVSxDQUFDO2dCQUFFQyxPQUFPO29CQUFFSDtnQkFBRztZQUFFO1lBQ2pFLElBQUksQ0FBQ1ksVUFBVSxPQUFPO1lBRXRCLE1BQU1YLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNJLE9BQU8sQ0FBQ21CLE1BQU0sQ0FBQztnQkFDdENSLE9BQU87b0JBQUVIO2dCQUFHO2dCQUNaTyxNQUFNO29CQUNKLEdBQUlELE1BQU1WLElBQUksS0FBS2lCLGFBQWE7d0JBQUVqQixNQUFNVSxNQUFNVixJQUFJO29CQUFDLENBQUM7b0JBQ3BELEdBQUlVLE1BQU1FLElBQUksS0FBS0ssYUFBYTt3QkFBRUwsTUFBTUYsTUFBTUUsSUFBSTtvQkFBQyxDQUFDO29CQUNwRCxHQUFJRixNQUFNRyxXQUFXLEtBQUtJLGFBQWE7d0JBQUVKLGFBQWFILE1BQU1HLFdBQVc7b0JBQUMsQ0FBQztvQkFDekUsR0FBSUgsTUFBTUksS0FBSyxLQUFLRyxhQUFhO3dCQUFFSCxPQUFPSixNQUFNSSxLQUFLO29CQUFDLENBQUM7b0JBQ3ZELEdBQUlKLE1BQU1YLFNBQVMsS0FBS2tCLGFBQWE7d0JBQUVsQixXQUFXVyxNQUFNWCxTQUFTO29CQUFDLENBQUM7Z0JBQ3JFO1lBQ0Y7WUFFQSxPQUFPRyxNQUFNRztRQUNmO1FBRUEsTUFBTWEsUUFBT2QsRUFBVTtZQUNyQixNQUFNWSxXQUFXLE1BQU14Qix1Q0FBTUEsQ0FBQ0ksT0FBTyxDQUFDVSxVQUFVLENBQUM7Z0JBQUVDLE9BQU87b0JBQUVIO2dCQUFHO1lBQUU7WUFDakUsSUFBSSxDQUFDWSxVQUFVLE9BQU87WUFDdEIsTUFBTXhCLHVDQUFNQSxDQUFDSSxPQUFPLENBQUNzQixNQUFNLENBQUM7Z0JBQUVYLE9BQU87b0JBQUVIO2dCQUFHO1lBQUU7WUFDNUMsT0FBTztRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRS9FLE1BQU1lLG1CQUF1RTtJQUMzRTtRQUNFZixJQUFJO1FBQ0pKLE1BQU07UUFDTlksTUFBTTtRQUNOQyxhQUFhO1FBQ2JDLE9BQU87UUFDUGYsV0FBVztJQUNiO0lBQ0E7UUFDRUssSUFBSTtRQUNKSixNQUFNO1FBQ05ZLE1BQU07UUFDTkMsYUFBYTtRQUNiQyxPQUFPO1FBQ1BmLFdBQVc7SUFDYjtJQUNBO1FBQ0VLLElBQUk7UUFDSkosTUFBTTtRQUNOWSxNQUFNO1FBQ05DLGFBQWE7UUFDYkMsT0FBTztRQUNQZixXQUFXO0lBQ2I7SUFDQTtRQUNFSyxJQUFJO1FBQ0pKLE1BQU07UUFDTlksTUFBTTtRQUNOQyxhQUFhO1FBQ2JDLE9BQU87UUFDUGYsV0FBVztJQUNiO0NBQ0Q7QUFFRCxNQUFNcUIsZUFBNkJELGlCQUFpQmxCLEdBQUcsQ0FBQyxDQUFDb0IsSUFBTztRQUM5RCxHQUFHQSxDQUFDO1FBQ0pDLFdBQVcsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLE1BQU0sS0FBSyxLQUFLLEtBQUs7UUFDdERDLFdBQVcsSUFBSUY7SUFDakI7QUFFTyxTQUFTRztJQUNkLE9BQU87UUFDTCxNQUFNaEM7WUFDSixPQUFPO21CQUFJMEI7YUFBYSxDQUFDTyxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTSxFQUFHOUIsU0FBUyxHQUFHOEIsRUFBRTlCLFNBQVMsSUFBSzZCLEVBQUU1QixJQUFJLENBQUM4QixhQUFhLENBQUNELEVBQUU3QixJQUFJO1FBQ3BHO1FBRUEsTUFBTUcsU0FBUUMsRUFBVTtZQUN0QixPQUFPZ0IsYUFBYVcsSUFBSSxDQUFDLENBQUNWLElBQU1BLEVBQUVqQixFQUFFLEtBQUtBLE9BQU87UUFDbEQ7UUFFQSxNQUFNSSxXQUFVUixJQUFZO1lBQzFCLE9BQU9vQixhQUFhVyxJQUFJLENBQUMsQ0FBQ1YsSUFBTUEsRUFBRXJCLElBQUksS0FBS0EsU0FBUztRQUN0RDtRQUVBLE1BQU1TLFFBQU9DLEtBQXlCO1lBQ3BDLE1BQU1jLE1BQU0sSUFBSUQ7WUFDaEIsTUFBTVMsTUFBa0I7Z0JBQ3RCNUIsSUFBSU0sTUFBTU4sRUFBRTtnQkFDWkosTUFBTVUsTUFBTVYsSUFBSTtnQkFDaEJZLE1BQU1GLE1BQU1FLElBQUk7Z0JBQ2hCQyxhQUFhSCxNQUFNRyxXQUFXLElBQUk7Z0JBQ2xDQyxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQ3RCZixXQUFXVyxNQUFNWCxTQUFTLElBQUk7Z0JBQzlCdUIsV0FBV0U7Z0JBQ1hDLFdBQVdEO1lBQ2I7WUFDQUosYUFBYWEsSUFBSSxDQUFDRDtZQUNsQixPQUFPQTtRQUNUO1FBRUEsTUFBTWpCLFFBQU9YLEVBQVUsRUFBRU0sS0FBeUI7WUFDaEQsTUFBTXdCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QixNQUFNbEIsV0FBV0ksWUFBWSxDQUFDYyxJQUFJO1lBQ2xDLE1BQU1FLFVBQXNCO2dCQUMxQixHQUFHcEIsUUFBUTtnQkFDWCxHQUFJTixNQUFNVixJQUFJLEtBQUtpQixhQUFhO29CQUFFakIsTUFBTVUsTUFBTVYsSUFBSTtnQkFBQyxDQUFDO2dCQUNwRCxHQUFJVSxNQUFNRSxJQUFJLEtBQUtLLGFBQWE7b0JBQUVMLE1BQU1GLE1BQU1FLElBQUk7Z0JBQUMsQ0FBQztnQkFDcEQsR0FBSUYsTUFBTUcsV0FBVyxLQUFLSSxhQUFhO29CQUFFSixhQUFhSCxNQUFNRyxXQUFXLElBQUk7Z0JBQUssQ0FBQztnQkFDakYsR0FBSUgsTUFBTUksS0FBSyxLQUFLRyxhQUFhO29CQUFFSCxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQUssQ0FBQztnQkFDL0QsR0FBSUosTUFBTVgsU0FBUyxLQUFLa0IsYUFBYTtvQkFBRWxCLFdBQVdXLE1BQU1YLFNBQVM7Z0JBQUMsQ0FBQztnQkFDbkUwQixXQUFXLElBQUlGO1lBQ2pCO1lBQ0FILFlBQVksQ0FBQ2MsSUFBSSxHQUFHRTtZQUNwQixPQUFPQTtRQUNUO1FBRUEsTUFBTWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/work-orders/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:307:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hY3Rpdml0aWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7O0NBS0MsR0FFNkI7QUFDb0I7QUFDUDtBQXdCM0MsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQiwrRUFBK0U7QUFFeEUsU0FBU0c7SUFDZCxPQUFPO1FBQ0wsTUFBTUMsTUFBS0MsT0FBeUIsRUFBRUMsVUFBOEI7WUFDbEUsTUFBTUMsUUFBUUMsV0FBV0g7WUFDekIsTUFBTUksT0FBTyxNQUFNVCx1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDQyxRQUFRLENBQUM7Z0JBQzFDSjtnQkFDQUssU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1SLFlBQVlTLFNBQVM7Z0JBQzNCQyxNQUFNVixZQUFZVyxVQUFVO1lBQzlCO1lBQ0EsT0FBT1IsS0FBS1MsR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ2EsVUFBVSxDQUFDO2dCQUFFaEIsT0FBTztvQkFBRWM7Z0JBQUc7WUFBRTtZQUM3RCxPQUFPQyxNQUFNSCxNQUFNRyxPQUFPO1FBQzVCO1FBRUEsTUFBTUUsWUFBV1QsUUFBUSxFQUFFO1lBQ3pCLE1BQU1OLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0MsU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1DO1lBQ1I7WUFDQSxPQUFPTixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTU0sZUFBY0MsVUFBa0IsRUFBRUMsUUFBZ0I7WUFDdEQsTUFBTWxCLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0osT0FBTztvQkFBRW1CO29CQUFZQztnQkFBUztnQkFDOUJmLFNBQVM7b0JBQUVDLElBQUk7Z0JBQU87WUFDeEI7WUFDQSxPQUFPSixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVMsUUFBT0MsS0FBMEI7WUFDckMsTUFBTVIsS0FBSyxDQUFDLElBQUksRUFBRVMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsSUFBSTtZQUN4RSxNQUFNYixNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDa0IsTUFBTSxDQUFDO2dCQUN2Q1EsTUFBTTtvQkFDSmY7b0JBQ0FSLElBQUksSUFBSWlCO29CQUNSTyxNQUFNUixNQUFNUSxJQUFJO29CQUNoQkMsT0FBT1QsTUFBTVMsS0FBSztvQkFDbEJaLFlBQVlHLE1BQU1ILFVBQVU7b0JBQzVCQyxVQUFVRSxNQUFNRixRQUFRO29CQUN4QlksU0FBU1YsTUFBTVUsT0FBTztvQkFDdEJDLGFBQWFDLEtBQUtDLFNBQVMsQ0FBQ2IsTUFBTVcsV0FBVyxJQUFJLENBQUM7Z0JBQ3BEO1lBQ0Y7WUFDQSxNQUFNRyxNQUFNeEIsTUFBTUc7WUFFbEIsd0JBQXdCO1lBQ3hCcEIsd0RBQWVBLENBQUN5QztZQUVoQixPQUFPQTtRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNDO0lBQ2QsT0FBTztRQUNMLE1BQU14QyxNQUFLQyxPQUF5QixFQUFFQyxVQUE4QjtZQUNsRSxJQUFJdUMsU0FBUzttQkFBSTVDLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVNxQixZQUFZO2dCQUN2Qm1CLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFckIsVUFBVSxLQUFLckIsUUFBUXFCLFVBQVU7WUFDbkU7WUFDQSxJQUFJckIsU0FBU3NCLFVBQVU7Z0JBQ3JCa0IsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLElBQU1BLEVBQUVwQixRQUFRLEtBQUt0QixRQUFRc0IsUUFBUTtZQUMvRDtZQUNBLElBQUl0QixTQUFTZ0MsTUFBTTtnQkFDakJRLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFVixJQUFJLEtBQUtoQyxRQUFRZ0MsSUFBSTtZQUN2RDtZQUNBLCtCQUErQjtZQUMvQlEsT0FBT0csSUFBSSxDQUFDLENBQUNELEdBQUdFLElBQU1BLEVBQUVwQyxFQUFFLENBQUNxQyxPQUFPLEtBQUtILEVBQUVsQyxFQUFFLENBQUNxQyxPQUFPO1lBQ25ELG1CQUFtQjtZQUNuQixNQUFNakMsU0FBU1gsWUFBWVcsVUFBVTtZQUNyQyxNQUFNRixRQUFRVCxZQUFZUyxTQUFTO1lBQ25DLE9BQU84QixPQUFPVixLQUFLLENBQUNsQixRQUFRQSxTQUFTRixPQUFPRyxHQUFHLENBQUNpQztRQUNsRDtRQUVBLE1BQU0vQixTQUFRQyxFQUFVO1lBQ3RCLE1BQU1YLFdBQVdULDZEQUFjQSxDQUFDbUQsSUFBSSxDQUFDLENBQUNMLElBQU1BLEVBQUUxQixFQUFFLEtBQUtBO1lBQ3JELE9BQU9YLFdBQVd5QyxVQUFVekMsWUFBWTtRQUMxQztRQUVBLE1BQU1jLFlBQVdULFFBQVEsRUFBRTtZQUN6QixPQUFPO21CQUFJZCw2REFBY0E7YUFBQyxDQUN2QitDLElBQUksQ0FBQyxDQUFDRCxHQUFHRSxJQUFNQSxFQUFFcEMsRUFBRSxDQUFDcUMsT0FBTyxLQUFLSCxFQUFFbEMsRUFBRSxDQUFDcUMsT0FBTyxJQUM1Q2YsS0FBSyxDQUFDLEdBQUdwQixPQUNURyxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTTFCLGVBQWNDLFVBQWtCLEVBQUVDLFFBQWdCO1lBQ3RELE9BQU8xQiw2REFBY0EsQ0FDbEI2QyxNQUFNLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRXJCLFVBQVUsS0FBS0EsY0FBY3FCLEVBQUVwQixRQUFRLEtBQUtBLFVBQzVEVCxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTXZCLFFBQU9DLEtBQTBCO1lBQ3JDLDJFQUEyRTtZQUMzRSxNQUFNUixLQUFLLENBQUMsSUFBSSxFQUFFUyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO1lBQ3hFLE1BQU1RLE1BQW1CO2dCQUN2QnRCO2dCQUNBUixJQUFJLElBQUlpQjtnQkFDUk8sTUFBTVIsTUFBTVEsSUFBSTtnQkFDaEJDLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQ2xCWixZQUFZRyxNQUFNSCxVQUFVO2dCQUM1QkMsVUFBVUUsTUFBTUYsUUFBUTtnQkFDeEJZLFNBQVNWLE1BQU1VLE9BQU87Z0JBQ3RCQyxhQUFhWCxNQUFNVyxXQUFXLElBQUksQ0FBQztZQUNyQztZQUVBLHdCQUF3QjtZQUN4QnRDLHdEQUFlQSxDQUFDeUM7WUFFaEIsT0FBT0E7UUFDVDtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTbkMsV0FBV0gsT0FBeUI7SUFDM0MsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNRSxRQUFpQyxDQUFDO0lBQ3hDLElBQUlGLFFBQVFxQixVQUFVLEVBQUU7UUFDdEJuQixNQUFNbUIsVUFBVSxHQUFHckIsUUFBUXFCLFVBQVU7SUFDdkM7SUFDQSxJQUFJckIsUUFBUXNCLFFBQVEsRUFBRTtRQUNwQnBCLE1BQU1vQixRQUFRLEdBQUd0QixRQUFRc0IsUUFBUTtJQUNuQztJQUNBLElBQUl0QixRQUFRZ0MsSUFBSSxFQUFFO1FBQ2hCOUIsTUFBTThCLElBQUksR0FBR2hDLFFBQVFnQyxJQUFJO0lBQzNCO0lBQ0EsT0FBTzlCO0FBQ1Q7QUFFQSxTQUFTWSxNQUFNRyxHQVNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZSLElBQUlTLElBQUlULEVBQUU7UUFDVndCLE1BQU1mLElBQUllLElBQUk7UUFDZEMsT0FBT2hCLElBQUlnQixLQUFLO1FBQ2hCWixZQUFZSixJQUFJSSxVQUFVO1FBQzFCQyxVQUFVTCxJQUFJSyxRQUFRO1FBQ3RCWSxTQUFTakIsSUFBSWlCLE9BQU87UUFDcEJDLGFBQWFDLEtBQUtZLEtBQUssQ0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:373:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:406:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:439:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/stream/activities/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby93b3JrT3JkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNZO0FBQ3dCO0FBcURsRSwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTSTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1ULHVDQUFNQSxDQUFDVSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLGFBQVlWLE9BQTBCO1lBQzFDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCSSxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO29CQUNuQztnQkFDRjtZQUNGO1lBQ0EsT0FBT1osS0FBS0ssR0FBRyxDQUFDLENBQUNRLE1BQVM7b0JBQ3hCLEdBQUdQLE1BQU1PLElBQUk7b0JBQ2JKLFlBQVlJLElBQUlKLFVBQVUsQ0FBQ0osR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQ3RDSCxJQUFJRyxHQUFHSCxFQUFFOzRCQUNUQyxRQUFRRSxHQUFHRixNQUFNO3dCQUNuQjtnQkFDRjtRQUNGO1FBRUEsTUFBTUcsU0FBUUosRUFBVTtZQUN0QixNQUFNRSxNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDZSxVQUFVLENBQUM7Z0JBQUVsQixPQUFPO29CQUFFYTtnQkFBRztZQUFFO1lBQzlELE9BQU9FLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxXQUFVQyxJQUFZO1lBQzFCLE1BQU1MLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNlLFVBQVUsQ0FBQztnQkFBRWxCLE9BQU87b0JBQUVvQjtnQkFBSztZQUFFO1lBQ2hFLE9BQU9MLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNTTtZQUNKLE1BQU1DLFNBQVMsTUFBTTdCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQixPQUFPLENBQUM7Z0JBQzVDQyxJQUFJO29CQUFDO2lCQUFRO2dCQUNiQyxRQUFRO29CQUFFWixJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT2EsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT2YsR0FBRyxDQUFDLENBQUNxQixJQUFNO29CQUFDQSxFQUFFQyxLQUFLO29CQUFFRCxFQUFFSCxNQUFNLENBQUNaLEVBQUU7aUJBQUM7UUFFNUM7UUFFQSxNQUFNaUI7WUFDSixNQUFNQyxRQUFRLElBQUlDO1lBQ2xCRCxNQUFNRSxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUc7WUFFeEIsT0FBT3hDLHVDQUFNQSxDQUFDVSxTQUFTLENBQUMrQixLQUFLLENBQUM7Z0JBQzVCbEMsT0FBTztvQkFDTDZCLE9BQU87b0JBQ1BNLFdBQVc7d0JBQUVDLEtBQUtMO29CQUFNO2dCQUMxQjtZQUNGO1FBQ0Y7UUFFQSxNQUFNTSxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTUUsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUM1Q2xCLE9BQU87b0JBQUVhO2dCQUFHO2dCQUNaSCxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO3dCQUNqQ1QsU0FBUzs0QkFBRWlDLFdBQVc7d0JBQU07b0JBQzlCO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJLENBQUN2QixLQUFLLE9BQU87WUFDakIsT0FBTztnQkFDTCxHQUFHUCxNQUFNTyxJQUFJO2dCQUNiSixZQUFZSSxJQUFJSixVQUFVLENBQUNKLEdBQUcsQ0FBQyxDQUFDUyxLQUFRO3dCQUN0Q0gsSUFBSUcsR0FBR0gsRUFBRTt3QkFDVEMsUUFBUUUsR0FBR0YsTUFBTTtvQkFDbkI7WUFDRjtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLHFCQUFxQjtZQUNyQixNQUFNQyxTQUFTLE1BQU1oRCx1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDdUMsU0FBUyxDQUFDO2dCQUM5Q3JDLFNBQVM7b0JBQUVlLE1BQU07Z0JBQU87Z0JBQ3hCUixRQUFRO29CQUFFUSxNQUFNO2dCQUFLO1lBQ3ZCO1lBQ0EsTUFBTXVCLFVBQVVGLFNBQVNHLFNBQVNILE9BQU9yQixJQUFJLENBQUN5QixPQUFPLENBQUMsT0FBTyxLQUFLLE1BQU07WUFDeEUsTUFBTXpCLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPSCxVQUFVLEdBQUdJLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekQsTUFBTWhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQyxNQUFNLENBQUM7Z0JBQ3hDUyxNQUFNO29CQUNKNUI7b0JBQ0E2QixPQUFPVCxNQUFNUyxLQUFLO29CQUNsQkMsUUFBUVYsTUFBTVUsTUFBTTtvQkFDcEJyQixPQUFPO29CQUNQc0IsVUFBVVgsTUFBTVcsUUFBUSxJQUFJO29CQUM1QkMsT0FBT1osTUFBTVksS0FBSyxJQUFJO29CQUN0QkMsaUJBQWlCYixNQUFNYSxlQUFlLElBQUk7Z0JBQzVDO1lBQ0Y7WUFFQSxtQkFBbUI7WUFDbkIsTUFBTTNELHVEQUFjQSxDQUFDcUIsSUFBSUYsRUFBRSxFQUFFRSxJQUFJSyxJQUFJLEVBQUVMLElBQUlrQyxLQUFLLEVBQUVsQyxJQUFJbUMsTUFBTTtZQUU1RCxPQUFPMUMsTUFBTU87UUFDZjtRQUVBLE1BQU11QyxRQUFPekMsRUFBVSxFQUFFMkIsS0FBMkI7WUFDbEQsTUFBTWUsV0FBVyxNQUFNOUQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUFFbEIsT0FBTztvQkFBRWE7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMwQyxVQUFVLE9BQU87WUFFdEIsTUFBTXhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNtRCxNQUFNLENBQUM7Z0JBQ3hDdEQsT0FBTztvQkFBRWE7Z0JBQUc7Z0JBQ1ptQyxNQUFNO29CQUNKLEdBQUlSLE1BQU1TLEtBQUssS0FBS08sYUFBYTt3QkFBRVAsT0FBT1QsTUFBTVMsS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJVCxNQUFNVSxNQUFNLEtBQUtNLGFBQWE7d0JBQUVOLFFBQVFWLE1BQU1VLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSVYsTUFBTVgsS0FBSyxLQUFLMkIsYUFBYTt3QkFBRTNCLE9BQU9XLE1BQU1YLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSVcsTUFBTVcsUUFBUSxLQUFLSyxhQUFhO3dCQUFFTCxVQUFVWCxNQUFNVyxRQUFRO29CQUFDLENBQUM7b0JBQ2hFLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTt3QkFBRUosT0FBT1osTUFBTVksS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJWixNQUFNaUIsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlakIsTUFBTWlCLGFBQWE7b0JBQUMsQ0FBQztvQkFDL0UsR0FBSWpCLE1BQU1YLEtBQUssS0FBSyxhQUFhO3dCQUFFTSxXQUFXLElBQUlIO29CQUFPLENBQUM7Z0JBQzVEO1lBQ0Y7WUFFQSwrQ0FBK0M7WUFDL0MsSUFBSVEsTUFBTVMsS0FBSyxLQUFLTyxhQUFhaEIsTUFBTVUsTUFBTSxLQUFLTSxXQUFXO2dCQUMzRCxNQUFNOUQsdURBQWNBLENBQUNxQixJQUFJRixFQUFFLEVBQUVFLElBQUlLLElBQUksRUFBRUwsSUFBSWtDLEtBQUssRUFBRWxDLElBQUltQyxNQUFNO1lBQzlEO1lBRUEsT0FBTzFDLE1BQU1PO1FBQ2Y7UUFFQSxNQUFNMkMseUJBQ0o3QyxFQUFVLEVBQ1Y4QyxRQUFnQixFQUNoQkMsS0FBYTtZQUViLE9BQU9uRSx1Q0FBTUEsQ0FBQ29FLFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsb0JBQW9CO2dCQUNwQixNQUFNUCxXQUFXLE1BQU1PLEdBQUczRCxTQUFTLENBQUNlLFVBQVUsQ0FBQztvQkFBRWxCLE9BQU87d0JBQUVhO29CQUFHO2dCQUFFO2dCQUMvRCxJQUFJLENBQUMwQyxVQUFVLE9BQU87Z0JBRXRCLE1BQU1RLGdCQUFnQlIsU0FBUzFCLEtBQUs7Z0JBRXBDLG9CQUFvQjtnQkFDcEIsTUFBTWQsTUFBTSxNQUFNK0MsR0FBRzNELFNBQVMsQ0FBQ21ELE1BQU0sQ0FBQztvQkFDcEN0RCxPQUFPO3dCQUFFYTtvQkFBRztvQkFDWm1DLE1BQU07d0JBQ0puQixPQUFPOEI7d0JBQ1AsR0FBSUEsYUFBYSxhQUFhOzRCQUFFeEIsV0FBVyxJQUFJSDt3QkFBTyxDQUFDO29CQUN6RDtnQkFDRjtnQkFFQSx5QkFBeUI7Z0JBQ3pCLE1BQU1nQyxhQUFhLENBQUMsSUFBSSxFQUFFaEMsS0FBS2lDLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLEtBQUssQ0FBQyxHQUFHLElBQUk7Z0JBQ2hGLE1BQU1QLEdBQUdRLFFBQVEsQ0FBQy9CLE1BQU0sQ0FBQztvQkFDdkJTLE1BQU07d0JBQ0puQyxJQUFJbUQ7d0JBQ0pPLElBQUksSUFBSXZDO3dCQUNSd0MsTUFBTTt3QkFDTlo7d0JBQ0FhLFlBQVk7d0JBQ1pDLFVBQVU3RDt3QkFDVjhELFNBQVMsQ0FBQywyQkFBMkIsRUFBRWhCLFVBQVU7d0JBQ2pEaUIsYUFBYUMsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQmY7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x4RCxXQUFXSyxNQUFNTztvQkFDakJnRDtvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNlO0lBQ2QsT0FBTztRQUNMLE1BQU1qRixNQUFLQyxPQUEwQjtZQUNuQyxJQUFJaUYsU0FBUzttQkFBSXJGLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVM4QixPQUFPO2dCQUNsQixNQUFNb0QsU0FBU0MsTUFBTUMsT0FBTyxDQUFDcEYsUUFBUThCLEtBQUssSUFBSTlCLFFBQVE4QixLQUFLLEdBQUc7b0JBQUM5QixRQUFROEIsS0FBSztpQkFBQztnQkFDN0VtRCxTQUFTQSxPQUFPSSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0osT0FBT0ssUUFBUSxDQUFDRCxHQUFHeEQsS0FBSztZQUN6RDtZQUNBLElBQUk5QixTQUFTb0QsVUFBVTtnQkFDckIsTUFBTW9DLGFBQWFMLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUlwRCxRQUFRb0QsUUFBUSxHQUFHO29CQUFDcEQsUUFBUW9ELFFBQVE7aUJBQUM7Z0JBQzFGNkIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9FLFdBQVdELFFBQVEsQ0FBQ0QsR0FBR2xDLFFBQVE7WUFDaEU7WUFDQSxJQUFJcEQsU0FBU3FELE9BQU87Z0JBQ2xCNEIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqQyxLQUFLLEtBQUtyRCxRQUFRcUQsS0FBSztZQUMzRDtZQUNBLE9BQU80QixPQUFPekUsR0FBRyxDQUFDaUY7UUFDcEI7UUFFQSxNQUFNL0UsYUFBWVYsT0FBMEI7WUFDMUMsTUFBTTBGLGFBQWEsTUFBTSxJQUFJLENBQUMzRixJQUFJLENBQUNDO1lBQ25DLE9BQU8wRixXQUFXbEYsR0FBRyxDQUFDLENBQUM4RSxLQUFRO29CQUM3QixHQUFHQSxFQUFFO29CQUNMMUUsWUFBWWYsNkRBQWNBLENBQ3ZCd0YsTUFBTSxDQUFDLENBQUNwRSxLQUFPQSxHQUFHMEUsV0FBVyxLQUFLTCxHQUFHeEUsRUFBRSxFQUN2Q04sR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQUVILElBQUlHLEdBQUdILEVBQUU7NEJBQUVDLFFBQVFFLEdBQUdGLE1BQU07d0JBQUM7Z0JBQ2pEO1FBQ0Y7UUFFQSxNQUFNRyxTQUFRSixFQUFVO1lBQ3RCLE1BQU13RSxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsT0FBT3dFLEtBQUtHLFVBQVVILE1BQU07UUFDOUI7UUFFQSxNQUFNbEUsV0FBVUMsSUFBWTtZQUMxQixNQUFNaUUsS0FBSzFGLDZEQUFjQSxDQUFDZ0csSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUV4RSxJQUFJLEtBQUtBO1lBQ2pELE9BQU9pRSxLQUFLRyxVQUFVSCxNQUFNO1FBQzlCO1FBRUEsTUFBTWhFO1lBQ0osTUFBTXdFLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNUixNQUFNMUYsNkRBQWNBLENBQUU7Z0JBQy9Ca0csTUFBTSxDQUFDUixHQUFHeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQ2dFLE1BQU0sQ0FBQ1IsR0FBR3hELEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPZ0U7UUFDVDtRQUVBLE1BQU0vRDtZQUNKLE1BQU1DLFFBQVEsSUFBSUM7WUFDbEJELE1BQU1FLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRztZQUV4QixPQUFPdEMsNkRBQWNBLENBQUN5RixNQUFNLENBQzFCLENBQUNDLEtBQU9BLEdBQUd4RCxLQUFLLEtBQUssYUFBYXdELEdBQUdsRCxTQUFTLElBQUlrRCxHQUFHbEQsU0FBUyxJQUFJSixPQUNsRStELE1BQU07UUFDVjtRQUVBLE1BQU16RCxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTXdFLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFDaEIsT0FBTztnQkFDTCxHQUFHRyxVQUFVSCxHQUFHO2dCQUNoQjFFLFlBQVlmLDZEQUFjQSxDQUN2QndGLE1BQU0sQ0FBQyxDQUFDcEUsS0FBT0EsR0FBRzBFLFdBQVcsS0FBSzdFLElBQ2xDTixHQUFHLENBQUMsQ0FBQ1MsS0FBUTt3QkFBRUgsSUFBSUcsR0FBR0gsRUFBRTt3QkFBRUMsUUFBUUUsR0FBR0YsTUFBTTtvQkFBQztZQUNqRDtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLDRCQUE0QjtZQUM1QixNQUFNM0IsS0FBSyxDQUFDLFFBQVEsRUFBRW1CLEtBQUtpQyxHQUFHLElBQUk7WUFDbEMsTUFBTTdDLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPbkQsNkRBQWNBLENBQUNtRyxNQUFNLEdBQUcsR0FBRy9DLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFDdkUsTUFBTWtCLE1BQU0sSUFBSWpDO1lBRWhCLE1BQU0rRCxRQUFRO2dCQUNabEY7Z0JBQ0FPO2dCQUNBNkIsT0FBT1QsTUFBTVMsS0FBSztnQkFDbEJDLFFBQVFWLE1BQU1VLE1BQU07Z0JBQ3BCckIsT0FBTztnQkFDUHNCLFVBQVdYLE1BQU1XLFFBQVEsSUFBSTtnQkFDN0JDLE9BQVFaLE1BQU1ZLEtBQUssSUFBSTtnQkFDdkJDLGlCQUFpQmIsTUFBTWEsZUFBZSxJQUFJO2dCQUMxQ0ksZUFBZTtnQkFDZm5CLFdBQVcyQjtnQkFDWDNELFdBQVcyRDtnQkFDWDlCLFdBQVc7WUFDYjtZQUVBLHVEQUF1RDtZQUN2RCxPQUFPcUQsVUFBVU87UUFDbkI7UUFFQSxNQUFNekMsUUFBT3pDLEVBQVUsRUFBRTJCLEtBQTJCO1lBQ2xELE1BQU02QyxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDd0UsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdHLFVBQVVILEdBQUc7Z0JBQ2hCLEdBQUk3QyxNQUFNUyxLQUFLLEtBQUtPLGFBQWE7b0JBQUVQLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSVQsTUFBTVUsTUFBTSxLQUFLTSxhQUFhO29CQUFFTixRQUFRVixNQUFNVSxNQUFNO2dCQUFDLENBQUM7Z0JBQzFELEdBQUlWLE1BQU1YLEtBQUssS0FBSzJCLGFBQWE7b0JBQUUzQixPQUFPVyxNQUFNWCxLQUFLO2dCQUEwQixDQUFDO2dCQUNoRixHQUFJVyxNQUFNVyxRQUFRLEtBQUtLLGFBQWE7b0JBQUVMLFVBQVVYLE1BQU1XLFFBQVE7Z0JBQTZCLENBQUM7Z0JBQzVGLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTtvQkFBRUosT0FBT1osTUFBTVksS0FBSztnQkFBMEIsQ0FBQztnQkFDaEYsR0FBSVosTUFBTWlCLGFBQWEsS0FBS0QsYUFBYTtvQkFBRUMsZUFBZWpCLE1BQU1pQixhQUFhO2dCQUFDLENBQUM7Z0JBQy9FbkQsV0FBVyxJQUFJMEI7WUFDakI7UUFDRjtRQUVBLE1BQU0wQix5QkFDSjdDLEVBQVUsRUFDVjhDLFFBQWdCLEVBQ2hCcUMsTUFBYztZQUVkLE1BQU1YLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFFaEIsTUFBTXRCLGdCQUFnQnNCLEdBQUd4RCxLQUFLO1lBQzlCLE1BQU1tQyxhQUFhLENBQUMsU0FBUyxFQUFFaEMsS0FBS2lDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMOUQsV0FBVztvQkFDVCxHQUFHcUYsVUFBVUgsR0FBRztvQkFDaEJ4RCxPQUFPOEI7b0JBQ1ByRCxXQUFXLElBQUkwQjtvQkFDZixHQUFJMkIsYUFBYSxhQUFhO3dCQUFFeEIsV0FBVyxJQUFJSDtvQkFBTyxDQUFDO2dCQUN6RDtnQkFDQStCO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUy9ELFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFROEIsS0FBSyxFQUFFO1FBQ2pCN0IsTUFBTTZCLEtBQUssR0FBR3FELE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVE4QixLQUFLLElBQUk7WUFBRW9FLElBQUlsRyxRQUFROEIsS0FBSztRQUFDLElBQUk5QixRQUFROEIsS0FBSztJQUNwRjtJQUNBLElBQUk5QixRQUFRb0QsUUFBUSxFQUFFO1FBQ3BCbkQsTUFBTW1ELFFBQVEsR0FBRytCLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUk7WUFBRThDLElBQUlsRyxRQUFRb0QsUUFBUTtRQUFDLElBQUlwRCxRQUFRb0QsUUFBUTtJQUNoRztJQUNBLElBQUlwRCxRQUFRcUQsS0FBSyxFQUFFO1FBQ2pCcEQsTUFBTW9ELEtBQUssR0FBR3JELFFBQVFxRCxLQUFLO0lBQzdCO0lBQ0EsT0FBT3BEO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNTyxHQWFkO0lBQ0MsT0FBTztRQUNMRixJQUFJRSxJQUFJRixFQUFFO1FBQ1ZPLE1BQU1MLElBQUlLLElBQUk7UUFDZDZCLE9BQU9sQyxJQUFJa0MsS0FBSztRQUNoQkMsUUFBUW5DLElBQUltQyxNQUFNO1FBQ2xCckIsT0FBT2QsSUFBSWMsS0FBSztRQUNoQnNCLFVBQVVwQyxJQUFJb0MsUUFBUTtRQUN0QkMsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCQyxpQkFBaUJ0QyxJQUFJc0MsZUFBZTtRQUNwQ0ksZUFBZTFDLElBQUkwQyxhQUFhO1FBQ2hDbkIsV0FBV3ZCLElBQUl1QixTQUFTO1FBQ3hCaEMsV0FBV1MsSUFBSVQsU0FBUztRQUN4QjZCLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBU3FELFVBQVVILEVBQWlDO0lBQ2xELE9BQU87UUFDTHhFLElBQUl3RSxHQUFHeEUsRUFBRTtRQUNUTyxNQUFNaUUsR0FBR2pFLElBQUk7UUFDYjZCLE9BQU9vQyxHQUFHcEMsS0FBSztRQUNmQyxRQUFRbUMsR0FBR25DLE1BQU07UUFDakJyQixPQUFPd0QsR0FBR3hELEtBQUs7UUFDZnNCLFVBQVVrQyxHQUFHbEMsUUFBUTtRQUNyQkMsT0FBT2lDLEdBQUdqQyxLQUFLO1FBQ2ZDLGlCQUFpQmdDLEdBQUdoQyxlQUFlO1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hY3Rpdml0aWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7O0NBS0MsR0FFNkI7QUFDb0I7QUFDUDtBQXdCM0MsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQiwrRUFBK0U7QUFFeEUsU0FBU0c7SUFDZCxPQUFPO1FBQ0wsTUFBTUMsTUFBS0MsT0FBeUIsRUFBRUMsVUFBOEI7WUFDbEUsTUFBTUMsUUFBUUMsV0FBV0g7WUFDekIsTUFBTUksT0FBTyxNQUFNVCx1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDQyxRQUFRLENBQUM7Z0JBQzFDSjtnQkFDQUssU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1SLFlBQVlTLFNBQVM7Z0JBQzNCQyxNQUFNVixZQUFZVyxVQUFVO1lBQzlCO1lBQ0EsT0FBT1IsS0FBS1MsR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ2EsVUFBVSxDQUFDO2dCQUFFaEIsT0FBTztvQkFBRWM7Z0JBQUc7WUFBRTtZQUM3RCxPQUFPQyxNQUFNSCxNQUFNRyxPQUFPO1FBQzVCO1FBRUEsTUFBTUUsWUFBV1QsUUFBUSxFQUFFO1lBQ3pCLE1BQU1OLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0MsU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1DO1lBQ1I7WUFDQSxPQUFPTixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTU0sZUFBY0MsVUFBa0IsRUFBRUMsUUFBZ0I7WUFDdEQsTUFBTWxCLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0osT0FBTztvQkFBRW1CO29CQUFZQztnQkFBUztnQkFDOUJmLFNBQVM7b0JBQUVDLElBQUk7Z0JBQU87WUFDeEI7WUFDQSxPQUFPSixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVMsUUFBT0MsS0FBMEI7WUFDckMsTUFBTVIsS0FBSyxDQUFDLElBQUksRUFBRVMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsSUFBSTtZQUN4RSxNQUFNYixNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDa0IsTUFBTSxDQUFDO2dCQUN2Q1EsTUFBTTtvQkFDSmY7b0JBQ0FSLElBQUksSUFBSWlCO29CQUNSTyxNQUFNUixNQUFNUSxJQUFJO29CQUNoQkMsT0FBT1QsTUFBTVMsS0FBSztvQkFDbEJaLFlBQVlHLE1BQU1ILFVBQVU7b0JBQzVCQyxVQUFVRSxNQUFNRixRQUFRO29CQUN4QlksU0FBU1YsTUFBTVUsT0FBTztvQkFDdEJDLGFBQWFDLEtBQUtDLFNBQVMsQ0FBQ2IsTUFBTVcsV0FBVyxJQUFJLENBQUM7Z0JBQ3BEO1lBQ0Y7WUFDQSxNQUFNRyxNQUFNeEIsTUFBTUc7WUFFbEIsd0JBQXdCO1lBQ3hCcEIsd0RBQWVBLENBQUN5QztZQUVoQixPQUFPQTtRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNDO0lBQ2QsT0FBTztRQUNMLE1BQU14QyxNQUFLQyxPQUF5QixFQUFFQyxVQUE4QjtZQUNsRSxJQUFJdUMsU0FBUzttQkFBSTVDLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVNxQixZQUFZO2dCQUN2Qm1CLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFckIsVUFBVSxLQUFLckIsUUFBUXFCLFVBQVU7WUFDbkU7WUFDQSxJQUFJckIsU0FBU3NCLFVBQVU7Z0JBQ3JCa0IsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLElBQU1BLEVBQUVwQixRQUFRLEtBQUt0QixRQUFRc0IsUUFBUTtZQUMvRDtZQUNBLElBQUl0QixTQUFTZ0MsTUFBTTtnQkFDakJRLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFVixJQUFJLEtBQUtoQyxRQUFRZ0MsSUFBSTtZQUN2RDtZQUNBLCtCQUErQjtZQUMvQlEsT0FBT0csSUFBSSxDQUFDLENBQUNELEdBQUdFLElBQU1BLEVBQUVwQyxFQUFFLENBQUNxQyxPQUFPLEtBQUtILEVBQUVsQyxFQUFFLENBQUNxQyxPQUFPO1lBQ25ELG1CQUFtQjtZQUNuQixNQUFNakMsU0FBU1gsWUFBWVcsVUFBVTtZQUNyQyxNQUFNRixRQUFRVCxZQUFZUyxTQUFTO1lBQ25DLE9BQU84QixPQUFPVixLQUFLLENBQUNsQixRQUFRQSxTQUFTRixPQUFPRyxHQUFHLENBQUNpQztRQUNsRDtRQUVBLE1BQU0vQixTQUFRQyxFQUFVO1lBQ3RCLE1BQU1YLFdBQVdULDZEQUFjQSxDQUFDbUQsSUFBSSxDQUFDLENBQUNMLElBQU1BLEVBQUUxQixFQUFFLEtBQUtBO1lBQ3JELE9BQU9YLFdBQVd5QyxVQUFVekMsWUFBWTtRQUMxQztRQUVBLE1BQU1jLFlBQVdULFFBQVEsRUFBRTtZQUN6QixPQUFPO21CQUFJZCw2REFBY0E7YUFBQyxDQUN2QitDLElBQUksQ0FBQyxDQUFDRCxHQUFHRSxJQUFNQSxFQUFFcEMsRUFBRSxDQUFDcUMsT0FBTyxLQUFLSCxFQUFFbEMsRUFBRSxDQUFDcUMsT0FBTyxJQUM1Q2YsS0FBSyxDQUFDLEdBQUdwQixPQUNURyxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTTFCLGVBQWNDLFVBQWtCLEVBQUVDLFFBQWdCO1lBQ3RELE9BQU8xQiw2REFBY0EsQ0FDbEI2QyxNQUFNLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRXJCLFVBQVUsS0FBS0EsY0FBY3FCLEVBQUVwQixRQUFRLEtBQUtBLFVBQzVEVCxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTXZCLFFBQU9DLEtBQTBCO1lBQ3JDLDJFQUEyRTtZQUMzRSxNQUFNUixLQUFLLENBQUMsSUFBSSxFQUFFUyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO1lBQ3hFLE1BQU1RLE1BQW1CO2dCQUN2QnRCO2dCQUNBUixJQUFJLElBQUlpQjtnQkFDUk8sTUFBTVIsTUFBTVEsSUFBSTtnQkFDaEJDLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQ2xCWixZQUFZRyxNQUFNSCxVQUFVO2dCQUM1QkMsVUFBVUUsTUFBTUYsUUFBUTtnQkFDeEJZLFNBQVNWLE1BQU1VLE9BQU87Z0JBQ3RCQyxhQUFhWCxNQUFNVyxXQUFXLElBQUksQ0FBQztZQUNyQztZQUVBLHdCQUF3QjtZQUN4QnRDLHdEQUFlQSxDQUFDeUM7WUFFaEIsT0FBT0E7UUFDVDtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTbkMsV0FBV0gsT0FBeUI7SUFDM0MsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNRSxRQUFpQyxDQUFDO0lBQ3hDLElBQUlGLFFBQVFxQixVQUFVLEVBQUU7UUFDdEJuQixNQUFNbUIsVUFBVSxHQUFHckIsUUFBUXFCLFVBQVU7SUFDdkM7SUFDQSxJQUFJckIsUUFBUXNCLFFBQVEsRUFBRTtRQUNwQnBCLE1BQU1vQixRQUFRLEdBQUd0QixRQUFRc0IsUUFBUTtJQUNuQztJQUNBLElBQUl0QixRQUFRZ0MsSUFBSSxFQUFFO1FBQ2hCOUIsTUFBTThCLElBQUksR0FBR2hDLFFBQVFnQyxJQUFJO0lBQzNCO0lBQ0EsT0FBTzlCO0FBQ1Q7QUFFQSxTQUFTWSxNQUFNRyxHQVNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZSLElBQUlTLElBQUlULEVBQUU7UUFDVndCLE1BQU1mLElBQUllLElBQUk7UUFDZEMsT0FBT2hCLElBQUlnQixLQUFLO1FBQ2hCWixZQUFZSixJQUFJSSxVQUFVO1FBQzFCQyxVQUFVTCxJQUFJSyxRQUFRO1FBQ3RCWSxTQUFTakIsSUFBSWlCLE9BQU87UUFDcEJDLGFBQWFDLEtBQUtZLEtBQUssQ0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:351:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:395:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:428:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/route.js:472:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:351:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:395:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:428:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9yZWNlaXB0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7O0NBS0MsR0FFNkI7QUFDMEM7QUFxQ3hFLCtFQUErRTtBQUMvRSwwQkFBMEI7QUFDMUIsK0VBQStFO0FBRXhFLFNBQVNHO0lBQ2QsT0FBTztRQUNMLE1BQU1DLE1BQUtDLE9BQXdCO1lBQ2pDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVIsdUNBQU1BLENBQUNTLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDO2dCQUN6Q0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCQyxNQUFNO1lBQ1I7WUFDQSxPQUFPTCxLQUFLTSxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTUMsU0FBUUMsRUFBVTtZQUN0QixNQUFNQyxNQUFNLE1BQU1sQix1Q0FBTUEsQ0FBQ1MsT0FBTyxDQUFDVSxVQUFVLENBQUM7Z0JBQUViLE9BQU87b0JBQUVXO2dCQUFHO1lBQUU7WUFDNUQsT0FBT0MsTUFBTUgsTUFBTUcsT0FBTztRQUM1QjtRQUVBLE1BQU1FLGtCQUFpQkMsV0FBbUI7WUFDeEMsTUFBTWIsT0FBTyxNQUFNUix1Q0FBTUEsQ0FBQ1MsT0FBTyxDQUFDQyxRQUFRLENBQUM7Z0JBQ3pDSixPQUFPO29CQUFFZTtnQkFBWTtnQkFDckJWLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87WUFDL0I7WUFDQSxPQUFPSixLQUFLTSxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTU8sa0JBQWlCQyxXQUFtQjtZQUN4QyxNQUFNZixPQUFPLE1BQU1SLHVDQUFNQSxDQUFDUyxPQUFPLENBQUNDLFFBQVEsQ0FBQztnQkFDekNKLE9BQU87b0JBQUVpQjtnQkFBWTtnQkFDckJaLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87WUFDL0I7WUFDQSxPQUFPSixLQUFLTSxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVM7WUFDSixNQUFNaEIsT0FBTyxNQUFNUix1Q0FBTUEsQ0FBQ1MsT0FBTyxDQUFDQyxRQUFRLENBQUM7Z0JBQ3pDSixPQUFPO29CQUFFbUIsU0FBUztnQkFBSztnQkFDdkJkLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87WUFDL0I7WUFDQSxPQUFPSixLQUFLTSxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVcsUUFBT0MsS0FBeUI7WUFDcEMsTUFBTVQsTUFBTSxNQUFNbEIsdUNBQU1BLENBQUNTLE9BQU8sQ0FBQ2lCLE1BQU0sQ0FBQztnQkFDdENFLE1BQU07b0JBQ0pQLGFBQWFNLE1BQU1OLFdBQVc7b0JBQzlCRSxhQUFhSSxNQUFNSixXQUFXLElBQUk7b0JBQ2xDTSxNQUFNRixNQUFNRSxJQUFJO29CQUNoQkMsYUFBYUgsTUFBTUcsV0FBVztvQkFDOUJDLGlCQUFpQkMsS0FBS0MsU0FBUyxDQUFDTixNQUFNTyxXQUFXLElBQUksQ0FBQztvQkFDdER0QixXQUFXLElBQUl1QjtnQkFDakI7WUFDRjtZQUNBLE9BQU9wQixNQUFNRztRQUNmO1FBRUEsTUFBTWtCLFFBQU9uQixFQUFVLEVBQUVVLEtBQXlCO1lBQ2hELE1BQU1VLFdBQVcsTUFBTXJDLHVDQUFNQSxDQUFDUyxPQUFPLENBQUNVLFVBQVUsQ0FBQztnQkFBRWIsT0FBTztvQkFBRVc7Z0JBQUc7WUFBRTtZQUNqRSxJQUFJLENBQUNvQixVQUFVLE9BQU87WUFFdEIsb0NBQW9DO1lBQ3BDLE1BQU1DLFFBQVFYLE1BQU1ZLE1BQU0sS0FBSyxXQUFXLGtCQUFrQjtZQUM1RCxNQUFNQyxlQUFlSCxRQUFRLENBQUNDLE1BQU07WUFDcEMsTUFBTUcsV0FBV0QsZUFBZWIsTUFBTWUsS0FBSztZQUUzQyxxQ0FBcUM7WUFDckMsTUFBTUMsWUFBWSxLQUFLO1lBQ3ZCLE1BQU1DLGlCQUNKSCxTQUFTSSxNQUFNLEdBQUdGLFlBQ2QscUJBQXFCRixTQUFTSyxLQUFLLENBQUMsQ0FBQ0gsYUFDckNGO1lBRU4sTUFBTXZCLE1BQU0sTUFBTWxCLHVDQUFNQSxDQUFDUyxPQUFPLENBQUNzQyxNQUFNLENBQUM7Z0JBQ3RDekMsT0FBTztvQkFBRVc7Z0JBQUc7Z0JBQ1pXLE1BQU07b0JBQUUsQ0FBQ1UsTUFBTSxFQUFFTTtnQkFBZTtZQUNsQztZQUVBLHdCQUF3QjtZQUN4QjNDLDREQUFtQkEsQ0FBQ2dCLElBQUlVLE1BQU1ZLE1BQU0sRUFBRVosTUFBTWUsS0FBSztZQUVqRCxPQUFPM0IsTUFBTUc7UUFDZjtRQUVBLE1BQU04QixVQUFTL0IsRUFBVSxFQUFFVSxLQUEyQjtZQUNwRCxNQUFNVSxXQUFXLE1BQU1yQyx1Q0FBTUEsQ0FBQ1MsT0FBTyxDQUFDVSxVQUFVLENBQUM7Z0JBQUViLE9BQU87b0JBQUVXO2dCQUFHO1lBQUU7WUFDakUsSUFBSSxDQUFDb0IsVUFBVSxPQUFPO1lBRXRCLE1BQU1uQixNQUFNLE1BQU1sQix1Q0FBTUEsQ0FBQ1MsT0FBTyxDQUFDc0MsTUFBTSxDQUFDO2dCQUN0Q3pDLE9BQU87b0JBQUVXO2dCQUFHO2dCQUNaVyxNQUFNO29CQUNKcUIsVUFBVXRCLE1BQU1zQixRQUFRO29CQUN4QkMsWUFBWXZCLE1BQU11QixVQUFVO29CQUM1QkMsWUFBWXhCLE1BQU13QixVQUFVLEdBQUduQixLQUFLQyxTQUFTLENBQUNOLE1BQU13QixVQUFVLElBQUk7b0JBQ2xFMUIsU0FBUyxJQUFJVTtnQkFDZjtZQUNGO1lBRUEsd0JBQXdCO1lBQ3hCakMsZ0VBQXVCQSxDQUFDZSxJQUFJVSxNQUFNc0IsUUFBUSxFQUFFdEIsTUFBTXVCLFVBQVU7WUFFNUQsT0FBT25DLE1BQU1HO1FBQ2Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLHNCQUFzQjtBQUN0QiwrRUFBK0U7QUFFL0UsTUFBTWtDLGVBQTZCLEVBQUU7QUFFOUIsU0FBU0M7SUFDZCxPQUFPO1FBQ0wsTUFBTWpELE1BQUtrRCxRQUF5QjtZQUNsQyxPQUFPO21CQUFJRjthQUFhLENBQUNHLElBQUksQ0FDM0IsQ0FBQ0MsR0FBR0MsSUFBTUEsRUFBRTdDLFNBQVMsQ0FBQzhDLE9BQU8sS0FBS0YsRUFBRTVDLFNBQVMsQ0FBQzhDLE9BQU87UUFFekQ7UUFFQSxNQUFNMUMsU0FBUUMsRUFBVTtZQUN0QixPQUFPbUMsYUFBYU8sSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUUzQyxFQUFFLEtBQUtBLE9BQU87UUFDbEQ7UUFFQSxNQUFNRyxrQkFBaUJDLFdBQW1CO1lBQ3hDLE9BQU8rQixhQUFhUyxNQUFNLENBQUMsQ0FBQ0QsSUFBTUEsRUFBRXZDLFdBQVcsS0FBS0E7UUFDdEQ7UUFFQSxNQUFNQyxrQkFBaUJDLFdBQW1CO1lBQ3hDLE9BQU82QixhQUFhUyxNQUFNLENBQUMsQ0FBQ0QsSUFBTUEsRUFBRXJDLFdBQVcsS0FBS0E7UUFDdEQ7UUFFQSxNQUFNQztZQUNKLE9BQU80QixhQUFhUyxNQUFNLENBQUMsQ0FBQ0QsSUFBTUEsRUFBRW5DLE9BQU8sS0FBSztRQUNsRDtRQUVBLE1BQU1DLFFBQU9DLEtBQXlCO1lBQ3BDLE1BQU1sQixVQUFzQjtnQkFDMUJRLElBQUksQ0FBQyxVQUFVLEVBQUVrQixLQUFLMkIsR0FBRyxJQUFJO2dCQUM3QnpDLGFBQWFNLE1BQU1OLFdBQVc7Z0JBQzlCRSxhQUFhSSxNQUFNSixXQUFXLElBQUk7Z0JBQ2xDTSxNQUFNRixNQUFNRSxJQUFJO2dCQUNoQkMsYUFBYUgsTUFBTUcsV0FBVztnQkFDOUJDLGlCQUFpQkosTUFBTU8sV0FBVyxJQUFJLENBQUM7Z0JBQ3ZDZSxVQUFVO2dCQUNWQyxZQUFZO2dCQUNaYSxlQUFlO2dCQUNmQyxlQUFlO2dCQUNmYixZQUFZO2dCQUNadkMsV0FBVyxJQUFJdUI7Z0JBQ2ZWLFNBQVM7WUFDWDtZQUNBMkIsYUFBYWEsSUFBSSxDQUFDeEQ7WUFDbEIsT0FBT0E7UUFDVDtRQUVBLE1BQU0yQixRQUFPbkIsRUFBVSxFQUFFVSxLQUF5QjtZQUNoRCxNQUFNbEIsVUFBVTJDLGFBQWFPLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFM0MsRUFBRSxLQUFLQTtZQUNsRCxJQUFJLENBQUNSLFNBQVMsT0FBTztZQUVyQixJQUFJa0IsTUFBTVksTUFBTSxLQUFLLFVBQVU7Z0JBQzdCOUIsUUFBUXNELGFBQWEsSUFBSXBDLE1BQU1lLEtBQUs7WUFDdEMsT0FBTztnQkFDTGpDLFFBQVF1RCxhQUFhLElBQUlyQyxNQUFNZSxLQUFLO1lBQ3RDO1lBRUEsd0JBQXdCO1lBQ3hCekMsNERBQW1CQSxDQUFDZ0IsSUFBSVUsTUFBTVksTUFBTSxFQUFFWixNQUFNZSxLQUFLO1lBRWpELE9BQU9qQztRQUNUO1FBRUEsTUFBTXVDLFVBQVMvQixFQUFVLEVBQUVVLEtBQTJCO1lBQ3BELE1BQU1sQixVQUFVMkMsYUFBYU8sSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUUzQyxFQUFFLEtBQUtBO1lBQ2xELElBQUksQ0FBQ1IsU0FBUyxPQUFPO1lBRXJCQSxRQUFRd0MsUUFBUSxHQUFHdEIsTUFBTXNCLFFBQVE7WUFDakN4QyxRQUFReUMsVUFBVSxHQUFHdkIsTUFBTXVCLFVBQVU7WUFDckN6QyxRQUFRMEMsVUFBVSxHQUFHeEIsTUFBTXdCLFVBQVUsSUFBSTtZQUN6QzFDLFFBQVFnQixPQUFPLEdBQUcsSUFBSVU7WUFFdEIsd0JBQXdCO1lBQ3hCakMsZ0VBQXVCQSxDQUFDZSxJQUFJVSxNQUFNc0IsUUFBUSxFQUFFdEIsTUFBTXVCLFVBQVU7WUFFNUQsT0FBT3pDO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU0YsV0FBV0YsT0FBd0I7SUFDMUMsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNQyxRQUFpQyxDQUFDO0lBQ3hDLElBQUlELFFBQVFnQixXQUFXLEVBQUU7UUFDdkJmLE1BQU1lLFdBQVcsR0FBR2hCLFFBQVFnQixXQUFXO0lBQ3pDO0lBQ0EsSUFBSWhCLFFBQVFrQixXQUFXLEVBQUU7UUFDdkJqQixNQUFNaUIsV0FBVyxHQUFHbEIsUUFBUWtCLFdBQVc7SUFDekM7SUFDQSxJQUFJbEIsUUFBUXdCLElBQUksRUFBRTtRQUNoQnZCLE1BQU11QixJQUFJLEdBQUdxQyxNQUFNQyxPQUFPLENBQUM5RCxRQUFRd0IsSUFBSSxJQUFJO1lBQUV1QyxJQUFJL0QsUUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/workspace/[id]/route.js:472:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby93b3JrT3JkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNZO0FBQ3dCO0FBcURsRSwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTSTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1ULHVDQUFNQSxDQUFDVSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLGFBQVlWLE9BQTBCO1lBQzFDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCSSxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO29CQUNuQztnQkFDRjtZQUNGO1lBQ0EsT0FBT1osS0FBS0ssR0FBRyxDQUFDLENBQUNRLE1BQVM7b0JBQ3hCLEdBQUdQLE1BQU1PLElBQUk7b0JBQ2JKLFlBQVlJLElBQUlKLFVBQVUsQ0FBQ0osR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQ3RDSCxJQUFJRyxHQUFHSCxFQUFFOzRCQUNUQyxRQUFRRSxHQUFHRixNQUFNO3dCQUNuQjtnQkFDRjtRQUNGO1FBRUEsTUFBTUcsU0FBUUosRUFBVTtZQUN0QixNQUFNRSxNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDZSxVQUFVLENBQUM7Z0JBQUVsQixPQUFPO29CQUFFYTtnQkFBRztZQUFFO1lBQzlELE9BQU9FLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxXQUFVQyxJQUFZO1lBQzFCLE1BQU1MLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNlLFVBQVUsQ0FBQztnQkFBRWxCLE9BQU87b0JBQUVvQjtnQkFBSztZQUFFO1lBQ2hFLE9BQU9MLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNTTtZQUNKLE1BQU1DLFNBQVMsTUFBTTdCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQixPQUFPLENBQUM7Z0JBQzVDQyxJQUFJO29CQUFDO2lCQUFRO2dCQUNiQyxRQUFRO29CQUFFWixJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT2EsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT2YsR0FBRyxDQUFDLENBQUNxQixJQUFNO29CQUFDQSxFQUFFQyxLQUFLO29CQUFFRCxFQUFFSCxNQUFNLENBQUNaLEVBQUU7aUJBQUM7UUFFNUM7UUFFQSxNQUFNaUI7WUFDSixNQUFNQyxRQUFRLElBQUlDO1lBQ2xCRCxNQUFNRSxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUc7WUFFeEIsT0FBT3hDLHVDQUFNQSxDQUFDVSxTQUFTLENBQUMrQixLQUFLLENBQUM7Z0JBQzVCbEMsT0FBTztvQkFDTDZCLE9BQU87b0JBQ1BNLFdBQVc7d0JBQUVDLEtBQUtMO29CQUFNO2dCQUMxQjtZQUNGO1FBQ0Y7UUFFQSxNQUFNTSxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTUUsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUM1Q2xCLE9BQU87b0JBQUVhO2dCQUFHO2dCQUNaSCxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO3dCQUNqQ1QsU0FBUzs0QkFBRWlDLFdBQVc7d0JBQU07b0JBQzlCO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJLENBQUN2QixLQUFLLE9BQU87WUFDakIsT0FBTztnQkFDTCxHQUFHUCxNQUFNTyxJQUFJO2dCQUNiSixZQUFZSSxJQUFJSixVQUFVLENBQUNKLEdBQUcsQ0FBQyxDQUFDUyxLQUFRO3dCQUN0Q0gsSUFBSUcsR0FBR0gsRUFBRTt3QkFDVEMsUUFBUUUsR0FBR0YsTUFBTTtvQkFDbkI7WUFDRjtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLHFCQUFxQjtZQUNyQixNQUFNQyxTQUFTLE1BQU1oRCx1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDdUMsU0FBUyxDQUFDO2dCQUM5Q3JDLFNBQVM7b0JBQUVlLE1BQU07Z0JBQU87Z0JBQ3hCUixRQUFRO29CQUFFUSxNQUFNO2dCQUFLO1lBQ3ZCO1lBQ0EsTUFBTXVCLFVBQVVGLFNBQVNHLFNBQVNILE9BQU9yQixJQUFJLENBQUN5QixPQUFPLENBQUMsT0FBTyxLQUFLLE1BQU07WUFDeEUsTUFBTXpCLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPSCxVQUFVLEdBQUdJLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekQsTUFBTWhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQyxNQUFNLENBQUM7Z0JBQ3hDUyxNQUFNO29CQUNKNUI7b0JBQ0E2QixPQUFPVCxNQUFNUyxLQUFLO29CQUNsQkMsUUFBUVYsTUFBTVUsTUFBTTtvQkFDcEJyQixPQUFPO29CQUNQc0IsVUFBVVgsTUFBTVcsUUFBUSxJQUFJO29CQUM1QkMsT0FBT1osTUFBTVksS0FBSyxJQUFJO29CQUN0QkMsaUJBQWlCYixNQUFNYSxlQUFlLElBQUk7Z0JBQzVDO1lBQ0Y7WUFFQSxtQkFBbUI7WUFDbkIsTUFBTTNELHVEQUFjQSxDQUFDcUIsSUFBSUYsRUFBRSxFQUFFRSxJQUFJSyxJQUFJLEVBQUVMLElBQUlrQyxLQUFLLEVBQUVsQyxJQUFJbUMsTUFBTTtZQUU1RCxPQUFPMUMsTUFBTU87UUFDZjtRQUVBLE1BQU11QyxRQUFPekMsRUFBVSxFQUFFMkIsS0FBMkI7WUFDbEQsTUFBTWUsV0FBVyxNQUFNOUQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUFFbEIsT0FBTztvQkFBRWE7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMwQyxVQUFVLE9BQU87WUFFdEIsTUFBTXhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNtRCxNQUFNLENBQUM7Z0JBQ3hDdEQsT0FBTztvQkFBRWE7Z0JBQUc7Z0JBQ1ptQyxNQUFNO29CQUNKLEdBQUlSLE1BQU1TLEtBQUssS0FBS08sYUFBYTt3QkFBRVAsT0FBT1QsTUFBTVMsS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJVCxNQUFNVSxNQUFNLEtBQUtNLGFBQWE7d0JBQUVOLFFBQVFWLE1BQU1VLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSVYsTUFBTVgsS0FBSyxLQUFLMkIsYUFBYTt3QkFBRTNCLE9BQU9XLE1BQU1YLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSVcsTUFBTVcsUUFBUSxLQUFLSyxhQUFhO3dCQUFFTCxVQUFVWCxNQUFNVyxRQUFRO29CQUFDLENBQUM7b0JBQ2hFLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTt3QkFBRUosT0FBT1osTUFBTVksS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJWixNQUFNaUIsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlakIsTUFBTWlCLGFBQWE7b0JBQUMsQ0FBQztvQkFDL0UsR0FBSWpCLE1BQU1YLEtBQUssS0FBSyxhQUFhO3dCQUFFTSxXQUFXLElBQUlIO29CQUFPLENBQUM7Z0JBQzVEO1lBQ0Y7WUFFQSwrQ0FBK0M7WUFDL0MsSUFBSVEsTUFBTVMsS0FBSyxLQUFLTyxhQUFhaEIsTUFBTVUsTUFBTSxLQUFLTSxXQUFXO2dCQUMzRCxNQUFNOUQsdURBQWNBLENBQUNxQixJQUFJRixFQUFFLEVBQUVFLElBQUlLLElBQUksRUFBRUwsSUFBSWtDLEtBQUssRUFBRWxDLElBQUltQyxNQUFNO1lBQzlEO1lBRUEsT0FBTzFDLE1BQU1PO1FBQ2Y7UUFFQSxNQUFNMkMseUJBQ0o3QyxFQUFVLEVBQ1Y4QyxRQUFnQixFQUNoQkMsS0FBYTtZQUViLE9BQU9uRSx1Q0FBTUEsQ0FBQ29FLFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsb0JBQW9CO2dCQUNwQixNQUFNUCxXQUFXLE1BQU1PLEdBQUczRCxTQUFTLENBQUNlLFVBQVUsQ0FBQztvQkFBRWxCLE9BQU87d0JBQUVhO29CQUFHO2dCQUFFO2dCQUMvRCxJQUFJLENBQUMwQyxVQUFVLE9BQU87Z0JBRXRCLE1BQU1RLGdCQUFnQlIsU0FBUzFCLEtBQUs7Z0JBRXBDLG9CQUFvQjtnQkFDcEIsTUFBTWQsTUFBTSxNQUFNK0MsR0FBRzNELFNBQVMsQ0FBQ21ELE1BQU0sQ0FBQztvQkFDcEN0RCxPQUFPO3dCQUFFYTtvQkFBRztvQkFDWm1DLE1BQU07d0JBQ0puQixPQUFPOEI7d0JBQ1AsR0FBSUEsYUFBYSxhQUFhOzRCQUFFeEIsV0FBVyxJQUFJSDt3QkFBTyxDQUFDO29CQUN6RDtnQkFDRjtnQkFFQSx5QkFBeUI7Z0JBQ3pCLE1BQU1nQyxhQUFhLENBQUMsSUFBSSxFQUFFaEMsS0FBS2lDLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLEtBQUssQ0FBQyxHQUFHLElBQUk7Z0JBQ2hGLE1BQU1QLEdBQUdRLFFBQVEsQ0FBQy9CLE1BQU0sQ0FBQztvQkFDdkJTLE1BQU07d0JBQ0puQyxJQUFJbUQ7d0JBQ0pPLElBQUksSUFBSXZDO3dCQUNSd0MsTUFBTTt3QkFDTlo7d0JBQ0FhLFlBQVk7d0JBQ1pDLFVBQVU3RDt3QkFDVjhELFNBQVMsQ0FBQywyQkFBMkIsRUFBRWhCLFVBQVU7d0JBQ2pEaUIsYUFBYUMsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQmY7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x4RCxXQUFXSyxNQUFNTztvQkFDakJnRDtvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNlO0lBQ2QsT0FBTztRQUNMLE1BQU1qRixNQUFLQyxPQUEwQjtZQUNuQyxJQUFJaUYsU0FBUzttQkFBSXJGLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVM4QixPQUFPO2dCQUNsQixNQUFNb0QsU0FBU0MsTUFBTUMsT0FBTyxDQUFDcEYsUUFBUThCLEtBQUssSUFBSTlCLFFBQVE4QixLQUFLLEdBQUc7b0JBQUM5QixRQUFROEIsS0FBSztpQkFBQztnQkFDN0VtRCxTQUFTQSxPQUFPSSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0osT0FBT0ssUUFBUSxDQUFDRCxHQUFHeEQsS0FBSztZQUN6RDtZQUNBLElBQUk5QixTQUFTb0QsVUFBVTtnQkFDckIsTUFBTW9DLGFBQWFMLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUlwRCxRQUFRb0QsUUFBUSxHQUFHO29CQUFDcEQsUUFBUW9ELFFBQVE7aUJBQUM7Z0JBQzFGNkIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9FLFdBQVdELFFBQVEsQ0FBQ0QsR0FBR2xDLFFBQVE7WUFDaEU7WUFDQSxJQUFJcEQsU0FBU3FELE9BQU87Z0JBQ2xCNEIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqQyxLQUFLLEtBQUtyRCxRQUFRcUQsS0FBSztZQUMzRDtZQUNBLE9BQU80QixPQUFPekUsR0FBRyxDQUFDaUY7UUFDcEI7UUFFQSxNQUFNL0UsYUFBWVYsT0FBMEI7WUFDMUMsTUFBTTBGLGFBQWEsTUFBTSxJQUFJLENBQUMzRixJQUFJLENBQUNDO1lBQ25DLE9BQU8wRixXQUFXbEYsR0FBRyxDQUFDLENBQUM4RSxLQUFRO29CQUM3QixHQUFHQSxFQUFFO29CQUNMMUUsWUFBWWYsNkRBQWNBLENBQ3ZCd0YsTUFBTSxDQUFDLENBQUNwRSxLQUFPQSxHQUFHMEUsV0FBVyxLQUFLTCxHQUFHeEUsRUFBRSxFQUN2Q04sR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQUVILElBQUlHLEdBQUdILEVBQUU7NEJBQUVDLFFBQVFFLEdBQUdGLE1BQU07d0JBQUM7Z0JBQ2pEO1FBQ0Y7UUFFQSxNQUFNRyxTQUFRSixFQUFVO1lBQ3RCLE1BQU13RSxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsT0FBT3dFLEtBQUtHLFVBQVVILE1BQU07UUFDOUI7UUFFQSxNQUFNbEUsV0FBVUMsSUFBWTtZQUMxQixNQUFNaUUsS0FBSzFGLDZEQUFjQSxDQUFDZ0csSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUV4RSxJQUFJLEtBQUtBO1lBQ2pELE9BQU9pRSxLQUFLRyxVQUFVSCxNQUFNO1FBQzlCO1FBRUEsTUFBTWhFO1lBQ0osTUFBTXdFLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNUixNQUFNMUYsNkRBQWNBLENBQUU7Z0JBQy9Ca0csTUFBTSxDQUFDUixHQUFHeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQ2dFLE1BQU0sQ0FBQ1IsR0FBR3hELEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPZ0U7UUFDVDtRQUVBLE1BQU0vRDtZQUNKLE1BQU1DLFFBQVEsSUFBSUM7WUFDbEJELE1BQU1FLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRztZQUV4QixPQUFPdEMsNkRBQWNBLENBQUN5RixNQUFNLENBQzFCLENBQUNDLEtBQU9BLEdBQUd4RCxLQUFLLEtBQUssYUFBYXdELEdBQUdsRCxTQUFTLElBQUlrRCxHQUFHbEQsU0FBUyxJQUFJSixPQUNsRStELE1BQU07UUFDVjtRQUVBLE1BQU16RCxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTXdFLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFDaEIsT0FBTztnQkFDTCxHQUFHRyxVQUFVSCxHQUFHO2dCQUNoQjFFLFlBQVlmLDZEQUFjQSxDQUN2QndGLE1BQU0sQ0FBQyxDQUFDcEUsS0FBT0EsR0FBRzBFLFdBQVcsS0FBSzdFLElBQ2xDTixHQUFHLENBQUMsQ0FBQ1MsS0FBUTt3QkFBRUgsSUFBSUcsR0FBR0gsRUFBRTt3QkFBRUMsUUFBUUUsR0FBR0YsTUFBTTtvQkFBQztZQUNqRDtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLDRCQUE0QjtZQUM1QixNQUFNM0IsS0FBSyxDQUFDLFFBQVEsRUFBRW1CLEtBQUtpQyxHQUFHLElBQUk7WUFDbEMsTUFBTTdDLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPbkQsNkRBQWNBLENBQUNtRyxNQUFNLEdBQUcsR0FBRy9DLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFDdkUsTUFBTWtCLE1BQU0sSUFBSWpDO1lBRWhCLE1BQU0rRCxRQUFRO2dCQUNabEY7Z0JBQ0FPO2dCQUNBNkIsT0FBT1QsTUFBTVMsS0FBSztnQkFDbEJDLFFBQVFWLE1BQU1VLE1BQU07Z0JBQ3BCckIsT0FBTztnQkFDUHNCLFVBQVdYLE1BQU1XLFFBQVEsSUFBSTtnQkFDN0JDLE9BQVFaLE1BQU1ZLEtBQUssSUFBSTtnQkFDdkJDLGlCQUFpQmIsTUFBTWEsZUFBZSxJQUFJO2dCQUMxQ0ksZUFBZTtnQkFDZm5CLFdBQVcyQjtnQkFDWDNELFdBQVcyRDtnQkFDWDlCLFdBQVc7WUFDYjtZQUVBLHVEQUF1RDtZQUN2RCxPQUFPcUQsVUFBVU87UUFDbkI7UUFFQSxNQUFNekMsUUFBT3pDLEVBQVUsRUFBRTJCLEtBQTJCO1lBQ2xELE1BQU02QyxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDd0UsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdHLFVBQVVILEdBQUc7Z0JBQ2hCLEdBQUk3QyxNQUFNUyxLQUFLLEtBQUtPLGFBQWE7b0JBQUVQLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSVQsTUFBTVUsTUFBTSxLQUFLTSxhQUFhO29CQUFFTixRQUFRVixNQUFNVSxNQUFNO2dCQUFDLENBQUM7Z0JBQzFELEdBQUlWLE1BQU1YLEtBQUssS0FBSzJCLGFBQWE7b0JBQUUzQixPQUFPVyxNQUFNWCxLQUFLO2dCQUEwQixDQUFDO2dCQUNoRixHQUFJVyxNQUFNVyxRQUFRLEtBQUtLLGFBQWE7b0JBQUVMLFVBQVVYLE1BQU1XLFFBQVE7Z0JBQTZCLENBQUM7Z0JBQzVGLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTtvQkFBRUosT0FBT1osTUFBTVksS0FBSztnQkFBMEIsQ0FBQztnQkFDaEYsR0FBSVosTUFBTWlCLGFBQWEsS0FBS0QsYUFBYTtvQkFBRUMsZUFBZWpCLE1BQU1pQixhQUFhO2dCQUFDLENBQUM7Z0JBQy9FbkQsV0FBVyxJQUFJMEI7WUFDakI7UUFDRjtRQUVBLE1BQU0wQix5QkFDSjdDLEVBQVUsRUFDVjhDLFFBQWdCLEVBQ2hCcUMsTUFBYztZQUVkLE1BQU1YLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFFaEIsTUFBTXRCLGdCQUFnQnNCLEdBQUd4RCxLQUFLO1lBQzlCLE1BQU1tQyxhQUFhLENBQUMsU0FBUyxFQUFFaEMsS0FBS2lDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMOUQsV0FBVztvQkFDVCxHQUFHcUYsVUFBVUgsR0FBRztvQkFDaEJ4RCxPQUFPOEI7b0JBQ1ByRCxXQUFXLElBQUkwQjtvQkFDZixHQUFJMkIsYUFBYSxhQUFhO3dCQUFFeEIsV0FBVyxJQUFJSDtvQkFBTyxDQUFDO2dCQUN6RDtnQkFDQStCO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUy9ELFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFROEIsS0FBSyxFQUFFO1FBQ2pCN0IsTUFBTTZCLEtBQUssR0FBR3FELE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVE4QixLQUFLLElBQUk7WUFBRW9FLElBQUlsRyxRQUFROEIsS0FBSztRQUFDLElBQUk5QixRQUFROEIsS0FBSztJQUNwRjtJQUNBLElBQUk5QixRQUFRb0QsUUFBUSxFQUFFO1FBQ3BCbkQsTUFBTW1ELFFBQVEsR0FBRytCLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUk7WUFBRThDLElBQUlsRyxRQUFRb0QsUUFBUTtRQUFDLElBQUlwRCxRQUFRb0QsUUFBUTtJQUNoRztJQUNBLElBQUlwRCxRQUFRcUQsS0FBSyxFQUFFO1FBQ2pCcEQsTUFBTW9ELEtBQUssR0FBR3JELFFBQVFxRCxLQUFLO0lBQzdCO0lBQ0EsT0FBT3BEO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNTyxHQWFkO0lBQ0MsT0FBTztRQUNMRixJQUFJRSxJQUFJRixFQUFFO1FBQ1ZPLE1BQU1MLElBQUlLLElBQUk7UUFDZDZCLE9BQU9sQyxJQUFJa0MsS0FBSztRQUNoQkMsUUFBUW5DLElBQUltQyxNQUFNO1FBQ2xCckIsT0FBT2QsSUFBSWMsS0FBSztRQUNoQnNCLFVBQVVwQyxJQUFJb0MsUUFBUTtRQUN0QkMsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCQyxpQkFBaUJ0QyxJQUFJc0MsZUFBZTtRQUNwQ0ksZUFBZTFDLElBQUkwQyxhQUFhO1FBQ2hDbkIsV0FBV3ZCLElBQUl1QixTQUFTO1FBQ3hCaEMsV0FBV1MsSUFBSVQsU0FBUztRQUN4QjZCLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBU3FELFVBQVVILEVBQWlDO0lBQ2xELE9BQU87UUFDTHhFLElBQUl3RSxHQUFHeEUsRUFBRTtRQUNUTyxNQUFNaUUsR0FBR2pFLElBQUk7UUFDYjZCLE9BQU9vQyxHQUFHcEMsS0FBSztRQUNmQyxRQUFRbUMsR0FBR25DLE1BQU07UUFDakJyQixPQUFPd0QsR0FBR3hELEtBQUs7UUFDZnNCLFVBQVVrQyxHQUFHbEMsUUFBUTtRQUNyQkMsT0FBT2lDLEdBQUdqQyxLQUFLO1FBQ2ZDLGlCQUFpQmdDLEdBQUdoQyxlQUFlO1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:384:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:417:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:351:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:395:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:428:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/agents/[id]/avatar/route.js:472:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:384:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:417:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/operations/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:307:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:373:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:406:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:439:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/activities/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:318:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hY3Rpdml0aWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7O0NBS0MsR0FFNkI7QUFDb0I7QUFDUDtBQXdCM0MsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQiwrRUFBK0U7QUFFeEUsU0FBU0c7SUFDZCxPQUFPO1FBQ0wsTUFBTUMsTUFBS0MsT0FBeUIsRUFBRUMsVUFBOEI7WUFDbEUsTUFBTUMsUUFBUUMsV0FBV0g7WUFDekIsTUFBTUksT0FBTyxNQUFNVCx1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDQyxRQUFRLENBQUM7Z0JBQzFDSjtnQkFDQUssU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1SLFlBQVlTLFNBQVM7Z0JBQzNCQyxNQUFNVixZQUFZVyxVQUFVO1lBQzlCO1lBQ0EsT0FBT1IsS0FBS1MsR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ2EsVUFBVSxDQUFDO2dCQUFFaEIsT0FBTztvQkFBRWM7Z0JBQUc7WUFBRTtZQUM3RCxPQUFPQyxNQUFNSCxNQUFNRyxPQUFPO1FBQzVCO1FBRUEsTUFBTUUsWUFBV1QsUUFBUSxFQUFFO1lBQ3pCLE1BQU1OLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0MsU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1DO1lBQ1I7WUFDQSxPQUFPTixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTU0sZUFBY0MsVUFBa0IsRUFBRUMsUUFBZ0I7WUFDdEQsTUFBTWxCLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0osT0FBTztvQkFBRW1CO29CQUFZQztnQkFBUztnQkFDOUJmLFNBQVM7b0JBQUVDLElBQUk7Z0JBQU87WUFDeEI7WUFDQSxPQUFPSixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVMsUUFBT0MsS0FBMEI7WUFDckMsTUFBTVIsS0FBSyxDQUFDLElBQUksRUFBRVMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsSUFBSTtZQUN4RSxNQUFNYixNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDa0IsTUFBTSxDQUFDO2dCQUN2Q1EsTUFBTTtvQkFDSmY7b0JBQ0FSLElBQUksSUFBSWlCO29CQUNSTyxNQUFNUixNQUFNUSxJQUFJO29CQUNoQkMsT0FBT1QsTUFBTVMsS0FBSztvQkFDbEJaLFlBQVlHLE1BQU1ILFVBQVU7b0JBQzVCQyxVQUFVRSxNQUFNRixRQUFRO29CQUN4QlksU0FBU1YsTUFBTVUsT0FBTztvQkFDdEJDLGFBQWFDLEtBQUtDLFNBQVMsQ0FBQ2IsTUFBTVcsV0FBVyxJQUFJLENBQUM7Z0JBQ3BEO1lBQ0Y7WUFDQSxNQUFNRyxNQUFNeEIsTUFBTUc7WUFFbEIsd0JBQXdCO1lBQ3hCcEIsd0RBQWVBLENBQUN5QztZQUVoQixPQUFPQTtRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNDO0lBQ2QsT0FBTztRQUNMLE1BQU14QyxNQUFLQyxPQUF5QixFQUFFQyxVQUE4QjtZQUNsRSxJQUFJdUMsU0FBUzttQkFBSTVDLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVNxQixZQUFZO2dCQUN2Qm1CLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFckIsVUFBVSxLQUFLckIsUUFBUXFCLFVBQVU7WUFDbkU7WUFDQSxJQUFJckIsU0FBU3NCLFVBQVU7Z0JBQ3JCa0IsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLElBQU1BLEVBQUVwQixRQUFRLEtBQUt0QixRQUFRc0IsUUFBUTtZQUMvRDtZQUNBLElBQUl0QixTQUFTZ0MsTUFBTTtnQkFDakJRLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFVixJQUFJLEtBQUtoQyxRQUFRZ0MsSUFBSTtZQUN2RDtZQUNBLCtCQUErQjtZQUMvQlEsT0FBT0csSUFBSSxDQUFDLENBQUNELEdBQUdFLElBQU1BLEVBQUVwQyxFQUFFLENBQUNxQyxPQUFPLEtBQUtILEVBQUVsQyxFQUFFLENBQUNxQyxPQUFPO1lBQ25ELG1CQUFtQjtZQUNuQixNQUFNakMsU0FBU1gsWUFBWVcsVUFBVTtZQUNyQyxNQUFNRixRQUFRVCxZQUFZUyxTQUFTO1lBQ25DLE9BQU84QixPQUFPVixLQUFLLENBQUNsQixRQUFRQSxTQUFTRixPQUFPRyxHQUFHLENBQUNpQztRQUNsRDtRQUVBLE1BQU0vQixTQUFRQyxFQUFVO1lBQ3RCLE1BQU1YLFdBQVdULDZEQUFjQSxDQUFDbUQsSUFBSSxDQUFDLENBQUNMLElBQU1BLEVBQUUxQixFQUFFLEtBQUtBO1lBQ3JELE9BQU9YLFdBQVd5QyxVQUFVekMsWUFBWTtRQUMxQztRQUVBLE1BQU1jLFlBQVdULFFBQVEsRUFBRTtZQUN6QixPQUFPO21CQUFJZCw2REFBY0E7YUFBQyxDQUN2QitDLElBQUksQ0FBQyxDQUFDRCxHQUFHRSxJQUFNQSxFQUFFcEMsRUFBRSxDQUFDcUMsT0FBTyxLQUFLSCxFQUFFbEMsRUFBRSxDQUFDcUMsT0FBTyxJQUM1Q2YsS0FBSyxDQUFDLEdBQUdwQixPQUNURyxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTTFCLGVBQWNDLFVBQWtCLEVBQUVDLFFBQWdCO1lBQ3RELE9BQU8xQiw2REFBY0EsQ0FDbEI2QyxNQUFNLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRXJCLFVBQVUsS0FBS0EsY0FBY3FCLEVBQUVwQixRQUFRLEtBQUtBLFVBQzVEVCxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTXZCLFFBQU9DLEtBQTBCO1lBQ3JDLDJFQUEyRTtZQUMzRSxNQUFNUixLQUFLLENBQUMsSUFBSSxFQUFFUyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO1lBQ3hFLE1BQU1RLE1BQW1CO2dCQUN2QnRCO2dCQUNBUixJQUFJLElBQUlpQjtnQkFDUk8sTUFBTVIsTUFBTVEsSUFBSTtnQkFDaEJDLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQ2xCWixZQUFZRyxNQUFNSCxVQUFVO2dCQUM1QkMsVUFBVUUsTUFBTUYsUUFBUTtnQkFDeEJZLFNBQVNWLE1BQU1VLE9BQU87Z0JBQ3RCQyxhQUFhWCxNQUFNVyxXQUFXLElBQUksQ0FBQztZQUNyQztZQUVBLHdCQUF3QjtZQUN4QnRDLHdEQUFlQSxDQUFDeUM7WUFFaEIsT0FBT0E7UUFDVDtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTbkMsV0FBV0gsT0FBeUI7SUFDM0MsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNRSxRQUFpQyxDQUFDO0lBQ3hDLElBQUlGLFFBQVFxQixVQUFVLEVBQUU7UUFDdEJuQixNQUFNbUIsVUFBVSxHQUFHckIsUUFBUXFCLFVBQVU7SUFDdkM7SUFDQSxJQUFJckIsUUFBUXNCLFFBQVEsRUFBRTtRQUNwQnBCLE1BQU1vQixRQUFRLEdBQUd0QixRQUFRc0IsUUFBUTtJQUNuQztJQUNBLElBQUl0QixRQUFRZ0MsSUFBSSxFQUFFO1FBQ2hCOUIsTUFBTThCLElBQUksR0FBR2hDLFFBQVFnQyxJQUFJO0lBQzNCO0lBQ0EsT0FBTzlCO0FBQ1Q7QUFFQSxTQUFTWSxNQUFNRyxHQVNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZSLElBQUlTLElBQUlULEVBQUU7UUFDVndCLE1BQU1mLElBQUllLElBQUk7UUFDZEMsT0FBT2hCLElBQUlnQixLQUFLO1FBQ2hCWixZQUFZSixJQUFJSSxVQUFVO1FBQzFCQyxVQUFVTCxJQUFJSyxRQUFRO1FBQ3RCWSxTQUFTakIsSUFBSWlCLE9BQU87UUFDcEJDLGFBQWFDLEtBQUtZLEtBQUssQ0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:329:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:340:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:384:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9vcGVyYXRpb25zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztDQUlDLEdBRTZCO0FBQ29CO0FBMkNsRCwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTRTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1QLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNaEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ1MsVUFBVSxDQUFDO2dCQUFFWixPQUFPO29CQUFFVTtnQkFBRztZQUFFO1lBQzlELE9BQU9DLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNRSxrQkFBaUJDLFdBQW1CO1lBQ3hDLE1BQU1aLE9BQU8sTUFBTVAsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0osT0FBTztvQkFBRWM7Z0JBQVk7Z0JBQ3JCVCxTQUFTO29CQUFFVSxXQUFXO2dCQUFNO1lBQzlCO1lBQ0EsT0FBT2IsS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1RO1lBQ0osTUFBTUMsU0FBUyxNQUFNdEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ2UsT0FBTyxDQUFDO2dCQUM1Q0MsSUFBSTtvQkFBQztpQkFBUztnQkFDZEMsUUFBUTtvQkFBRVYsSUFBSTtnQkFBSztZQUNyQjtZQUNBLE9BQU9XLE9BQU9DLFdBQVcsQ0FDdkJMLE9BQU9WLEdBQUcsQ0FBQyxDQUFDZ0IsSUFBTTtvQkFBQ0EsRUFBRUMsTUFBTTtvQkFBRUQsRUFBRUgsTUFBTSxDQUFDVixFQUFFO2lCQUFDO1FBRTdDO1FBRUEsTUFBTWUsUUFBT0MsS0FBMkI7WUFDdEMsTUFBTWYsTUFBTSxNQUFNaEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ3NCLE1BQU0sQ0FBQztnQkFDeENFLE1BQU07b0JBQ0piLGFBQWFZLE1BQU1aLFdBQVc7b0JBQzlCYyxTQUFTRixNQUFNRSxPQUFPO29CQUN0QkMsT0FBT0gsTUFBTUcsS0FBSztvQkFDbEJDLE9BQU9KLE1BQU1JLEtBQUssSUFBSTtvQkFDdEJOLFFBQVE7b0JBQ1JPLGtCQUFrQjtvQkFDbEJDLHVCQUF1QkMsS0FBS0MsU0FBUyxDQUFDUixNQUFNTSxxQkFBcUIsSUFBSSxFQUFFO29CQUN2RUcsVUFBVVQsTUFBTVMsUUFBUSxJQUFJO2dCQUM5QjtZQUNGO1lBQ0EsT0FBTzNCLE1BQU1HO1FBQ2Y7UUFFQSxNQUFNeUIsUUFBTzFCLEVBQVUsRUFBRWdCLEtBQTJCO1lBQ2xELE1BQU1XLFdBQVcsTUFBTTFDLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVU7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMyQixVQUFVLE9BQU87WUFFdEIsTUFBTTFCLE1BQU0sTUFBTWhCLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNpQyxNQUFNLENBQUM7Z0JBQ3hDcEMsT0FBTztvQkFBRVU7Z0JBQUc7Z0JBQ1ppQixNQUFNO29CQUNKLEdBQUlELE1BQU1GLE1BQU0sS0FBS2MsYUFBYTt3QkFBRWQsUUFBUUUsTUFBTUYsTUFBTTtvQkFBQyxDQUFDO29CQUMxRCxHQUFJRSxNQUFNSSxLQUFLLEtBQUtRLGFBQWE7d0JBQUVSLE9BQU9KLE1BQU1JLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSUosTUFBTWEsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlYixNQUFNYSxhQUFhO29CQUFDLENBQUM7Z0JBQ2pGO1lBQ0Y7WUFFQSxPQUFPL0IsTUFBTUc7UUFDZjtRQUVBLE1BQU02QiwwQkFDSjlCLEVBQVUsRUFDVitCLFNBQWlCLEVBQ2pCQyxLQUFhO1lBRWIsT0FBTy9DLHVDQUFNQSxDQUFDZ0QsWUFBWSxDQUFDLE9BQU9DO2dCQUNoQyx3QkFBd0I7Z0JBQ3hCLE1BQU1QLFdBQVcsTUFBTU8sR0FBR3pDLFNBQVMsQ0FBQ1MsVUFBVSxDQUFDO29CQUFFWixPQUFPO3dCQUFFVTtvQkFBRztnQkFBRTtnQkFDL0QsSUFBSSxDQUFDMkIsVUFBVSxPQUFPO2dCQUV0QixNQUFNUSxpQkFBaUJSLFNBQVNiLE1BQU07Z0JBRXRDLG1CQUFtQjtnQkFDbkIsTUFBTWIsTUFBTSxNQUFNaUMsR0FBR3pDLFNBQVMsQ0FBQ2lDLE1BQU0sQ0FBQztvQkFDcENwQyxPQUFPO3dCQUFFVTtvQkFBRztvQkFDWmlCLE1BQU07d0JBQUVILFFBQVFpQjtvQkFBVTtnQkFDNUI7Z0JBRUEseUJBQXlCO2dCQUN6QixNQUFNSyxhQUFhLENBQUMsSUFBSSxFQUFFQyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO2dCQUNoRixNQUFNUixHQUFHUyxRQUFRLENBQUM1QixNQUFNLENBQUM7b0JBQ3ZCRSxNQUFNO3dCQUNKakIsSUFBSW9DO3dCQUNKUSxJQUFJLElBQUlQO3dCQUNSUSxNQUFNO3dCQUNOYjt3QkFDQWMsWUFBWTt3QkFDWkMsVUFBVS9DO3dCQUNWZ0QsU0FBUyxDQUFDLDBCQUEwQixFQUFFakIsV0FBVzt3QkFDakRrQixhQUFhMUIsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQnBCLGFBQWF1QixTQUFTdkIsV0FBVzs0QkFDakMrQjs0QkFDQUo7d0JBQ0Y7b0JBQ0Y7Z0JBQ0Y7Z0JBRUEsT0FBTztvQkFDTHRDLFdBQVdLLE1BQU1HO29CQUNqQmtDO29CQUNBQztnQkFDRjtZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLHNCQUFzQjtBQUN0QiwrRUFBK0U7QUFFeEUsU0FBU2M7SUFDZCxPQUFPO1FBQ0wsTUFBTTlELE1BQUtDLE9BQTBCO1lBQ25DLElBQUk4RCxTQUFTO21CQUFJakUsNkRBQWNBO2FBQUM7WUFDaEMsSUFBSUcsU0FBU2UsYUFBYTtnQkFDeEIrQyxTQUFTQSxPQUFPQyxNQUFNLENBQUMsQ0FBQ0MsS0FBT0EsR0FBR2pELFdBQVcsS0FBS2YsUUFBUWUsV0FBVztZQUN2RTtZQUNBLElBQUlmLFNBQVN5QixRQUFRO2dCQUNuQixNQUFNd0MsV0FBV0MsTUFBTUMsT0FBTyxDQUFDbkUsUUFBUXlCLE1BQU0sSUFBSXpCLFFBQVF5QixNQUFNLEdBQUc7b0JBQUN6QixRQUFReUIsTUFBTTtpQkFBQztnQkFDbEZxQyxTQUFTQSxPQUFPQyxNQUFNLENBQUMsQ0FBQ0MsS0FBT0MsU0FBU0csUUFBUSxDQUFDSixHQUFHdkMsTUFBTTtZQUM1RDtZQUNBLElBQUl6QixTQUFTNkIsU0FBUztnQkFDcEIsTUFBTXdDLFdBQVdILE1BQU1DLE9BQU8sQ0FBQ25FLFFBQVE2QixPQUFPLElBQUk3QixRQUFRNkIsT0FBTyxHQUFHO29CQUFDN0IsUUFBUTZCLE9BQU87aUJBQUM7Z0JBQ3JGaUMsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLEtBQU9LLFNBQVNELFFBQVEsQ0FBQ0osR0FBR25DLE9BQU87WUFDN0Q7WUFDQSxPQUFPaUMsT0FBT3RELEdBQUcsQ0FBQzhEO1FBQ3BCO1FBRUEsTUFBTTVELFNBQVFDLEVBQVU7WUFDdEIsTUFBTXFELEtBQUtuRSw2REFBY0EsQ0FBQzBFLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFN0QsRUFBRSxLQUFLQTtZQUMvQyxPQUFPcUQsS0FBS00sVUFBVU4sTUFBTTtRQUM5QjtRQUVBLE1BQU1sRCxrQkFBaUJDLFdBQW1CO1lBQ3hDLE9BQU9sQiw2REFBY0EsQ0FDbEJrRSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0EsR0FBR2pELFdBQVcsS0FBS0EsYUFDbENQLEdBQUcsQ0FBQzhEO1FBQ1Q7UUFFQSxNQUFNckQ7WUFDSixNQUFNd0QsU0FBaUMsQ0FBQztZQUN4QyxLQUFLLE1BQU1ULE1BQU1uRSw2REFBY0EsQ0FBRTtnQkFDL0I0RSxNQUFNLENBQUNULEdBQUd2QyxNQUFNLENBQUMsR0FBRyxDQUFDZ0QsTUFBTSxDQUFDVCxHQUFHdkMsTUFBTSxDQUFDLElBQUksS0FBSztZQUNqRDtZQUNBLE9BQU9nRDtRQUNUO1FBRUEsTUFBTS9DLFFBQU9DLEtBQTJCO1lBQ3RDLE1BQU1oQixLQUFLLENBQUMsUUFBUSxFQUFFcUMsS0FBS0MsR0FBRyxJQUFJO1lBQ2xDLE1BQU1BLE1BQU0sSUFBSUQ7WUFDaEIsT0FBTztnQkFDTHJDO2dCQUNBSSxhQUFhWSxNQUFNWixXQUFXO2dCQUM5QmMsU0FBU0YsTUFBTUUsT0FBTztnQkFDdEJDLE9BQU9ILE1BQU1HLEtBQUs7Z0JBQ2xCQyxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQ3RCTixRQUFRO2dCQUNSTyxrQkFBa0IsRUFBRTtnQkFDcEJDLHVCQUF1Qk4sTUFBTU0scUJBQXFCLElBQUksRUFBRTtnQkFDeERHLFVBQVVULE1BQU1TLFFBQVEsSUFBSTtnQkFDNUJJLGVBQWU7Z0JBQ2Z4QixXQUFXaUM7Z0JBQ1gxQyxXQUFXMEM7WUFDYjtRQUNGO1FBRUEsTUFBTVosUUFBTzFCLEVBQVUsRUFBRWdCLEtBQTJCO1lBQ2xELE1BQU1xQyxLQUFLbkUsNkRBQWNBLENBQUMwRSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRTdELEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDcUQsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdNLFVBQVVOLEdBQUc7Z0JBQ2hCLEdBQUlyQyxNQUFNRixNQUFNLEtBQUtjLGFBQWE7b0JBQUVkLFFBQVFFLE1BQU1GLE1BQU07Z0JBQTJCLENBQUM7Z0JBQ3BGLEdBQUlFLE1BQU1JLEtBQUssS0FBS1EsYUFBYTtvQkFBRVIsT0FBT0osTUFBTUksS0FBSztnQkFBQyxDQUFDO2dCQUN2RCxHQUFJSixNQUFNYSxhQUFhLEtBQUtELGFBQWE7b0JBQUVDLGVBQWViLE1BQU1hLGFBQWE7Z0JBQUMsQ0FBQztnQkFDL0VqQyxXQUFXLElBQUl5QztZQUNqQjtRQUNGO1FBRUEsTUFBTVAsMEJBQ0o5QixFQUFVLEVBQ1YrQixTQUFpQixFQUNqQmdDLE1BQWM7WUFFZCxNQUFNVixLQUFLbkUsNkRBQWNBLENBQUMwRSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRTdELEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDcUQsSUFBSSxPQUFPO1lBRWhCLE1BQU1sQixpQkFBaUJrQixHQUFHdkMsTUFBTTtZQUNoQyxNQUFNc0IsYUFBYSxDQUFDLFNBQVMsRUFBRUMsS0FBS0MsR0FBRyxJQUFJO1lBRTNDLE9BQU87Z0JBQ0w3QyxXQUFXO29CQUNULEdBQUdrRSxVQUFVTixHQUFHO29CQUNoQnZDLFFBQVFpQjtvQkFDUm5DLFdBQVcsSUFBSXlDO2dCQUNqQjtnQkFDQUY7Z0JBQ0FDO1lBQ0Y7UUFDRjtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTN0MsV0FBV0YsT0FBMEI7SUFDNUMsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNQyxRQUFpQyxDQUFDO0lBQ3hDLElBQUlELFFBQVFlLFdBQVcsRUFBRTtRQUN2QmQsTUFBTWMsV0FBVyxHQUFHZixRQUFRZSxXQUFXO0lBQ3pDO0lBQ0EsSUFBSWYsUUFBUXlCLE1BQU0sRUFBRTtRQUNsQnhCLE1BQU13QixNQUFNLEdBQUd5QyxNQUFNQyxPQUFPLENBQUNuRSxRQUFReUIsTUFBTSxJQUFJO1lBQUVrRCxJQUFJM0UsUUFBUXlCLE1BQU07UUFBQyxJQUFJekIsUUFBUXlCLE1BQU07SUFDeEY7SUFDQSxJQUFJekIsUUFBUTZCLE9BQU8sRUFBRTtRQUNuQjVCLE1BQU00QixPQUFPLEdBQUdxQyxNQUFNQyxPQUFPLENBQUNuRSxRQUFRNkIsT0FBTyxJQUFJO1lBQUU4QyxJQUFJM0UsUUFBUTZCLE9BQU87UUFBQyxJQUFJN0IsUUFBUTZCLE9BQU87SUFDNUY7SUFDQSxPQUFPNUI7QUFDVDtBQUVBLFNBQVNRLE1BQU1HLEdBYWQ7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:417:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:450:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/api/skills/route.js:461:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby93b3JrT3JkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNZO0FBQ3dCO0FBcURsRSwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTSTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1ULHVDQUFNQSxDQUFDVSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLGFBQVlWLE9BQTBCO1lBQzFDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCSSxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO29CQUNuQztnQkFDRjtZQUNGO1lBQ0EsT0FBT1osS0FBS0ssR0FBRyxDQUFDLENBQUNRLE1BQVM7b0JBQ3hCLEdBQUdQLE1BQU1PLElBQUk7b0JBQ2JKLFlBQVlJLElBQUlKLFVBQVUsQ0FBQ0osR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQ3RDSCxJQUFJRyxHQUFHSCxFQUFFOzRCQUNUQyxRQUFRRSxHQUFHRixNQUFNO3dCQUNuQjtnQkFDRjtRQUNGO1FBRUEsTUFBTUcsU0FBUUosRUFBVTtZQUN0QixNQUFNRSxNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDZSxVQUFVLENBQUM7Z0JBQUVsQixPQUFPO29CQUFFYTtnQkFBRztZQUFFO1lBQzlELE9BQU9FLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxXQUFVQyxJQUFZO1lBQzFCLE1BQU1MLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNlLFVBQVUsQ0FBQztnQkFBRWxCLE9BQU87b0JBQUVvQjtnQkFBSztZQUFFO1lBQ2hFLE9BQU9MLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNTTtZQUNKLE1BQU1DLFNBQVMsTUFBTTdCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQixPQUFPLENBQUM7Z0JBQzVDQyxJQUFJO29CQUFDO2lCQUFRO2dCQUNiQyxRQUFRO29CQUFFWixJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT2EsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT2YsR0FBRyxDQUFDLENBQUNxQixJQUFNO29CQUFDQSxFQUFFQyxLQUFLO29CQUFFRCxFQUFFSCxNQUFNLENBQUNaLEVBQUU7aUJBQUM7UUFFNUM7UUFFQSxNQUFNaUI7WUFDSixNQUFNQyxRQUFRLElBQUlDO1lBQ2xCRCxNQUFNRSxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUc7WUFFeEIsT0FBT3hDLHVDQUFNQSxDQUFDVSxTQUFTLENBQUMrQixLQUFLLENBQUM7Z0JBQzVCbEMsT0FBTztvQkFDTDZCLE9BQU87b0JBQ1BNLFdBQVc7d0JBQUVDLEtBQUtMO29CQUFNO2dCQUMxQjtZQUNGO1FBQ0Y7UUFFQSxNQUFNTSxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTUUsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUM1Q2xCLE9BQU87b0JBQUVhO2dCQUFHO2dCQUNaSCxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO3dCQUNqQ1QsU0FBUzs0QkFBRWlDLFdBQVc7d0JBQU07b0JBQzlCO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJLENBQUN2QixLQUFLLE9BQU87WUFDakIsT0FBTztnQkFDTCxHQUFHUCxNQUFNTyxJQUFJO2dCQUNiSixZQUFZSSxJQUFJSixVQUFVLENBQUNKLEdBQUcsQ0FBQyxDQUFDUyxLQUFRO3dCQUN0Q0gsSUFBSUcsR0FBR0gsRUFBRTt3QkFDVEMsUUFBUUUsR0FBR0YsTUFBTTtvQkFDbkI7WUFDRjtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLHFCQUFxQjtZQUNyQixNQUFNQyxTQUFTLE1BQU1oRCx1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDdUMsU0FBUyxDQUFDO2dCQUM5Q3JDLFNBQVM7b0JBQUVlLE1BQU07Z0JBQU87Z0JBQ3hCUixRQUFRO29CQUFFUSxNQUFNO2dCQUFLO1lBQ3ZCO1lBQ0EsTUFBTXVCLFVBQVVGLFNBQVNHLFNBQVNILE9BQU9yQixJQUFJLENBQUN5QixPQUFPLENBQUMsT0FBTyxLQUFLLE1BQU07WUFDeEUsTUFBTXpCLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPSCxVQUFVLEdBQUdJLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekQsTUFBTWhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQyxNQUFNLENBQUM7Z0JBQ3hDUyxNQUFNO29CQUNKNUI7b0JBQ0E2QixPQUFPVCxNQUFNUyxLQUFLO29CQUNsQkMsUUFBUVYsTUFBTVUsTUFBTTtvQkFDcEJyQixPQUFPO29CQUNQc0IsVUFBVVgsTUFBTVcsUUFBUSxJQUFJO29CQUM1QkMsT0FBT1osTUFBTVksS0FBSyxJQUFJO29CQUN0QkMsaUJBQWlCYixNQUFNYSxlQUFlLElBQUk7Z0JBQzVDO1lBQ0Y7WUFFQSxtQkFBbUI7WUFDbkIsTUFBTTNELHVEQUFjQSxDQUFDcUIsSUFBSUYsRUFBRSxFQUFFRSxJQUFJSyxJQUFJLEVBQUVMLElBQUlrQyxLQUFLLEVBQUVsQyxJQUFJbUMsTUFBTTtZQUU1RCxPQUFPMUMsTUFBTU87UUFDZjtRQUVBLE1BQU11QyxRQUFPekMsRUFBVSxFQUFFMkIsS0FBMkI7WUFDbEQsTUFBTWUsV0FBVyxNQUFNOUQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUFFbEIsT0FBTztvQkFBRWE7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMwQyxVQUFVLE9BQU87WUFFdEIsTUFBTXhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNtRCxNQUFNLENBQUM7Z0JBQ3hDdEQsT0FBTztvQkFBRWE7Z0JBQUc7Z0JBQ1ptQyxNQUFNO29CQUNKLEdBQUlSLE1BQU1TLEtBQUssS0FBS08sYUFBYTt3QkFBRVAsT0FBT1QsTUFBTVMsS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJVCxNQUFNVSxNQUFNLEtBQUtNLGFBQWE7d0JBQUVOLFFBQVFWLE1BQU1VLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSVYsTUFBTVgsS0FBSyxLQUFLMkIsYUFBYTt3QkFBRTNCLE9BQU9XLE1BQU1YLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSVcsTUFBTVcsUUFBUSxLQUFLSyxhQUFhO3dCQUFFTCxVQUFVWCxNQUFNVyxRQUFRO29CQUFDLENBQUM7b0JBQ2hFLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTt3QkFBRUosT0FBT1osTUFBTVksS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJWixNQUFNaUIsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlakIsTUFBTWlCLGFBQWE7b0JBQUMsQ0FBQztvQkFDL0UsR0FBSWpCLE1BQU1YLEtBQUssS0FBSyxhQUFhO3dCQUFFTSxXQUFXLElBQUlIO29CQUFPLENBQUM7Z0JBQzVEO1lBQ0Y7WUFFQSwrQ0FBK0M7WUFDL0MsSUFBSVEsTUFBTVMsS0FBSyxLQUFLTyxhQUFhaEIsTUFBTVUsTUFBTSxLQUFLTSxXQUFXO2dCQUMzRCxNQUFNOUQsdURBQWNBLENBQUNxQixJQUFJRixFQUFFLEVBQUVFLElBQUlLLElBQUksRUFBRUwsSUFBSWtDLEtBQUssRUFBRWxDLElBQUltQyxNQUFNO1lBQzlEO1lBRUEsT0FBTzFDLE1BQU1PO1FBQ2Y7UUFFQSxNQUFNMkMseUJBQ0o3QyxFQUFVLEVBQ1Y4QyxRQUFnQixFQUNoQkMsS0FBYTtZQUViLE9BQU9uRSx1Q0FBTUEsQ0FBQ29FLFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsb0JBQW9CO2dCQUNwQixNQUFNUCxXQUFXLE1BQU1PLEdBQUczRCxTQUFTLENBQUNlLFVBQVUsQ0FBQztvQkFBRWxCLE9BQU87d0JBQUVhO29CQUFHO2dCQUFFO2dCQUMvRCxJQUFJLENBQUMwQyxVQUFVLE9BQU87Z0JBRXRCLE1BQU1RLGdCQUFnQlIsU0FBUzFCLEtBQUs7Z0JBRXBDLG9CQUFvQjtnQkFDcEIsTUFBTWQsTUFBTSxNQUFNK0MsR0FBRzNELFNBQVMsQ0FBQ21ELE1BQU0sQ0FBQztvQkFDcEN0RCxPQUFPO3dCQUFFYTtvQkFBRztvQkFDWm1DLE1BQU07d0JBQ0puQixPQUFPOEI7d0JBQ1AsR0FBSUEsYUFBYSxhQUFhOzRCQUFFeEIsV0FBVyxJQUFJSDt3QkFBTyxDQUFDO29CQUN6RDtnQkFDRjtnQkFFQSx5QkFBeUI7Z0JBQ3pCLE1BQU1nQyxhQUFhLENBQUMsSUFBSSxFQUFFaEMsS0FBS2lDLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLEtBQUssQ0FBQyxHQUFHLElBQUk7Z0JBQ2hGLE1BQU1QLEdBQUdRLFFBQVEsQ0FBQy9CLE1BQU0sQ0FBQztvQkFDdkJTLE1BQU07d0JBQ0puQyxJQUFJbUQ7d0JBQ0pPLElBQUksSUFBSXZDO3dCQUNSd0MsTUFBTTt3QkFDTlo7d0JBQ0FhLFlBQVk7d0JBQ1pDLFVBQVU3RDt3QkFDVjhELFNBQVMsQ0FBQywyQkFBMkIsRUFBRWhCLFVBQVU7d0JBQ2pEaUIsYUFBYUMsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQmY7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x4RCxXQUFXSyxNQUFNTztvQkFDakJnRDtvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNlO0lBQ2QsT0FBTztRQUNMLE1BQU1qRixNQUFLQyxPQUEwQjtZQUNuQyxJQUFJaUYsU0FBUzttQkFBSXJGLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVM4QixPQUFPO2dCQUNsQixNQUFNb0QsU0FBU0MsTUFBTUMsT0FBTyxDQUFDcEYsUUFBUThCLEtBQUssSUFBSTlCLFFBQVE4QixLQUFLLEdBQUc7b0JBQUM5QixRQUFROEIsS0FBSztpQkFBQztnQkFDN0VtRCxTQUFTQSxPQUFPSSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0osT0FBT0ssUUFBUSxDQUFDRCxHQUFHeEQsS0FBSztZQUN6RDtZQUNBLElBQUk5QixTQUFTb0QsVUFBVTtnQkFDckIsTUFBTW9DLGFBQWFMLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUlwRCxRQUFRb0QsUUFBUSxHQUFHO29CQUFDcEQsUUFBUW9ELFFBQVE7aUJBQUM7Z0JBQzFGNkIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9FLFdBQVdELFFBQVEsQ0FBQ0QsR0FBR2xDLFFBQVE7WUFDaEU7WUFDQSxJQUFJcEQsU0FBU3FELE9BQU87Z0JBQ2xCNEIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqQyxLQUFLLEtBQUtyRCxRQUFRcUQsS0FBSztZQUMzRDtZQUNBLE9BQU80QixPQUFPekUsR0FBRyxDQUFDaUY7UUFDcEI7UUFFQSxNQUFNL0UsYUFBWVYsT0FBMEI7WUFDMUMsTUFBTTBGLGFBQWEsTUFBTSxJQUFJLENBQUMzRixJQUFJLENBQUNDO1lBQ25DLE9BQU8wRixXQUFXbEYsR0FBRyxDQUFDLENBQUM4RSxLQUFRO29CQUM3QixHQUFHQSxFQUFFO29CQUNMMUUsWUFBWWYsNkRBQWNBLENBQ3ZCd0YsTUFBTSxDQUFDLENBQUNwRSxLQUFPQSxHQUFHMEUsV0FBVyxLQUFLTCxHQUFHeEUsRUFBRSxFQUN2Q04sR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQUVILElBQUlHLEdBQUdILEVBQUU7NEJBQUVDLFFBQVFFLEdBQUdGLE1BQU07d0JBQUM7Z0JBQ2pEO1FBQ0Y7UUFFQSxNQUFNRyxTQUFRSixFQUFVO1lBQ3RCLE1BQU13RSxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsT0FBT3dFLEtBQUtHLFVBQVVILE1BQU07UUFDOUI7UUFFQSxNQUFNbEUsV0FBVUMsSUFBWTtZQUMxQixNQUFNaUUsS0FBSzFGLDZEQUFjQSxDQUFDZ0csSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUV4RSxJQUFJLEtBQUtBO1lBQ2pELE9BQU9pRSxLQUFLRyxVQUFVSCxNQUFNO1FBQzlCO1FBRUEsTUFBTWhFO1lBQ0osTUFBTXdFLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNUixNQUFNMUYsNkRBQWNBLENBQUU7Z0JBQy9Ca0csTUFBTSxDQUFDUixHQUFHeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQ2dFLE1BQU0sQ0FBQ1IsR0FBR3hELEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPZ0U7UUFDVDtRQUVBLE1BQU0vRDtZQUNKLE1BQU1DLFFBQVEsSUFBSUM7WUFDbEJELE1BQU1FLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRztZQUV4QixPQUFPdEMsNkRBQWNBLENBQUN5RixNQUFNLENBQzFCLENBQUNDLEtBQU9BLEdBQUd4RCxLQUFLLEtBQUssYUFBYXdELEdBQUdsRCxTQUFTLElBQUlrRCxHQUFHbEQsU0FBUyxJQUFJSixPQUNsRStELE1BQU07UUFDVjtRQUVBLE1BQU16RCxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTXdFLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFDaEIsT0FBTztnQkFDTCxHQUFHRyxVQUFVSCxHQUFHO2dCQUNoQjFFLFlBQVlmLDZEQUFjQSxDQUN2QndGLE1BQU0sQ0FBQyxDQUFDcEUsS0FBT0EsR0FBRzBFLFdBQVcsS0FBSzdFLElBQ2xDTixHQUFHLENBQUMsQ0FBQ1MsS0FBUTt3QkFBRUgsSUFBSUcsR0FBR0gsRUFBRTt3QkFBRUMsUUFBUUUsR0FBR0YsTUFBTTtvQkFBQztZQUNqRDtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLDRCQUE0QjtZQUM1QixNQUFNM0IsS0FBSyxDQUFDLFFBQVEsRUFBRW1CLEtBQUtpQyxHQUFHLElBQUk7WUFDbEMsTUFBTTdDLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPbkQsNkRBQWNBLENBQUNtRyxNQUFNLEdBQUcsR0FBRy9DLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFDdkUsTUFBTWtCLE1BQU0sSUFBSWpDO1lBRWhCLE1BQU0rRCxRQUFRO2dCQUNabEY7Z0JBQ0FPO2dCQUNBNkIsT0FBT1QsTUFBTVMsS0FBSztnQkFDbEJDLFFBQVFWLE1BQU1VLE1BQU07Z0JBQ3BCckIsT0FBTztnQkFDUHNCLFVBQVdYLE1BQU1XLFFBQVEsSUFBSTtnQkFDN0JDLE9BQVFaLE1BQU1ZLEtBQUssSUFBSTtnQkFDdkJDLGlCQUFpQmIsTUFBTWEsZUFBZSxJQUFJO2dCQUMxQ0ksZUFBZTtnQkFDZm5CLFdBQVcyQjtnQkFDWDNELFdBQVcyRDtnQkFDWDlCLFdBQVc7WUFDYjtZQUVBLHVEQUF1RDtZQUN2RCxPQUFPcUQsVUFBVU87UUFDbkI7UUFFQSxNQUFNekMsUUFBT3pDLEVBQVUsRUFBRTJCLEtBQTJCO1lBQ2xELE1BQU02QyxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDd0UsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdHLFVBQVVILEdBQUc7Z0JBQ2hCLEdBQUk3QyxNQUFNUyxLQUFLLEtBQUtPLGFBQWE7b0JBQUVQLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSVQsTUFBTVUsTUFBTSxLQUFLTSxhQUFhO29CQUFFTixRQUFRVixNQUFNVSxNQUFNO2dCQUFDLENBQUM7Z0JBQzFELEdBQUlWLE1BQU1YLEtBQUssS0FBSzJCLGFBQWE7b0JBQUUzQixPQUFPVyxNQUFNWCxLQUFLO2dCQUEwQixDQUFDO2dCQUNoRixHQUFJVyxNQUFNVyxRQUFRLEtBQUtLLGFBQWE7b0JBQUVMLFVBQVVYLE1BQU1XLFFBQVE7Z0JBQTZCLENBQUM7Z0JBQzVGLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTtvQkFBRUosT0FBT1osTUFBTVksS0FBSztnQkFBMEIsQ0FBQztnQkFDaEYsR0FBSVosTUFBTWlCLGFBQWEsS0FBS0QsYUFBYTtvQkFBRUMsZUFBZWpCLE1BQU1pQixhQUFhO2dCQUFDLENBQUM7Z0JBQy9FbkQsV0FBVyxJQUFJMEI7WUFDakI7UUFDRjtRQUVBLE1BQU0wQix5QkFDSjdDLEVBQVUsRUFDVjhDLFFBQWdCLEVBQ2hCcUMsTUFBYztZQUVkLE1BQU1YLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFFaEIsTUFBTXRCLGdCQUFnQnNCLEdBQUd4RCxLQUFLO1lBQzlCLE1BQU1tQyxhQUFhLENBQUMsU0FBUyxFQUFFaEMsS0FBS2lDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMOUQsV0FBVztvQkFDVCxHQUFHcUYsVUFBVUgsR0FBRztvQkFDaEJ4RCxPQUFPOEI7b0JBQ1ByRCxXQUFXLElBQUkwQjtvQkFDZixHQUFJMkIsYUFBYSxhQUFhO3dCQUFFeEIsV0FBVyxJQUFJSDtvQkFBTyxDQUFDO2dCQUN6RDtnQkFDQStCO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUy9ELFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFROEIsS0FBSyxFQUFFO1FBQ2pCN0IsTUFBTTZCLEtBQUssR0FBR3FELE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVE4QixLQUFLLElBQUk7WUFBRW9FLElBQUlsRyxRQUFROEIsS0FBSztRQUFDLElBQUk5QixRQUFROEIsS0FBSztJQUNwRjtJQUNBLElBQUk5QixRQUFRb0QsUUFBUSxFQUFFO1FBQ3BCbkQsTUFBTW1ELFFBQVEsR0FBRytCLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUk7WUFBRThDLElBQUlsRyxRQUFRb0QsUUFBUTtRQUFDLElBQUlwRCxRQUFRb0QsUUFBUTtJQUNoRztJQUNBLElBQUlwRCxRQUFRcUQsS0FBSyxFQUFFO1FBQ2pCcEQsTUFBTW9ELEtBQUssR0FBR3JELFFBQVFxRCxLQUFLO0lBQzdCO0lBQ0EsT0FBT3BEO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNTyxHQWFkO0lBQ0MsT0FBTztRQUNMRixJQUFJRSxJQUFJRixFQUFFO1FBQ1ZPLE1BQU1MLElBQUlLLElBQUk7UUFDZDZCLE9BQU9sQyxJQUFJa0MsS0FBSztRQUNoQkMsUUFBUW5DLElBQUltQyxNQUFNO1FBQ2xCckIsT0FBT2QsSUFBSWMsS0FBSztRQUNoQnNCLFVBQVVwQyxJQUFJb0MsUUFBUTtRQUN0QkMsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCQyxpQkFBaUJ0QyxJQUFJc0MsZUFBZTtRQUNwQ0ksZUFBZTFDLElBQUkwQyxhQUFhO1FBQ2hDbkIsV0FBV3ZCLElBQUl1QixTQUFTO1FBQ3hCaEMsV0FBV1MsSUFBSVQsU0FBUztRQUN4QjZCLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBU3FELFVBQVVILEVBQWlDO0lBQ2xELE9BQU87UUFDTHhFLElBQUl3RSxHQUFHeEUsRUFBRTtRQUNUTyxNQUFNaUUsR0FBR2pFLElBQUk7UUFDYjZCLE9BQU9vQyxHQUFHcEMsS0FBSztRQUNmQyxRQUFRbUMsR0FBR25DLE1BQU07UUFDakJyQixPQUFPd0QsR0FBR3hELEtBQUs7UUFDZnNCLFVBQVVrQyxHQUFHbEMsUUFBUTtRQUNyQkMsT0FBT2lDLEdBQUdqQyxLQUFLO1FBQ2ZDLGlCQUFpQmdDLEdBQUdoQyxlQUFlO1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:423:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:434:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hZ2VudHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0NBSUMsR0FFNkI7QUFDZ0I7QUF5QzlDLCtFQUErRTtBQUMvRSwwQkFBMEI7QUFDMUIsK0VBQStFO0FBRXhFLFNBQVNFO0lBQ2QsT0FBTztRQUNMLE1BQU1DLE1BQUtDLE9BQXNCO1lBQy9CLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVAsdUNBQU1BLENBQUNRLEtBQUssQ0FBQ0MsUUFBUSxDQUFDO2dCQUN2Q0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLE1BQU07Z0JBQU07WUFDekI7WUFDQSxPQUFPSixLQUFLSyxHQUFHLENBQUMsQ0FBQ0MsTUFBUUMsTUFBTUQ7UUFDakM7UUFFQSxNQUFNRSxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1ILE1BQU0sTUFBTWIsdUNBQU1BLENBQUNRLEtBQUssQ0FBQ1MsVUFBVSxDQUFDO2dCQUFFWixPQUFPO29CQUFFVztnQkFBRztZQUFFO1lBQzFELE9BQU9ILE1BQU1DLE1BQU1ELE9BQW9DO1FBQ3pEO1FBRUEsTUFBTUssV0FBVVAsSUFBWTtZQUMxQixNQUFNRSxNQUFNLE1BQU1iLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRU07Z0JBQUs7WUFBRTtZQUM1RCxPQUFPRSxNQUFNQyxNQUFNRCxPQUFvQztRQUN6RDtRQUVBLE1BQU1NLGlCQUFnQkMsVUFBa0I7WUFDdEMsTUFBTVAsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDUyxVQUFVLENBQUM7Z0JBQUVaLE9BQU87b0JBQUVlO2dCQUFXO1lBQUU7WUFDbEUsT0FBT1AsTUFBTUMsTUFBTUQsT0FBb0M7UUFDekQ7UUFFQSxNQUFNUTtZQUNKLE1BQU1DLFNBQVMsTUFBTXRCLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNlLE9BQU8sQ0FBQztnQkFDeENDLElBQUk7b0JBQUM7aUJBQVM7Z0JBQ2RDLFFBQVE7b0JBQUVULElBQUk7Z0JBQUs7WUFDckI7WUFDQSxPQUFPVSxPQUFPQyxXQUFXLENBQ3ZCTCxPQUFPVixHQUFHLENBQUMsQ0FBQ2dCLElBQU07b0JBQUNBLEVBQUVDLE1BQU07b0JBQUVELEVBQUVILE1BQU0sQ0FBQ1QsRUFBRTtpQkFBQztRQUU3QztRQUVBLE1BQU1jLFFBQU9DLEtBQXVCO1lBQ2xDLE1BQU1sQixNQUFNLE1BQU1iLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNzQixNQUFNLENBQUM7Z0JBQ3BDRSxNQUFNO29CQUNKckIsTUFBTW9CLE1BQU1wQixJQUFJO29CQUNoQnNCLE1BQU1GLE1BQU1FLElBQUk7b0JBQ2hCQyxTQUFTSCxNQUFNRyxPQUFPO29CQUN0QkwsUUFBUTtvQkFDUlQsWUFBWVcsTUFBTVgsVUFBVTtvQkFDNUJlLGNBQWNDLEtBQUtDLFNBQVMsQ0FBQ04sTUFBTUksWUFBWTtvQkFDL0NHLFVBQVVQLE1BQU1PLFFBQVEsSUFBSTtnQkFDOUI7WUFDRjtZQUNBLE9BQU94QixNQUFNRDtRQUNmO1FBRUEsTUFBTTBCLFFBQU92QixFQUFVLEVBQUVlLEtBQXVCO1lBQzlDLE1BQU1TLFdBQVcsTUFBTXhDLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVc7Z0JBQUc7WUFBRTtZQUMvRCxJQUFJLENBQUN3QixVQUFVLE9BQU87WUFFdEIsNkVBQTZFO1lBQzdFLE1BQU1DLGFBQXNDO2dCQUMxQ0MsWUFBWSxJQUFJQztZQUNsQjtZQUNBLElBQUlaLE1BQU1GLE1BQU0sS0FBS2UsV0FBV0gsV0FBV1osTUFBTSxHQUFHRSxNQUFNRixNQUFNO1lBQ2hFLElBQUlFLE1BQU1wQixJQUFJLEtBQUtpQyxXQUFXSCxXQUFXOUIsSUFBSSxHQUFHb0IsTUFBTXBCLElBQUk7WUFDMUQsSUFBSW9CLE1BQU1FLElBQUksS0FBS1csV0FBV0gsV0FBV1IsSUFBSSxHQUFHRixNQUFNRSxJQUFJO1lBQzFELElBQUlGLE1BQU1HLE9BQU8sS0FBS1UsV0FBV0gsV0FBV1AsT0FBTyxHQUFHSCxNQUFNRyxPQUFPO1lBQ25FLElBQUlILE1BQU1JLFlBQVksS0FBS1MsV0FBV0gsV0FBV04sWUFBWSxHQUFHQyxLQUFLQyxTQUFTLENBQUNOLE1BQU1JLFlBQVk7WUFDakcsSUFBSUosTUFBTU8sUUFBUSxLQUFLTSxXQUFXSCxXQUFXSCxRQUFRLEdBQUdQLE1BQU1PLFFBQVE7WUFDdEUsSUFBSVAsTUFBTVgsVUFBVSxLQUFLd0IsV0FBV0gsV0FBV3JCLFVBQVUsR0FBR1csTUFBTVgsVUFBVTtZQUM1RSxJQUFJVyxNQUFNYyxVQUFVLEtBQUtELFdBQVdILFdBQVdJLFVBQVUsR0FBR2QsTUFBTWMsVUFBVTtZQUM1RSxJQUFJZCxNQUFNZSxLQUFLLEtBQUtGLFdBQVdILFdBQVdLLEtBQUssR0FBR2YsTUFBTWUsS0FBSztZQUU3RCxNQUFNakMsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDK0IsTUFBTSxDQUFDO2dCQUNwQ2xDLE9BQU87b0JBQUVXO2dCQUFHO2dCQUNaZ0IsTUFBTVM7WUFDUjtZQUVBLE9BQU8zQixNQUFNRDtRQUNmO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNrQztJQUNkLE9BQU87UUFDTCxNQUFNNUMsTUFBS0MsT0FBc0I7WUFDL0IsSUFBSTRDLFNBQVM7bUJBQUkvQyx5REFBVUE7YUFBQztZQUM1QixJQUFJRyxTQUFTeUIsUUFBUTtnQkFDbkIsTUFBTW9CLFdBQVdDLE1BQU1DLE9BQU8sQ0FBQy9DLFFBQVF5QixNQUFNLElBQUl6QixRQUFReUIsTUFBTSxHQUFHO29CQUFDekIsUUFBUXlCLE1BQU07aUJBQUM7Z0JBQ2xGbUIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLElBQU1KLFNBQVNLLFFBQVEsQ0FBQ0QsRUFBRXhCLE1BQU07WUFDMUQ7WUFDQSxJQUFJekIsU0FBUzhCLFNBQVM7Z0JBQ3BCLE1BQU1xQixXQUFXTCxNQUFNQyxPQUFPLENBQUMvQyxRQUFROEIsT0FBTyxJQUFJOUIsUUFBUThCLE9BQU8sR0FBRztvQkFBQzlCLFFBQVE4QixPQUFPO2lCQUFDO2dCQUNyRmMsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLElBQU1FLFNBQVNELFFBQVEsQ0FBQ0QsRUFBRW5CLE9BQU87WUFDM0Q7WUFDQSxPQUFPYyxPQUFPcEMsR0FBRyxDQUFDNEM7UUFDcEI7UUFFQSxNQUFNekMsU0FBUUMsRUFBVTtZQUN0QixNQUFNUixRQUFRUCx5REFBVUEsQ0FBQ3dELElBQUksQ0FBQyxDQUFDSixJQUFNQSxFQUFFckMsRUFBRSxLQUFLQTtZQUM5QyxPQUFPUixRQUFRZ0QsVUFBVWhELFNBQVM7UUFDcEM7UUFFQSxNQUFNVSxXQUFVUCxJQUFZO1lBQzFCLE1BQU1ILFFBQVFQLHlEQUFVQSxDQUFDd0QsSUFBSSxDQUFDLENBQUNKLElBQU1BLEVBQUUxQyxJQUFJLEtBQUtBO1lBQ2hELE9BQU9ILFFBQVFnRCxVQUFVaEQsU0FBUztRQUNwQztRQUVBLE1BQU1XLGlCQUFnQkMsVUFBa0I7WUFDdEMsTUFBTVosUUFBUVAseURBQVVBLENBQUN3RCxJQUFJLENBQUMsQ0FBQ0osSUFBTUEsRUFBRWpDLFVBQVUsS0FBS0E7WUFDdEQsT0FBT1osUUFBUWdELFVBQVVoRCxTQUFTO1FBQ3BDO1FBRUEsTUFBTWE7WUFDSixNQUFNcUMsU0FBaUMsQ0FBQztZQUN4QyxLQUFLLE1BQU1MLEtBQUtwRCx5REFBVUEsQ0FBRTtnQkFDMUJ5RCxNQUFNLENBQUNMLEVBQUV4QixNQUFNLENBQUMsR0FBRyxDQUFDNkIsTUFBTSxDQUFDTCxFQUFFeEIsTUFBTSxDQUFDLElBQUksS0FBSztZQUMvQztZQUNBLE9BQU82QjtRQUNUO1FBRUEsTUFBTTVCLFFBQU9DLEtBQXVCO1lBQ2xDLE1BQU00QixNQUFNLElBQUloQjtZQUNoQixNQUFNM0IsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDZix5REFBVUEsQ0FBQzJELE1BQU0sR0FBRyxHQUFHQyxRQUFRLEdBQUdDLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekUsTUFBTUMsV0FBVztnQkFDZi9DO2dCQUNBTCxNQUFNb0IsTUFBTXBCLElBQUk7Z0JBQ2hCc0IsTUFBTUYsTUFBTUUsSUFBSTtnQkFDaEJDLFNBQVNILE1BQU1HLE9BQU87Z0JBQ3RCTCxRQUFRO2dCQUNSVCxZQUFZVyxNQUFNWCxVQUFVO2dCQUM1QmUsY0FBY0osTUFBTUksWUFBWTtnQkFDaENHLFVBQVVQLE1BQU1PLFFBQVEsSUFBSTtnQkFDNUJJLFlBQVk7Z0JBQ1pzQixpQkFBaUI7Z0JBQ2pCQyxXQUFXTjtnQkFDWE8sV0FBV1A7WUFDYjtZQUVBLHNFQUFzRTtZQUN0RTFELHlEQUFVQSxDQUFDa0UsSUFBSSxDQUFDSjtZQUVoQixPQUFPUCxVQUFVTztRQUNuQjtRQUVBLE1BQU14QixRQUFPdkIsRUFBVSxFQUFFZSxLQUF1QjtZQUM5QyxNQUFNdkIsUUFBUVAseURBQVVBLENBQUN3RCxJQUFJLENBQUMsQ0FBQ0osSUFBTUEsRUFBRXJDLEVBQUUsS0FBS0E7WUFDOUMsSUFBSSxDQUFDUixPQUFPLE9BQU87WUFFbkIsbUVBQW1FO1lBQ25FLE9BQU87Z0JBQ0wsR0FBR2dELFVBQVVoRCxNQUFNO2dCQUNuQixHQUFJdUIsTUFBTUYsTUFBTSxLQUFLZSxhQUFhO29CQUFFZixRQUFRRSxNQUFNRixNQUFNO2dCQUF1QixDQUFDO2dCQUNoRmEsWUFBWSxJQUFJQztnQkFDaEJ1QixXQUFXLElBQUl2QjtZQUNqQjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxVQUFVO0FBQ1YsK0VBQStFO0FBRS9FLFNBQVNyQyxXQUFXRixPQUFzQjtJQUN4QyxJQUFJLENBQUNBLFNBQVMsT0FBTyxDQUFDO0lBQ3RCLE1BQU1DLFFBQWlDLENBQUM7SUFDeEMsSUFBSUQsUUFBUXlCLE1BQU0sRUFBRTtRQUNsQnhCLE1BQU13QixNQUFNLEdBQUdxQixNQUFNQyxPQUFPLENBQUMvQyxRQUFReUIsTUFBTSxJQUFJO1lBQUV1QyxJQUFJaEUsUUFBUXlCLE1BQU07UUFBQyxJQUFJekIsUUFBUXlCLE1BQU07SUFDeEY7SUFDQSxJQUFJekIsUUFBUThCLE9BQU8sRUFBRTtRQUNuQjdCLE1BQU02QixPQUFPLEdBQUdnQixNQUFNQyxPQUFPLENBQUMvQyxRQUFROEIsT0FBTyxJQUFJO1lBQUVrQyxJQUFJaEUsUUFBUThCLE9BQU87UUFBQyxJQUFJOUIsUUFBUThCLE9BQU87SUFDNUY7SUFDQSxPQUFPN0I7QUFDVDtBQW9CQSxTQUFTUyxNQUFNRCxHQUFtQjtJQUNoQyxPQUFPO1FBQ0xHLElBQUlILElBQUlHLEVBQUU7UUFDVkwsTUFBTUUsSUFBSUYsSUFBSTtRQUNkc0IsTUFBTXBCLElBQUlvQixJQUFJO1FBQ2RDLFNBQVNyQixJQUFJcUIsT0FBTztRQUNwQkwsUUFBUWhCLElBQUlnQixNQUFNO1FBQ2xCVCxZQUFZUCxJQUFJTyxVQUFVO1FBQzFCZSxjQUFjQyxLQUFLaUMsS0FBSyxDQUFDeEQsSUFBSXNCLFlBQVk7UUFDekNHLFVBQVV6QixJQUFJeUIsUUFBUTtRQUN0Qk8sWUFBWWhDLElBQUlnQyxVQUFVLElBQUk7UUFDOUJDLE9BQU9qQyxJQUFJaUMsS0FBSyxJQUFJO1FBQ3BCSixZQUFZN0IsSUFBSTZCLFVBQVU7UUFDMUJzQixpQkFBaUJuRCxJQUFJbUQsZUFBZTtRQUNwQ0MsV0FBV3BELElBQUlvRCxTQUFTO1FBQ3hCQyxXQUFXckQsSUFBSXFELFNBQVM7SUFDMUI7QUFDRjtBQUVBLFNBQVNWLFVBQVVoRCxLQUFnQztJQUNqRCxPQUFPO1FBQ0xRLElBQUlSLE1BQU1RLEVBQUU7UUFDWkwsTUFBTUgsTUFBTUcsSUFBSTtRQUNoQnNCLE1BQU16QixNQUFNeUIsSUFBSTtRQUNoQkMsU0FBUzFCLE1BQU0wQixPQUFPO1FBQ3RCTCxRQUFRckIsTUFBTXFCLE1BQU07UUFDcEJULFlBQVlaLE1BQU1ZLFVBQVU7UUFDNUJlLGNBQWMzQixNQUFNMkIsWUFBWTtRQUNoQ0csVUFBVTlCLE1BQU04QixRQUFRO1FBQ3hCTyxZQUFZO1FBQ1pDLE9BQU87UUFDUEosWUFBWWxDLE1BQU1rQyxVQUFVO1FBQzVCc0IsaUJBQWlCeEQsTUFBTXdELGVBQWU7UUFDdENDLFdBQVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:489:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:522:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:555:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/plugins/page.js:566:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:434:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:456:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:500:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:533:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:566:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/workspace/page.js:577:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:423:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:434:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:489:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:522:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:555:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/now/page.js:566:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby93b3JrT3JkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNZO0FBQ3dCO0FBcURsRSwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTSTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1ULHVDQUFNQSxDQUFDVSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLGFBQVlWLE9BQTBCO1lBQzFDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCSSxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO29CQUNuQztnQkFDRjtZQUNGO1lBQ0EsT0FBT1osS0FBS0ssR0FBRyxDQUFDLENBQUNRLE1BQVM7b0JBQ3hCLEdBQUdQLE1BQU1PLElBQUk7b0JBQ2JKLFlBQVlJLElBQUlKLFVBQVUsQ0FBQ0osR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQ3RDSCxJQUFJRyxHQUFHSCxFQUFFOzRCQUNUQyxRQUFRRSxHQUFHRixNQUFNO3dCQUNuQjtnQkFDRjtRQUNGO1FBRUEsTUFBTUcsU0FBUUosRUFBVTtZQUN0QixNQUFNRSxNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDZSxVQUFVLENBQUM7Z0JBQUVsQixPQUFPO29CQUFFYTtnQkFBRztZQUFFO1lBQzlELE9BQU9FLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxXQUFVQyxJQUFZO1lBQzFCLE1BQU1MLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNlLFVBQVUsQ0FBQztnQkFBRWxCLE9BQU87b0JBQUVvQjtnQkFBSztZQUFFO1lBQ2hFLE9BQU9MLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNTTtZQUNKLE1BQU1DLFNBQVMsTUFBTTdCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQixPQUFPLENBQUM7Z0JBQzVDQyxJQUFJO29CQUFDO2lCQUFRO2dCQUNiQyxRQUFRO29CQUFFWixJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT2EsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT2YsR0FBRyxDQUFDLENBQUNxQixJQUFNO29CQUFDQSxFQUFFQyxLQUFLO29CQUFFRCxFQUFFSCxNQUFNLENBQUNaLEVBQUU7aUJBQUM7UUFFNUM7UUFFQSxNQUFNaUI7WUFDSixNQUFNQyxRQUFRLElBQUlDO1lBQ2xCRCxNQUFNRSxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUc7WUFFeEIsT0FBT3hDLHVDQUFNQSxDQUFDVSxTQUFTLENBQUMrQixLQUFLLENBQUM7Z0JBQzVCbEMsT0FBTztvQkFDTDZCLE9BQU87b0JBQ1BNLFdBQVc7d0JBQUVDLEtBQUtMO29CQUFNO2dCQUMxQjtZQUNGO1FBQ0Y7UUFFQSxNQUFNTSxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTUUsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUM1Q2xCLE9BQU87b0JBQUVhO2dCQUFHO2dCQUNaSCxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO3dCQUNqQ1QsU0FBUzs0QkFBRWlDLFdBQVc7d0JBQU07b0JBQzlCO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJLENBQUN2QixLQUFLLE9BQU87WUFDakIsT0FBTztnQkFDTCxHQUFHUCxNQUFNTyxJQUFJO2dCQUNiSixZQUFZSSxJQUFJSixVQUFVLENBQUNKLEdBQUcsQ0FBQyxDQUFDUyxLQUFRO3dCQUN0Q0gsSUFBSUcsR0FBR0gsRUFBRTt3QkFDVEMsUUFBUUUsR0FBR0YsTUFBTTtvQkFDbkI7WUFDRjtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLHFCQUFxQjtZQUNyQixNQUFNQyxTQUFTLE1BQU1oRCx1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDdUMsU0FBUyxDQUFDO2dCQUM5Q3JDLFNBQVM7b0JBQUVlLE1BQU07Z0JBQU87Z0JBQ3hCUixRQUFRO29CQUFFUSxNQUFNO2dCQUFLO1lBQ3ZCO1lBQ0EsTUFBTXVCLFVBQVVGLFNBQVNHLFNBQVNILE9BQU9yQixJQUFJLENBQUN5QixPQUFPLENBQUMsT0FBTyxLQUFLLE1BQU07WUFDeEUsTUFBTXpCLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPSCxVQUFVLEdBQUdJLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekQsTUFBTWhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQyxNQUFNLENBQUM7Z0JBQ3hDUyxNQUFNO29CQUNKNUI7b0JBQ0E2QixPQUFPVCxNQUFNUyxLQUFLO29CQUNsQkMsUUFBUVYsTUFBTVUsTUFBTTtvQkFDcEJyQixPQUFPO29CQUNQc0IsVUFBVVgsTUFBTVcsUUFBUSxJQUFJO29CQUM1QkMsT0FBT1osTUFBTVksS0FBSyxJQUFJO29CQUN0QkMsaUJBQWlCYixNQUFNYSxlQUFlLElBQUk7Z0JBQzVDO1lBQ0Y7WUFFQSxtQkFBbUI7WUFDbkIsTUFBTTNELHVEQUFjQSxDQUFDcUIsSUFBSUYsRUFBRSxFQUFFRSxJQUFJSyxJQUFJLEVBQUVMLElBQUlrQyxLQUFLLEVBQUVsQyxJQUFJbUMsTUFBTTtZQUU1RCxPQUFPMUMsTUFBTU87UUFDZjtRQUVBLE1BQU11QyxRQUFPekMsRUFBVSxFQUFFMkIsS0FBMkI7WUFDbEQsTUFBTWUsV0FBVyxNQUFNOUQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUFFbEIsT0FBTztvQkFBRWE7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMwQyxVQUFVLE9BQU87WUFFdEIsTUFBTXhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNtRCxNQUFNLENBQUM7Z0JBQ3hDdEQsT0FBTztvQkFBRWE7Z0JBQUc7Z0JBQ1ptQyxNQUFNO29CQUNKLEdBQUlSLE1BQU1TLEtBQUssS0FBS08sYUFBYTt3QkFBRVAsT0FBT1QsTUFBTVMsS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJVCxNQUFNVSxNQUFNLEtBQUtNLGFBQWE7d0JBQUVOLFFBQVFWLE1BQU1VLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSVYsTUFBTVgsS0FBSyxLQUFLMkIsYUFBYTt3QkFBRTNCLE9BQU9XLE1BQU1YLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSVcsTUFBTVcsUUFBUSxLQUFLSyxhQUFhO3dCQUFFTCxVQUFVWCxNQUFNVyxRQUFRO29CQUFDLENBQUM7b0JBQ2hFLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTt3QkFBRUosT0FBT1osTUFBTVksS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJWixNQUFNaUIsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlakIsTUFBTWlCLGFBQWE7b0JBQUMsQ0FBQztvQkFDL0UsR0FBSWpCLE1BQU1YLEtBQUssS0FBSyxhQUFhO3dCQUFFTSxXQUFXLElBQUlIO29CQUFPLENBQUM7Z0JBQzVEO1lBQ0Y7WUFFQSwrQ0FBK0M7WUFDL0MsSUFBSVEsTUFBTVMsS0FBSyxLQUFLTyxhQUFhaEIsTUFBTVUsTUFBTSxLQUFLTSxXQUFXO2dCQUMzRCxNQUFNOUQsdURBQWNBLENBQUNxQixJQUFJRixFQUFFLEVBQUVFLElBQUlLLElBQUksRUFBRUwsSUFBSWtDLEtBQUssRUFBRWxDLElBQUltQyxNQUFNO1lBQzlEO1lBRUEsT0FBTzFDLE1BQU1PO1FBQ2Y7UUFFQSxNQUFNMkMseUJBQ0o3QyxFQUFVLEVBQ1Y4QyxRQUFnQixFQUNoQkMsS0FBYTtZQUViLE9BQU9uRSx1Q0FBTUEsQ0FBQ29FLFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsb0JBQW9CO2dCQUNwQixNQUFNUCxXQUFXLE1BQU1PLEdBQUczRCxTQUFTLENBQUNlLFVBQVUsQ0FBQztvQkFBRWxCLE9BQU87d0JBQUVhO29CQUFHO2dCQUFFO2dCQUMvRCxJQUFJLENBQUMwQyxVQUFVLE9BQU87Z0JBRXRCLE1BQU1RLGdCQUFnQlIsU0FBUzFCLEtBQUs7Z0JBRXBDLG9CQUFvQjtnQkFDcEIsTUFBTWQsTUFBTSxNQUFNK0MsR0FBRzNELFNBQVMsQ0FBQ21ELE1BQU0sQ0FBQztvQkFDcEN0RCxPQUFPO3dCQUFFYTtvQkFBRztvQkFDWm1DLE1BQU07d0JBQ0puQixPQUFPOEI7d0JBQ1AsR0FBSUEsYUFBYSxhQUFhOzRCQUFFeEIsV0FBVyxJQUFJSDt3QkFBTyxDQUFDO29CQUN6RDtnQkFDRjtnQkFFQSx5QkFBeUI7Z0JBQ3pCLE1BQU1nQyxhQUFhLENBQUMsSUFBSSxFQUFFaEMsS0FBS2lDLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLEtBQUssQ0FBQyxHQUFHLElBQUk7Z0JBQ2hGLE1BQU1QLEdBQUdRLFFBQVEsQ0FBQy9CLE1BQU0sQ0FBQztvQkFDdkJTLE1BQU07d0JBQ0puQyxJQUFJbUQ7d0JBQ0pPLElBQUksSUFBSXZDO3dCQUNSd0MsTUFBTTt3QkFDTlo7d0JBQ0FhLFlBQVk7d0JBQ1pDLFVBQVU3RDt3QkFDVjhELFNBQVMsQ0FBQywyQkFBMkIsRUFBRWhCLFVBQVU7d0JBQ2pEaUIsYUFBYUMsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQmY7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x4RCxXQUFXSyxNQUFNTztvQkFDakJnRDtvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNlO0lBQ2QsT0FBTztRQUNMLE1BQU1qRixNQUFLQyxPQUEwQjtZQUNuQyxJQUFJaUYsU0FBUzttQkFBSXJGLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVM4QixPQUFPO2dCQUNsQixNQUFNb0QsU0FBU0MsTUFBTUMsT0FBTyxDQUFDcEYsUUFBUThCLEtBQUssSUFBSTlCLFFBQVE4QixLQUFLLEdBQUc7b0JBQUM5QixRQUFROEIsS0FBSztpQkFBQztnQkFDN0VtRCxTQUFTQSxPQUFPSSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0osT0FBT0ssUUFBUSxDQUFDRCxHQUFHeEQsS0FBSztZQUN6RDtZQUNBLElBQUk5QixTQUFTb0QsVUFBVTtnQkFDckIsTUFBTW9DLGFBQWFMLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUlwRCxRQUFRb0QsUUFBUSxHQUFHO29CQUFDcEQsUUFBUW9ELFFBQVE7aUJBQUM7Z0JBQzFGNkIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9FLFdBQVdELFFBQVEsQ0FBQ0QsR0FBR2xDLFFBQVE7WUFDaEU7WUFDQSxJQUFJcEQsU0FBU3FELE9BQU87Z0JBQ2xCNEIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqQyxLQUFLLEtBQUtyRCxRQUFRcUQsS0FBSztZQUMzRDtZQUNBLE9BQU80QixPQUFPekUsR0FBRyxDQUFDaUY7UUFDcEI7UUFFQSxNQUFNL0UsYUFBWVYsT0FBMEI7WUFDMUMsTUFBTTBGLGFBQWEsTUFBTSxJQUFJLENBQUMzRixJQUFJLENBQUNDO1lBQ25DLE9BQU8wRixXQUFXbEYsR0FBRyxDQUFDLENBQUM4RSxLQUFRO29CQUM3QixHQUFHQSxFQUFFO29CQUNMMUUsWUFBWWYsNkRBQWNBLENBQ3ZCd0YsTUFBTSxDQUFDLENBQUNwRSxLQUFPQSxHQUFHMEUsV0FBVyxLQUFLTCxHQUFHeEUsRUFBRSxFQUN2Q04sR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQUVILElBQUlHLEdBQUdILEVBQUU7NEJBQUVDLFFBQVFFLEdBQUdGLE1BQU07d0JBQUM7Z0JBQ2pEO1FBQ0Y7UUFFQSxNQUFNRyxTQUFRSixFQUFVO1lBQ3RCLE1BQU13RSxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsT0FBT3dFLEtBQUtHLFVBQVVILE1BQU07UUFDOUI7UUFFQSxNQUFNbEUsV0FBVUMsSUFBWTtZQUMxQixNQUFNaUUsS0FBSzFGLDZEQUFjQSxDQUFDZ0csSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUV4RSxJQUFJLEtBQUtBO1lBQ2pELE9BQU9pRSxLQUFLRyxVQUFVSCxNQUFNO1FBQzlCO1FBRUEsTUFBTWhFO1lBQ0osTUFBTXdFLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNUixNQUFNMUYsNkRBQWNBLENBQUU7Z0JBQy9Ca0csTUFBTSxDQUFDUixHQUFHeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQ2dFLE1BQU0sQ0FBQ1IsR0FBR3hELEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPZ0U7UUFDVDtRQUVBLE1BQU0vRDtZQUNKLE1BQU1DLFFBQVEsSUFBSUM7WUFDbEJELE1BQU1FLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRztZQUV4QixPQUFPdEMsNkRBQWNBLENBQUN5RixNQUFNLENBQzFCLENBQUNDLEtBQU9BLEdBQUd4RCxLQUFLLEtBQUssYUFBYXdELEdBQUdsRCxTQUFTLElBQUlrRCxHQUFHbEQsU0FBUyxJQUFJSixPQUNsRStELE1BQU07UUFDVjtRQUVBLE1BQU16RCxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTXdFLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFDaEIsT0FBTztnQkFDTCxHQUFHRyxVQUFVSCxHQUFHO2dCQUNoQjFFLFlBQVlmLDZEQUFjQSxDQUN2QndGLE1BQU0sQ0FBQyxDQUFDcEUsS0FBT0EsR0FBRzBFLFdBQVcsS0FBSzdFLElBQ2xDTixHQUFHLENBQUMsQ0FBQ1MsS0FBUTt3QkFBRUgsSUFBSUcsR0FBR0gsRUFBRTt3QkFBRUMsUUFBUUUsR0FBR0YsTUFBTTtvQkFBQztZQUNqRDtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLDRCQUE0QjtZQUM1QixNQUFNM0IsS0FBSyxDQUFDLFFBQVEsRUFBRW1CLEtBQUtpQyxHQUFHLElBQUk7WUFDbEMsTUFBTTdDLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPbkQsNkRBQWNBLENBQUNtRyxNQUFNLEdBQUcsR0FBRy9DLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFDdkUsTUFBTWtCLE1BQU0sSUFBSWpDO1lBRWhCLE1BQU0rRCxRQUFRO2dCQUNabEY7Z0JBQ0FPO2dCQUNBNkIsT0FBT1QsTUFBTVMsS0FBSztnQkFDbEJDLFFBQVFWLE1BQU1VLE1BQU07Z0JBQ3BCckIsT0FBTztnQkFDUHNCLFVBQVdYLE1BQU1XLFFBQVEsSUFBSTtnQkFDN0JDLE9BQVFaLE1BQU1ZLEtBQUssSUFBSTtnQkFDdkJDLGlCQUFpQmIsTUFBTWEsZUFBZSxJQUFJO2dCQUMxQ0ksZUFBZTtnQkFDZm5CLFdBQVcyQjtnQkFDWDNELFdBQVcyRDtnQkFDWDlCLFdBQVc7WUFDYjtZQUVBLHVEQUF1RDtZQUN2RCxPQUFPcUQsVUFBVU87UUFDbkI7UUFFQSxNQUFNekMsUUFBT3pDLEVBQVUsRUFBRTJCLEtBQTJCO1lBQ2xELE1BQU02QyxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDd0UsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdHLFVBQVVILEdBQUc7Z0JBQ2hCLEdBQUk3QyxNQUFNUyxLQUFLLEtBQUtPLGFBQWE7b0JBQUVQLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSVQsTUFBTVUsTUFBTSxLQUFLTSxhQUFhO29CQUFFTixRQUFRVixNQUFNVSxNQUFNO2dCQUFDLENBQUM7Z0JBQzFELEdBQUlWLE1BQU1YLEtBQUssS0FBSzJCLGFBQWE7b0JBQUUzQixPQUFPVyxNQUFNWCxLQUFLO2dCQUEwQixDQUFDO2dCQUNoRixHQUFJVyxNQUFNVyxRQUFRLEtBQUtLLGFBQWE7b0JBQUVMLFVBQVVYLE1BQU1XLFFBQVE7Z0JBQTZCLENBQUM7Z0JBQzVGLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTtvQkFBRUosT0FBT1osTUFBTVksS0FBSztnQkFBMEIsQ0FBQztnQkFDaEYsR0FBSVosTUFBTWlCLGFBQWEsS0FBS0QsYUFBYTtvQkFBRUMsZUFBZWpCLE1BQU1pQixhQUFhO2dCQUFDLENBQUM7Z0JBQy9FbkQsV0FBVyxJQUFJMEI7WUFDakI7UUFDRjtRQUVBLE1BQU0wQix5QkFDSjdDLEVBQVUsRUFDVjhDLFFBQWdCLEVBQ2hCcUMsTUFBYztZQUVkLE1BQU1YLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFFaEIsTUFBTXRCLGdCQUFnQnNCLEdBQUd4RCxLQUFLO1lBQzlCLE1BQU1tQyxhQUFhLENBQUMsU0FBUyxFQUFFaEMsS0FBS2lDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMOUQsV0FBVztvQkFDVCxHQUFHcUYsVUFBVUgsR0FBRztvQkFDaEJ4RCxPQUFPOEI7b0JBQ1ByRCxXQUFXLElBQUkwQjtvQkFDZixHQUFJMkIsYUFBYSxhQUFhO3dCQUFFeEIsV0FBVyxJQUFJSDtvQkFBTyxDQUFDO2dCQUN6RDtnQkFDQStCO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUy9ELFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFROEIsS0FBSyxFQUFFO1FBQ2pCN0IsTUFBTTZCLEtBQUssR0FBR3FELE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVE4QixLQUFLLElBQUk7WUFBRW9FLElBQUlsRyxRQUFROEIsS0FBSztRQUFDLElBQUk5QixRQUFROEIsS0FBSztJQUNwRjtJQUNBLElBQUk5QixRQUFRb0QsUUFBUSxFQUFFO1FBQ3BCbkQsTUFBTW1ELFFBQVEsR0FBRytCLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUk7WUFBRThDLElBQUlsRyxRQUFRb0QsUUFBUTtRQUFDLElBQUlwRCxRQUFRb0QsUUFBUTtJQUNoRztJQUNBLElBQUlwRCxRQUFRcUQsS0FBSyxFQUFFO1FBQ2pCcEQsTUFBTW9ELEtBQUssR0FBR3JELFFBQVFxRCxLQUFLO0lBQzdCO0lBQ0EsT0FBT3BEO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNTyxHQWFkO0lBQ0MsT0FBTztRQUNMRixJQUFJRSxJQUFJRixFQUFFO1FBQ1ZPLE1BQU1MLElBQUlLLElBQUk7UUFDZDZCLE9BQU9sQyxJQUFJa0MsS0FBSztRQUNoQkMsUUFBUW5DLElBQUltQyxNQUFNO1FBQ2xCckIsT0FBT2QsSUFBSWMsS0FBSztRQUNoQnNCLFVBQVVwQyxJQUFJb0MsUUFBUTtRQUN0QkMsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCQyxpQkFBaUJ0QyxJQUFJc0MsZUFBZTtRQUNwQ0ksZUFBZTFDLElBQUkwQyxhQUFhO1FBQ2hDbkIsV0FBV3ZCLElBQUl1QixTQUFTO1FBQ3hCaEMsV0FBV1MsSUFBSVQsU0FBUztRQUN4QjZCLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBU3FELFVBQVVILEVBQWlDO0lBQ2xELE9BQU87UUFDTHhFLElBQUl3RSxHQUFHeEUsRUFBRTtRQUNUTyxNQUFNaUUsR0FBR2pFLElBQUk7UUFDYjZCLE9BQU9vQyxHQUFHcEMsS0FBSztRQUNmQyxRQUFRbUMsR0FBR25DLE1BQU07UUFDakJyQixPQUFPd0QsR0FBR3hELEtBQUs7UUFDZnNCLFVBQVVrQyxHQUFHbEMsUUFBUTtRQUNyQkMsT0FBT2lDLEdBQUdqQyxLQUFLO1FBQ2ZDLGlCQUFpQmdDLEdBQUdoQyxlQUFlO1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9hY3Rpdml0aWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7O0NBS0MsR0FFNkI7QUFDb0I7QUFDUDtBQXdCM0MsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQiwrRUFBK0U7QUFFeEUsU0FBU0c7SUFDZCxPQUFPO1FBQ0wsTUFBTUMsTUFBS0MsT0FBeUIsRUFBRUMsVUFBOEI7WUFDbEUsTUFBTUMsUUFBUUMsV0FBV0g7WUFDekIsTUFBTUksT0FBTyxNQUFNVCx1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDQyxRQUFRLENBQUM7Z0JBQzFDSjtnQkFDQUssU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1SLFlBQVlTLFNBQVM7Z0JBQzNCQyxNQUFNVixZQUFZVyxVQUFVO1lBQzlCO1lBQ0EsT0FBT1IsS0FBS1MsR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ2EsVUFBVSxDQUFDO2dCQUFFaEIsT0FBTztvQkFBRWM7Z0JBQUc7WUFBRTtZQUM3RCxPQUFPQyxNQUFNSCxNQUFNRyxPQUFPO1FBQzVCO1FBRUEsTUFBTUUsWUFBV1QsUUFBUSxFQUFFO1lBQ3pCLE1BQU1OLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0MsU0FBUztvQkFBRUMsSUFBSTtnQkFBTztnQkFDdEJDLE1BQU1DO1lBQ1I7WUFDQSxPQUFPTixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTU0sZUFBY0MsVUFBa0IsRUFBRUMsUUFBZ0I7WUFDdEQsTUFBTWxCLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMxQ0osT0FBTztvQkFBRW1CO29CQUFZQztnQkFBUztnQkFDOUJmLFNBQVM7b0JBQUVDLElBQUk7Z0JBQU87WUFDeEI7WUFDQSxPQUFPSixLQUFLUyxHQUFHLENBQUNDO1FBQ2xCO1FBRUEsTUFBTVMsUUFBT0MsS0FBMEI7WUFDckMsTUFBTVIsS0FBSyxDQUFDLElBQUksRUFBRVMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsSUFBSTtZQUN4RSxNQUFNYixNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsUUFBUSxDQUFDa0IsTUFBTSxDQUFDO2dCQUN2Q1EsTUFBTTtvQkFDSmY7b0JBQ0FSLElBQUksSUFBSWlCO29CQUNSTyxNQUFNUixNQUFNUSxJQUFJO29CQUNoQkMsT0FBT1QsTUFBTVMsS0FBSztvQkFDbEJaLFlBQVlHLE1BQU1ILFVBQVU7b0JBQzVCQyxVQUFVRSxNQUFNRixRQUFRO29CQUN4QlksU0FBU1YsTUFBTVUsT0FBTztvQkFDdEJDLGFBQWFDLEtBQUtDLFNBQVMsQ0FBQ2IsTUFBTVcsV0FBVyxJQUFJLENBQUM7Z0JBQ3BEO1lBQ0Y7WUFDQSxNQUFNRyxNQUFNeEIsTUFBTUc7WUFFbEIsd0JBQXdCO1lBQ3hCcEIsd0RBQWVBLENBQUN5QztZQUVoQixPQUFPQTtRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNDO0lBQ2QsT0FBTztRQUNMLE1BQU14QyxNQUFLQyxPQUF5QixFQUFFQyxVQUE4QjtZQUNsRSxJQUFJdUMsU0FBUzttQkFBSTVDLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVNxQixZQUFZO2dCQUN2Qm1CLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFckIsVUFBVSxLQUFLckIsUUFBUXFCLFVBQVU7WUFDbkU7WUFDQSxJQUFJckIsU0FBU3NCLFVBQVU7Z0JBQ3JCa0IsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLElBQU1BLEVBQUVwQixRQUFRLEtBQUt0QixRQUFRc0IsUUFBUTtZQUMvRDtZQUNBLElBQUl0QixTQUFTZ0MsTUFBTTtnQkFDakJRLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxFQUFFVixJQUFJLEtBQUtoQyxRQUFRZ0MsSUFBSTtZQUN2RDtZQUNBLCtCQUErQjtZQUMvQlEsT0FBT0csSUFBSSxDQUFDLENBQUNELEdBQUdFLElBQU1BLEVBQUVwQyxFQUFFLENBQUNxQyxPQUFPLEtBQUtILEVBQUVsQyxFQUFFLENBQUNxQyxPQUFPO1lBQ25ELG1CQUFtQjtZQUNuQixNQUFNakMsU0FBU1gsWUFBWVcsVUFBVTtZQUNyQyxNQUFNRixRQUFRVCxZQUFZUyxTQUFTO1lBQ25DLE9BQU84QixPQUFPVixLQUFLLENBQUNsQixRQUFRQSxTQUFTRixPQUFPRyxHQUFHLENBQUNpQztRQUNsRDtRQUVBLE1BQU0vQixTQUFRQyxFQUFVO1lBQ3RCLE1BQU1YLFdBQVdULDZEQUFjQSxDQUFDbUQsSUFBSSxDQUFDLENBQUNMLElBQU1BLEVBQUUxQixFQUFFLEtBQUtBO1lBQ3JELE9BQU9YLFdBQVd5QyxVQUFVekMsWUFBWTtRQUMxQztRQUVBLE1BQU1jLFlBQVdULFFBQVEsRUFBRTtZQUN6QixPQUFPO21CQUFJZCw2REFBY0E7YUFBQyxDQUN2QitDLElBQUksQ0FBQyxDQUFDRCxHQUFHRSxJQUFNQSxFQUFFcEMsRUFBRSxDQUFDcUMsT0FBTyxLQUFLSCxFQUFFbEMsRUFBRSxDQUFDcUMsT0FBTyxJQUM1Q2YsS0FBSyxDQUFDLEdBQUdwQixPQUNURyxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTTFCLGVBQWNDLFVBQWtCLEVBQUVDLFFBQWdCO1lBQ3RELE9BQU8xQiw2REFBY0EsQ0FDbEI2QyxNQUFNLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRXJCLFVBQVUsS0FBS0EsY0FBY3FCLEVBQUVwQixRQUFRLEtBQUtBLFVBQzVEVCxHQUFHLENBQUNpQztRQUNUO1FBRUEsTUFBTXZCLFFBQU9DLEtBQTBCO1lBQ3JDLDJFQUEyRTtZQUMzRSxNQUFNUixLQUFLLENBQUMsSUFBSSxFQUFFUyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO1lBQ3hFLE1BQU1RLE1BQW1CO2dCQUN2QnRCO2dCQUNBUixJQUFJLElBQUlpQjtnQkFDUk8sTUFBTVIsTUFBTVEsSUFBSTtnQkFDaEJDLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQ2xCWixZQUFZRyxNQUFNSCxVQUFVO2dCQUM1QkMsVUFBVUUsTUFBTUYsUUFBUTtnQkFDeEJZLFNBQVNWLE1BQU1VLE9BQU87Z0JBQ3RCQyxhQUFhWCxNQUFNVyxXQUFXLElBQUksQ0FBQztZQUNyQztZQUVBLHdCQUF3QjtZQUN4QnRDLHdEQUFlQSxDQUFDeUM7WUFFaEIsT0FBT0E7UUFDVDtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTbkMsV0FBV0gsT0FBeUI7SUFDM0MsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNRSxRQUFpQyxDQUFDO0lBQ3hDLElBQUlGLFFBQVFxQixVQUFVLEVBQUU7UUFDdEJuQixNQUFNbUIsVUFBVSxHQUFHckIsUUFBUXFCLFVBQVU7SUFDdkM7SUFDQSxJQUFJckIsUUFBUXNCLFFBQVEsRUFBRTtRQUNwQnBCLE1BQU1vQixRQUFRLEdBQUd0QixRQUFRc0IsUUFBUTtJQUNuQztJQUNBLElBQUl0QixRQUFRZ0MsSUFBSSxFQUFFO1FBQ2hCOUIsTUFBTThCLElBQUksR0FBR2hDLFFBQVFnQyxJQUFJO0lBQzNCO0lBQ0EsT0FBTzlCO0FBQ1Q7QUFFQSxTQUFTWSxNQUFNRyxHQVNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZSLElBQUlTLElBQUlULEVBQUU7UUFDVndCLE1BQU1mLElBQUllLElBQUk7UUFDZEMsT0FBT2hCLElBQUlnQixLQUFLO1FBQ2hCWixZQUFZSixJQUFJSSxVQUFVO1FBQzFCQyxVQUFVTCxJQUFJSyxRQUFRO1FBQ3RCWSxTQUFTakIsSUFBSWlCLE9BQU87UUFDcEJDLGFBQWFDLEtBQUtZLEtBQUssQ0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:456:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:467:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:511:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby9vcGVyYXRpb25zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztDQUlDLEdBRTZCO0FBQ29CO0FBMkNsRCwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTRTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1QLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLFNBQVFDLEVBQVU7WUFDdEIsTUFBTUMsTUFBTSxNQUFNaEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ1MsVUFBVSxDQUFDO2dCQUFFWixPQUFPO29CQUFFVTtnQkFBRztZQUFFO1lBQzlELE9BQU9DLE1BQU1ILE1BQU1HLE9BQU87UUFDNUI7UUFFQSxNQUFNRSxrQkFBaUJDLFdBQW1CO1lBQ3hDLE1BQU1aLE9BQU8sTUFBTVAsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0osT0FBTztvQkFBRWM7Z0JBQVk7Z0JBQ3JCVCxTQUFTO29CQUFFVSxXQUFXO2dCQUFNO1lBQzlCO1lBQ0EsT0FBT2IsS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1RO1lBQ0osTUFBTUMsU0FBUyxNQUFNdEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ2UsT0FBTyxDQUFDO2dCQUM1Q0MsSUFBSTtvQkFBQztpQkFBUztnQkFDZEMsUUFBUTtvQkFBRVYsSUFBSTtnQkFBSztZQUNyQjtZQUNBLE9BQU9XLE9BQU9DLFdBQVcsQ0FDdkJMLE9BQU9WLEdBQUcsQ0FBQyxDQUFDZ0IsSUFBTTtvQkFBQ0EsRUFBRUMsTUFBTTtvQkFBRUQsRUFBRUgsTUFBTSxDQUFDVixFQUFFO2lCQUFDO1FBRTdDO1FBRUEsTUFBTWUsUUFBT0MsS0FBMkI7WUFDdEMsTUFBTWYsTUFBTSxNQUFNaEIsdUNBQU1BLENBQUNRLFNBQVMsQ0FBQ3NCLE1BQU0sQ0FBQztnQkFDeENFLE1BQU07b0JBQ0piLGFBQWFZLE1BQU1aLFdBQVc7b0JBQzlCYyxTQUFTRixNQUFNRSxPQUFPO29CQUN0QkMsT0FBT0gsTUFBTUcsS0FBSztvQkFDbEJDLE9BQU9KLE1BQU1JLEtBQUssSUFBSTtvQkFDdEJOLFFBQVE7b0JBQ1JPLGtCQUFrQjtvQkFDbEJDLHVCQUF1QkMsS0FBS0MsU0FBUyxDQUFDUixNQUFNTSxxQkFBcUIsSUFBSSxFQUFFO29CQUN2RUcsVUFBVVQsTUFBTVMsUUFBUSxJQUFJO2dCQUM5QjtZQUNGO1lBQ0EsT0FBTzNCLE1BQU1HO1FBQ2Y7UUFFQSxNQUFNeUIsUUFBTzFCLEVBQVUsRUFBRWdCLEtBQTJCO1lBQ2xELE1BQU1XLFdBQVcsTUFBTTFDLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVU7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMyQixVQUFVLE9BQU87WUFFdEIsTUFBTTFCLE1BQU0sTUFBTWhCLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNpQyxNQUFNLENBQUM7Z0JBQ3hDcEMsT0FBTztvQkFBRVU7Z0JBQUc7Z0JBQ1ppQixNQUFNO29CQUNKLEdBQUlELE1BQU1GLE1BQU0sS0FBS2MsYUFBYTt3QkFBRWQsUUFBUUUsTUFBTUYsTUFBTTtvQkFBQyxDQUFDO29CQUMxRCxHQUFJRSxNQUFNSSxLQUFLLEtBQUtRLGFBQWE7d0JBQUVSLE9BQU9KLE1BQU1JLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSUosTUFBTWEsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlYixNQUFNYSxhQUFhO29CQUFDLENBQUM7Z0JBQ2pGO1lBQ0Y7WUFFQSxPQUFPL0IsTUFBTUc7UUFDZjtRQUVBLE1BQU02QiwwQkFDSjlCLEVBQVUsRUFDVitCLFNBQWlCLEVBQ2pCQyxLQUFhO1lBRWIsT0FBTy9DLHVDQUFNQSxDQUFDZ0QsWUFBWSxDQUFDLE9BQU9DO2dCQUNoQyx3QkFBd0I7Z0JBQ3hCLE1BQU1QLFdBQVcsTUFBTU8sR0FBR3pDLFNBQVMsQ0FBQ1MsVUFBVSxDQUFDO29CQUFFWixPQUFPO3dCQUFFVTtvQkFBRztnQkFBRTtnQkFDL0QsSUFBSSxDQUFDMkIsVUFBVSxPQUFPO2dCQUV0QixNQUFNUSxpQkFBaUJSLFNBQVNiLE1BQU07Z0JBRXRDLG1CQUFtQjtnQkFDbkIsTUFBTWIsTUFBTSxNQUFNaUMsR0FBR3pDLFNBQVMsQ0FBQ2lDLE1BQU0sQ0FBQztvQkFDcENwQyxPQUFPO3dCQUFFVTtvQkFBRztvQkFDWmlCLE1BQU07d0JBQUVILFFBQVFpQjtvQkFBVTtnQkFDNUI7Z0JBRUEseUJBQXlCO2dCQUN6QixNQUFNSyxhQUFhLENBQUMsSUFBSSxFQUFFQyxLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsR0FBRyxJQUFJO2dCQUNoRixNQUFNUixHQUFHUyxRQUFRLENBQUM1QixNQUFNLENBQUM7b0JBQ3ZCRSxNQUFNO3dCQUNKakIsSUFBSW9DO3dCQUNKUSxJQUFJLElBQUlQO3dCQUNSUSxNQUFNO3dCQUNOYjt3QkFDQWMsWUFBWTt3QkFDWkMsVUFBVS9DO3dCQUNWZ0QsU0FBUyxDQUFDLDBCQUEwQixFQUFFakIsV0FBVzt3QkFDakRrQixhQUFhMUIsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQnBCLGFBQWF1QixTQUFTdkIsV0FBVzs0QkFDakMrQjs0QkFDQUo7d0JBQ0Y7b0JBQ0Y7Z0JBQ0Y7Z0JBRUEsT0FBTztvQkFDTHRDLFdBQVdLLE1BQU1HO29CQUNqQmtDO29CQUNBQztnQkFDRjtZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLHNCQUFzQjtBQUN0QiwrRUFBK0U7QUFFeEUsU0FBU2M7SUFDZCxPQUFPO1FBQ0wsTUFBTTlELE1BQUtDLE9BQTBCO1lBQ25DLElBQUk4RCxTQUFTO21CQUFJakUsNkRBQWNBO2FBQUM7WUFDaEMsSUFBSUcsU0FBU2UsYUFBYTtnQkFDeEIrQyxTQUFTQSxPQUFPQyxNQUFNLENBQUMsQ0FBQ0MsS0FBT0EsR0FBR2pELFdBQVcsS0FBS2YsUUFBUWUsV0FBVztZQUN2RTtZQUNBLElBQUlmLFNBQVN5QixRQUFRO2dCQUNuQixNQUFNd0MsV0FBV0MsTUFBTUMsT0FBTyxDQUFDbkUsUUFBUXlCLE1BQU0sSUFBSXpCLFFBQVF5QixNQUFNLEdBQUc7b0JBQUN6QixRQUFReUIsTUFBTTtpQkFBQztnQkFDbEZxQyxTQUFTQSxPQUFPQyxNQUFNLENBQUMsQ0FBQ0MsS0FBT0MsU0FBU0csUUFBUSxDQUFDSixHQUFHdkMsTUFBTTtZQUM1RDtZQUNBLElBQUl6QixTQUFTNkIsU0FBUztnQkFDcEIsTUFBTXdDLFdBQVdILE1BQU1DLE9BQU8sQ0FBQ25FLFFBQVE2QixPQUFPLElBQUk3QixRQUFRNkIsT0FBTyxHQUFHO29CQUFDN0IsUUFBUTZCLE9BQU87aUJBQUM7Z0JBQ3JGaUMsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLEtBQU9LLFNBQVNELFFBQVEsQ0FBQ0osR0FBR25DLE9BQU87WUFDN0Q7WUFDQSxPQUFPaUMsT0FBT3RELEdBQUcsQ0FBQzhEO1FBQ3BCO1FBRUEsTUFBTTVELFNBQVFDLEVBQVU7WUFDdEIsTUFBTXFELEtBQUtuRSw2REFBY0EsQ0FBQzBFLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFN0QsRUFBRSxLQUFLQTtZQUMvQyxPQUFPcUQsS0FBS00sVUFBVU4sTUFBTTtRQUM5QjtRQUVBLE1BQU1sRCxrQkFBaUJDLFdBQW1CO1lBQ3hDLE9BQU9sQiw2REFBY0EsQ0FDbEJrRSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0EsR0FBR2pELFdBQVcsS0FBS0EsYUFDbENQLEdBQUcsQ0FBQzhEO1FBQ1Q7UUFFQSxNQUFNckQ7WUFDSixNQUFNd0QsU0FBaUMsQ0FBQztZQUN4QyxLQUFLLE1BQU1ULE1BQU1uRSw2REFBY0EsQ0FBRTtnQkFDL0I0RSxNQUFNLENBQUNULEdBQUd2QyxNQUFNLENBQUMsR0FBRyxDQUFDZ0QsTUFBTSxDQUFDVCxHQUFHdkMsTUFBTSxDQUFDLElBQUksS0FBSztZQUNqRDtZQUNBLE9BQU9nRDtRQUNUO1FBRUEsTUFBTS9DLFFBQU9DLEtBQTJCO1lBQ3RDLE1BQU1oQixLQUFLLENBQUMsUUFBUSxFQUFFcUMsS0FBS0MsR0FBRyxJQUFJO1lBQ2xDLE1BQU1BLE1BQU0sSUFBSUQ7WUFDaEIsT0FBTztnQkFDTHJDO2dCQUNBSSxhQUFhWSxNQUFNWixXQUFXO2dCQUM5QmMsU0FBU0YsTUFBTUUsT0FBTztnQkFDdEJDLE9BQU9ILE1BQU1HLEtBQUs7Z0JBQ2xCQyxPQUFPSixNQUFNSSxLQUFLLElBQUk7Z0JBQ3RCTixRQUFRO2dCQUNSTyxrQkFBa0IsRUFBRTtnQkFDcEJDLHVCQUF1Qk4sTUFBTU0scUJBQXFCLElBQUksRUFBRTtnQkFDeERHLFVBQVVULE1BQU1TLFFBQVEsSUFBSTtnQkFDNUJJLGVBQWU7Z0JBQ2Z4QixXQUFXaUM7Z0JBQ1gxQyxXQUFXMEM7WUFDYjtRQUNGO1FBRUEsTUFBTVosUUFBTzFCLEVBQVUsRUFBRWdCLEtBQTJCO1lBQ2xELE1BQU1xQyxLQUFLbkUsNkRBQWNBLENBQUMwRSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRTdELEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDcUQsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdNLFVBQVVOLEdBQUc7Z0JBQ2hCLEdBQUlyQyxNQUFNRixNQUFNLEtBQUtjLGFBQWE7b0JBQUVkLFFBQVFFLE1BQU1GLE1BQU07Z0JBQTJCLENBQUM7Z0JBQ3BGLEdBQUlFLE1BQU1JLEtBQUssS0FBS1EsYUFBYTtvQkFBRVIsT0FBT0osTUFBTUksS0FBSztnQkFBQyxDQUFDO2dCQUN2RCxHQUFJSixNQUFNYSxhQUFhLEtBQUtELGFBQWE7b0JBQUVDLGVBQWViLE1BQU1hLGFBQWE7Z0JBQUMsQ0FBQztnQkFDL0VqQyxXQUFXLElBQUl5QztZQUNqQjtRQUNGO1FBRUEsTUFBTVAsMEJBQ0o5QixFQUFVLEVBQ1YrQixTQUFpQixFQUNqQmdDLE1BQWM7WUFFZCxNQUFNVixLQUFLbkUsNkRBQWNBLENBQUMwRSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRTdELEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDcUQsSUFBSSxPQUFPO1lBRWhCLE1BQU1sQixpQkFBaUJrQixHQUFHdkMsTUFBTTtZQUNoQyxNQUFNc0IsYUFBYSxDQUFDLFNBQVMsRUFBRUMsS0FBS0MsR0FBRyxJQUFJO1lBRTNDLE9BQU87Z0JBQ0w3QyxXQUFXO29CQUNULEdBQUdrRSxVQUFVTixHQUFHO29CQUNoQnZDLFFBQVFpQjtvQkFDUm5DLFdBQVcsSUFBSXlDO2dCQUNqQjtnQkFDQUY7Z0JBQ0FDO1lBQ0Y7UUFDRjtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTN0MsV0FBV0YsT0FBMEI7SUFDNUMsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNQyxRQUFpQyxDQUFDO0lBQ3hDLElBQUlELFFBQVFlLFdBQVcsRUFBRTtRQUN2QmQsTUFBTWMsV0FBVyxHQUFHZixRQUFRZSxXQUFXO0lBQ3pDO0lBQ0EsSUFBSWYsUUFBUXlCLE1BQU0sRUFBRTtRQUNsQnhCLE1BQU13QixNQUFNLEdBQUd5QyxNQUFNQyxPQUFPLENBQUNuRSxRQUFReUIsTUFBTSxJQUFJO1lBQUVrRCxJQUFJM0UsUUFBUXlCLE1BQU07UUFBQyxJQUFJekIsUUFBUXlCLE1BQU07SUFDeEY7SUFDQSxJQUFJekIsUUFBUTZCLE9BQU8sRUFBRTtRQUNuQjVCLE1BQU00QixPQUFPLEdBQUdxQyxNQUFNQyxPQUFPLENBQUNuRSxRQUFRNkIsT0FBTyxJQUFJO1lBQUU4QyxJQUFJM0UsUUFBUTZCLE9BQU87UUFBQyxJQUFJN0IsUUFBUTZCLE9BQU87SUFDNUY7SUFDQSxPQUFPNUI7QUFDVDtBQUVBLFNBQVNRLE1BQU1HLEdBYWQ7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:544:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:577:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/maintenance/page.js:588:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:434:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:456:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:500:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:533:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:566:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/skills/page.js:577:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVwby93b3JrT3JkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNZO0FBQ3dCO0FBcURsRSwrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTSTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUEwQjtZQUNuQyxNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1ULHVDQUFNQSxDQUFDVSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKO2dCQUNBSyxTQUFTO29CQUFFQyxXQUFXO2dCQUFPO1lBQy9CO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDQztRQUNsQjtRQUVBLE1BQU1DLGFBQVlWLE9BQTBCO1lBQzFDLE1BQU1DLFFBQVFDLFdBQVdGO1lBQ3pCLE1BQU1HLE9BQU8sTUFBTVQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ0MsUUFBUSxDQUFDO2dCQUMzQ0o7Z0JBQ0FLLFNBQVM7b0JBQUVDLFdBQVc7Z0JBQU87Z0JBQzdCSSxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO29CQUNuQztnQkFDRjtZQUNGO1lBQ0EsT0FBT1osS0FBS0ssR0FBRyxDQUFDLENBQUNRLE1BQVM7b0JBQ3hCLEdBQUdQLE1BQU1PLElBQUk7b0JBQ2JKLFlBQVlJLElBQUlKLFVBQVUsQ0FBQ0osR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQ3RDSCxJQUFJRyxHQUFHSCxFQUFFOzRCQUNUQyxRQUFRRSxHQUFHRixNQUFNO3dCQUNuQjtnQkFDRjtRQUNGO1FBRUEsTUFBTUcsU0FBUUosRUFBVTtZQUN0QixNQUFNRSxNQUFNLE1BQU10Qix1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDZSxVQUFVLENBQUM7Z0JBQUVsQixPQUFPO29CQUFFYTtnQkFBRztZQUFFO1lBQzlELE9BQU9FLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNSSxXQUFVQyxJQUFZO1lBQzFCLE1BQU1MLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNlLFVBQVUsQ0FBQztnQkFBRWxCLE9BQU87b0JBQUVvQjtnQkFBSztZQUFFO1lBQ2hFLE9BQU9MLE1BQU1QLE1BQU1PLE9BQU87UUFDNUI7UUFFQSxNQUFNTTtZQUNKLE1BQU1DLFNBQVMsTUFBTTdCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQixPQUFPLENBQUM7Z0JBQzVDQyxJQUFJO29CQUFDO2lCQUFRO2dCQUNiQyxRQUFRO29CQUFFWixJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT2EsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT2YsR0FBRyxDQUFDLENBQUNxQixJQUFNO29CQUFDQSxFQUFFQyxLQUFLO29CQUFFRCxFQUFFSCxNQUFNLENBQUNaLEVBQUU7aUJBQUM7UUFFNUM7UUFFQSxNQUFNaUI7WUFDSixNQUFNQyxRQUFRLElBQUlDO1lBQ2xCRCxNQUFNRSxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUc7WUFFeEIsT0FBT3hDLHVDQUFNQSxDQUFDVSxTQUFTLENBQUMrQixLQUFLLENBQUM7Z0JBQzVCbEMsT0FBTztvQkFDTDZCLE9BQU87b0JBQ1BNLFdBQVc7d0JBQUVDLEtBQUtMO29CQUFNO2dCQUMxQjtZQUNGO1FBQ0Y7UUFFQSxNQUFNTSxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTUUsTUFBTSxNQUFNdEIsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUM1Q2xCLE9BQU87b0JBQUVhO2dCQUFHO2dCQUNaSCxTQUFTO29CQUNQQyxZQUFZO3dCQUNWQyxRQUFROzRCQUFFQyxJQUFJOzRCQUFNQyxRQUFRO3dCQUFLO3dCQUNqQ1QsU0FBUzs0QkFBRWlDLFdBQVc7d0JBQU07b0JBQzlCO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJLENBQUN2QixLQUFLLE9BQU87WUFDakIsT0FBTztnQkFDTCxHQUFHUCxNQUFNTyxJQUFJO2dCQUNiSixZQUFZSSxJQUFJSixVQUFVLENBQUNKLEdBQUcsQ0FBQyxDQUFDUyxLQUFRO3dCQUN0Q0gsSUFBSUcsR0FBR0gsRUFBRTt3QkFDVEMsUUFBUUUsR0FBR0YsTUFBTTtvQkFDbkI7WUFDRjtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLHFCQUFxQjtZQUNyQixNQUFNQyxTQUFTLE1BQU1oRCx1Q0FBTUEsQ0FBQ1UsU0FBUyxDQUFDdUMsU0FBUyxDQUFDO2dCQUM5Q3JDLFNBQVM7b0JBQUVlLE1BQU07Z0JBQU87Z0JBQ3hCUixRQUFRO29CQUFFUSxNQUFNO2dCQUFLO1lBQ3ZCO1lBQ0EsTUFBTXVCLFVBQVVGLFNBQVNHLFNBQVNILE9BQU9yQixJQUFJLENBQUN5QixPQUFPLENBQUMsT0FBTyxLQUFLLE1BQU07WUFDeEUsTUFBTXpCLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPSCxVQUFVLEdBQUdJLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFFekQsTUFBTWhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNvQyxNQUFNLENBQUM7Z0JBQ3hDUyxNQUFNO29CQUNKNUI7b0JBQ0E2QixPQUFPVCxNQUFNUyxLQUFLO29CQUNsQkMsUUFBUVYsTUFBTVUsTUFBTTtvQkFDcEJyQixPQUFPO29CQUNQc0IsVUFBVVgsTUFBTVcsUUFBUSxJQUFJO29CQUM1QkMsT0FBT1osTUFBTVksS0FBSyxJQUFJO29CQUN0QkMsaUJBQWlCYixNQUFNYSxlQUFlLElBQUk7Z0JBQzVDO1lBQ0Y7WUFFQSxtQkFBbUI7WUFDbkIsTUFBTTNELHVEQUFjQSxDQUFDcUIsSUFBSUYsRUFBRSxFQUFFRSxJQUFJSyxJQUFJLEVBQUVMLElBQUlrQyxLQUFLLEVBQUVsQyxJQUFJbUMsTUFBTTtZQUU1RCxPQUFPMUMsTUFBTU87UUFDZjtRQUVBLE1BQU11QyxRQUFPekMsRUFBVSxFQUFFMkIsS0FBMkI7WUFDbEQsTUFBTWUsV0FBVyxNQUFNOUQsdUNBQU1BLENBQUNVLFNBQVMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUFFbEIsT0FBTztvQkFBRWE7Z0JBQUc7WUFBRTtZQUNuRSxJQUFJLENBQUMwQyxVQUFVLE9BQU87WUFFdEIsTUFBTXhDLE1BQU0sTUFBTXRCLHVDQUFNQSxDQUFDVSxTQUFTLENBQUNtRCxNQUFNLENBQUM7Z0JBQ3hDdEQsT0FBTztvQkFBRWE7Z0JBQUc7Z0JBQ1ptQyxNQUFNO29CQUNKLEdBQUlSLE1BQU1TLEtBQUssS0FBS08sYUFBYTt3QkFBRVAsT0FBT1QsTUFBTVMsS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJVCxNQUFNVSxNQUFNLEtBQUtNLGFBQWE7d0JBQUVOLFFBQVFWLE1BQU1VLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSVYsTUFBTVgsS0FBSyxLQUFLMkIsYUFBYTt3QkFBRTNCLE9BQU9XLE1BQU1YLEtBQUs7b0JBQUMsQ0FBQztvQkFDdkQsR0FBSVcsTUFBTVcsUUFBUSxLQUFLSyxhQUFhO3dCQUFFTCxVQUFVWCxNQUFNVyxRQUFRO29CQUFDLENBQUM7b0JBQ2hFLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTt3QkFBRUosT0FBT1osTUFBTVksS0FBSztvQkFBQyxDQUFDO29CQUN2RCxHQUFJWixNQUFNaUIsYUFBYSxLQUFLRCxhQUFhO3dCQUFFQyxlQUFlakIsTUFBTWlCLGFBQWE7b0JBQUMsQ0FBQztvQkFDL0UsR0FBSWpCLE1BQU1YLEtBQUssS0FBSyxhQUFhO3dCQUFFTSxXQUFXLElBQUlIO29CQUFPLENBQUM7Z0JBQzVEO1lBQ0Y7WUFFQSwrQ0FBK0M7WUFDL0MsSUFBSVEsTUFBTVMsS0FBSyxLQUFLTyxhQUFhaEIsTUFBTVUsTUFBTSxLQUFLTSxXQUFXO2dCQUMzRCxNQUFNOUQsdURBQWNBLENBQUNxQixJQUFJRixFQUFFLEVBQUVFLElBQUlLLElBQUksRUFBRUwsSUFBSWtDLEtBQUssRUFBRWxDLElBQUltQyxNQUFNO1lBQzlEO1lBRUEsT0FBTzFDLE1BQU1PO1FBQ2Y7UUFFQSxNQUFNMkMseUJBQ0o3QyxFQUFVLEVBQ1Y4QyxRQUFnQixFQUNoQkMsS0FBYTtZQUViLE9BQU9uRSx1Q0FBTUEsQ0FBQ29FLFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsb0JBQW9CO2dCQUNwQixNQUFNUCxXQUFXLE1BQU1PLEdBQUczRCxTQUFTLENBQUNlLFVBQVUsQ0FBQztvQkFBRWxCLE9BQU87d0JBQUVhO29CQUFHO2dCQUFFO2dCQUMvRCxJQUFJLENBQUMwQyxVQUFVLE9BQU87Z0JBRXRCLE1BQU1RLGdCQUFnQlIsU0FBUzFCLEtBQUs7Z0JBRXBDLG9CQUFvQjtnQkFDcEIsTUFBTWQsTUFBTSxNQUFNK0MsR0FBRzNELFNBQVMsQ0FBQ21ELE1BQU0sQ0FBQztvQkFDcEN0RCxPQUFPO3dCQUFFYTtvQkFBRztvQkFDWm1DLE1BQU07d0JBQ0puQixPQUFPOEI7d0JBQ1AsR0FBSUEsYUFBYSxhQUFhOzRCQUFFeEIsV0FBVyxJQUFJSDt3QkFBTyxDQUFDO29CQUN6RDtnQkFDRjtnQkFFQSx5QkFBeUI7Z0JBQ3pCLE1BQU1nQyxhQUFhLENBQUMsSUFBSSxFQUFFaEMsS0FBS2lDLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLEtBQUssQ0FBQyxHQUFHLElBQUk7Z0JBQ2hGLE1BQU1QLEdBQUdRLFFBQVEsQ0FBQy9CLE1BQU0sQ0FBQztvQkFDdkJTLE1BQU07d0JBQ0puQyxJQUFJbUQ7d0JBQ0pPLElBQUksSUFBSXZDO3dCQUNSd0MsTUFBTTt3QkFDTlo7d0JBQ0FhLFlBQVk7d0JBQ1pDLFVBQVU3RDt3QkFDVjhELFNBQVMsQ0FBQywyQkFBMkIsRUFBRWhCLFVBQVU7d0JBQ2pEaUIsYUFBYUMsS0FBS0MsU0FBUyxDQUFDOzRCQUMxQmY7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x4RCxXQUFXSyxNQUFNTztvQkFDakJnRDtvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNlO0lBQ2QsT0FBTztRQUNMLE1BQU1qRixNQUFLQyxPQUEwQjtZQUNuQyxJQUFJaUYsU0FBUzttQkFBSXJGLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlJLFNBQVM4QixPQUFPO2dCQUNsQixNQUFNb0QsU0FBU0MsTUFBTUMsT0FBTyxDQUFDcEYsUUFBUThCLEtBQUssSUFBSTlCLFFBQVE4QixLQUFLLEdBQUc7b0JBQUM5QixRQUFROEIsS0FBSztpQkFBQztnQkFDN0VtRCxTQUFTQSxPQUFPSSxNQUFNLENBQUMsQ0FBQ0MsS0FBT0osT0FBT0ssUUFBUSxDQUFDRCxHQUFHeEQsS0FBSztZQUN6RDtZQUNBLElBQUk5QixTQUFTb0QsVUFBVTtnQkFDckIsTUFBTW9DLGFBQWFMLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUlwRCxRQUFRb0QsUUFBUSxHQUFHO29CQUFDcEQsUUFBUW9ELFFBQVE7aUJBQUM7Z0JBQzFGNkIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9FLFdBQVdELFFBQVEsQ0FBQ0QsR0FBR2xDLFFBQVE7WUFDaEU7WUFDQSxJQUFJcEQsU0FBU3FELE9BQU87Z0JBQ2xCNEIsU0FBU0EsT0FBT0ksTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqQyxLQUFLLEtBQUtyRCxRQUFRcUQsS0FBSztZQUMzRDtZQUNBLE9BQU80QixPQUFPekUsR0FBRyxDQUFDaUY7UUFDcEI7UUFFQSxNQUFNL0UsYUFBWVYsT0FBMEI7WUFDMUMsTUFBTTBGLGFBQWEsTUFBTSxJQUFJLENBQUMzRixJQUFJLENBQUNDO1lBQ25DLE9BQU8wRixXQUFXbEYsR0FBRyxDQUFDLENBQUM4RSxLQUFRO29CQUM3QixHQUFHQSxFQUFFO29CQUNMMUUsWUFBWWYsNkRBQWNBLENBQ3ZCd0YsTUFBTSxDQUFDLENBQUNwRSxLQUFPQSxHQUFHMEUsV0FBVyxLQUFLTCxHQUFHeEUsRUFBRSxFQUN2Q04sR0FBRyxDQUFDLENBQUNTLEtBQVE7NEJBQUVILElBQUlHLEdBQUdILEVBQUU7NEJBQUVDLFFBQVFFLEdBQUdGLE1BQU07d0JBQUM7Z0JBQ2pEO1FBQ0Y7UUFFQSxNQUFNRyxTQUFRSixFQUFVO1lBQ3RCLE1BQU13RSxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsT0FBT3dFLEtBQUtHLFVBQVVILE1BQU07UUFDOUI7UUFFQSxNQUFNbEUsV0FBVUMsSUFBWTtZQUMxQixNQUFNaUUsS0FBSzFGLDZEQUFjQSxDQUFDZ0csSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUV4RSxJQUFJLEtBQUtBO1lBQ2pELE9BQU9pRSxLQUFLRyxVQUFVSCxNQUFNO1FBQzlCO1FBRUEsTUFBTWhFO1lBQ0osTUFBTXdFLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNUixNQUFNMUYsNkRBQWNBLENBQUU7Z0JBQy9Ca0csTUFBTSxDQUFDUixHQUFHeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQ2dFLE1BQU0sQ0FBQ1IsR0FBR3hELEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPZ0U7UUFDVDtRQUVBLE1BQU0vRDtZQUNKLE1BQU1DLFFBQVEsSUFBSUM7WUFDbEJELE1BQU1FLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRztZQUV4QixPQUFPdEMsNkRBQWNBLENBQUN5RixNQUFNLENBQzFCLENBQUNDLEtBQU9BLEdBQUd4RCxLQUFLLEtBQUssYUFBYXdELEdBQUdsRCxTQUFTLElBQUlrRCxHQUFHbEQsU0FBUyxJQUFJSixPQUNsRStELE1BQU07UUFDVjtRQUVBLE1BQU16RCxnQkFBZXhCLEVBQVU7WUFDN0IsTUFBTXdFLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFDaEIsT0FBTztnQkFDTCxHQUFHRyxVQUFVSCxHQUFHO2dCQUNoQjFFLFlBQVlmLDZEQUFjQSxDQUN2QndGLE1BQU0sQ0FBQyxDQUFDcEUsS0FBT0EsR0FBRzBFLFdBQVcsS0FBSzdFLElBQ2xDTixHQUFHLENBQUMsQ0FBQ1MsS0FBUTt3QkFBRUgsSUFBSUcsR0FBR0gsRUFBRTt3QkFBRUMsUUFBUUUsR0FBR0YsTUFBTTtvQkFBQztZQUNqRDtRQUNGO1FBRUEsTUFBTXlCLFFBQU9DLEtBQTJCO1lBQ3RDLDRCQUE0QjtZQUM1QixNQUFNM0IsS0FBSyxDQUFDLFFBQVEsRUFBRW1CLEtBQUtpQyxHQUFHLElBQUk7WUFDbEMsTUFBTTdDLE9BQU8sQ0FBQyxHQUFHLEVBQUUwQixPQUFPbkQsNkRBQWNBLENBQUNtRyxNQUFNLEdBQUcsR0FBRy9DLFFBQVEsQ0FBQyxHQUFHLE1BQU07WUFDdkUsTUFBTWtCLE1BQU0sSUFBSWpDO1lBRWhCLE1BQU0rRCxRQUFRO2dCQUNabEY7Z0JBQ0FPO2dCQUNBNkIsT0FBT1QsTUFBTVMsS0FBSztnQkFDbEJDLFFBQVFWLE1BQU1VLE1BQU07Z0JBQ3BCckIsT0FBTztnQkFDUHNCLFVBQVdYLE1BQU1XLFFBQVEsSUFBSTtnQkFDN0JDLE9BQVFaLE1BQU1ZLEtBQUssSUFBSTtnQkFDdkJDLGlCQUFpQmIsTUFBTWEsZUFBZSxJQUFJO2dCQUMxQ0ksZUFBZTtnQkFDZm5CLFdBQVcyQjtnQkFDWDNELFdBQVcyRDtnQkFDWDlCLFdBQVc7WUFDYjtZQUVBLHVEQUF1RDtZQUN2RCxPQUFPcUQsVUFBVU87UUFDbkI7UUFFQSxNQUFNekMsUUFBT3pDLEVBQVUsRUFBRTJCLEtBQTJCO1lBQ2xELE1BQU02QyxLQUFLMUYsNkRBQWNBLENBQUNnRyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRS9FLEVBQUUsS0FBS0E7WUFDL0MsSUFBSSxDQUFDd0UsSUFBSSxPQUFPO1lBRWhCLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdHLFVBQVVILEdBQUc7Z0JBQ2hCLEdBQUk3QyxNQUFNUyxLQUFLLEtBQUtPLGFBQWE7b0JBQUVQLE9BQU9ULE1BQU1TLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSVQsTUFBTVUsTUFBTSxLQUFLTSxhQUFhO29CQUFFTixRQUFRVixNQUFNVSxNQUFNO2dCQUFDLENBQUM7Z0JBQzFELEdBQUlWLE1BQU1YLEtBQUssS0FBSzJCLGFBQWE7b0JBQUUzQixPQUFPVyxNQUFNWCxLQUFLO2dCQUEwQixDQUFDO2dCQUNoRixHQUFJVyxNQUFNVyxRQUFRLEtBQUtLLGFBQWE7b0JBQUVMLFVBQVVYLE1BQU1XLFFBQVE7Z0JBQTZCLENBQUM7Z0JBQzVGLEdBQUlYLE1BQU1ZLEtBQUssS0FBS0ksYUFBYTtvQkFBRUosT0FBT1osTUFBTVksS0FBSztnQkFBMEIsQ0FBQztnQkFDaEYsR0FBSVosTUFBTWlCLGFBQWEsS0FBS0QsYUFBYTtvQkFBRUMsZUFBZWpCLE1BQU1pQixhQUFhO2dCQUFDLENBQUM7Z0JBQy9FbkQsV0FBVyxJQUFJMEI7WUFDakI7UUFDRjtRQUVBLE1BQU0wQix5QkFDSjdDLEVBQVUsRUFDVjhDLFFBQWdCLEVBQ2hCcUMsTUFBYztZQUVkLE1BQU1YLEtBQUsxRiw2REFBY0EsQ0FBQ2dHLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFL0UsRUFBRSxLQUFLQTtZQUMvQyxJQUFJLENBQUN3RSxJQUFJLE9BQU87WUFFaEIsTUFBTXRCLGdCQUFnQnNCLEdBQUd4RCxLQUFLO1lBQzlCLE1BQU1tQyxhQUFhLENBQUMsU0FBUyxFQUFFaEMsS0FBS2lDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMOUQsV0FBVztvQkFDVCxHQUFHcUYsVUFBVUgsR0FBRztvQkFDaEJ4RCxPQUFPOEI7b0JBQ1ByRCxXQUFXLElBQUkwQjtvQkFDZixHQUFJMkIsYUFBYSxhQUFhO3dCQUFFeEIsV0FBVyxJQUFJSDtvQkFBTyxDQUFDO2dCQUN6RDtnQkFDQStCO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUy9ELFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFROEIsS0FBSyxFQUFFO1FBQ2pCN0IsTUFBTTZCLEtBQUssR0FBR3FELE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVE4QixLQUFLLElBQUk7WUFBRW9FLElBQUlsRyxRQUFROEIsS0FBSztRQUFDLElBQUk5QixRQUFROEIsS0FBSztJQUNwRjtJQUNBLElBQUk5QixRQUFRb0QsUUFBUSxFQUFFO1FBQ3BCbkQsTUFBTW1ELFFBQVEsR0FBRytCLE1BQU1DLE9BQU8sQ0FBQ3BGLFFBQVFvRCxRQUFRLElBQUk7WUFBRThDLElBQUlsRyxRQUFRb0QsUUFBUTtRQUFDLElBQUlwRCxRQUFRb0QsUUFBUTtJQUNoRztJQUNBLElBQUlwRCxRQUFRcUQsS0FBSyxFQUFFO1FBQ2pCcEQsTUFBTW9ELEtBQUssR0FBR3JELFFBQVFxRCxLQUFLO0lBQzdCO0lBQ0EsT0FBT3BEO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNTyxHQWFkO0lBQ0MsT0FBTztRQUNMRixJQUFJRSxJQUFJRixFQUFFO1FBQ1ZPLE1BQU1MLElBQUlLLElBQUk7UUFDZDZCLE9BQU9sQyxJQUFJa0MsS0FBSztRQUNoQkMsUUFBUW5DLElBQUltQyxNQUFNO1FBQ2xCckIsT0FBT2QsSUFBSWMsS0FBSztRQUNoQnNCLFVBQVVwQyxJQUFJb0MsUUFBUTtRQUN0QkMsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCQyxpQkFBaUJ0QyxJQUFJc0MsZUFBZTtRQUNwQ0ksZUFBZTFDLElBQUkwQyxhQUFhO1FBQ2hDbkIsV0FBV3ZCLElBQUl1QixTQUFTO1FBQ3hCaEMsV0FBV1MsSUFBSVQsU0FBUztRQUN4QjZCLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBU3FELFVBQVVILEVBQWlDO0lBQ2xELE9BQU87UUFDTHhFLElBQUl3RSxHQUFHeEUsRUFBRTtRQUNUTyxNQUFNaUUsR0FBR2pFLElBQUk7UUFDYjZCLE9BQU9vQyxHQUFHcEMsS0FBSztRQUNmQyxRQUFRbUMsR0FBR25DLE1BQU07UUFDakJyQixPQUFPd0QsR0FBR3hELEtBQUs7UUFDZnNCLFVBQVVrQyxHQUFHbEMsUUFBUTtRQUNyQkMsT0FBT2lDLEdBQUdqQyxLQUFLO1FBQ2ZDLGlCQUFpQmdDLEdBQUdoQyxlQUFlO1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:423:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:434:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:489:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:522:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:555:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/agent-templates/page.js:566:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:445:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQy9CLElBQUlrQixXQUFXO0lBQ3pDO0FBQ0Y7QUFFQSxTQUFTVyxVQUFVekMsUUFBdUM7SUFDeEQsT0FBTztRQUNMVyxJQUFJWCxTQUFTVyxFQUFFO1FBQ2ZSLElBQUlILFNBQVNHLEVBQUU7UUFDZndCLE1BQU0zQixTQUFTMkIsSUFBSTtRQUNuQkMsT0FBTzVCLFNBQVM0QixLQUFLO1FBQ3JCWixZQUFZaEIsU0FBU2dCLFVBQVU7UUFDL0JDLFVBQVVqQixTQUFTaUIsUUFBUTtRQUMzQlksU0FBUzdCLFNBQVM2QixPQUFPO1FBQ3pCQyxhQUFhOUIsU0FBUzhCLFdBQVc7SUFDbkM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hY3Rpdml0aWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWN0aXZpdGllcyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFjdGl2aXRpZXMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqIFB1Ymxpc2hlcyBhY3Rpdml0aWVzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBY3Rpdml0aWVzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgeyBwdWJsaXNoQWN0aXZpdHkgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5RFRPLCBBY3Rpdml0eUZpbHRlcnMsIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBY3Rpdml0eUlucHV0IHtcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0aWVzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD5cbiAgbGlzdFJlY2VudChsaW1pdD86IG51bWJlcik6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYkFjdGl2aXRpZXNSZXBvKCk6IEFjdGl2aXRpZXNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MCxcbiAgICAgICAgc2tpcDogcGFnaW5hdGlvbj8ub2Zmc2V0ID8/IDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYWN0aXZpdHkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWN0aXZpdHlJbnB1dCk6IFByb21pc2U8QWN0aXZpdHlEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIGFjdG9yOiBpbnB1dC5hY3RvcixcbiAgICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgICBzdW1tYXJ5OiBpbnB1dC5zdW1tYXJ5LFxuICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgZHRvID0gdG9EVE8ocm93KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FjdGl2aXRpZXNdXG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5VHlwZSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGZpbHRlcnMuZW50aXR5VHlwZSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5lbnRpdHlJZCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBhLmVudGl0eUlkID09PSBmaWx0ZXJzLmVudGl0eUlkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS50eXBlID09PSBmaWx0ZXJzLnR5cGUpXG4gICAgICB9XG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBkZXNjZW5kaW5nXG4gICAgICByZXN1bHQuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwXG4gICAgICBjb25zdCBsaW1pdCA9IHBhZ2luYXRpb24/LmxpbWl0ID8/IDUwXG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aXZpdHlEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhY3Rpdml0eSA9IG1vY2tBY3Rpdml0aWVzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFjdGl2aXR5ID8gbW9ja1RvRFRPKGFjdGl2aXR5KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJlY2VudChsaW1pdCA9IDIwKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi50cy5nZXRUaW1lKCkgLSBhLnRzLmdldFRpbWUoKSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvckVudGl0eShlbnRpdHlUeXBlOiBzdHJpbmcsIGVudGl0eUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQWN0aXZpdGllc1xuICAgICAgICAuZmlsdGVyKChhKSA9PiBhLmVudGl0eVR5cGUgPT09IGVudGl0eVR5cGUgJiYgYS5lbnRpdHlJZCA9PT0gZW50aXR5SWQpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGp1c3QgcmV0dXJucyB0aGUgY3JlYXRlZCBhY3Rpdml0eSB3aXRob3V0IHBlcnNpc3RpbmdcbiAgICAgIGNvbnN0IGlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgY29uc3QgZHRvOiBBY3Rpdml0eURUTyA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgIGVudGl0eVR5cGU6IGlucHV0LmVudGl0eVR5cGUsXG4gICAgICAgIGVudGl0eUlkOiBpbnB1dC5lbnRpdHlJZCxcbiAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgcGF5bG9hZEpzb246IGlucHV0LnBheWxvYWRKc29uID8/IHt9LFxuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hBY3Rpdml0eShkdG8pXG5cbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLmVudGl0eVR5cGUpIHtcbiAgICB3aGVyZS5lbnRpdHlUeXBlID0gZmlsdGVycy5lbnRpdHlUeXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMuZW50aXR5SWQpIHtcbiAgICB3aGVyZS5lbnRpdHlJZCA9IGZpbHRlcnMuZW50aXR5SWRcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IGZpbHRlcnMudHlwZVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB0czogRGF0ZVxuICB0eXBlOiBzdHJpbmdcbiAgYWN0b3I6IHN0cmluZ1xuICBlbnRpdHlUeXBlOiBzdHJpbmdcbiAgZW50aXR5SWQ6IHN0cmluZ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAgcGF5bG9hZEpzb246IHN0cmluZ1xufSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHRzOiByb3cudHMsXG4gICAgdHlwZTogcm93LnR5cGUsXG4gICAgYWN0b3I6IHJvdy5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiByb3cuZW50aXR5VHlwZSxcbiAgICBlbnRpdHlJZDogcm93LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IHJvdy5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBKU09OLnBhcnNlKHJvdy5wYXlsb2FkSnNvbiksXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFjdGl2aXR5OiB0eXBlb2YgbW9ja0FjdGl2aXRpZXNbbnVtYmVyXSk6IEFjdGl2aXR5RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWN0aXZpdHkuaWQsXG4gICAgdHM6IGFjdGl2aXR5LnRzLFxuICAgIHR5cGU6IGFjdGl2aXR5LnR5cGUsXG4gICAgYWN0b3I6IGFjdGl2aXR5LmFjdG9yLFxuICAgIGVudGl0eVR5cGU6IGFjdGl2aXR5LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IGFjdGl2aXR5LmVudGl0eUlkLFxuICAgIHN1bW1hcnk6IGFjdGl2aXR5LnN1bW1hcnksXG4gICAgcGF5bG9hZEpzb246IGFjdGl2aXR5LnBheWxvYWRKc29uIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB9XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwibW9ja0FjdGl2aXRpZXMiLCJwdWJsaXNoQWN0aXZpdHkiLCJjcmVhdGVEYkFjdGl2aXRpZXNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJwYWdpbmF0aW9uIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsImFjdGl2aXR5IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidHMiLCJ0YWtlIiwibGltaXQiLCJza2lwIiwib2Zmc2V0IiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdFJlY2VudCIsImxpc3RGb3JFbnRpdHkiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJjcmVhdGUiLCJpbnB1dCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImRhdGEiLCJ0eXBlIiwiYWN0b3IiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZHRvIiwiY3JlYXRlTW9ja0FjdGl2aXRpZXNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwiYSIsInNvcnQiLCJiIiwiZ2V0VGltZSIsIm1vY2tUb0RUTyIsImZpbmQiLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:456:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVd6RCxNQUFNeUQsU0FBUztRQUMxQkMsV0FBVzFELE1BQU0wRCxTQUFTO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWdlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYWdlbnRzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWdlbnRzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFnZW50RFRPLCBBZ2VudEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFnZW50SW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgY3VycmVudFdvcmtPcmRlcklkPzogc3RyaW5nIHwgbnVsbFxuXG4gIC8vIEFkbWluLWVkaXRhYmxlIGZpZWxkc1xuICBuYW1lPzogc3RyaW5nXG4gIHJvbGU/OiBzdHJpbmdcbiAgc3RhdGlvbj86IHN0cmluZ1xuICBjYXBhYmlsaXRpZXM/OiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxuICBzZXNzaW9uS2V5Pzogc3RyaW5nXG4gIGF2YXRhclBhdGg/OiBzdHJpbmcgfCBudWxsXG4gIG1vZGVsPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFnZW50SW5wdXQge1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPlxuICB3aXBMaW1pdD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50c1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc2Vzc2lvbktleSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93IGFzIHVua25vd24gYXMgUHJpc21hQWdlbnRSb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLmFnZW50Lmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgICBjYXBhYmlsaXRpZXM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmNhcGFiaWxpdGllcyksXG4gICAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEJ1aWxkIHVwZGF0ZSBkYXRhLCBjYXN0aW5nIHRvIGFueSB0byBoYW5kbGUgZmllbGRzIG5vdCBpbiBnZW5lcmF0ZWQgY2xpZW50XG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcbiAgICAgICAgbGFzdFNlZW5BdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5zdGF0dXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zdGF0dXMgPSBpbnB1dC5zdGF0dXNcbiAgICAgIGlmIChpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IGlucHV0Lm5hbWVcbiAgICAgIGlmIChpbnB1dC5yb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IGlucHV0LnJvbGVcbiAgICAgIGlmIChpbnB1dC5zdGF0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdGlvbiA9IGlucHV0LnN0YXRpb25cbiAgICAgIGlmIChpbnB1dC5jYXBhYmlsaXRpZXMgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5jYXBhYmlsaXRpZXMgPSBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpXG4gICAgICBpZiAoaW5wdXQud2lwTGltaXQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS53aXBMaW1pdCA9IGlucHV0LndpcExpbWl0XG4gICAgICBpZiAoaW5wdXQuc2Vzc2lvbktleSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNlc3Npb25LZXkgPSBpbnB1dC5zZXNzaW9uS2V5XG4gICAgICBpZiAoaW5wdXQuYXZhdGFyUGF0aCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmF2YXRhclBhdGggPSBpbnB1dC5hdmF0YXJQYXRoXG4gICAgICBpZiAoaW5wdXQubW9kZWwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5tb2RlbCA9IGlucHV0Lm1vZGVsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVEYXRhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FnZW50c1JlcG8oKTogQWdlbnRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBZ2VudHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0aW9ucy5pbmNsdWRlcyhhLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5uYW1lID09PSBuYW1lKVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5zZXNzaW9uS2V5ID09PSBzZXNzaW9uS2V5KVxuICAgICAgcmV0dXJuIGFnZW50ID8gbW9ja1RvRFRPKGFnZW50KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IGEgb2YgbW9ja0FnZW50cykge1xuICAgICAgICBjb3VudHNbYS5zdGF0dXNdID0gKGNvdW50c1thLnN0YXR1c10gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGlkID0gYGFnZW50XyR7KG1vY2tBZ2VudHMubGVuZ3RoICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWBcblxuICAgICAgY29uc3QgbmV3QWdlbnQgPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uIGFzICdzcGVjJyB8ICdidWlsZCcgfCAncWEnIHwgJ29wcycgfCAndXBkYXRlJyB8ICdzaGlwJyB8ICdjb21wb3VuZCcsXG4gICAgICAgIHN0YXR1czogJ2lkbGUnIGFzIGNvbnN0LFxuICAgICAgICBzZXNzaW9uS2V5OiBpbnB1dC5zZXNzaW9uS2V5LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IGlucHV0LmNhcGFiaWxpdGllcyxcbiAgICAgICAgd2lwTGltaXQ6IGlucHV0LndpcExpbWl0ID8/IDIsXG4gICAgICAgIGxhc3RTZWVuQXQ6IG51bGwsXG4gICAgICAgIGxhc3RIZWFydGJlYXRBdDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdG8gbW9jayBhcnJheSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiB0aGlzIHdvdWxkIGJlIHBlcnNpc3RlbnQpXG4gICAgICBtb2NrQWdlbnRzLnB1c2gobmV3QWdlbnQpXG5cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3QWdlbnQpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQWdlbnRJbnB1dCk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhZ2VudCA9IG1vY2tBZ2VudHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFnZW50KSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYWdlbnQpLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBBZ2VudERUT1snc3RhdHVzJ10gfSksXG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXR1cykge1xuICAgIHdoZXJlLnN0YXR1cyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8geyBpbjogZmlsdGVycy5zdGF0dXMgfSA6IGZpbHRlcnMuc3RhdHVzXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdGlvbikge1xuICAgIHdoZXJlLnN0YXRpb24gPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyB7IGluOiBmaWx0ZXJzLnN0YXRpb24gfSA6IGZpbHRlcnMuc3RhdGlvblxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG4vLyBFeHRlbmRlZCB0eXBlIHRvIGhhbmRsZSBuZXcgZmllbGRzIHRoYXQgbWF5IG5vdCBiZSBpbiBnZW5lcmF0ZWQgUHJpc21hIGNsaWVudFxuaW50ZXJmYWNlIFByaXNtYUFnZW50Um93IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICBzdGF0dXM6IHN0cmluZ1xuICBzZXNzaW9uS2V5OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdcbiAgd2lwTGltaXQ6IG51bWJlclxuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbiAgbGFzdFNlZW5BdDogRGF0ZSB8IG51bGxcbiAgbGFzdEhlYXJ0YmVhdEF0OiBEYXRlIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzogUHJpc21hQWdlbnRSb3cpOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICByb2xlOiByb3cucm9sZSxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IHJvdy5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogSlNPTi5wYXJzZShyb3cuY2FwYWJpbGl0aWVzKSxcbiAgICB3aXBMaW1pdDogcm93LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IHJvdy5hdmF0YXJQYXRoID8/IG51bGwsXG4gICAgbW9kZWw6IHJvdy5tb2RlbCA/PyBudWxsLFxuICAgIGxhc3RTZWVuQXQ6IHJvdy5sYXN0U2VlbkF0LFxuICAgIGxhc3RIZWFydGJlYXRBdDogcm93Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhZ2VudDogdHlwZW9mIG1vY2tBZ2VudHNbbnVtYmVyXSk6IEFnZW50RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICByb2xlOiBhZ2VudC5yb2xlLFxuICAgIHN0YXRpb246IGFnZW50LnN0YXRpb24sXG4gICAgc3RhdHVzOiBhZ2VudC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddLFxuICAgIHNlc3Npb25LZXk6IGFnZW50LnNlc3Npb25LZXksXG4gICAgY2FwYWJpbGl0aWVzOiBhZ2VudC5jYXBhYmlsaXRpZXMsXG4gICAgd2lwTGltaXQ6IGFnZW50LndpcExpbWl0LFxuICAgIGF2YXRhclBhdGg6IG51bGwsIC8vIE1vY2sgYWdlbnRzIGRvbid0IGhhdmUgY3VzdG9tIGF2YXRhcnNcbiAgICBtb2RlbDogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsIC8vIERlZmF1bHQgbW9kZWwgZm9yIG1vY2sgYWdlbnRzXG4gICAgbGFzdFNlZW5BdDogYWdlbnQubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IGFnZW50Lmxhc3RIZWFydGJlYXRBdCxcbiAgICBjcmVhdGVkQXQ6IGFnZW50LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IGFnZW50LnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBZ2VudHMiLCJjcmVhdGVEYkFnZW50c1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhZ2VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm5hbWUiLCJtYXAiLCJyb3ciLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsImZpbmRVbmlxdWUiLCJnZXRCeU5hbWUiLCJnZXRCeVNlc3Npb25LZXkiLCJzZXNzaW9uS2V5IiwiY291bnRCeVN0YXR1cyIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXR1cyIsImNyZWF0ZSIsImlucHV0IiwiZGF0YSIsInJvbGUiLCJzdGF0aW9uIiwiY2FwYWJpbGl0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcExpbWl0IiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1cGRhdGVEYXRhIiwibGFzdFNlZW5BdCIsIkRhdGUiLCJ1bmRlZmluZWQiLCJhdmF0YXJQYXRoIiwibW9kZWwiLCJjcmVhdGVNb2NrQWdlbnRzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwiY291bnRzIiwibm93IiwibGVuZ3RoIiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm5ld0FnZW50IiwibGFzdEhlYXJ0YmVhdEF0IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicHVzaCIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:467:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBV0ssSUFBSUwsU0FBUztRQUN4QnFCLFlBQVloQixJQUFJZ0IsVUFBVTtJQUM1QjtBQUNGO0FBRUEsU0FBU1csVUFBVW5DLFFBQXNDO0lBQ3ZELE9BQU87UUFDTE8sSUFBSVAsU0FBU08sRUFBRTtRQUNmVSxhQUFhakIsU0FBU2lCLFdBQVc7UUFDakNDLGFBQWFsQixTQUFTa0IsV0FBVztRQUNqQ0MsTUFBTW5CLFNBQVNtQixJQUFJO1FBQ25CQyxZQUFZcEIsU0FBU29CLFVBQVU7UUFDL0JULFFBQVFYLFNBQVNXLE1BQU07UUFDdkJZLFlBQVl2QixTQUFTdUIsVUFBVTtRQUMvQnBCLFdBQVdILFNBQVNHLFNBQVM7UUFDN0JxQixZQUFZeEIsU0FBU3dCLFVBQVU7SUFDakM7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9hcHByb3ZhbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHByb3ZhbHMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhcHByb3ZhbHMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tBcHByb3ZhbHMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgQXBwcm92YWxEVE8sIEFwcHJvdmFsRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQXBwcm92YWxJbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgb3BlcmF0aW9uSWQ/OiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6ICdzaGlwX2dhdGUnIHwgJ3Jpc2t5X2FjdGlvbicgfCAnc2NvcGVfY2hhbmdlJyB8ICdjcm9uX2NoYW5nZScgfCAnZXh0ZXJuYWxfc2lkZV9lZmZlY3QnXG4gIHF1ZXN0aW9uTWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFwcHJvdmFsSW5wdXQge1xuICBzdGF0dXM6ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnXG4gIHJlc29sdmVkQnk/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHByb3ZhbHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbiAgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPlxuICBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBcHByb3ZhbHNSZXBvKCk6IEFwcHJvdmFsc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBwcmlzbWEuYXBwcm92YWwuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdwZW5kaW5nJyB9IH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgICAgcmVzb2x2ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja0FwcHJvdmFsc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhhLnN0YXR1cykpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8udHlwZSkge1xuICAgICAgICBjb25zdCB0eXBlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IGZpbHRlcnMudHlwZSA6IFtmaWx0ZXJzLnR5cGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHR5cGVzLmluY2x1ZGVzKGEudHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gbW9ja0FwcHJvdmFscy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhcHByb3ZhbCA/IG1vY2tUb0RUTyhhcHByb3ZhbCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJylcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50UGVuZGluZygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgcmV0dXJuIG1vY2tBcHByb3ZhbHMuZmlsdGVyKChhKSA9PiBhLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGhcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTz4ge1xuICAgICAgY29uc3QgaWQgPSBgYXByX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICBxdWVzdGlvbk1kOiBpbnB1dC5xdWVzdGlvbk1kLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgcmVzb2x2ZWRCeTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8oYXBwcm92YWwpLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgcmVzb2x2ZWRCeTogaW5wdXQucmVzb2x2ZWRCeSB8fCAndXNlcicsXG4gICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnR5cGUpIHtcbiAgICB3aGVyZS50eXBlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnR5cGUpID8geyBpbjogZmlsdGVycy50eXBlIH0gOiBmaWx0ZXJzLnR5cGVcbiAgfVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIHR5cGU6IHN0cmluZ1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgcmVzb2x2ZWRCeTogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgcmVzb2x2ZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB3b3JrT3JkZXJJZDogcm93LndvcmtPcmRlcklkLFxuICAgIG9wZXJhdGlvbklkOiByb3cub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogcm93LnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiByb3cucXVlc3Rpb25NZCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IHJvdy5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICByZXNvbHZlZEF0OiByb3cucmVzb2x2ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYXBwcm92YWw6IHR5cGVvZiBtb2NrQXBwcm92YWxzW251bWJlcl0pOiBBcHByb3ZhbERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFwcHJvdmFsLmlkLFxuICAgIHdvcmtPcmRlcklkOiBhcHByb3ZhbC53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogYXBwcm92YWwub3BlcmF0aW9uSWQsXG4gICAgdHlwZTogYXBwcm92YWwudHlwZSBhcyBBcHByb3ZhbERUT1sndHlwZSddLFxuICAgIHF1ZXN0aW9uTWQ6IGFwcHJvdmFsLnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiBhcHByb3ZhbC5zdGF0dXMgYXMgQXBwcm92YWxEVE9bJ3N0YXR1cyddLFxuICAgIHJlc29sdmVkQnk6IGFwcHJvdmFsLnJlc29sdmVkQnksXG4gICAgY3JlYXRlZEF0OiBhcHByb3ZhbC5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogYXBwcm92YWwucmVzb2x2ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBcHByb3ZhbHMiLCJjcmVhdGVEYkFwcHJvdmFsc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhcHByb3ZhbCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RQZW5kaW5nIiwic3RhdHVzIiwiY291bnRQZW5kaW5nIiwiY291bnQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJ3b3JrT3JkZXJJZCIsIm9wZXJhdGlvbklkIiwidHlwZSIsInF1ZXN0aW9uTWQiLCJ1cGRhdGUiLCJleGlzdGluZyIsInJlc29sdmVkQnkiLCJyZXNvbHZlZEF0IiwiRGF0ZSIsImNyZWF0ZU1vY2tBcHByb3ZhbHNSZXBvIiwicmVzdWx0Iiwic3RhdHVzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJhIiwiaW5jbHVkZXMiLCJ0eXBlcyIsIm1vY2tUb0RUTyIsImZpbmQiLCJsZW5ndGgiLCJub3ciLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:511:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlELEVBQUU7UUFDVkksYUFBYUgsSUFBSUcsV0FBVztRQUM1QmMsU0FBU2pCLElBQUlpQixPQUFPO1FBQ3BCQyxPQUFPbEIsSUFBSWtCLEtBQUs7UUFDaEJDLE9BQU9uQixJQUFJbUIsS0FBSztRQUNoQk4sUUFBUWIsSUFBSWEsTUFBTTtRQUNsQk8sa0JBQWtCRSxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSW9CLGdCQUFnQjtRQUNqREMsdUJBQXVCQyxLQUFLMEMsS0FBSyxDQUFDaEUsSUFBSXFCLHFCQUFxQjtRQUMzREcsVUFBVXhCLElBQUl3QixRQUFRO1FBQ3RCSSxlQUFlNUIsSUFBSTRCLGFBQWE7UUFDaEN4QixXQUFXSixJQUFJSSxTQUFTO1FBQ3hCVCxXQUFXSyxJQUFJTCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTK0QsVUFBVU4sRUFBaUM7SUFDbEQsT0FBTztRQUNMckQsSUFBSXFELEdBQUdyRCxFQUFFO1FBQ1RJLGFBQWFpRCxHQUFHakQsV0FBVztRQUMzQmMsU0FBU21DLEdBQUduQyxPQUFPO1FBQ25CQyxPQUFPa0MsR0FBR2xDLEtBQUs7UUFDZkMsT0FBT2lDLEdBQUdqQyxLQUFLLElBQUk7UUFDbkJOLFFBQVF1QyxHQUFHdkMsTUFBTTtRQUNqQk8sa0JBQWtCZ0MsR0FBR2hDLGdCQUFnQjtRQUNyQ0MsdUJBQXVCK0IsR0FBRy9CLHFCQUFxQjtRQUMvQ0csVUFBVTRCLEdBQUc1QixRQUFRO1FBQ3JCSSxlQUFld0IsR0FBR3hCLGFBQWE7UUFDL0J4QixXQUFXZ0QsR0FBR2hELFNBQVM7UUFDdkJULFdBQVd5RCxHQUFHekQsU0FBUztJQUN6QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL29wZXJhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcGVyYXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igb3BlcmF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHsgT3BlcmF0aW9uRFRPLCBPcGVyYXRpb25GaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVPcGVyYXRpb25JbnB1dCB7XG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkcz86IHN0cmluZ1tdXG4gIHdpcENsYXNzPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlT3BlcmF0aW9uSW5wdXQge1xuICBzdGF0dXM/OiBzdHJpbmdcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gIGJsb2NrZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzVHJhbnNpdGlvblJlc3VsdCB7XG4gIG9wZXJhdGlvbjogT3BlcmF0aW9uRFRPXG4gIHByZXZpb3VzU3RhdHVzOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPlxuICBjb3VudEJ5U3RhdHVzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPlxuICAvKiogQXRvbWljYWxseSB1cGRhdGUgc3RhdHVzIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICBhY3Rvcjogc3RyaW5nXG4gICk6IFByb21pc2U8U3RhdHVzVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYk9wZXJhdGlvbnNSZXBvKCk6IE9wZXJhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHdvcmtPcmRlcklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3N0YXR1cyddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0dXMsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbixcbiAgICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiAndG9kbycsXG4gICAgICAgICAgYXNzaWduZWVBZ2VudElkczogJ1tdJyxcbiAgICAgICAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IEpTT04uc3RyaW5naWZ5KGlucHV0LmRlcGVuZHNPbk9wZXJhdGlvbklkcyA/PyBbXSksXG4gICAgICAgICAgd2lwQ2xhc3M6IGlucHV0LndpcENsYXNzID8/ICdpbXBsZW1lbnRhdGlvbicsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIGFjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBleGlzdGluZy5zdGF0dXNcblxuICAgICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ29wZXJhdGlvbi5zdGF0dXNfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdvcGVyYXRpb24nLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYE9wZXJhdGlvbiB0cmFuc2l0aW9uZWQgdG8gJHtuZXdTdGF0dXN9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHdvcmtPcmRlcklkOiBleGlzdGluZy53b3JrT3JkZXJJZCxcbiAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgICAgIG5ld1N0YXR1cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRpb246IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGxldCByZXN1bHQgPSBbLi4ubW9ja09wZXJhdGlvbnNdXG4gICAgICBpZiAoZmlsdGVycz8ud29ya09yZGVySWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBmaWx0ZXJzLndvcmtPcmRlcklkKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhvcC5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRpb24pIHtcbiAgICAgICAgY29uc3Qgc3RhdGlvbnMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGlvbikgPyBmaWx0ZXJzLnN0YXRpb24gOiBbZmlsdGVycy5zdGF0aW9uXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdGlvbnMuaW5jbHVkZXMob3Auc3RhdGlvbikpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIHJldHVybiBvcCA/IG1vY2tUb0RUTyhvcCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvcmtPcmRlcklkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IG9wIG9mIG1vY2tPcGVyYXRpb25zKSB7XG4gICAgICAgIGNvdW50c1tvcC5zdGF0dXNdID0gKGNvdW50c1tvcC5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYG9wX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG4gICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICBhc3NpZ25lZUFnZW50SWRzOiBbXSxcbiAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10sXG4gICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICBibG9ja2VkUmVhc29uOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICBpZiAoIW9wKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8ob3ApLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0dXM6IGlucHV0LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICAuLi4oaW5wdXQubm90ZXMgIT09IHVuZGVmaW5lZCAmJiB7IG5vdGVzOiBpbnB1dC5ub3RlcyB9KSxcbiAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXR1czogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3QgcHJldmlvdXNTdGF0dXMgPSBvcC5zdGF0dXNcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgICBzdGF0dXM6IG5ld1N0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0dXMsXG4gICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICBzdGF0dXM6IHN0cmluZ1xuICBhc3NpZ25lZUFnZW50SWRzOiBzdHJpbmdcbiAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBzdHJpbmdcbiAgd2lwQ2xhc3M6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBPcGVyYXRpb25EVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiByb3cuc3RhdGlvbixcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIG5vdGVzOiByb3cubm90ZXMsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogSlNPTi5wYXJzZShyb3cuYXNzaWduZWVBZ2VudElkcyksXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnBhcnNlKHJvdy5kZXBlbmRzT25PcGVyYXRpb25JZHMpLFxuICAgIHdpcENsYXNzOiByb3cud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8ob3A6IHR5cGVvZiBtb2NrT3BlcmF0aW9uc1tudW1iZXJdKTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogb3AuaWQsXG4gICAgd29ya09yZGVySWQ6IG9wLndvcmtPcmRlcklkLFxuICAgIHN0YXRpb246IG9wLnN0YXRpb24sXG4gICAgdGl0bGU6IG9wLnRpdGxlLFxuICAgIG5vdGVzOiBvcC5ub3RlcyA/PyBudWxsLFxuICAgIHN0YXR1czogb3Auc3RhdHVzIGFzIE9wZXJhdGlvbkRUT1snc3RhdHVzJ10sXG4gICAgYXNzaWduZWVBZ2VudElkczogb3AuYXNzaWduZWVBZ2VudElkcyxcbiAgICBkZXBlbmRzT25PcGVyYXRpb25JZHM6IG9wLmRlcGVuZHNPbk9wZXJhdGlvbklkcyxcbiAgICB3aXBDbGFzczogb3Aud2lwQ2xhc3MsXG4gICAgYmxvY2tlZFJlYXNvbjogb3AuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IG9wLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IG9wLnVwZGF0ZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tPcGVyYXRpb25zIiwiY3JlYXRlRGJPcGVyYXRpb25zUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsIm9wZXJhdGlvbiIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZWRBdCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RGb3JXb3JrT3JkZXIiLCJ3b3JrT3JkZXJJZCIsImNyZWF0ZWRBdCIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJzdGF0aW9uIiwidGl0bGUiLCJub3RlcyIsImFzc2lnbmVlQWdlbnRJZHMiLCJkZXBlbmRzT25PcGVyYXRpb25JZHMiLCJKU09OIiwic3RyaW5naWZ5Iiwid2lwQ2xhc3MiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkiLCJuZXdTdGF0dXMiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0dXMiLCJhY3Rpdml0eUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiYWN0aXZpdHkiLCJ0cyIsInR5cGUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdW1tYXJ5IiwicGF5bG9hZEpzb24iLCJjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8iLCJyZXN1bHQiLCJmaWx0ZXIiLCJvcCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiaW5jbHVkZXMiLCJzdGF0aW9ucyIsIm1vY2tUb0RUTyIsImZpbmQiLCJvIiwiY291bnRzIiwiX2FjdG9yIiwiaW4iLCJwYXJzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:544:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(rsc)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUXdCLElBQUk7UUFBQyxJQUFJeEIsUUFBUXdCLElBQUk7SUFDaEY7SUFDQSxJQUFJeEIsUUFBUWdFLE9BQU8sS0FBS0MsV0FBVztRQUNqQ2hFLE1BQU1tQixPQUFPLEdBQUdwQixRQUFRZ0UsT0FBTyxHQUFHLE9BQU87WUFBRUUsS0FBSztRQUFLO0lBQ3ZEO0lBQ0EsT0FBT2pFO0FBQ1Q7QUFFQSxTQUFTUyxNQUFNRyxHQWNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJFLGFBQWFMLElBQUlLLFdBQVc7UUFDNUJNLE1BQU1YLElBQUlXLElBQUk7UUFDZEMsYUFBYVosSUFBSVksV0FBVztRQUM1QkMsaUJBQWlCQyxLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWEsZUFBZTtRQUMvQ2tCLFVBQVUvQixJQUFJK0IsUUFBUTtRQUN0QkMsWUFBWWhDLElBQUlnQyxVQUFVO1FBQzFCYSxlQUFlN0MsSUFBSTZDLGFBQWE7UUFDaENDLGVBQWU5QyxJQUFJOEMsYUFBYTtRQUNoQ2IsWUFBWWpDLElBQUlpQyxVQUFVLEdBQUduQixLQUFLd0MsS0FBSyxDQUFDdEQsSUFBSWlDLFVBQVUsSUFBSTtRQUMxRHZDLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJhLFNBQVNQLElBQUlPLE9BQU87SUFDdEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9yZWNlaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY2VpcHRzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgcmVjZWlwdHMgKGNvbW1hbmQgZXhlY3V0aW9uIGxvZ3MpIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgcmVjZWlwdCBldmVudHMgdG8gdGhlIHB1Yi9zdWIgc3lzdGVtIGZvciBTU0Ugc3RyZWFtaW5nLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgcHVibGlzaFJlY2VpcHRDaHVuaywgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQgfSBmcm9tICcuLi9wdWJzdWInXG5pbXBvcnQgdHlwZSB7IFJlY2VpcHREVE8sIFJlY2VpcHRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVSZWNlaXB0SW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICBraW5kOiAncGxheWJvb2tfc3RlcCcgfCAnY3Jvbl9ydW4nIHwgJ2FnZW50X3J1bicgfCAnbWFudWFsJ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBlbmRSZWNlaXB0SW5wdXQge1xuICBzdHJlYW06ICdzdGRvdXQnIHwgJ3N0ZGVycidcbiAgY2h1bms6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsaXplUmVjZWlwdElucHV0IHtcbiAgZXhpdENvZGU6IG51bWJlclxuICBkdXJhdGlvbk1zOiBudW1iZXJcbiAgcGFyc2VkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0UnVubmluZygpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+XG4gIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbiAgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiAxMDAsXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgb3BlcmF0aW9uSWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVuZGVkQXQ6IG51bGwgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3b3JrT3JkZXJJZDogaW5wdXQud29ya09yZGVySWQsXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgICBjb21tYW5kTmFtZTogaW5wdXQuY29tbWFuZE5hbWUsXG4gICAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jb21tYW5kQXJncyA/PyB7fSksXG4gICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gQXBwZW5kIHRvIHRoZSBhcHByb3ByaWF0ZSBleGNlcnB0XG4gICAgICBjb25zdCBmaWVsZCA9IGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcgPyAnc3Rkb3V0RXhjZXJwdCcgOiAnc3RkZXJyRXhjZXJwdCdcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGV4aXN0aW5nW2ZpZWxkXVxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjdXJyZW50VmFsdWUgKyBpbnB1dC5jaHVua1xuXG4gICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhc3QgMTBLQiBhcyBleGNlcnB0XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMCAqIDEwMjRcbiAgICAgIGNvbnN0IHRydW5jYXRlZFZhbHVlID1cbiAgICAgICAgbmV3VmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoXG4gICAgICAgICAgPyAnLi4uKHRydW5jYXRlZClcXG4nICsgbmV3VmFsdWUuc2xpY2UoLW1heExlbmd0aClcbiAgICAgICAgICA6IG5ld1ZhbHVlXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHsgW2ZpZWxkXTogdHJ1bmNhdGVkVmFsdWUgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRDaHVuayhpZCwgaW5wdXQuc3RyZWFtLCBpbnB1dC5jaHVuaylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZmluYWxpemUoaWQ6IHN0cmluZywgaW5wdXQ6IEZpbmFsaXplUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGV4aXRDb2RlOiBpbnB1dC5leGl0Q29kZSxcbiAgICAgICAgICBkdXJhdGlvbk1zOiBpbnB1dC5kdXJhdGlvbk1zLFxuICAgICAgICAgIHBhcnNlZEpzb246IGlucHV0LnBhcnNlZEpzb24gPyBKU09OLnN0cmluZ2lmeShpbnB1dC5wYXJzZWRKc29uKSA6IG51bGwsXG4gICAgICAgICAgZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtb2NrUmVjZWlwdHM6IFJlY2VpcHREVE9bXSA9IFtdXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrUmVjZWlwdHNSZXBvKCk6IFJlY2VpcHRzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChfZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1JlY2VpcHRzXS5zb3J0KFxuICAgICAgICAoYSwgYikgPT4gYi5zdGFydGVkQXQuZ2V0VGltZSgpIC0gYS5zdGFydGVkQXQuZ2V0VGltZSgpXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLm9wZXJhdGlvbklkID09PSBvcGVyYXRpb25JZClcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrUmVjZWlwdHMuZmlsdGVyKChyKSA9PiByLmVuZGVkQXQgPT09IG51bGwpXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByZWNlaXB0OiBSZWNlaXB0RFRPID0ge1xuICAgICAgICBpZDogYHJjcHRfbW9ja18ke0RhdGUubm93KCl9YCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAga2luZDogaW5wdXQua2luZCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBjb21tYW5kQXJnc0pzb246IGlucHV0LmNvbW1hbmRBcmdzID8/IHt9LFxuICAgICAgICBleGl0Q29kZTogbnVsbCxcbiAgICAgICAgZHVyYXRpb25NczogbnVsbCxcbiAgICAgICAgc3Rkb3V0RXhjZXJwdDogJycsXG4gICAgICAgIHN0ZGVyckV4Y2VycHQ6ICcnLFxuICAgICAgICBwYXJzZWRKc29uOiBudWxsLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZGVkQXQ6IG51bGwsXG4gICAgICB9XG4gICAgICBtb2NrUmVjZWlwdHMucHVzaChyZWNlaXB0KVxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuXG4gICAgYXN5bmMgYXBwZW5kKGlkOiBzdHJpbmcsIGlucHV0OiBBcHBlbmRSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICBpZiAoaW5wdXQuc3RyZWFtID09PSAnc3Rkb3V0Jykge1xuICAgICAgICByZWNlaXB0LnN0ZG91dEV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY2VpcHQuc3RkZXJyRXhjZXJwdCArPSBpbnB1dC5jaHVua1xuICAgICAgfVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBtb2NrUmVjZWlwdHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXJlY2VpcHQpIHJldHVybiBudWxsXG5cbiAgICAgIHJlY2VpcHQuZXhpdENvZGUgPSBpbnB1dC5leGl0Q29kZVxuICAgICAgcmVjZWlwdC5kdXJhdGlvbk1zID0gaW5wdXQuZHVyYXRpb25Nc1xuICAgICAgcmVjZWlwdC5wYXJzZWRKc29uID0gaW5wdXQucGFyc2VkSnNvbiA/PyBudWxsXG4gICAgICByZWNlaXB0LmVuZGVkQXQgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIC8vIFB1Ymxpc2ggdG8gU1NFIHN0cmVhbVxuICAgICAgcHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQoaWQsIGlucHV0LmV4aXRDb2RlLCBpbnB1dC5kdXJhdGlvbk1zKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy53b3JrT3JkZXJJZCkge1xuICAgIHdoZXJlLndvcmtPcmRlcklkID0gZmlsdGVycy53b3JrT3JkZXJJZFxuICB9XG4gIGlmIChmaWx0ZXJzLm9wZXJhdGlvbklkKSB7XG4gICAgd2hlcmUub3BlcmF0aW9uSWQgPSBmaWx0ZXJzLm9wZXJhdGlvbklkXG4gIH1cbiAgaWYgKGZpbHRlcnMua2luZCkge1xuICAgIHdoZXJlLmtpbmQgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMua2luZCkgPyB7IGluOiBmaWx0ZXJzLmtpbmQgfSA6IGZpbHRlcnMua2luZFxuICB9XG4gIGlmIChmaWx0ZXJzLnJ1bm5pbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIHdoZXJlLmVuZGVkQXQgPSBmaWx0ZXJzLnJ1bm5pbmcgPyBudWxsIDogeyBub3Q6IG51bGwgfVxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkOiBzdHJpbmcgfCBudWxsXG4gIGtpbmQ6IHN0cmluZ1xuICBjb21tYW5kTmFtZTogc3RyaW5nXG4gIGNvbW1hbmRBcmdzSnNvbjogc3RyaW5nXG4gIGV4aXRDb2RlOiBudW1iZXIgfCBudWxsXG4gIGR1cmF0aW9uTXM6IG51bWJlciB8IG51bGxcbiAgc3Rkb3V0RXhjZXJwdDogc3RyaW5nXG4gIHN0ZGVyckV4Y2VycHQ6IHN0cmluZ1xuICBwYXJzZWRKc29uOiBzdHJpbmcgfCBudWxsXG4gIHN0YXJ0ZWRBdDogRGF0ZVxuICBlbmRlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFJlY2VpcHREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIGtpbmQ6IHJvdy5raW5kIGFzIFJlY2VpcHREVE9bJ2tpbmQnXSxcbiAgICBjb21tYW5kTmFtZTogcm93LmNvbW1hbmROYW1lLFxuICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5wYXJzZShyb3cuY29tbWFuZEFyZ3NKc29uKSxcbiAgICBleGl0Q29kZTogcm93LmV4aXRDb2RlLFxuICAgIGR1cmF0aW9uTXM6IHJvdy5kdXJhdGlvbk1zLFxuICAgIHN0ZG91dEV4Y2VycHQ6IHJvdy5zdGRvdXRFeGNlcnB0LFxuICAgIHN0ZGVyckV4Y2VycHQ6IHJvdy5zdGRlcnJFeGNlcnB0LFxuICAgIHBhcnNlZEpzb246IHJvdy5wYXJzZWRKc29uID8gSlNPTi5wYXJzZShyb3cucGFyc2VkSnNvbikgOiBudWxsLFxuICAgIHN0YXJ0ZWRBdDogcm93LnN0YXJ0ZWRBdCxcbiAgICBlbmRlZEF0OiByb3cuZW5kZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInB1Ymxpc2hSZWNlaXB0Q2h1bmsiLCJwdWJsaXNoUmVjZWlwdEZpbmFsaXplZCIsImNyZWF0ZURiUmVjZWlwdHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwicmVjZWlwdCIsImZpbmRNYW55Iiwib3JkZXJCeSIsInN0YXJ0ZWRBdCIsInRha2UiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJsaXN0Rm9yT3BlcmF0aW9uIiwib3BlcmF0aW9uSWQiLCJsaXN0UnVubmluZyIsImVuZGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJraW5kIiwiY29tbWFuZE5hbWUiLCJjb21tYW5kQXJnc0pzb24iLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZEFyZ3MiLCJEYXRlIiwiYXBwZW5kIiwiZXhpc3RpbmciLCJmaWVsZCIsInN0cmVhbSIsImN1cnJlbnRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2h1bmsiLCJtYXhMZW5ndGgiLCJ0cnVuY2F0ZWRWYWx1ZSIsImxlbmd0aCIsInNsaWNlIiwidXBkYXRlIiwiZmluYWxpemUiLCJleGl0Q29kZSIsImR1cmF0aW9uTXMiLCJwYXJzZWRKc29uIiwibW9ja1JlY2VpcHRzIiwiY3JlYXRlTW9ja1JlY2VpcHRzUmVwbyIsIl9maWx0ZXJzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImZpbmQiLCJyIiwiZmlsdGVyIiwibm93Iiwic3Rkb3V0RXhjZXJwdCIsInN0ZGVyckV4Y2VycHQiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiaW4iLCJydW5uaW5nIiwidW5kZWZpbmVkIiwibm90IiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:577:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TWxCLFFBQU9kLEVBQVU7WUFDckIsTUFBTThCLE1BQU1kLGFBQWFlLFNBQVMsQ0FBQyxDQUFDZCxJQUFNQSxFQUFFakIsRUFBRSxLQUFLQTtZQUNuRCxJQUFJOEIsUUFBUSxDQUFDLEdBQUcsT0FBTztZQUN2QmQsYUFBYWlCLE1BQU0sQ0FBQ0gsS0FBSztZQUN6QixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBU2hDLE1BQU1HLEdBU2Q7SUFDQyxPQUFPO1FBQ0xELElBQUlDLElBQUlELEVBQUU7UUFDVkosTUFBTUssSUFBSUwsSUFBSTtRQUNkWSxNQUFNUCxJQUFJTyxJQUFJO1FBQ2RDLGFBQWFSLElBQUlRLFdBQVc7UUFDNUJDLE9BQU9ULElBQUlTLEtBQUs7UUFDaEJmLFdBQVdNLElBQUlOLFNBQVM7UUFDeEJ1QixXQUFXakIsSUFBSWlCLFNBQVM7UUFDeEJHLFdBQVdwQixJQUFJb0IsU0FBUztJQUMxQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL3N0YXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGlvbnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBzdGF0aW9ucyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHR5cGUgeyBTdGF0aW9uRFRPIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTdGF0aW9uSW5wdXQge1xuICAvKiogU3RhYmxlLCB1c2VyLWZhY2luZyBpZCAoa2ViYWItY2FzZSBzbHVnKS4gKi9cbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RhdGlvbklucHV0IHtcbiAgbmFtZT86IHN0cmluZ1xuICBpY29uPzogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgbnVsbFxuICBjb2xvcj86IHN0cmluZyB8IG51bGxcbiAgc29ydE9yZGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGlvbnNSZXBvIHtcbiAgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZE1hbnkoe1xuICAgICAgICBvcmRlckJ5OiBbeyBzb3J0T3JkZXI6ICdhc2MnIH0sIHsgbmFtZTogJ2FzYycgfV0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgbmFtZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogaW5wdXQuaWQsXG4gICAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbiA/PyBudWxsLFxuICAgICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0Lm5hbWUgIT09IHVuZGVmaW5lZCAmJiB7IG5hbWU6IGlucHV0Lm5hbWUgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIGZhbHNlXG4gICAgICBhd2FpdCBwcmlzbWEuc3RhdGlvbi5kZWxldGUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBERUZBVUxUX1NUQVRJT05TOiBBcnJheTxPbWl0PFN0YXRpb25EVE8sICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+PiA9IFtcbiAge1xuICAgIGlkOiAnc3BlYycsXG4gICAgbmFtZTogJ3NwZWMnLFxuICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgIGRlc2NyaXB0aW9uOiAnUGxhbm5pbmcgJiBzcGVjaWZpY2F0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAxMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnYnVpbGQnLFxuICAgIG5hbWU6ICdidWlsZCcsXG4gICAgaWNvbjogJ2hhbW1lcicsXG4gICAgZGVzY3JpcHRpb246ICdJbXBsZW1lbnRhdGlvbicsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAyMCxcbiAgfSxcbiAge1xuICAgIGlkOiAncWEnLFxuICAgIG5hbWU6ICdxYScsXG4gICAgaWNvbjogJ2NoZWNrLWNpcmNsZScsXG4gICAgZGVzY3JpcHRpb246ICdRdWFsaXR5IGFzc3VyYW5jZScsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiAzMCxcbiAgfSxcbiAge1xuICAgIGlkOiAnb3BzJyxcbiAgICBuYW1lOiAnb3BzJyxcbiAgICBpY29uOiAnc2V0dGluZ3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnT3BlcmF0aW9ucycsXG4gICAgY29sb3I6IG51bGwsXG4gICAgc29ydE9yZGVyOiA0MCxcbiAgfSxcbl1cblxuY29uc3QgbW9ja1N0YXRpb25zOiBTdGF0aW9uRFRPW10gPSBERUZBVUxUX1NUQVRJT05TLm1hcCgocykgPT4gKHtcbiAgLi4ucyxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbn0pKVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1N0YXRpb25zUmVwbygpOiBTdGF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+IHtcbiAgICAgIHJldHVybiBbLi4ubW9ja1N0YXRpb25zXS5zb3J0KChhLCBiKSA9PiAoYS5zb3J0T3JkZXIgLSBiLnNvcnRPcmRlcikgfHwgYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLmlkID09PSBpZCkgPz8gbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIG1vY2tTdGF0aW9ucy5maW5kKChzKSA9PiBzLm5hbWUgPT09IG5hbWUpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGR0bzogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgICAgICBpY29uOiBpbnB1dC5pY29uLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwsXG4gICAgICAgIHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyID8/IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9ucy5wdXNoKGR0bylcbiAgICAgIHJldHVybiBkdG9cbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gbnVsbFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrU3RhdGlvbnNbaWR4XVxuICAgICAgY29uc3QgdXBkYXRlZDogU3RhdGlvbkRUTyA9IHtcbiAgICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAuLi4oaW5wdXQuaWNvbiAhPT0gdW5kZWZpbmVkICYmIHsgaWNvbjogaW5wdXQuaWNvbiB9KSxcbiAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQgJiYgeyBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LmNvbG9yICE9PSB1bmRlZmluZWQgJiYgeyBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCB9KSxcbiAgICAgICAgLi4uKGlucHV0LnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkICYmIHsgc29ydE9yZGVyOiBpbnB1dC5zb3J0T3JkZXIgfSksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH1cbiAgICAgIG1vY2tTdGF0aW9uc1tpZHhdID0gdXBkYXRlZFxuICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGlkeCA9IG1vY2tTdGF0aW9ucy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IGlkKVxuICAgICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBmYWxzZVxuICAgICAgbW9ja1N0YXRpb25zLnNwbGljZShpZHgsIDEpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaWNvbjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNvbG9yOiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcjogbnVtYmVyXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbn0pOiBTdGF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIGljb246IHJvdy5pY29uLFxuICAgIGRlc2NyaXB0aW9uOiByb3cuZGVzY3JpcHRpb24sXG4gICAgY29sb3I6IHJvdy5jb2xvcixcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0T3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJpc21hIiwiY3JlYXRlRGJTdGF0aW9uc1JlcG8iLCJsaXN0Iiwicm93cyIsInN0YXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzb3J0T3JkZXIiLCJuYW1lIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRCeU5hbWUiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJpY29uIiwiZGVzY3JpcHRpb24iLCJjb2xvciIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiREVGQVVMVF9TVEFUSU9OUyIsIm1vY2tTdGF0aW9ucyIsInMiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiY3JlYXRlTW9ja1N0YXRpb25zUmVwbyIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJmaW5kIiwiZHRvIiwicHVzaCIsImlkeCIsImZpbmRJbmRleCIsInVwZGF0ZWQiLCJzcGxpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/app/(dashboard)/cron/page.js:588:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(rsc)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(rsc)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ25DSSxlQUFlNEIsR0FBRzVCLGFBQWE7UUFDL0JuQixXQUFXK0MsR0FBRy9DLFNBQVM7UUFDdkJoQyxXQUFXK0UsR0FBRy9FLFNBQVM7UUFDdkI2QixXQUFXa0QsR0FBR2xELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby93b3JrT3JkZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV29yayBPcmRlcnMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciB3b3JrIG9yZGVycyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgaW5kZXhXb3JrT3JkZXIgfSBmcm9tICcuLi9kYi9mdHMnXG5pbXBvcnQgeyBtb2NrV29ya09yZGVycywgbW9ja09wZXJhdGlvbnMgfSBmcm9tICdAY2xhd2NvbnRyb2wvY29yZSdcbmltcG9ydCB0eXBlIHtcbiAgV29ya09yZGVyRFRPLFxuICBXb3JrT3JkZXJXaXRoT3BzRFRPLFxuICBXb3JrT3JkZXJGaWx0ZXJzLFxufSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVdvcmtPcmRlcklucHV0IHtcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlPzogc3RyaW5nXG4gIGdvYWxNZD86IHN0cmluZ1xuICBzdGF0ZT86IHN0cmluZ1xuICBwcmlvcml0eT86IHN0cmluZ1xuICBvd25lcj86IHN0cmluZ1xuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlVHJhbnNpdGlvblJlc3VsdCB7XG4gIHdvcmtPcmRlcjogV29ya09yZGVyRFRPXG4gIHByZXZpb3VzU3RhdGU6IHN0cmluZ1xuICBhY3Rpdml0eUlkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JrT3JkZXJzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPlxuICBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPlxuICBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICAvKiogQ291bnQgd29yayBvcmRlcnMgc2hpcHBlZCBzaW5jZSBzdGFydCBvZiB0b2RheSAobG9jYWwgdGltZSkgKi9cbiAgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXRlIGFuZCB3cml0ZSBhY3Rpdml0eSByZWNvcmQgaW4gYSB0cmFuc2FjdGlvbiAqL1xuICB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICBpZDogc3RyaW5nLFxuICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYldvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3aGVyZSA9IGJ1aWxkV2hlcmUoZmlsdGVycylcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgdXBkYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG9wZXJhdGlvbnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gKHtcbiAgICAgICAgLi4udG9EVE8ocm93KSxcbiAgICAgICAgb3BlcmF0aW9uczogcm93Lm9wZXJhdGlvbnMubWFwKChvcCkgPT4gKHtcbiAgICAgICAgICBpZDogb3AuaWQsXG4gICAgICAgICAgc3RhdHVzOiBvcC5zdGF0dXMsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBjb2RlIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0ZSddLFxuICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBncm91cHMubWFwKChnKSA9PiBbZy5zdGF0ZSwgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFNoaXBwZWRUb2RheSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICByZXR1cm4gcHJpc21hLndvcmtPcmRlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc3RhdGU6ICdzaGlwcGVkJyxcbiAgICAgICAgICBzaGlwcGVkQXQ6IHsgZ3RlOiB0b2RheSB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZFdpdGhPcHMoaWQ6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbmV4dCBjb2RlXG4gICAgICBjb25zdCBsYXN0V28gPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRGaXJzdCh7XG4gICAgICAgIG9yZGVyQnk6IHsgY29kZTogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDogeyBjb2RlOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgbGFzdE51bSA9IGxhc3RXbyA/IHBhcnNlSW50KGxhc3RXby5jb2RlLnJlcGxhY2UoJ1dPLScsICcnKSwgMTApIDogMFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhsYXN0TnVtICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICAgIHN0YXRlOiAncGxhbm5lZCcsXG4gICAgICAgICAgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IHx8ICdQMicsXG4gICAgICAgICAgb3duZXI6IGlucHV0Lm93bmVyIHx8ICd1c2VyJyxcbiAgICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEluZGV4IGZvciBzZWFyY2hcbiAgICAgIGF3YWl0IGluZGV4V29ya09yZGVyKHJvdy5pZCwgcm93LmNvZGUsIHJvdy50aXRsZSwgcm93LmdvYWxNZClcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVXb3JrT3JkZXJJbnB1dCk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQgJiYgeyBnb2FsTWQ6IGlucHV0LmdvYWxNZCB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQucHJpb3JpdHkgIT09IHVuZGVmaW5lZCAmJiB7IHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgICAuLi4oaW5wdXQuc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIFJlLWluZGV4IGZvciBzZWFyY2ggaWYgdGl0bGUgb3IgZ29hbCBjaGFuZ2VkXG4gICAgICBpZiAoaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCB8fCBpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgICByZXR1cm4gcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCB0eC53b3JrT3JkZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZXhpc3Rpbmcuc3RhdGVcblxuICAgICAgICAvLyBVcGRhdGUgd29yayBvcmRlclxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC53b3JrT3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSxcbiAgICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFjdGl2aXR5IHJlY29yZFxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YFxuICAgICAgICBhd2FpdCB0eC5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0eXBlOiAnd29ya19vcmRlci5zdGF0ZV9jaGFuZ2VkJyxcbiAgICAgICAgICAgIGFjdG9yLFxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3dvcmtfb3JkZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGlkLFxuICAgICAgICAgICAgc3VtbWFyeTogYFdvcmsgb3JkZXIgdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdGV9YCxcbiAgICAgICAgICAgIHBheWxvYWRKc29uOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgICAgICAgIG5ld1N0YXRlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdvcmtPcmRlcjogdG9EVE8ocm93KSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8oKTogV29ya09yZGVyc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlckRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tXb3JrT3JkZXJzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0ZSkgPyBmaWx0ZXJzLnN0YXRlIDogW2ZpbHRlcnMuc3RhdGVdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiBzdGF0ZXMuaW5jbHVkZXMod28uc3RhdGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXRpZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8gZmlsdGVycy5wcmlvcml0eSA6IFtmaWx0ZXJzLnByaW9yaXR5XVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gcHJpb3JpdGllcy5pbmNsdWRlcyh3by5wcmlvcml0eSkpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8ub3duZXIpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHdvLm93bmVyID09PSBmaWx0ZXJzLm93bmVyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0V2l0aE9wcyhmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyV2l0aE9wc0RUT1tdPiB7XG4gICAgICBjb25zdCB3b3JrT3JkZXJzID0gYXdhaXQgdGhpcy5saXN0KGZpbHRlcnMpXG4gICAgICByZXR1cm4gd29ya09yZGVycy5tYXAoKHdvKSA9PiAoe1xuICAgICAgICAuLi53byxcbiAgICAgICAgb3BlcmF0aW9uczogbW9ja09wZXJhdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKChvcCkgPT4gb3Aud29ya09yZGVySWQgPT09IHdvLmlkKVxuICAgICAgICAgIC5tYXAoKG9wKSA9PiAoeyBpZDogb3AuaWQsIHN0YXR1czogb3Auc3RhdHVzIH0pKSxcbiAgICAgIH0pKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuY29kZSA9PT0gY29kZSlcbiAgICAgIHJldHVybiB3byA/IG1vY2tUb0RUTyh3bykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0ZSgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHdvIG9mIG1vY2tXb3JrT3JkZXJzKSB7XG4gICAgICAgIGNvdW50c1t3by5zdGF0ZV0gPSAoY291bnRzW3dvLnN0YXRlXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIG1vY2tXb3JrT3JkZXJzLmZpbHRlcihcbiAgICAgICAgKHdvKSA9PiB3by5zdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHdvLnNoaXBwZWRBdCAmJiB3by5zaGlwcGVkQXQgPj0gdG9kYXlcbiAgICAgICkubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm1vY2tUb0RUTyh3byksXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSBpZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTz4ge1xuICAgICAgLy8gR2VuZXJhdGUgbW9jayBJRCBhbmQgY29kZVxuICAgICAgY29uc3QgaWQgPSBgd29fbW9ja18ke0RhdGUubm93KCl9YFxuICAgICAgY29uc3QgY29kZSA9IGBXTy0ke1N0cmluZyhtb2NrV29ya09yZGVycy5sZW5ndGggKyAxKS5wYWRTdGFydCgzLCAnMCcpfWBcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcblxuICAgICAgY29uc3QgbmV3V28gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICBjb2RlLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIGdvYWxNZDogaW5wdXQuZ29hbE1kLFxuICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogKGlucHV0LnByaW9yaXR5IHx8ICdQMicpIGFzICdQMCcgfCAnUDEnIHwgJ1AyJyB8ICdQMycsXG4gICAgICAgIG93bmVyOiAoaW5wdXQub3duZXIgfHwgJ3VzZXInKSBhcyAndXNlcicgfCAnY2xhd2NvbnRyb2xjZW8nLFxuICAgICAgICByb3V0aW5nVGVtcGxhdGU6IGlucHV0LnJvdXRpbmdUZW1wbGF0ZSB8fCAnZGVmYXVsdF9yb3V0aW5nJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgICBzaGlwcGVkQXQ6IG51bGwsXG4gICAgICB9XG5cbiAgICAgIC8vIEluIG1vY2sgbW9kZSwgd2UgZG9uJ3QgcGVyc2lzdCAtIGp1c3QgcmV0dXJuIHRoZSBEVE9cbiAgICAgIHJldHVybiBtb2NrVG9EVE8obmV3V28pXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IGFjdHVhbGx5IG11dGF0ZSAtIGp1c3QgcmV0dXJuIHVwZGF0ZWQgRFRPXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAuLi4oaW5wdXQudGl0bGUgIT09IHVuZGVmaW5lZCAmJiB7IHRpdGxlOiBpbnB1dC50aXRsZSB9KSxcbiAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgIC4uLihpbnB1dC5zdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdGU6IGlucHV0LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddIH0pLFxuICAgICAgICAuLi4oaW5wdXQub3duZXIgIT09IHVuZGVmaW5lZCAmJiB7IG93bmVyOiBpbnB1dC5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5KFxuICAgICAgaWQ6IHN0cmluZyxcbiAgICAgIG5ld1N0YXRlOiBzdHJpbmcsXG4gICAgICBfYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdGUgPSB3by5zdGF0ZVxuICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfbW9ja18ke0RhdGUubm93KCl9YFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB3b3JrT3JkZXI6IHtcbiAgICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICAgIHN0YXRlOiBuZXdTdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLihuZXdTdGF0ZSA9PT0gJ3NoaXBwZWQnICYmIHsgc2hpcHBlZEF0OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICB9LFxuICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLnN0YXRlKSB7XG4gICAgd2hlcmUuc3RhdGUgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8geyBpbjogZmlsdGVycy5zdGF0ZSB9IDogZmlsdGVycy5zdGF0ZVxuICB9XG4gIGlmIChmaWx0ZXJzLnByaW9yaXR5KSB7XG4gICAgd2hlcmUucHJpb3JpdHkgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMucHJpb3JpdHkpID8geyBpbjogZmlsdGVycy5wcmlvcml0eSB9IDogZmlsdGVycy5wcmlvcml0eVxuICB9XG4gIGlmIChmaWx0ZXJzLm93bmVyKSB7XG4gICAgd2hlcmUub3duZXIgPSBmaWx0ZXJzLm93bmVyXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIGNvZGU6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGdvYWxNZDogc3RyaW5nXG4gIHN0YXRlOiBzdHJpbmdcbiAgcHJpb3JpdHk6IHN0cmluZ1xuICBvd25lcjogc3RyaW5nXG4gIHJvdXRpbmdUZW1wbGF0ZTogc3RyaW5nXG4gIGJsb2NrZWRSZWFzb246IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBzaGlwcGVkQXQ6IERhdGUgfCBudWxsXG59KTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIGNvZGU6IHJvdy5jb2RlLFxuICAgIHRpdGxlOiByb3cudGl0bGUsXG4gICAgZ29hbE1kOiByb3cuZ29hbE1kLFxuICAgIHN0YXRlOiByb3cuc3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgIHByaW9yaXR5OiByb3cucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiByb3cub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogcm93LnJvdXRpbmdUZW1wbGF0ZSxcbiAgICBibG9ja2VkUmVhc29uOiByb3cuYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZEF0LFxuICAgIHNoaXBwZWRBdDogcm93LnNoaXBwZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8od286IHR5cGVvZiBtb2NrV29ya09yZGVyc1tudW1iZXJdKTogV29ya09yZGVyRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogd28uaWQsXG4gICAgY29kZTogd28uY29kZSxcbiAgICB0aXRsZTogd28udGl0bGUsXG4gICAgZ29hbE1kOiB3by5nb2FsTWQsXG4gICAgc3RhdGU6IHdvLnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogd28ucHJpb3JpdHkgYXMgV29ya09yZGVyRFRPWydwcmlvcml0eSddLFxuICAgIG93bmVyOiB3by5vd25lciBhcyBXb3JrT3JkZXJEVE9bJ293bmVyJ10sXG4gICAgcm91dGluZ1RlbXBsYXRlOiB3by5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogd28uYmxvY2tlZFJlYXNvbixcbiAgICBjcmVhdGVkQXQ6IHdvLmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHdvLnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHdvLnNoaXBwZWRBdCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImluZGV4V29ya09yZGVyIiwibW9ja1dvcmtPcmRlcnMiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiV29ya09yZGVyc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJ3b3JrT3JkZXIiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImxpc3RXaXRoT3BzIiwiaW5jbHVkZSIsIm9wZXJhdGlvbnMiLCJzZWxlY3QiLCJpZCIsInN0YXR1cyIsInJvdyIsIm9wIiwiZ2V0QnlJZCIsImZpbmRVbmlxdWUiLCJnZXRCeUNvZGUiLCJjb2RlIiwiY291bnRCeVN0YXRlIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdGUiLCJjb3VudFNoaXBwZWRUb2RheSIsInRvZGF5IiwiRGF0ZSIsInNldEhvdXJzIiwiY291bnQiLCJzaGlwcGVkQXQiLCJndGUiLCJnZXRCeUlkV2l0aE9wcyIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImlucHV0IiwibGFzdFdvIiwiZmluZEZpcnN0IiwibGFzdE51bSIsInBhcnNlSW50IiwicmVwbGFjZSIsIlN0cmluZyIsInBhZFN0YXJ0IiwiZGF0YSIsInRpdGxlIiwiZ29hbE1kIiwicHJpb3JpdHkiLCJvd25lciIsInJvdXRpbmdUZW1wbGF0ZSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidW5kZWZpbmVkIiwiYmxvY2tlZFJlYXNvbiIsInVwZGF0ZVN0YXRlV2l0aEFjdGl2aXR5IiwibmV3U3RhdGUiLCJhY3RvciIsIiR0cmFuc2FjdGlvbiIsInR4IiwicHJldmlvdXNTdGF0ZSIsImFjdGl2aXR5SWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZU1vY2tXb3JrT3JkZXJzUmVwbyIsInJlc3VsdCIsInN0YXRlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIndvIiwiaW5jbHVkZXMiLCJwcmlvcml0aWVzIiwibW9ja1RvRFRPIiwid29ya09yZGVycyIsIndvcmtPcmRlcklkIiwiZmluZCIsInciLCJjb3VudHMiLCJsZW5ndGgiLCJuZXdXbyIsIl9hY3RvciIsImluIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:270:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbActivitiesRepo: () => (/* binding */ createDbActivitiesRepo),\n/* harmony export */   createMockActivitiesRepo: () => (/* binding */ createMockActivitiesRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(instrument)/../../packages/core/src/index.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pubsub */ \"(instrument)/./lib/pubsub.ts\");\n/**\n * Activities Repository\n *\n * Provides data access for activities with both DB and mock implementations.\n * Publishes activities to the pub/sub system for SSE streaming.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where,\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: pagination?.limit ?? 50,\n                skip: pagination?.offset ?? 0\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listRecent (limit = 20) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                orderBy: {\n                    ts: 'desc'\n                },\n                take: limit\n            });\n            return rows.map(toDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.findMany({\n                where: {\n                    entityType,\n                    entityId\n                },\n                orderBy: {\n                    ts: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.activity.create({\n                data: {\n                    id,\n                    ts: new Date(),\n                    type: input.type,\n                    actor: input.actor,\n                    entityType: input.entityType,\n                    entityId: input.entityId,\n                    summary: input.summary,\n                    payloadJson: JSON.stringify(input.payloadJson ?? {})\n                }\n            });\n            const dto = toDTO(row);\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockActivitiesRepo() {\n    return {\n        async list (filters, pagination) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ];\n            if (filters?.entityType) {\n                result = result.filter((a)=>a.entityType === filters.entityType);\n            }\n            if (filters?.entityId) {\n                result = result.filter((a)=>a.entityId === filters.entityId);\n            }\n            if (filters?.type) {\n                result = result.filter((a)=>a.type === filters.type);\n            }\n            // Sort by timestamp descending\n            result.sort((a, b)=>b.ts.getTime() - a.ts.getTime());\n            // Apply pagination\n            const offset = pagination?.offset ?? 0;\n            const limit = pagination?.limit ?? 50;\n            return result.slice(offset, offset + limit).map(mockToDTO);\n        },\n        async getById (id) {\n            const activity = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.find((a)=>a.id === id);\n            return activity ? mockToDTO(activity) : null;\n        },\n        async listRecent (limit = 20) {\n            return [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities\n            ].sort((a, b)=>b.ts.getTime() - a.ts.getTime()).slice(0, limit).map(mockToDTO);\n        },\n        async listForEntity (entityType, entityId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockActivities.filter((a)=>a.entityType === entityType && a.entityId === entityId).map(mockToDTO);\n        },\n        async create (input) {\n            // Mock implementation just returns the created activity without persisting\n            const id = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n            const dto = {\n                id,\n                ts: new Date(),\n                type: input.type,\n                actor: input.actor,\n                entityType: input.entityType,\n                entityId: input.entityId,\n                summary: input.summary,\n                payloadJson: input.payloadJson ?? {}\n            };\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_2__.publishActivity)(dto);\n            return dto;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.entityType) {\n        where.entityType = filters.entityType;\n    }\n    if (filters.entityId) {\n        where.entityId = filters.entityId;\n    }\n    if (filters.type) {\n        where.type = filters.type;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        ts: row.ts,\n        type: row.type,\n        actor: row.actor,\n        entityType: row.entityType,\n        entityId: row.entityId,\n        summary: row.summary,\n        payloadJson: JSON.parse(row.payloadJson)\n    };\n}\nfunction mockToDTO(activity) {\n    return {\n        id: activity.id,\n        ts: activity.ts,\n        type: activity.type,\n        actor: activity.actor,\n        entityType: activity.entityType,\n        entityId: activity.entityId,\n        summary: activity.summary,\n        payloadJson: activity.payloadJson\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WSxLQUFLLENBQUMvQixJQUFJa0IsV0FBVztJQUN6QztBQUNGO0FBRUEsU0FBU1csVUFBVXpDLFFBQXVDO0lBQ3hELE9BQU87UUFDTFcsSUFBSVgsU0FBU1csRUFBRTtRQUNmUixJQUFJSCxTQUFTRyxFQUFFO1FBQ2Z3QixNQUFNM0IsU0FBUzJCLElBQUk7UUFDbkJDLE9BQU81QixTQUFTNEIsS0FBSztRQUNyQlosWUFBWWhCLFNBQVNnQixVQUFVO1FBQy9CQyxVQUFVakIsU0FBU2lCLFFBQVE7UUFDM0JZLFNBQVM3QixTQUFTNkIsT0FBTztRQUN6QkMsYUFBYTlCLFNBQVM4QixXQUFXO0lBQ25DO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYWN0aXZpdGllcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFjdGl2aXRpZXMgUmVwb3NpdG9yeVxuICpcbiAqIFByb3ZpZGVzIGRhdGEgYWNjZXNzIGZvciBhY3Rpdml0aWVzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKiBQdWJsaXNoZXMgYWN0aXZpdGllcyB0byB0aGUgcHViL3N1YiBzeXN0ZW0gZm9yIFNTRSBzdHJlYW1pbmcuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQWN0aXZpdGllcyB9IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHsgcHVibGlzaEFjdGl2aXR5IH0gZnJvbSAnLi4vcHVic3ViJ1xuaW1wb3J0IHR5cGUgeyBBY3Rpdml0eURUTywgQWN0aXZpdHlGaWx0ZXJzLCBQYWdpbmF0aW9uT3B0aW9ucyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlQWN0aXZpdHlJbnB1dCB7XG4gIHR5cGU6IHN0cmluZ1xuICBhY3Rvcjogc3RyaW5nXG4gIGVudGl0eVR5cGU6IHN0cmluZ1xuICBlbnRpdHlJZDogc3RyaW5nXG4gIHN1bW1hcnk6IHN0cmluZ1xuICBwYXlsb2FkSnNvbj86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aXZpdGllc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBBY3Rpdml0eUZpbHRlcnMsIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uT3B0aW9ucyk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpdml0eURUTyB8IG51bGw+XG4gIGxpc3RSZWNlbnQobGltaXQ/OiBudW1iZXIpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+XG4gIGxpc3RGb3JFbnRpdHkoZW50aXR5VHlwZTogc3RyaW5nLCBlbnRpdHlJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPlxuICBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJBY3Rpdml0aWVzUmVwbygpOiBBY3Rpdml0aWVzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQWN0aXZpdHlGaWx0ZXJzLCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPEFjdGl2aXR5RFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5hY3Rpdml0eS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHRzOiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogcGFnaW5hdGlvbj8ubGltaXQgPz8gNTAsXG4gICAgICAgIHNraXA6IHBhZ2luYXRpb24/Lm9mZnNldCA/PyAwLFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpdml0eURUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hY3Rpdml0eS5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RSZWNlbnQobGltaXQgPSAyMCk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5hY3Rpdml0eS5maW5kTWFueSh7XG4gICAgICAgIG9yZGVyQnk6IHsgdHM6ICdkZXNjJyB9LFxuICAgICAgICB0YWtlOiBsaW1pdCxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JFbnRpdHkoZW50aXR5VHlwZTogc3RyaW5nLCBlbnRpdHlJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFjdGl2aXR5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgZW50aXR5VHlwZSwgZW50aXR5SWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyB0czogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFjdGl2aXR5SW5wdXQpOiBQcm9taXNlPEFjdGl2aXR5RFRPPiB7XG4gICAgICBjb25zdCBpZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hY3Rpdml0eS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQsXG4gICAgICAgICAgdHM6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdHlwZTogaW5wdXQudHlwZSxcbiAgICAgICAgICBhY3RvcjogaW5wdXQuYWN0b3IsXG4gICAgICAgICAgZW50aXR5VHlwZTogaW5wdXQuZW50aXR5VHlwZSxcbiAgICAgICAgICBlbnRpdHlJZDogaW5wdXQuZW50aXR5SWQsXG4gICAgICAgICAgc3VtbWFyeTogaW5wdXQuc3VtbWFyeSxcbiAgICAgICAgICBwYXlsb2FkSnNvbjogSlNPTi5zdHJpbmdpZnkoaW5wdXQucGF5bG9hZEpzb24gPz8ge30pLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIGNvbnN0IGR0byA9IHRvRFRPKHJvdylcblxuICAgICAgLy8gUHVibGlzaCB0byBTU0Ugc3RyZWFtXG4gICAgICBwdWJsaXNoQWN0aXZpdHkoZHRvKVxuXG4gICAgICByZXR1cm4gZHRvXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrQWN0aXZpdGllc1JlcG8oKTogQWN0aXZpdGllc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycywgcGFnaW5hdGlvbj86IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBY3Rpdml0aWVzXVxuICAgICAgaWYgKGZpbHRlcnM/LmVudGl0eVR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS5lbnRpdHlUeXBlID09PSBmaWx0ZXJzLmVudGl0eVR5cGUpXG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVycz8uZW50aXR5SWQpIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gYS5lbnRpdHlJZCA9PT0gZmlsdGVycy5lbnRpdHlJZClcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy50eXBlKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IGEudHlwZSA9PT0gZmlsdGVycy50eXBlKVxuICAgICAgfVxuICAgICAgLy8gU29ydCBieSB0aW1lc3RhbXAgZGVzY2VuZGluZ1xuICAgICAgcmVzdWx0LnNvcnQoKGEsIGIpID0+IGIudHMuZ2V0VGltZSgpIC0gYS50cy5nZXRUaW1lKCkpXG4gICAgICAvLyBBcHBseSBwYWdpbmF0aW9uXG4gICAgICBjb25zdCBvZmZzZXQgPSBwYWdpbmF0aW9uPy5vZmZzZXQgPz8gMFxuICAgICAgY29uc3QgbGltaXQgPSBwYWdpbmF0aW9uPy5saW1pdCA/PyA1MFxuICAgICAgcmV0dXJuIHJlc3VsdC5zbGljZShvZmZzZXQsIG9mZnNldCArIGxpbWl0KS5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWN0aXZpdHkgPSBtb2NrQWN0aXZpdGllcy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhY3Rpdml0eSA/IG1vY2tUb0RUTyhhY3Rpdml0eSkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RSZWNlbnQobGltaXQgPSAyMCk6IFByb21pc2U8QWN0aXZpdHlEVE9bXT4ge1xuICAgICAgcmV0dXJuIFsuLi5tb2NrQWN0aXZpdGllc11cbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIudHMuZ2V0VGltZSgpIC0gYS50cy5nZXRUaW1lKCkpXG4gICAgICAgIC5zbGljZSgwLCBsaW1pdClcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JFbnRpdHkoZW50aXR5VHlwZTogc3RyaW5nLCBlbnRpdHlJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpdml0eURUT1tdPiB7XG4gICAgICByZXR1cm4gbW9ja0FjdGl2aXRpZXNcbiAgICAgICAgLmZpbHRlcigoYSkgPT4gYS5lbnRpdHlUeXBlID09PSBlbnRpdHlUeXBlICYmIGEuZW50aXR5SWQgPT09IGVudGl0eUlkKVxuICAgICAgICAubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVBY3Rpdml0eUlucHV0KTogUHJvbWlzZTxBY3Rpdml0eURUTz4ge1xuICAgICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiBqdXN0IHJldHVybnMgdGhlIGNyZWF0ZWQgYWN0aXZpdHkgd2l0aG91dCBwZXJzaXN0aW5nXG4gICAgICBjb25zdCBpZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgIGNvbnN0IGR0bzogQWN0aXZpdHlEVE8gPSB7XG4gICAgICAgIGlkLFxuICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgdHlwZTogaW5wdXQudHlwZSxcbiAgICAgICAgYWN0b3I6IGlucHV0LmFjdG9yLFxuICAgICAgICBlbnRpdHlUeXBlOiBpbnB1dC5lbnRpdHlUeXBlLFxuICAgICAgICBlbnRpdHlJZDogaW5wdXQuZW50aXR5SWQsXG4gICAgICAgIHN1bW1hcnk6IGlucHV0LnN1bW1hcnksXG4gICAgICAgIHBheWxvYWRKc29uOiBpbnB1dC5wYXlsb2FkSnNvbiA/PyB7fSxcbiAgICAgIH1cblxuICAgICAgLy8gUHVibGlzaCB0byBTU0Ugc3RyZWFtXG4gICAgICBwdWJsaXNoQWN0aXZpdHkoZHRvKVxuXG4gICAgICByZXR1cm4gZHRvXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFjdGl2aXR5RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5lbnRpdHlUeXBlKSB7XG4gICAgd2hlcmUuZW50aXR5VHlwZSA9IGZpbHRlcnMuZW50aXR5VHlwZVxuICB9XG4gIGlmIChmaWx0ZXJzLmVudGl0eUlkKSB7XG4gICAgd2hlcmUuZW50aXR5SWQgPSBmaWx0ZXJzLmVudGl0eUlkXG4gIH1cbiAgaWYgKGZpbHRlcnMudHlwZSkge1xuICAgIHdoZXJlLnR5cGUgPSBmaWx0ZXJzLnR5cGVcbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgdHM6IERhdGVcbiAgdHlwZTogc3RyaW5nXG4gIGFjdG9yOiBzdHJpbmdcbiAgZW50aXR5VHlwZTogc3RyaW5nXG4gIGVudGl0eUlkOiBzdHJpbmdcbiAgc3VtbWFyeTogc3RyaW5nXG4gIHBheWxvYWRKc29uOiBzdHJpbmdcbn0pOiBBY3Rpdml0eURUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICB0czogcm93LnRzLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIGFjdG9yOiByb3cuYWN0b3IsXG4gICAgZW50aXR5VHlwZTogcm93LmVudGl0eVR5cGUsXG4gICAgZW50aXR5SWQ6IHJvdy5lbnRpdHlJZCxcbiAgICBzdW1tYXJ5OiByb3cuc3VtbWFyeSxcbiAgICBwYXlsb2FkSnNvbjogSlNPTi5wYXJzZShyb3cucGF5bG9hZEpzb24pLFxuICB9XG59XG5cbmZ1bmN0aW9uIG1vY2tUb0RUTyhhY3Rpdml0eTogdHlwZW9mIG1vY2tBY3Rpdml0aWVzW251bWJlcl0pOiBBY3Rpdml0eURUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFjdGl2aXR5LmlkLFxuICAgIHRzOiBhY3Rpdml0eS50cyxcbiAgICB0eXBlOiBhY3Rpdml0eS50eXBlLFxuICAgIGFjdG9yOiBhY3Rpdml0eS5hY3RvcixcbiAgICBlbnRpdHlUeXBlOiBhY3Rpdml0eS5lbnRpdHlUeXBlLFxuICAgIGVudGl0eUlkOiBhY3Rpdml0eS5lbnRpdHlJZCxcbiAgICBzdW1tYXJ5OiBhY3Rpdml0eS5zdW1tYXJ5LFxuICAgIHBheWxvYWRKc29uOiBhY3Rpdml0eS5wYXlsb2FkSnNvbiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm1vY2tBY3Rpdml0aWVzIiwicHVibGlzaEFjdGl2aXR5IiwiY3JlYXRlRGJBY3Rpdml0aWVzUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwicGFnaW5hdGlvbiIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJhY3Rpdml0eSIsImZpbmRNYW55Iiwib3JkZXJCeSIsInRzIiwidGFrZSIsImxpbWl0Iiwic2tpcCIsIm9mZnNldCIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsImxpc3RSZWNlbnQiLCJsaXN0Rm9yRW50aXR5IiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiY3JlYXRlIiwiaW5wdXQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic2xpY2UiLCJkYXRhIiwidHlwZSIsImFjdG9yIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImR0byIsImNyZWF0ZU1vY2tBY3Rpdml0aWVzUmVwbyIsInJlc3VsdCIsImZpbHRlciIsImEiLCJzb3J0IiwiYiIsImdldFRpbWUiLCJtb2NrVG9EVE8iLCJmaW5kIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/activities.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:280:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbAgentsRepo: () => (/* binding */ createDbAgentsRepo),\n/* harmony export */   createMockAgentsRepo: () => (/* binding */ createMockAgentsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(instrument)/../../packages/core/src/index.ts\");\n/**\n * Agents Repository\n *\n * Provides data access for agents with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbAgentsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findMany({\n                where,\n                orderBy: {\n                    name: 'asc'\n                }\n            });\n            return rows.map((row)=>toDTO(row));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    sessionKey\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.create({\n                data: {\n                    name: input.name,\n                    role: input.role,\n                    station: input.station,\n                    status: 'idle',\n                    sessionKey: input.sessionKey,\n                    capabilities: JSON.stringify(input.capabilities),\n                    wipLimit: input.wipLimit ?? 2\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Build update data, casting to any to handle fields not in generated client\n            const updateData = {\n                lastSeenAt: new Date()\n            };\n            if (input.status !== undefined) updateData.status = input.status;\n            if (input.name !== undefined) updateData.name = input.name;\n            if (input.role !== undefined) updateData.role = input.role;\n            if (input.station !== undefined) updateData.station = input.station;\n            if (input.capabilities !== undefined) updateData.capabilities = JSON.stringify(input.capabilities);\n            if (input.wipLimit !== undefined) updateData.wipLimit = input.wipLimit;\n            if (input.sessionKey !== undefined) updateData.sessionKey = input.sessionKey;\n            if (input.avatarPath !== undefined) updateData.avatarPath = input.avatarPath;\n            if (input.model !== undefined) updateData.model = input.model;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.agent.update({\n                where: {\n                    id\n                },\n                data: updateData\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockAgentsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((a)=>stations.includes(a.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getByName (name) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.name === name);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async getBySessionKey (sessionKey) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.sessionKey === sessionKey);\n            return agent ? mockToDTO(agent) : null;\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const a of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents){\n                counts[a.status] = (counts[a.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const now = new Date();\n            const id = `agent_${(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.length + 1).toString().padStart(2, '0')}`;\n            const newAgent = {\n                id,\n                name: input.name,\n                role: input.role,\n                station: input.station,\n                status: 'idle',\n                sessionKey: input.sessionKey,\n                capabilities: input.capabilities,\n                wipLimit: input.wipLimit ?? 2,\n                lastSeenAt: null,\n                lastHeartbeatAt: null,\n                createdAt: now,\n                updatedAt: now\n            };\n            // Add to mock array (in real implementation this would be persistent)\n            _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.push(newAgent);\n            return mockToDTO(newAgent);\n        },\n        async update (id, input) {\n            const agent = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockAgents.find((a)=>a.id === id);\n            if (!agent) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(agent),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                lastSeenAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        role: row.role,\n        station: row.station,\n        status: row.status,\n        sessionKey: row.sessionKey,\n        capabilities: JSON.parse(row.capabilities),\n        wipLimit: row.wipLimit,\n        avatarPath: row.avatarPath ?? null,\n        model: row.model ?? null,\n        lastSeenAt: row.lastSeenAt,\n        lastHeartbeatAt: row.lastHeartbeatAt,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(agent) {\n    return {\n        id: agent.id,\n        name: agent.name,\n        role: agent.role,\n        station: agent.station,\n        status: agent.status,\n        sessionKey: agent.sessionKey,\n        capabilities: agent.capabilities,\n        wipLimit: agent.wipLimit,\n        avatarPath: null,\n        model: 'claude-sonnet-4-20250514',\n        lastSeenAt: agent.lastSeenAt,\n        lastHeartbeatAt: agent.lastHeartbeatAt,\n        createdAt: agent.createdAt,\n        updatedAt: agent.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGluc3RydW1lbnQpLy4vbGliL3JlcG8vYWdlbnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztDQUlDLEdBRTZCO0FBQ2dCO0FBeUM5QywrRUFBK0U7QUFDL0UsMEJBQTBCO0FBQzFCLCtFQUErRTtBQUV4RSxTQUFTRTtJQUNkLE9BQU87UUFDTCxNQUFNQyxNQUFLQyxPQUFzQjtZQUMvQixNQUFNQyxRQUFRQyxXQUFXRjtZQUN6QixNQUFNRyxPQUFPLE1BQU1QLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNDLFFBQVEsQ0FBQztnQkFDdkNKO2dCQUNBSyxTQUFTO29CQUFFQyxNQUFNO2dCQUFNO1lBQ3pCO1lBQ0EsT0FBT0osS0FBS0ssR0FBRyxDQUFDLENBQUNDLE1BQVFDLE1BQU1EO1FBQ2pDO1FBRUEsTUFBTUUsU0FBUUMsRUFBVTtZQUN0QixNQUFNSCxNQUFNLE1BQU1iLHVDQUFNQSxDQUFDUSxLQUFLLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVc7Z0JBQUc7WUFBRTtZQUMxRCxPQUFPSCxNQUFNQyxNQUFNRCxPQUFvQztRQUN6RDtRQUVBLE1BQU1LLFdBQVVQLElBQVk7WUFDMUIsTUFBTUUsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDUyxVQUFVLENBQUM7Z0JBQUVaLE9BQU87b0JBQUVNO2dCQUFLO1lBQUU7WUFDNUQsT0FBT0UsTUFBTUMsTUFBTUQsT0FBb0M7UUFDekQ7UUFFQSxNQUFNTSxpQkFBZ0JDLFVBQWtCO1lBQ3RDLE1BQU1QLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNRLEtBQUssQ0FBQ1MsVUFBVSxDQUFDO2dCQUFFWixPQUFPO29CQUFFZTtnQkFBVztZQUFFO1lBQ2xFLE9BQU9QLE1BQU1DLE1BQU1ELE9BQW9DO1FBQ3pEO1FBRUEsTUFBTVE7WUFDSixNQUFNQyxTQUFTLE1BQU10Qix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDZSxPQUFPLENBQUM7Z0JBQ3hDQyxJQUFJO29CQUFDO2lCQUFTO2dCQUNkQyxRQUFRO29CQUFFVCxJQUFJO2dCQUFLO1lBQ3JCO1lBQ0EsT0FBT1UsT0FBT0MsV0FBVyxDQUN2QkwsT0FBT1YsR0FBRyxDQUFDLENBQUNnQixJQUFNO29CQUFDQSxFQUFFQyxNQUFNO29CQUFFRCxFQUFFSCxNQUFNLENBQUNULEVBQUU7aUJBQUM7UUFFN0M7UUFFQSxNQUFNYyxRQUFPQyxLQUF1QjtZQUNsQyxNQUFNbEIsTUFBTSxNQUFNYix1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDc0IsTUFBTSxDQUFDO2dCQUNwQ0UsTUFBTTtvQkFDSnJCLE1BQU1vQixNQUFNcEIsSUFBSTtvQkFDaEJzQixNQUFNRixNQUFNRSxJQUFJO29CQUNoQkMsU0FBU0gsTUFBTUcsT0FBTztvQkFDdEJMLFFBQVE7b0JBQ1JULFlBQVlXLE1BQU1YLFVBQVU7b0JBQzVCZSxjQUFjQyxLQUFLQyxTQUFTLENBQUNOLE1BQU1JLFlBQVk7b0JBQy9DRyxVQUFVUCxNQUFNTyxRQUFRLElBQUk7Z0JBQzlCO1lBQ0Y7WUFDQSxPQUFPeEIsTUFBTUQ7UUFDZjtRQUVBLE1BQU0wQixRQUFPdkIsRUFBVSxFQUFFZSxLQUF1QjtZQUM5QyxNQUFNUyxXQUFXLE1BQU14Qyx1Q0FBTUEsQ0FBQ1EsS0FBSyxDQUFDUyxVQUFVLENBQUM7Z0JBQUVaLE9BQU87b0JBQUVXO2dCQUFHO1lBQUU7WUFDL0QsSUFBSSxDQUFDd0IsVUFBVSxPQUFPO1lBRXRCLDZFQUE2RTtZQUM3RSxNQUFNQyxhQUFzQztnQkFDMUNDLFlBQVksSUFBSUM7WUFDbEI7WUFDQSxJQUFJWixNQUFNRixNQUFNLEtBQUtlLFdBQVdILFdBQVdaLE1BQU0sR0FBR0UsTUFBTUYsTUFBTTtZQUNoRSxJQUFJRSxNQUFNcEIsSUFBSSxLQUFLaUMsV0FBV0gsV0FBVzlCLElBQUksR0FBR29CLE1BQU1wQixJQUFJO1lBQzFELElBQUlvQixNQUFNRSxJQUFJLEtBQUtXLFdBQVdILFdBQVdSLElBQUksR0FBR0YsTUFBTUUsSUFBSTtZQUMxRCxJQUFJRixNQUFNRyxPQUFPLEtBQUtVLFdBQVdILFdBQVdQLE9BQU8sR0FBR0gsTUFBTUcsT0FBTztZQUNuRSxJQUFJSCxNQUFNSSxZQUFZLEtBQUtTLFdBQVdILFdBQVdOLFlBQVksR0FBR0MsS0FBS0MsU0FBUyxDQUFDTixNQUFNSSxZQUFZO1lBQ2pHLElBQUlKLE1BQU1PLFFBQVEsS0FBS00sV0FBV0gsV0FBV0gsUUFBUSxHQUFHUCxNQUFNTyxRQUFRO1lBQ3RFLElBQUlQLE1BQU1YLFVBQVUsS0FBS3dCLFdBQVdILFdBQVdyQixVQUFVLEdBQUdXLE1BQU1YLFVBQVU7WUFDNUUsSUFBSVcsTUFBTWMsVUFBVSxLQUFLRCxXQUFXSCxXQUFXSSxVQUFVLEdBQUdkLE1BQU1jLFVBQVU7WUFDNUUsSUFBSWQsTUFBTWUsS0FBSyxLQUFLRixXQUFXSCxXQUFXSyxLQUFLLEdBQUdmLE1BQU1lLEtBQUs7WUFFN0QsTUFBTWpDLE1BQU0sTUFBTWIsdUNBQU1BLENBQUNRLEtBQUssQ0FBQytCLE1BQU0sQ0FBQztnQkFDcENsQyxPQUFPO29CQUFFVztnQkFBRztnQkFDWmdCLE1BQU1TO1lBQ1I7WUFFQSxPQUFPM0IsTUFBTUQ7UUFDZjtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0Usc0JBQXNCO0FBQ3RCLCtFQUErRTtBQUV4RSxTQUFTa0M7SUFDZCxPQUFPO1FBQ0wsTUFBTTVDLE1BQUtDLE9BQXNCO1lBQy9CLElBQUk0QyxTQUFTO21CQUFJL0MseURBQVVBO2FBQUM7WUFDNUIsSUFBSUcsU0FBU3lCLFFBQVE7Z0JBQ25CLE1BQU1vQixXQUFXQyxNQUFNQyxPQUFPLENBQUMvQyxRQUFReUIsTUFBTSxJQUFJekIsUUFBUXlCLE1BQU0sR0FBRztvQkFBQ3pCLFFBQVF5QixNQUFNO2lCQUFDO2dCQUNsRm1CLFNBQVNBLE9BQU9JLE1BQU0sQ0FBQyxDQUFDQyxJQUFNSixTQUFTSyxRQUFRLENBQUNELEVBQUV4QixNQUFNO1lBQzFEO1lBQ0EsSUFBSXpCLFNBQVM4QixTQUFTO2dCQUNwQixNQUFNcUIsV0FBV0wsTUFBTUMsT0FBTyxDQUFDL0MsUUFBUThCLE9BQU8sSUFBSTlCLFFBQVE4QixPQUFPLEdBQUc7b0JBQUM5QixRQUFROEIsT0FBTztpQkFBQztnQkFDckZjLFNBQVNBLE9BQU9JLE1BQU0sQ0FBQyxDQUFDQyxJQUFNRSxTQUFTRCxRQUFRLENBQUNELEVBQUVuQixPQUFPO1lBQzNEO1lBQ0EsT0FBT2MsT0FBT3BDLEdBQUcsQ0FBQzRDO1FBQ3BCO1FBRUEsTUFBTXpDLFNBQVFDLEVBQVU7WUFDdEIsTUFBTVIsUUFBUVAseURBQVVBLENBQUN3RCxJQUFJLENBQUMsQ0FBQ0osSUFBTUEsRUFBRXJDLEVBQUUsS0FBS0E7WUFDOUMsT0FBT1IsUUFBUWdELFVBQVVoRCxTQUFTO1FBQ3BDO1FBRUEsTUFBTVUsV0FBVVAsSUFBWTtZQUMxQixNQUFNSCxRQUFRUCx5REFBVUEsQ0FBQ3dELElBQUksQ0FBQyxDQUFDSixJQUFNQSxFQUFFMUMsSUFBSSxLQUFLQTtZQUNoRCxPQUFPSCxRQUFRZ0QsVUFBVWhELFNBQVM7UUFDcEM7UUFFQSxNQUFNVyxpQkFBZ0JDLFVBQWtCO1lBQ3RDLE1BQU1aLFFBQVFQLHlEQUFVQSxDQUFDd0QsSUFBSSxDQUFDLENBQUNKLElBQU1BLEVBQUVqQyxVQUFVLEtBQUtBO1lBQ3RELE9BQU9aLFFBQVFnRCxVQUFVaEQsU0FBUztRQUNwQztRQUVBLE1BQU1hO1lBQ0osTUFBTXFDLFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNTCxLQUFLcEQseURBQVVBLENBQUU7Z0JBQzFCeUQsTUFBTSxDQUFDTCxFQUFFeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQzZCLE1BQU0sQ0FBQ0wsRUFBRXhCLE1BQU0sQ0FBQyxJQUFJLEtBQUs7WUFDL0M7WUFDQSxPQUFPNkI7UUFDVDtRQUVBLE1BQU01QixRQUFPQyxLQUF1QjtZQUNsQyxNQUFNNEIsTUFBTSxJQUFJaEI7WUFDaEIsTUFBTTNCLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQ2YseURBQVVBLENBQUMyRCxNQUFNLEdBQUcsR0FBR0MsUUFBUSxHQUFHQyxRQUFRLENBQUMsR0FBRyxNQUFNO1lBRXpFLE1BQU1DLFdBQVc7Z0JBQ2YvQztnQkFDQUwsTUFBTW9CLE1BQU1wQixJQUFJO2dCQUNoQnNCLE1BQU1GLE1BQU1FLElBQUk7Z0JBQ2hCQyxTQUFTSCxNQUFNRyxPQUFPO2dCQUN0QkwsUUFBUTtnQkFDUlQsWUFBWVcsTUFBTVgsVUFBVTtnQkFDNUJlLGNBQWNKLE1BQU1JLFlBQVk7Z0JBQ2hDRyxVQUFVUCxNQUFNTyxRQUFRLElBQUk7Z0JBQzVCSSxZQUFZO2dCQUNac0IsaUJBQWlCO2dCQUNqQkMsV0FBV047Z0JBQ1hPLFdBQVdQO1lBQ2I7WUFFQSxzRUFBc0U7WUFDdEUxRCx5REFBVUEsQ0FBQ2tFLElBQUksQ0FBQ0o7WUFFaEIsT0FBT1AsVUFBVU87UUFDbkI7UUFFQSxNQUFNeEIsUUFBT3ZCLEVBQVUsRUFBRWUsS0FBdUI7WUFDOUMsTUFBTXZCLFFBQVFQLHlEQUFVQSxDQUFDd0QsSUFBSSxDQUFDLENBQUNKLElBQU1BLEVBQUVyQyxFQUFFLEtBQUtBO1lBQzlDLElBQUksQ0FBQ1IsT0FBTyxPQUFPO1lBRW5CLG1FQUFtRTtZQUNuRSxPQUFPO2dCQUNMLEdBQUdnRCxVQUFVaEQsTUFBTTtnQkFDbkIsR0FBSXVCLE1BQU1GLE1BQU0sS0FBS2UsYUFBYTtvQkFBRWYsUUFBUUUsTUFBTUYsTUFBTTtnQkFBdUIsQ0FBQztnQkFDaEZhLFlBQVksSUFBSUM7Z0JBQ2hCdUIsV0FBVyxJQUFJdkI7WUFDakI7UUFDRjtJQUNGO0FBQ0Y7QUFFQSwrRUFBK0U7QUFDL0UsVUFBVTtBQUNWLCtFQUErRTtBQUUvRSxTQUFTckMsV0FBV0YsT0FBc0I7SUFDeEMsSUFBSSxDQUFDQSxTQUFTLE9BQU8sQ0FBQztJQUN0QixNQUFNQyxRQUFpQyxDQUFDO0lBQ3hDLElBQUlELFFBQVF5QixNQUFNLEVBQUU7UUFDbEJ4QixNQUFNd0IsTUFBTSxHQUFHcUIsTUFBTUMsT0FBTyxDQUFDL0MsUUFBUXlCLE1BQU0sSUFBSTtZQUFFdUMsSUFBSWhFLFFBQVF5QixNQUFNO1FBQUMsSUFBSXpCLFFBQVF5QixNQUFNO0lBQ3hGO0lBQ0EsSUFBSXpCLFFBQVE4QixPQUFPLEVBQUU7UUFDbkI3QixNQUFNNkIsT0FBTyxHQUFHZ0IsTUFBTUMsT0FBTyxDQUFDL0MsUUFBUThCLE9BQU8sSUFBSTtZQUFFa0MsSUFBSWhFLFFBQVE4QixPQUFPO1FBQUMsSUFBSTlCLFFBQVE4QixPQUFPO0lBQzVGO0lBQ0EsT0FBTzdCO0FBQ1Q7QUFvQkEsU0FBU1MsTUFBTUQsR0FBbUI7SUFDaEMsT0FBTztRQUNMRyxJQUFJSCxJQUFJRyxFQUFFO1FBQ1ZMLE1BQU1FLElBQUlGLElBQUk7UUFDZHNCLE1BQU1wQixJQUFJb0IsSUFBSTtRQUNkQyxTQUFTckIsSUFBSXFCLE9BQU87UUFDcEJMLFFBQVFoQixJQUFJZ0IsTUFBTTtRQUNsQlQsWUFBWVAsSUFBSU8sVUFBVTtRQUMxQmUsY0FBY0MsS0FBS2lDLEtBQUssQ0FBQ3hELElBQUlzQixZQUFZO1FBQ3pDRyxVQUFVekIsSUFBSXlCLFFBQVE7UUFDdEJPLFlBQVloQyxJQUFJZ0MsVUFBVSxJQUFJO1FBQzlCQyxPQUFPakMsSUFBSWlDLEtBQUssSUFBSTtRQUNwQkosWUFBWTdCLElBQUk2QixVQUFVO1FBQzFCc0IsaUJBQWlCbkQsSUFBSW1ELGVBQWU7UUFDcENDLFdBQVdwRCxJQUFJb0QsU0FBUztRQUN4QkMsV0FBV3JELElBQUlxRCxTQUFTO0lBQzFCO0FBQ0Y7QUFFQSxTQUFTVixVQUFVaEQsS0FBZ0M7SUFDakQsT0FBTztRQUNMUSxJQUFJUixNQUFNUSxFQUFFO1FBQ1pMLE1BQU1ILE1BQU1HLElBQUk7UUFDaEJzQixNQUFNekIsTUFBTXlCLElBQUk7UUFDaEJDLFNBQVMxQixNQUFNMEIsT0FBTztRQUN0QkwsUUFBUXJCLE1BQU1xQixNQUFNO1FBQ3BCVCxZQUFZWixNQUFNWSxVQUFVO1FBQzVCZSxjQUFjM0IsTUFBTTJCLFlBQVk7UUFDaENHLFVBQVU5QixNQUFNOEIsUUFBUTtRQUN4Qk8sWUFBWTtRQUNaQyxPQUFPO1FBQ1BKLFlBQVlsQyxNQUFNa0MsVUFBVTtRQUM1QnNCLGlCQUFpQnhELE1BQU13RCxlQUFlO1FBQ3RDQyxXQUFXekQsTUFBTXlELFNBQVM7UUFDMUJDLFdBQVcxRCxNQUFNMEQsU0FBUztJQUM1QjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2F2b3Jnc2VydmVyL2NsYXdkL3Byb2plY3RzL3Nhdk9SRy9hcHBzL2NsYXdjb250cm9sL2xpYi9yZXBvL2FnZW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFnZW50cyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIGFnZW50cyB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL2RiJ1xuaW1wb3J0IHsgbW9ja0FnZW50cyB9IGZyb20gJ0BjbGF3Y29udHJvbC9jb3JlJ1xuaW1wb3J0IHR5cGUgeyBBZ2VudERUTywgQWdlbnRGaWx0ZXJzIH0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVBZ2VudElucHV0IHtcbiAgc3RhdHVzPzogc3RyaW5nXG4gIGN1cnJlbnRXb3JrT3JkZXJJZD86IHN0cmluZyB8IG51bGxcblxuICAvLyBBZG1pbi1lZGl0YWJsZSBmaWVsZHNcbiAgbmFtZT86IHN0cmluZ1xuICByb2xlPzogc3RyaW5nXG4gIHN0YXRpb24/OiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzPzogUmVjb3JkPHN0cmluZywgYm9vbGVhbj5cbiAgd2lwTGltaXQ/OiBudW1iZXJcbiAgc2Vzc2lvbktleT86IHN0cmluZ1xuICBhdmF0YXJQYXRoPzogc3RyaW5nIHwgbnVsbFxuICBtb2RlbD86IHN0cmluZyB8IG51bGxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBZ2VudElucHV0IHtcbiAgbmFtZTogc3RyaW5nXG4gIHJvbGU6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgc2Vzc2lvbktleTogc3RyaW5nXG4gIGNhcGFiaWxpdGllczogUmVjb3JkPHN0cmluZywgYm9vbGVhbj5cbiAgd2lwTGltaXQ/OiBudW1iZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBZ2VudHNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogQWdlbnRGaWx0ZXJzKTogUHJvbWlzZTxBZ2VudERUT1tdPlxuICBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbiAgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPlxuICBnZXRCeVNlc3Npb25LZXkoc2Vzc2lvbktleTogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+XG4gIGNvdW50QnlTdGF0dXMoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PlxuICBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiQWdlbnRzUmVwbygpOiBBZ2VudHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBZ2VudEZpbHRlcnMpOiBQcm9taXNlPEFnZW50RFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IG5hbWU6ICdhc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKChyb3cpID0+IHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5hZ2VudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IG5hbWUgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlTZXNzaW9uS2V5KHNlc3Npb25LZXk6IHN0cmluZyk6IFByb21pc2U8QWdlbnREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYWdlbnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IHNlc3Npb25LZXkgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdyBhcyB1bmtub3duIGFzIFByaXNtYUFnZW50Um93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IHByaXNtYS5hZ2VudC5ncm91cEJ5KHtcbiAgICAgICAgYnk6IFsnc3RhdHVzJ10sXG4gICAgICAgIF9jb3VudDogeyBpZDogdHJ1ZSB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIGdyb3Vwcy5tYXAoKGcpID0+IFtnLnN0YXR1cywgZy5fY291bnQuaWRdKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYWdlbnQuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG5hbWU6IGlucHV0Lm5hbWUsXG4gICAgICAgICAgcm9sZTogaW5wdXQucm9sZSxcbiAgICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uLFxuICAgICAgICAgIHN0YXR1czogJ2lkbGUnLFxuICAgICAgICAgIHNlc3Npb25LZXk6IGlucHV0LnNlc3Npb25LZXksXG4gICAgICAgICAgY2FwYWJpbGl0aWVzOiBKU09OLnN0cmluZ2lmeShpbnB1dC5jYXBhYmlsaXRpZXMpLFxuICAgICAgICAgIHdpcExpbWl0OiBpbnB1dC53aXBMaW1pdCA/PyAyLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cgYXMgdW5rbm93biBhcyBQcmlzbWFBZ2VudFJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVBZ2VudElucHV0KTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLmFnZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICAvLyBCdWlsZCB1cGRhdGUgZGF0YSwgY2FzdGluZyB0byBhbnkgdG8gaGFuZGxlIGZpZWxkcyBub3QgaW4gZ2VuZXJhdGVkIGNsaWVudFxuICAgICAgY29uc3QgdXBkYXRlRGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7XG4gICAgICAgIGxhc3RTZWVuQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgICBpZiAoaW5wdXQuc3RhdHVzICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3RhdHVzID0gaW5wdXQuc3RhdHVzXG4gICAgICBpZiAoaW5wdXQubmFtZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLm5hbWUgPSBpbnB1dC5uYW1lXG4gICAgICBpZiAoaW5wdXQucm9sZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnJvbGUgPSBpbnB1dC5yb2xlXG4gICAgICBpZiAoaW5wdXQuc3RhdGlvbiAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnN0YXRpb24gPSBpbnB1dC5zdGF0aW9uXG4gICAgICBpZiAoaW5wdXQuY2FwYWJpbGl0aWVzICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuY2FwYWJpbGl0aWVzID0gSlNPTi5zdHJpbmdpZnkoaW5wdXQuY2FwYWJpbGl0aWVzKVxuICAgICAgaWYgKGlucHV0LndpcExpbWl0ICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEud2lwTGltaXQgPSBpbnB1dC53aXBMaW1pdFxuICAgICAgaWYgKGlucHV0LnNlc3Npb25LZXkgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5zZXNzaW9uS2V5ID0gaW5wdXQuc2Vzc2lvbktleVxuICAgICAgaWYgKGlucHV0LmF2YXRhclBhdGggIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5hdmF0YXJQYXRoID0gaW5wdXQuYXZhdGFyUGF0aFxuICAgICAgaWYgKGlucHV0Lm1vZGVsICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubW9kZWwgPSBpbnB1dC5tb2RlbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYWdlbnQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YTogdXBkYXRlRGF0YSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cgYXMgdW5rbm93biBhcyBQcmlzbWFBZ2VudFJvdylcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tBZ2VudHNSZXBvKCk6IEFnZW50c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IEFnZW50RmlsdGVycyk6IFByb21pc2U8QWdlbnREVE9bXT4ge1xuICAgICAgbGV0IHJlc3VsdCA9IFsuLi5tb2NrQWdlbnRzXVxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXR1cykge1xuICAgICAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0dXMpID8gZmlsdGVycy5zdGF0dXMgOiBbZmlsdGVycy5zdGF0dXNdXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IHN0YXR1c2VzLmluY2x1ZGVzKGEuc3RhdHVzKSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IHN0YXRpb25zID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8gZmlsdGVycy5zdGF0aW9uIDogW2ZpbHRlcnMuc3RhdGlvbl1cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdGlvbnMuaW5jbHVkZXMoYS5zdGF0aW9uKSlcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBZ2VudERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGFnZW50ID0gbW9ja0FnZW50cy5maW5kKChhKSA9PiBhLmlkID09PSBpZClcbiAgICAgIHJldHVybiBhZ2VudCA/IG1vY2tUb0RUTyhhZ2VudCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEubmFtZSA9PT0gbmFtZSlcbiAgICAgIHJldHVybiBhZ2VudCA/IG1vY2tUb0RUTyhhZ2VudCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5U2Vzc2lvbktleShzZXNzaW9uS2V5OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuc2Vzc2lvbktleSA9PT0gc2Vzc2lvbktleSlcbiAgICAgIHJldHVybiBhZ2VudCA/IG1vY2tUb0RUTyhhZ2VudCkgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0dXMoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBjb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fVxuICAgICAgZm9yIChjb25zdCBhIG9mIG1vY2tBZ2VudHMpIHtcbiAgICAgICAgY291bnRzW2Euc3RhdHVzXSA9IChjb3VudHNbYS5zdGF0dXNdIHx8IDApICsgMVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvdW50c1xuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPPiB7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICBjb25zdCBpZCA9IGBhZ2VudF8keyhtb2NrQWdlbnRzLmxlbmd0aCArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gXG5cbiAgICAgIGNvbnN0IG5ld0FnZW50ID0ge1xuICAgICAgICBpZCxcbiAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgcm9sZTogaW5wdXQucm9sZSxcbiAgICAgICAgc3RhdGlvbjogaW5wdXQuc3RhdGlvbiBhcyAnc3BlYycgfCAnYnVpbGQnIHwgJ3FhJyB8ICdvcHMnIHwgJ3VwZGF0ZScgfCAnc2hpcCcgfCAnY29tcG91bmQnLFxuICAgICAgICBzdGF0dXM6ICdpZGxlJyBhcyBjb25zdCxcbiAgICAgICAgc2Vzc2lvbktleTogaW5wdXQuc2Vzc2lvbktleSxcbiAgICAgICAgY2FwYWJpbGl0aWVzOiBpbnB1dC5jYXBhYmlsaXRpZXMsXG4gICAgICAgIHdpcExpbWl0OiBpbnB1dC53aXBMaW1pdCA/PyAyLFxuICAgICAgICBsYXN0U2VlbkF0OiBudWxsLFxuICAgICAgICBsYXN0SGVhcnRiZWF0QXQ6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIHRvIG1vY2sgYXJyYXkgKGluIHJlYWwgaW1wbGVtZW50YXRpb24gdGhpcyB3b3VsZCBiZSBwZXJzaXN0ZW50KVxuICAgICAgbW9ja0FnZW50cy5wdXNoKG5ld0FnZW50KVxuXG4gICAgICByZXR1cm4gbW9ja1RvRFRPKG5ld0FnZW50KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFnZW50SW5wdXQpOiBQcm9taXNlPEFnZW50RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYWdlbnQgPSBtb2NrQWdlbnRzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgaWYgKCFhZ2VudCkgcmV0dXJuIG51bGxcblxuICAgICAgLy8gSW4gbW9jayBtb2RlLCB3ZSBkb24ndCBhY3R1YWxseSBtdXRhdGUgLSBqdXN0IHJldHVybiB1cGRhdGVkIERUT1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ubW9ja1RvRFRPKGFnZW50KSxcbiAgICAgICAgLi4uKGlucHV0LnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdHVzOiBpbnB1dC5zdGF0dXMgYXMgQWdlbnREVE9bJ3N0YXR1cyddIH0pLFxuICAgICAgICBsYXN0U2VlbkF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVJTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIGJ1aWxkV2hlcmUoZmlsdGVycz86IEFnZW50RmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IHsgaW46IGZpbHRlcnMuc3RhdHVzIH0gOiBmaWx0ZXJzLnN0YXR1c1xuICB9XG4gIGlmIChmaWx0ZXJzLnN0YXRpb24pIHtcbiAgICB3aGVyZS5zdGF0aW9uID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8geyBpbjogZmlsdGVycy5zdGF0aW9uIH0gOiBmaWx0ZXJzLnN0YXRpb25cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuLy8gRXh0ZW5kZWQgdHlwZSB0byBoYW5kbGUgbmV3IGZpZWxkcyB0aGF0IG1heSBub3QgYmUgaW4gZ2VuZXJhdGVkIFByaXNtYSBjbGllbnRcbmludGVyZmFjZSBQcmlzbWFBZ2VudFJvdyB7XG4gIGlkOiBzdHJpbmdcbiAgbmFtZTogc3RyaW5nXG4gIHJvbGU6IHN0cmluZ1xuICBzdGF0aW9uOiBzdHJpbmdcbiAgc3RhdHVzOiBzdHJpbmdcbiAgc2Vzc2lvbktleTogc3RyaW5nXG4gIGNhcGFiaWxpdGllczogc3RyaW5nXG4gIHdpcExpbWl0OiBudW1iZXJcbiAgYXZhdGFyUGF0aD86IHN0cmluZyB8IG51bGxcbiAgbW9kZWw/OiBzdHJpbmcgfCBudWxsXG4gIGxhc3RTZWVuQXQ6IERhdGUgfCBudWxsXG4gIGxhc3RIZWFydGJlYXRBdDogRGF0ZSB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IFByaXNtYUFnZW50Um93KTogQWdlbnREVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgbmFtZTogcm93Lm5hbWUsXG4gICAgcm9sZTogcm93LnJvbGUsXG4gICAgc3RhdGlvbjogcm93LnN0YXRpb24sXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIEFnZW50RFRPWydzdGF0dXMnXSxcbiAgICBzZXNzaW9uS2V5OiByb3cuc2Vzc2lvbktleSxcbiAgICBjYXBhYmlsaXRpZXM6IEpTT04ucGFyc2Uocm93LmNhcGFiaWxpdGllcyksXG4gICAgd2lwTGltaXQ6IHJvdy53aXBMaW1pdCxcbiAgICBhdmF0YXJQYXRoOiByb3cuYXZhdGFyUGF0aCA/PyBudWxsLFxuICAgIG1vZGVsOiByb3cubW9kZWwgPz8gbnVsbCxcbiAgICBsYXN0U2VlbkF0OiByb3cubGFzdFNlZW5BdCxcbiAgICBsYXN0SGVhcnRiZWF0QXQ6IHJvdy5sYXN0SGVhcnRiZWF0QXQsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgfVxufVxuXG5mdW5jdGlvbiBtb2NrVG9EVE8oYWdlbnQ6IHR5cGVvZiBtb2NrQWdlbnRzW251bWJlcl0pOiBBZ2VudERUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGFnZW50LmlkLFxuICAgIG5hbWU6IGFnZW50Lm5hbWUsXG4gICAgcm9sZTogYWdlbnQucm9sZSxcbiAgICBzdGF0aW9uOiBhZ2VudC5zdGF0aW9uLFxuICAgIHN0YXR1czogYWdlbnQuc3RhdHVzIGFzIEFnZW50RFRPWydzdGF0dXMnXSxcbiAgICBzZXNzaW9uS2V5OiBhZ2VudC5zZXNzaW9uS2V5LFxuICAgIGNhcGFiaWxpdGllczogYWdlbnQuY2FwYWJpbGl0aWVzLFxuICAgIHdpcExpbWl0OiBhZ2VudC53aXBMaW1pdCxcbiAgICBhdmF0YXJQYXRoOiBudWxsLCAvLyBNb2NrIGFnZW50cyBkb24ndCBoYXZlIGN1c3RvbSBhdmF0YXJzXG4gICAgbW9kZWw6ICdjbGF1ZGUtc29ubmV0LTQtMjAyNTA1MTQnLCAvLyBEZWZhdWx0IG1vZGVsIGZvciBtb2NrIGFnZW50c1xuICAgIGxhc3RTZWVuQXQ6IGFnZW50Lmxhc3RTZWVuQXQsXG4gICAgbGFzdEhlYXJ0YmVhdEF0OiBhZ2VudC5sYXN0SGVhcnRiZWF0QXQsXG4gICAgY3JlYXRlZEF0OiBhZ2VudC5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiBhZ2VudC51cGRhdGVkQXQsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJtb2NrQWdlbnRzIiwiY3JlYXRlRGJBZ2VudHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwiYWdlbnQiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJuYW1lIiwibWFwIiwicm93IiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJmaW5kVW5pcXVlIiwiZ2V0QnlOYW1lIiwiZ2V0QnlTZXNzaW9uS2V5Iiwic2Vzc2lvbktleSIsImNvdW50QnlTdGF0dXMiLCJncm91cHMiLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImciLCJzdGF0dXMiLCJjcmVhdGUiLCJpbnB1dCIsImRhdGEiLCJyb2xlIiwic3RhdGlvbiIsImNhcGFiaWxpdGllcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ3aXBMaW1pdCIsInVwZGF0ZSIsImV4aXN0aW5nIiwidXBkYXRlRGF0YSIsImxhc3RTZWVuQXQiLCJEYXRlIiwidW5kZWZpbmVkIiwiYXZhdGFyUGF0aCIsIm1vZGVsIiwiY3JlYXRlTW9ja0FnZW50c1JlcG8iLCJyZXN1bHQiLCJzdGF0dXNlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsImEiLCJpbmNsdWRlcyIsInN0YXRpb25zIiwibW9ja1RvRFRPIiwiZmluZCIsImNvdW50cyIsIm5vdyIsImxlbmd0aCIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJuZXdBZ2VudCIsImxhc3RIZWFydGJlYXRBdCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInB1c2giLCJpbiIsInBhcnNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/agents.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:290:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbApprovalsRepo: () => (/* binding */ createDbApprovalsRepo),\n/* harmony export */   createMockApprovalsRepo: () => (/* binding */ createMockApprovalsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(instrument)/../../packages/core/src/index.ts\");\n/**\n * Approvals Repository\n *\n * Provides data access for approvals with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbApprovalsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where,\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listPending () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findMany({\n                where: {\n                    status: 'pending'\n                },\n                orderBy: {\n                    createdAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countPending () {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.count({\n                where: {\n                    status: 'pending'\n                }\n            });\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    type: input.type,\n                    questionMd: input.questionMd,\n                    status: 'pending'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.approval.update({\n                where: {\n                    id\n                },\n                data: {\n                    status: input.status,\n                    resolvedBy: input.resolvedBy || 'user',\n                    resolvedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockApprovalsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals\n            ];\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((a)=>statuses.includes(a.status));\n            }\n            if (filters?.type) {\n                const types = Array.isArray(filters.type) ? filters.type : [\n                    filters.type\n                ];\n                result = result.filter((a)=>types.includes(a.type));\n            }\n            if (filters?.workOrderId) {\n                result = result.filter((a)=>a.workOrderId === filters.workOrderId);\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            return approval ? mockToDTO(approval) : null;\n        },\n        async listPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').map(mockToDTO);\n        },\n        async countPending () {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.filter((a)=>a.status === 'pending').length;\n        },\n        async create (input) {\n            const id = `apr_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                type: input.type,\n                questionMd: input.questionMd,\n                status: 'pending',\n                resolvedBy: null,\n                createdAt: now,\n                resolvedAt: null\n            };\n        },\n        async update (id, input) {\n            const approval = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockApprovals.find((a)=>a.id === id);\n            if (!approval) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(approval),\n                status: input.status,\n                resolvedBy: input.resolvedBy || 'user',\n                resolvedAt: new Date()\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.type) {\n        where.type = Array.isArray(filters.type) ? {\n            in: filters.type\n        } : filters.type;\n    }\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        type: row.type,\n        questionMd: row.questionMd,\n        status: row.status,\n        resolvedBy: row.resolvedBy,\n        createdAt: row.createdAt,\n        resolvedAt: row.resolvedAt\n    };\n}\nfunction mockToDTO(approval) {\n    return {\n        id: approval.id,\n        workOrderId: approval.workOrderId,\n        operationId: approval.operationId,\n        type: approval.type,\n        questionMd: approval.questionMd,\n        status: approval.status,\n        resolvedBy: approval.resolvedBy,\n        createdAt: approval.createdAt,\n        resolvedAt: approval.resolvedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUMxQnBCLFdBQVdLLElBQUlMLFNBQVM7UUFDeEJxQixZQUFZaEIsSUFBSWdCLFVBQVU7SUFDNUI7QUFDRjtBQUVBLFNBQVNXLFVBQVVuQyxRQUFzQztJQUN2RCxPQUFPO1FBQ0xPLElBQUlQLFNBQVNPLEVBQUU7UUFDZlUsYUFBYWpCLFNBQVNpQixXQUFXO1FBQ2pDQyxhQUFhbEIsU0FBU2tCLFdBQVc7UUFDakNDLE1BQU1uQixTQUFTbUIsSUFBSTtRQUNuQkMsWUFBWXBCLFNBQVNvQixVQUFVO1FBQy9CVCxRQUFRWCxTQUFTVyxNQUFNO1FBQ3ZCWSxZQUFZdkIsU0FBU3VCLFVBQVU7UUFDL0JwQixXQUFXSCxTQUFTRyxTQUFTO1FBQzdCcUIsWUFBWXhCLFNBQVN3QixVQUFVO0lBQ2pDO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vYXBwcm92YWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXBwcm92YWxzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3IgYXBwcm92YWxzIHdpdGggYm90aCBEQiBhbmQgbW9jayBpbXBsZW1lbnRhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgeyBtb2NrQXBwcm92YWxzIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IEFwcHJvdmFsRFRPLCBBcHByb3ZhbEZpbHRlcnMgfSBmcm9tICcuL3R5cGVzJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVBPU0lUT1JZIElOVEVSRkFDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUFwcHJvdmFsSW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIG9wZXJhdGlvbklkPzogc3RyaW5nIHwgbnVsbFxuICB0eXBlOiAnc2hpcF9nYXRlJyB8ICdyaXNreV9hY3Rpb24nIHwgJ3Njb3BlX2NoYW5nZScgfCAnY3Jvbl9jaGFuZ2UnIHwgJ2V4dGVybmFsX3NpZGVfZWZmZWN0J1xuICBxdWVzdGlvbk1kOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVBcHByb3ZhbElucHV0IHtcbiAgc3RhdHVzOiAnYXBwcm92ZWQnIHwgJ3JlamVjdGVkJ1xuICByZXNvbHZlZEJ5Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwcm92YWxzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IEFwcHJvdmFsRmlsdGVycyk6IFByb21pc2U8QXBwcm92YWxEVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+XG4gIGxpc3RQZW5kaW5nKCk6IFByb21pc2U8QXBwcm92YWxEVE9bXT5cbiAgY291bnRQZW5kaW5nKCk6IFByb21pc2U8bnVtYmVyPlxuICBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPPlxuICB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiQXBwcm92YWxzUmVwbygpOiBBcHByb3ZhbHNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5hcHByb3ZhbC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKHRvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFBlbmRpbmcoKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgc3RhdHVzOiAncGVuZGluZycgfSxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRQZW5kaW5nKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICByZXR1cm4gcHJpc21hLmFwcHJvdmFsLmNvdW50KHsgd2hlcmU6IHsgc3RhdHVzOiAncGVuZGluZycgfSB9KVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdvcmtPcmRlcklkOiBpbnB1dC53b3JrT3JkZXJJZCxcbiAgICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgIHF1ZXN0aW9uTWQ6IGlucHV0LnF1ZXN0aW9uTWQsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVBcHByb3ZhbElucHV0KTogUHJvbWlzZTxBcHByb3ZhbERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLmFwcHJvdmFsLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuYXBwcm92YWwudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHN0YXR1czogaW5wdXQuc3RhdHVzLFxuICAgICAgICAgIHJlc29sdmVkQnk6IGlucHV0LnJlc29sdmVkQnkgfHwgJ3VzZXInLFxuICAgICAgICAgIHJlc29sdmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FwcHJvdmFsc1JlcG8oKTogQXBwcm92YWxzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogQXBwcm92YWxGaWx0ZXJzKTogUHJvbWlzZTxBcHByb3ZhbERUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tBcHByb3ZhbHNdXG4gICAgICBpZiAoZmlsdGVycz8uc3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyBmaWx0ZXJzLnN0YXR1cyA6IFtmaWx0ZXJzLnN0YXR1c11cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigoYSkgPT4gc3RhdHVzZXMuaW5jbHVkZXMoYS5zdGF0dXMpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcbiAgICAgICAgY29uc3QgdHlwZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMudHlwZSkgPyBmaWx0ZXJzLnR5cGUgOiBbZmlsdGVycy50eXBlXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChhKSA9PiB0eXBlcy5pbmNsdWRlcyhhLnR5cGUpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/LndvcmtPcmRlcklkKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKGEpID0+IGEud29ya09yZGVySWQgPT09IGZpbHRlcnMud29ya09yZGVySWQpXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0Lm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBwcm92YWxEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBhcHByb3ZhbCA9IG1vY2tBcHByb3ZhbHMuZmluZCgoYSkgPT4gYS5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gYXBwcm92YWwgPyBtb2NrVG9EVE8oYXBwcm92YWwpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0UGVuZGluZygpOiBQcm9taXNlPEFwcHJvdmFsRFRPW10+IHtcbiAgICAgIHJldHVybiBtb2NrQXBwcm92YWxzXG4gICAgICAgIC5maWx0ZXIoKGEpID0+IGEuc3RhdHVzID09PSAncGVuZGluZycpXG4gICAgICAgIC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudFBlbmRpbmcoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBtb2NrQXBwcm92YWxzLmZpbHRlcigoYSkgPT4gYS5zdGF0dXMgPT09ICdwZW5kaW5nJykubGVuZ3RoXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlQXBwcm92YWxJbnB1dCk6IFByb21pc2U8QXBwcm92YWxEVE8+IHtcbiAgICAgIGNvbnN0IGlkID0gYGFwcl9tb2NrXyR7RGF0ZS5ub3coKX1gXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBvcGVyYXRpb25JZDogaW5wdXQub3BlcmF0aW9uSWQgPz8gbnVsbCxcbiAgICAgICAgdHlwZTogaW5wdXQudHlwZSxcbiAgICAgICAgcXVlc3Rpb25NZDogaW5wdXQucXVlc3Rpb25NZCxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgIHJlc29sdmVkQnk6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICByZXNvbHZlZEF0OiBudWxsLFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZUFwcHJvdmFsSW5wdXQpOiBQcm9taXNlPEFwcHJvdmFsRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgYXBwcm92YWwgPSBtb2NrQXBwcm92YWxzLmZpbmQoKGEpID0+IGEuaWQgPT09IGlkKVxuICAgICAgaWYgKCFhcHByb3ZhbCkgcmV0dXJuIG51bGxcblxuICAgICAgLy8gSW4gbW9jayBtb2RlLCB3ZSBkb24ndCBhY3R1YWxseSBtdXRhdGUgLSBqdXN0IHJldHVybiB1cGRhdGVkIERUT1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ubW9ja1RvRFRPKGFwcHJvdmFsKSxcbiAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgIHJlc29sdmVkQnk6IGlucHV0LnJlc29sdmVkQnkgfHwgJ3VzZXInLFxuICAgICAgICByZXNvbHZlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBBcHByb3ZhbEZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMuc3RhdHVzKSB7XG4gICAgd2hlcmUuc3RhdHVzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyB7IGluOiBmaWx0ZXJzLnN0YXR1cyB9IDogZmlsdGVycy5zdGF0dXNcbiAgfVxuICBpZiAoZmlsdGVycy50eXBlKSB7XG4gICAgd2hlcmUudHlwZSA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy50eXBlKSA/IHsgaW46IGZpbHRlcnMudHlwZSB9IDogZmlsdGVycy50eXBlXG4gIH1cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZDogc3RyaW5nIHwgbnVsbFxuICB0eXBlOiBzdHJpbmdcbiAgcXVlc3Rpb25NZDogc3RyaW5nXG4gIHN0YXR1czogc3RyaW5nXG4gIHJlc29sdmVkQnk6IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHJlc29sdmVkQXQ6IERhdGUgfCBudWxsXG59KTogQXBwcm92YWxEVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiByb3cuaWQsXG4gICAgd29ya09yZGVySWQ6IHJvdy53b3JrT3JkZXJJZCxcbiAgICBvcGVyYXRpb25JZDogcm93Lm9wZXJhdGlvbklkLFxuICAgIHR5cGU6IHJvdy50eXBlIGFzIEFwcHJvdmFsRFRPWyd0eXBlJ10sXG4gICAgcXVlc3Rpb25NZDogcm93LnF1ZXN0aW9uTWQsXG4gICAgc3RhdHVzOiByb3cuc3RhdHVzIGFzIEFwcHJvdmFsRFRPWydzdGF0dXMnXSxcbiAgICByZXNvbHZlZEJ5OiByb3cucmVzb2x2ZWRCeSxcbiAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkQXQsXG4gICAgcmVzb2x2ZWRBdDogcm93LnJlc29sdmVkQXQsXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKGFwcHJvdmFsOiB0eXBlb2YgbW9ja0FwcHJvdmFsc1tudW1iZXJdKTogQXBwcm92YWxEVE8ge1xuICByZXR1cm4ge1xuICAgIGlkOiBhcHByb3ZhbC5pZCxcbiAgICB3b3JrT3JkZXJJZDogYXBwcm92YWwud29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQ6IGFwcHJvdmFsLm9wZXJhdGlvbklkLFxuICAgIHR5cGU6IGFwcHJvdmFsLnR5cGUgYXMgQXBwcm92YWxEVE9bJ3R5cGUnXSxcbiAgICBxdWVzdGlvbk1kOiBhcHByb3ZhbC5xdWVzdGlvbk1kLFxuICAgIHN0YXR1czogYXBwcm92YWwuc3RhdHVzIGFzIEFwcHJvdmFsRFRPWydzdGF0dXMnXSxcbiAgICByZXNvbHZlZEJ5OiBhcHByb3ZhbC5yZXNvbHZlZEJ5LFxuICAgIGNyZWF0ZWRBdDogYXBwcm92YWwuY3JlYXRlZEF0LFxuICAgIHJlc29sdmVkQXQ6IGFwcHJvdmFsLnJlc29sdmVkQXQsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJtb2NrQXBwcm92YWxzIiwiY3JlYXRlRGJBcHByb3ZhbHNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwiYXBwcm92YWwiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0UGVuZGluZyIsInN0YXR1cyIsImNvdW50UGVuZGluZyIsImNvdW50IiwiY3JlYXRlIiwiaW5wdXQiLCJkYXRhIiwid29ya09yZGVySWQiLCJvcGVyYXRpb25JZCIsInR5cGUiLCJxdWVzdGlvbk1kIiwidXBkYXRlIiwiZXhpc3RpbmciLCJyZXNvbHZlZEJ5IiwicmVzb2x2ZWRBdCIsIkRhdGUiLCJjcmVhdGVNb2NrQXBwcm92YWxzUmVwbyIsInJlc3VsdCIsInN0YXR1c2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiYSIsImluY2x1ZGVzIiwidHlwZXMiLCJtb2NrVG9EVE8iLCJmaW5kIiwibGVuZ3RoIiwibm93IiwiaW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/approvals.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:330:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbOperationsRepo: () => (/* binding */ createDbOperationsRepo),\n/* harmony export */   createMockOperationsRepo: () => (/* binding */ createMockOperationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clawcontrol/core */ \"(instrument)/../../packages/core/src/index.ts\");\n/**\n * Operations Repository\n *\n * Provides data access for operations with both DB and mock implementations.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbOperationsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    createdAt: 'asc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async countByStatus () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.groupBy({\n                by: [\n                    'status'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.status,\n                    g._count.id\n                ]));\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    station: input.station,\n                    title: input.title,\n                    notes: input.notes ?? null,\n                    status: 'todo',\n                    assigneeAgentIds: '[]',\n                    dependsOnOperationIds: JSON.stringify(input.dependsOnOperationIds ?? []),\n                    wipClass: input.wipClass ?? 'implementation'\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.operation.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.status !== undefined && {\n                        status: input.status\n                    },\n                    ...input.notes !== undefined && {\n                        notes: input.notes\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async updateStatusWithActivity (id, newStatus, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current operation\n                const existing = await tx.operation.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousStatus = existing.status;\n                // Update operation\n                const row = await tx.operation.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        status: newStatus\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'operation.status_changed',\n                        actor,\n                        entityType: 'operation',\n                        entityId: id,\n                        summary: `Operation transitioned to ${newStatus}`,\n                        payloadJson: JSON.stringify({\n                            workOrderId: existing.workOrderId,\n                            previousStatus,\n                            newStatus\n                        })\n                    }\n                });\n                return {\n                    operation: toDTO(row),\n                    previousStatus,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockOperationsRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations\n            ];\n            if (filters?.workOrderId) {\n                result = result.filter((op)=>op.workOrderId === filters.workOrderId);\n            }\n            if (filters?.status) {\n                const statuses = Array.isArray(filters.status) ? filters.status : [\n                    filters.status\n                ];\n                result = result.filter((op)=>statuses.includes(op.status));\n            }\n            if (filters?.station) {\n                const stations = Array.isArray(filters.station) ? filters.station : [\n                    filters.station\n                ];\n                result = result.filter((op)=>stations.includes(op.station));\n            }\n            return result.map(mockToDTO);\n        },\n        async getById (id) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            return op ? mockToDTO(op) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.filter((op)=>op.workOrderId === workOrderId).map(mockToDTO);\n        },\n        async countByStatus () {\n            const counts = {};\n            for (const op of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations){\n                counts[op.status] = (counts[op.status] || 0) + 1;\n            }\n            return counts;\n        },\n        async create (input) {\n            const id = `op_mock_${Date.now()}`;\n            const now = new Date();\n            return {\n                id,\n                workOrderId: input.workOrderId,\n                station: input.station,\n                title: input.title,\n                notes: input.notes ?? null,\n                status: 'todo',\n                assigneeAgentIds: [],\n                dependsOnOperationIds: input.dependsOnOperationIds ?? [],\n                wipClass: input.wipClass ?? 'implementation',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now\n            };\n        },\n        async update (id, input) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(op),\n                ...input.status !== undefined && {\n                    status: input.status\n                },\n                ...input.notes !== undefined && {\n                    notes: input.notes\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStatusWithActivity (id, newStatus, _actor) {\n            const op = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_1__.mockOperations.find((o)=>o.id === id);\n            if (!op) return null;\n            const previousStatus = op.status;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                operation: {\n                    ...mockToDTO(op),\n                    status: newStatus,\n                    updatedAt: new Date()\n                },\n                previousStatus,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.status) {\n        where.status = Array.isArray(filters.status) ? {\n            in: filters.status\n        } : filters.status;\n    }\n    if (filters.station) {\n        where.station = Array.isArray(filters.station) ? {\n            in: filters.station\n        } : filters.station;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        station: row.station,\n        title: row.title,\n        notes: row.notes,\n        status: row.status,\n        assigneeAgentIds: JSON.parse(row.assigneeAgentIds),\n        dependsOnOperationIds: JSON.parse(row.dependsOnOperationIds),\n        wipClass: row.wipClass,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\nfunction mockToDTO(op) {\n    return {\n        id: op.id,\n        workOrderId: op.workOrderId,\n        station: op.station,\n        title: op.title,\n        notes: op.notes ?? null,\n        status: op.status,\n        assigneeAgentIds: op.assigneeAgentIds,\n        dependsOnOperationIds: op.dependsOnOperationIds,\n        wipClass: op.wipClass,\n        blockedReason: op.blockedReason,\n        createdAt: op.createdAt,\n        updatedAt: op.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGluc3RydW1lbnQpLy4vbGliL3JlcG8vb3BlcmF0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUU2QjtBQUNvQjtBQTJDbEQsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQiwrRUFBK0U7QUFFeEUsU0FBU0U7SUFDZCxPQUFPO1FBQ0wsTUFBTUMsTUFBS0MsT0FBMEI7WUFDbkMsTUFBTUMsUUFBUUMsV0FBV0Y7WUFDekIsTUFBTUcsT0FBTyxNQUFNUCx1Q0FBTUEsQ0FBQ1EsU0FBUyxDQUFDQyxRQUFRLENBQUM7Z0JBQzNDSjtnQkFDQUssU0FBUztvQkFBRUMsV0FBVztnQkFBTztZQUMvQjtZQUNBLE9BQU9KLEtBQUtLLEdBQUcsQ0FBQ0M7UUFDbEI7UUFFQSxNQUFNQyxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1DLE1BQU0sTUFBTWhCLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNTLFVBQVUsQ0FBQztnQkFBRVosT0FBTztvQkFBRVU7Z0JBQUc7WUFBRTtZQUM5RCxPQUFPQyxNQUFNSCxNQUFNRyxPQUFPO1FBQzVCO1FBRUEsTUFBTUUsa0JBQWlCQyxXQUFtQjtZQUN4QyxNQUFNWixPQUFPLE1BQU1QLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNDLFFBQVEsQ0FBQztnQkFDM0NKLE9BQU87b0JBQUVjO2dCQUFZO2dCQUNyQlQsU0FBUztvQkFBRVUsV0FBVztnQkFBTTtZQUM5QjtZQUNBLE9BQU9iLEtBQUtLLEdBQUcsQ0FBQ0M7UUFDbEI7UUFFQSxNQUFNUTtZQUNKLE1BQU1DLFNBQVMsTUFBTXRCLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNlLE9BQU8sQ0FBQztnQkFDNUNDLElBQUk7b0JBQUM7aUJBQVM7Z0JBQ2RDLFFBQVE7b0JBQUVWLElBQUk7Z0JBQUs7WUFDckI7WUFDQSxPQUFPVyxPQUFPQyxXQUFXLENBQ3ZCTCxPQUFPVixHQUFHLENBQUMsQ0FBQ2dCLElBQU07b0JBQUNBLEVBQUVDLE1BQU07b0JBQUVELEVBQUVILE1BQU0sQ0FBQ1YsRUFBRTtpQkFBQztRQUU3QztRQUVBLE1BQU1lLFFBQU9DLEtBQTJCO1lBQ3RDLE1BQU1mLE1BQU0sTUFBTWhCLHVDQUFNQSxDQUFDUSxTQUFTLENBQUNzQixNQUFNLENBQUM7Z0JBQ3hDRSxNQUFNO29CQUNKYixhQUFhWSxNQUFNWixXQUFXO29CQUM5QmMsU0FBU0YsTUFBTUUsT0FBTztvQkFDdEJDLE9BQU9ILE1BQU1HLEtBQUs7b0JBQ2xCQyxPQUFPSixNQUFNSSxLQUFLLElBQUk7b0JBQ3RCTixRQUFRO29CQUNSTyxrQkFBa0I7b0JBQ2xCQyx1QkFBdUJDLEtBQUtDLFNBQVMsQ0FBQ1IsTUFBTU0scUJBQXFCLElBQUksRUFBRTtvQkFDdkVHLFVBQVVULE1BQU1TLFFBQVEsSUFBSTtnQkFDOUI7WUFDRjtZQUNBLE9BQU8zQixNQUFNRztRQUNmO1FBRUEsTUFBTXlCLFFBQU8xQixFQUFVLEVBQUVnQixLQUEyQjtZQUNsRCxNQUFNVyxXQUFXLE1BQU0xQyx1Q0FBTUEsQ0FBQ1EsU0FBUyxDQUFDUyxVQUFVLENBQUM7Z0JBQUVaLE9BQU87b0JBQUVVO2dCQUFHO1lBQUU7WUFDbkUsSUFBSSxDQUFDMkIsVUFBVSxPQUFPO1lBRXRCLE1BQU0xQixNQUFNLE1BQU1oQix1Q0FBTUEsQ0FBQ1EsU0FBUyxDQUFDaUMsTUFBTSxDQUFDO2dCQUN4Q3BDLE9BQU87b0JBQUVVO2dCQUFHO2dCQUNaaUIsTUFBTTtvQkFDSixHQUFJRCxNQUFNRixNQUFNLEtBQUtjLGFBQWE7d0JBQUVkLFFBQVFFLE1BQU1GLE1BQU07b0JBQUMsQ0FBQztvQkFDMUQsR0FBSUUsTUFBTUksS0FBSyxLQUFLUSxhQUFhO3dCQUFFUixPQUFPSixNQUFNSSxLQUFLO29CQUFDLENBQUM7b0JBQ3ZELEdBQUlKLE1BQU1hLGFBQWEsS0FBS0QsYUFBYTt3QkFBRUMsZUFBZWIsTUFBTWEsYUFBYTtvQkFBQyxDQUFDO2dCQUNqRjtZQUNGO1lBRUEsT0FBTy9CLE1BQU1HO1FBQ2Y7UUFFQSxNQUFNNkIsMEJBQ0o5QixFQUFVLEVBQ1YrQixTQUFpQixFQUNqQkMsS0FBYTtZQUViLE9BQU8vQyx1Q0FBTUEsQ0FBQ2dELFlBQVksQ0FBQyxPQUFPQztnQkFDaEMsd0JBQXdCO2dCQUN4QixNQUFNUCxXQUFXLE1BQU1PLEdBQUd6QyxTQUFTLENBQUNTLFVBQVUsQ0FBQztvQkFBRVosT0FBTzt3QkFBRVU7b0JBQUc7Z0JBQUU7Z0JBQy9ELElBQUksQ0FBQzJCLFVBQVUsT0FBTztnQkFFdEIsTUFBTVEsaUJBQWlCUixTQUFTYixNQUFNO2dCQUV0QyxtQkFBbUI7Z0JBQ25CLE1BQU1iLE1BQU0sTUFBTWlDLEdBQUd6QyxTQUFTLENBQUNpQyxNQUFNLENBQUM7b0JBQ3BDcEMsT0FBTzt3QkFBRVU7b0JBQUc7b0JBQ1ppQixNQUFNO3dCQUFFSCxRQUFRaUI7b0JBQVU7Z0JBQzVCO2dCQUVBLHlCQUF5QjtnQkFDekIsTUFBTUssYUFBYSxDQUFDLElBQUksRUFBRUMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsSUFBSTtnQkFDaEYsTUFBTVIsR0FBR1MsUUFBUSxDQUFDNUIsTUFBTSxDQUFDO29CQUN2QkUsTUFBTTt3QkFDSmpCLElBQUlvQzt3QkFDSlEsSUFBSSxJQUFJUDt3QkFDUlEsTUFBTTt3QkFDTmI7d0JBQ0FjLFlBQVk7d0JBQ1pDLFVBQVUvQzt3QkFDVmdELFNBQVMsQ0FBQywwQkFBMEIsRUFBRWpCLFdBQVc7d0JBQ2pEa0IsYUFBYTFCLEtBQUtDLFNBQVMsQ0FBQzs0QkFDMUJwQixhQUFhdUIsU0FBU3ZCLFdBQVc7NEJBQ2pDK0I7NEJBQ0FKO3dCQUNGO29CQUNGO2dCQUNGO2dCQUVBLE9BQU87b0JBQ0x0QyxXQUFXSyxNQUFNRztvQkFDakJrQztvQkFDQUM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxzQkFBc0I7QUFDdEIsK0VBQStFO0FBRXhFLFNBQVNjO0lBQ2QsT0FBTztRQUNMLE1BQU05RCxNQUFLQyxPQUEwQjtZQUNuQyxJQUFJOEQsU0FBUzttQkFBSWpFLDZEQUFjQTthQUFDO1lBQ2hDLElBQUlHLFNBQVNlLGFBQWE7Z0JBQ3hCK0MsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqRCxXQUFXLEtBQUtmLFFBQVFlLFdBQVc7WUFDdkU7WUFDQSxJQUFJZixTQUFTeUIsUUFBUTtnQkFDbkIsTUFBTXdDLFdBQVdDLE1BQU1DLE9BQU8sQ0FBQ25FLFFBQVF5QixNQUFNLElBQUl6QixRQUFReUIsTUFBTSxHQUFHO29CQUFDekIsUUFBUXlCLE1BQU07aUJBQUM7Z0JBQ2xGcUMsU0FBU0EsT0FBT0MsTUFBTSxDQUFDLENBQUNDLEtBQU9DLFNBQVNHLFFBQVEsQ0FBQ0osR0FBR3ZDLE1BQU07WUFDNUQ7WUFDQSxJQUFJekIsU0FBUzZCLFNBQVM7Z0JBQ3BCLE1BQU13QyxXQUFXSCxNQUFNQyxPQUFPLENBQUNuRSxRQUFRNkIsT0FBTyxJQUFJN0IsUUFBUTZCLE9BQU8sR0FBRztvQkFBQzdCLFFBQVE2QixPQUFPO2lCQUFDO2dCQUNyRmlDLFNBQVNBLE9BQU9DLE1BQU0sQ0FBQyxDQUFDQyxLQUFPSyxTQUFTRCxRQUFRLENBQUNKLEdBQUduQyxPQUFPO1lBQzdEO1lBQ0EsT0FBT2lDLE9BQU90RCxHQUFHLENBQUM4RDtRQUNwQjtRQUVBLE1BQU01RCxTQUFRQyxFQUFVO1lBQ3RCLE1BQU1xRCxLQUFLbkUsNkRBQWNBLENBQUMwRSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUEsRUFBRTdELEVBQUUsS0FBS0E7WUFDL0MsT0FBT3FELEtBQUtNLFVBQVVOLE1BQU07UUFDOUI7UUFFQSxNQUFNbEQsa0JBQWlCQyxXQUFtQjtZQUN4QyxPQUFPbEIsNkRBQWNBLENBQ2xCa0UsTUFBTSxDQUFDLENBQUNDLEtBQU9BLEdBQUdqRCxXQUFXLEtBQUtBLGFBQ2xDUCxHQUFHLENBQUM4RDtRQUNUO1FBRUEsTUFBTXJEO1lBQ0osTUFBTXdELFNBQWlDLENBQUM7WUFDeEMsS0FBSyxNQUFNVCxNQUFNbkUsNkRBQWNBLENBQUU7Z0JBQy9CNEUsTUFBTSxDQUFDVCxHQUFHdkMsTUFBTSxDQUFDLEdBQUcsQ0FBQ2dELE1BQU0sQ0FBQ1QsR0FBR3ZDLE1BQU0sQ0FBQyxJQUFJLEtBQUs7WUFDakQ7WUFDQSxPQUFPZ0Q7UUFDVDtRQUVBLE1BQU0vQyxRQUFPQyxLQUEyQjtZQUN0QyxNQUFNaEIsS0FBSyxDQUFDLFFBQVEsRUFBRXFDLEtBQUtDLEdBQUcsSUFBSTtZQUNsQyxNQUFNQSxNQUFNLElBQUlEO1lBQ2hCLE9BQU87Z0JBQ0xyQztnQkFDQUksYUFBYVksTUFBTVosV0FBVztnQkFDOUJjLFNBQVNGLE1BQU1FLE9BQU87Z0JBQ3RCQyxPQUFPSCxNQUFNRyxLQUFLO2dCQUNsQkMsT0FBT0osTUFBTUksS0FBSyxJQUFJO2dCQUN0Qk4sUUFBUTtnQkFDUk8sa0JBQWtCLEVBQUU7Z0JBQ3BCQyx1QkFBdUJOLE1BQU1NLHFCQUFxQixJQUFJLEVBQUU7Z0JBQ3hERyxVQUFVVCxNQUFNUyxRQUFRLElBQUk7Z0JBQzVCSSxlQUFlO2dCQUNmeEIsV0FBV2lDO2dCQUNYMUMsV0FBVzBDO1lBQ2I7UUFDRjtRQUVBLE1BQU1aLFFBQU8xQixFQUFVLEVBQUVnQixLQUEyQjtZQUNsRCxNQUFNcUMsS0FBS25FLDZEQUFjQSxDQUFDMEUsSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUU3RCxFQUFFLEtBQUtBO1lBQy9DLElBQUksQ0FBQ3FELElBQUksT0FBTztZQUVoQixtRUFBbUU7WUFDbkUsT0FBTztnQkFDTCxHQUFHTSxVQUFVTixHQUFHO2dCQUNoQixHQUFJckMsTUFBTUYsTUFBTSxLQUFLYyxhQUFhO29CQUFFZCxRQUFRRSxNQUFNRixNQUFNO2dCQUEyQixDQUFDO2dCQUNwRixHQUFJRSxNQUFNSSxLQUFLLEtBQUtRLGFBQWE7b0JBQUVSLE9BQU9KLE1BQU1JLEtBQUs7Z0JBQUMsQ0FBQztnQkFDdkQsR0FBSUosTUFBTWEsYUFBYSxLQUFLRCxhQUFhO29CQUFFQyxlQUFlYixNQUFNYSxhQUFhO2dCQUFDLENBQUM7Z0JBQy9FakMsV0FBVyxJQUFJeUM7WUFDakI7UUFDRjtRQUVBLE1BQU1QLDBCQUNKOUIsRUFBVSxFQUNWK0IsU0FBaUIsRUFDakJnQyxNQUFjO1lBRWQsTUFBTVYsS0FBS25FLDZEQUFjQSxDQUFDMEUsSUFBSSxDQUFDLENBQUNDLElBQU1BLEVBQUU3RCxFQUFFLEtBQUtBO1lBQy9DLElBQUksQ0FBQ3FELElBQUksT0FBTztZQUVoQixNQUFNbEIsaUJBQWlCa0IsR0FBR3ZDLE1BQU07WUFDaEMsTUFBTXNCLGFBQWEsQ0FBQyxTQUFTLEVBQUVDLEtBQUtDLEdBQUcsSUFBSTtZQUUzQyxPQUFPO2dCQUNMN0MsV0FBVztvQkFDVCxHQUFHa0UsVUFBVU4sR0FBRztvQkFDaEJ2QyxRQUFRaUI7b0JBQ1JuQyxXQUFXLElBQUl5QztnQkFDakI7Z0JBQ0FGO2dCQUNBQztZQUNGO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsU0FBUzdDLFdBQVdGLE9BQTBCO0lBQzVDLElBQUksQ0FBQ0EsU0FBUyxPQUFPLENBQUM7SUFDdEIsTUFBTUMsUUFBaUMsQ0FBQztJQUN4QyxJQUFJRCxRQUFRZSxXQUFXLEVBQUU7UUFDdkJkLE1BQU1jLFdBQVcsR0FBR2YsUUFBUWUsV0FBVztJQUN6QztJQUNBLElBQUlmLFFBQVF5QixNQUFNLEVBQUU7UUFDbEJ4QixNQUFNd0IsTUFBTSxHQUFHeUMsTUFBTUMsT0FBTyxDQUFDbkUsUUFBUXlCLE1BQU0sSUFBSTtZQUFFa0QsSUFBSTNFLFFBQVF5QixNQUFNO1FBQUMsSUFBSXpCLFFBQVF5QixNQUFNO0lBQ3hGO0lBQ0EsSUFBSXpCLFFBQVE2QixPQUFPLEVBQUU7UUFDbkI1QixNQUFNNEIsT0FBTyxHQUFHcUMsTUFBTUMsT0FBTyxDQUFDbkUsUUFBUTZCLE9BQU8sSUFBSTtZQUFFOEMsSUFBSTNFLFFBQVE2QixPQUFPO1FBQUMsSUFBSTdCLFFBQVE2QixPQUFPO0lBQzVGO0lBQ0EsT0FBTzVCO0FBQ1Q7QUFFQSxTQUFTUSxNQUFNRyxHQWFkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZJLGFBQWFILElBQUlHLFdBQVc7UUFDNUJjLFNBQVNqQixJQUFJaUIsT0FBTztRQUNwQkMsT0FBT2xCLElBQUlrQixLQUFLO1FBQ2hCQyxPQUFPbkIsSUFBSW1CLEtBQUs7UUFDaEJOLFFBQVFiLElBQUlhLE1BQU07UUFDbEJPLGtCQUFrQkUsS0FBSzBDLEtBQUssQ0FBQ2hFLElBQUlvQixnQkFBZ0I7UUFDakRDLHVCQUF1QkMsS0FBSzBDLEtBQUssQ0FBQ2hFLElBQUlxQixxQkFBcUI7UUFDM0RHLFVBQVV4QixJQUFJd0IsUUFBUTtRQUN0QkksZUFBZTVCLElBQUk0QixhQUFhO1FBQ2hDeEIsV0FBV0osSUFBSUksU0FBUztRQUN4QlQsV0FBV0ssSUFBSUwsU0FBUztJQUMxQjtBQUNGO0FBRUEsU0FBUytELFVBQVVOLEVBQWlDO0lBQ2xELE9BQU87UUFDTHJELElBQUlxRCxHQUFHckQsRUFBRTtRQUNUSSxhQUFhaUQsR0FBR2pELFdBQVc7UUFDM0JjLFNBQVNtQyxHQUFHbkMsT0FBTztRQUNuQkMsT0FBT2tDLEdBQUdsQyxLQUFLO1FBQ2ZDLE9BQU9pQyxHQUFHakMsS0FBSyxJQUFJO1FBQ25CTixRQUFRdUMsR0FBR3ZDLE1BQU07UUFDakJPLGtCQUFrQmdDLEdBQUdoQyxnQkFBZ0I7UUFDckNDLHVCQUF1QitCLEdBQUcvQixxQkFBcUI7UUFDL0NHLFVBQVU0QixHQUFHNUIsUUFBUTtRQUNyQkksZUFBZXdCLEdBQUd4QixhQUFhO1FBQy9CeEIsV0FBV2dELEdBQUdoRCxTQUFTO1FBQ3ZCVCxXQUFXeUQsR0FBR3pELFNBQVM7SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9vcGVyYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogT3BlcmF0aW9ucyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIG9wZXJhdGlvbnMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IG1vY2tPcGVyYXRpb25zIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7IE9wZXJhdGlvbkRUTywgT3BlcmF0aW9uRmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlT3BlcmF0aW9uSW5wdXQge1xuICB3b3JrT3JkZXJJZDogc3RyaW5nXG4gIHN0YXRpb246IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIG5vdGVzPzogc3RyaW5nIHwgbnVsbFxuICBkZXBlbmRzT25PcGVyYXRpb25JZHM/OiBzdHJpbmdbXVxuICB3aXBDbGFzcz86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZU9wZXJhdGlvbklucHV0IHtcbiAgc3RhdHVzPzogc3RyaW5nXG4gIG5vdGVzPzogc3RyaW5nIHwgbnVsbFxuICBibG9ja2VkUmVhc29uPzogc3RyaW5nIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXR1c1RyYW5zaXRpb25SZXN1bHQge1xuICBvcGVyYXRpb246IE9wZXJhdGlvbkRUT1xuICBwcmV2aW91c1N0YXR1czogc3RyaW5nXG4gIGFjdGl2aXR5SWQ6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9wZXJhdGlvbnNSZXBvIHtcbiAgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD5cbiAgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT5cbiAgY291bnRCeVN0YXR1cygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIG51bWJlcj4+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPIHwgbnVsbD5cbiAgLyoqIEF0b21pY2FsbHkgdXBkYXRlIHN0YXR1cyBhbmQgd3JpdGUgYWN0aXZpdHkgcmVjb3JkIGluIGEgdHJhbnNhY3Rpb24gKi9cbiAgdXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5KFxuICAgIGlkOiBzdHJpbmcsXG4gICAgbmV3U3RhdHVzOiBzdHJpbmcsXG4gICAgYWN0b3I6IHN0cmluZ1xuICApOiBQcm9taXNlPFN0YXR1c1RyYW5zaXRpb25SZXN1bHQgfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJPcGVyYXRpb25zUmVwbygpOiBPcGVyYXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogT3BlcmF0aW9uRmlsdGVycyk6IFByb21pc2U8T3BlcmF0aW9uRFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyB1cGRhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvcldvcmtPcmRlcih3b3JrT3JkZXJJZDogc3RyaW5nKTogUHJvbWlzZTxPcGVyYXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5vcGVyYXRpb24uZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3b3JrT3JkZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2FzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0dXMoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBwcmlzbWEub3BlcmF0aW9uLmdyb3VwQnkoe1xuICAgICAgICBieTogWydzdGF0dXMnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdHVzLCBnLl9jb3VudC5pZF0pXG4gICAgICApXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTz4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIHN0YXRpb246IGlucHV0LnN0YXRpb24sXG4gICAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICAgIG5vdGVzOiBpbnB1dC5ub3RlcyA/PyBudWxsLFxuICAgICAgICAgIHN0YXR1czogJ3RvZG8nLFxuICAgICAgICAgIGFzc2lnbmVlQWdlbnRJZHM6ICdbXScsXG4gICAgICAgICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBKU09OLnN0cmluZ2lmeShpbnB1dC5kZXBlbmRzT25PcGVyYXRpb25JZHMgPz8gW10pLFxuICAgICAgICAgIHdpcENsYXNzOiBpbnB1dC53aXBDbGFzcyA/PyAnaW1wbGVtZW50YXRpb24nLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlT3BlcmF0aW9uSW5wdXQpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLm9wZXJhdGlvbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0LnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdHVzOiBpbnB1dC5zdGF0dXMgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lm5vdGVzICE9PSB1bmRlZmluZWQgJiYgeyBub3RlczogaW5wdXQubm90ZXMgfSksXG4gICAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGVTdGF0dXNXaXRoQWN0aXZpdHkoXG4gICAgICBpZDogc3RyaW5nLFxuICAgICAgbmV3U3RhdHVzOiBzdHJpbmcsXG4gICAgICBhY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0dXNUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIEdldCBjdXJyZW50IG9wZXJhdGlvblxuICAgICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHR4Lm9wZXJhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gbnVsbFxuXG4gICAgICAgIGNvbnN0IHByZXZpb3VzU3RhdHVzID0gZXhpc3Rpbmcuc3RhdHVzXG5cbiAgICAgICAgLy8gVXBkYXRlIG9wZXJhdGlvblxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCB0eC5vcGVyYXRpb24udXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICAgIGRhdGE6IHsgc3RhdHVzOiBuZXdTdGF0dXMgfSxcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBDcmVhdGUgYWN0aXZpdHkgcmVjb3JkXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KX1gXG4gICAgICAgIGF3YWl0IHR4LmFjdGl2aXR5LmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaWQ6IGFjdGl2aXR5SWQsXG4gICAgICAgICAgICB0czogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHR5cGU6ICdvcGVyYXRpb24uc3RhdHVzX2NoYW5nZWQnLFxuICAgICAgICAgICAgYWN0b3IsXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiAnb3BlcmF0aW9uJyxcbiAgICAgICAgICAgIGVudGl0eUlkOiBpZCxcbiAgICAgICAgICAgIHN1bW1hcnk6IGBPcGVyYXRpb24gdHJhbnNpdGlvbmVkIHRvICR7bmV3U3RhdHVzfWAsXG4gICAgICAgICAgICBwYXlsb2FkSnNvbjogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICB3b3JrT3JkZXJJZDogZXhpc3Rpbmcud29ya09yZGVySWQsXG4gICAgICAgICAgICAgIHByZXZpb3VzU3RhdHVzLFxuICAgICAgICAgICAgICBuZXdTdGF0dXMsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb3BlcmF0aW9uOiB0b0RUTyhyb3cpLFxuICAgICAgICAgIHByZXZpb3VzU3RhdHVzLFxuICAgICAgICAgIGFjdGl2aXR5SWQsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNT0NLIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2NrT3BlcmF0aW9uc1JlcG8oKTogT3BlcmF0aW9uc1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IE9wZXJhdGlvbkZpbHRlcnMpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICBsZXQgcmVzdWx0ID0gWy4uLm1vY2tPcGVyYXRpb25zXVxuICAgICAgaWYgKGZpbHRlcnM/LndvcmtPcmRlcklkKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKG9wKSA9PiBvcC53b3JrT3JkZXJJZCA9PT0gZmlsdGVycy53b3JrT3JkZXJJZClcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdHVzKSA/IGZpbHRlcnMuc3RhdHVzIDogW2ZpbHRlcnMuc3RhdHVzXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKChvcCkgPT4gc3RhdHVzZXMuaW5jbHVkZXMob3Auc3RhdHVzKSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IHN0YXRpb25zID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRpb24pID8gZmlsdGVycy5zdGF0aW9uIDogW2ZpbHRlcnMuc3RhdGlvbl1cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigob3ApID0+IHN0YXRpb25zLmluY2x1ZGVzKG9wLnN0YXRpb24pKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAobW9ja1RvRFRPKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IG9wID0gbW9ja09wZXJhdGlvbnMuZmluZCgobykgPT4gby5pZCA9PT0gaWQpXG4gICAgICByZXR1cm4gb3AgPyBtb2NrVG9EVE8ob3ApIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9wZXJhdGlvbkRUT1tdPiB7XG4gICAgICByZXR1cm4gbW9ja09wZXJhdGlvbnNcbiAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSB3b3JrT3JkZXJJZClcbiAgICAgICAgLm1hcChtb2NrVG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50QnlTdGF0dXMoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBjb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fVxuICAgICAgZm9yIChjb25zdCBvcCBvZiBtb2NrT3BlcmF0aW9ucykge1xuICAgICAgICBjb3VudHNbb3Auc3RhdHVzXSA9IChjb3VudHNbb3Auc3RhdHVzXSB8fCAwKSArIDFcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudHNcbiAgICB9LFxuXG4gICAgYXN5bmMgY3JlYXRlKGlucHV0OiBDcmVhdGVPcGVyYXRpb25JbnB1dCk6IFByb21pc2U8T3BlcmF0aW9uRFRPPiB7XG4gICAgICBjb25zdCBpZCA9IGBvcF9tb2NrXyR7RGF0ZS5ub3coKX1gXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZCxcbiAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICBzdGF0aW9uOiBpbnB1dC5zdGF0aW9uLFxuICAgICAgICB0aXRsZTogaW5wdXQudGl0bGUsXG4gICAgICAgIG5vdGVzOiBpbnB1dC5ub3RlcyA/PyBudWxsLFxuICAgICAgICBzdGF0dXM6ICd0b2RvJyxcbiAgICAgICAgYXNzaWduZWVBZ2VudElkczogW10sXG4gICAgICAgIGRlcGVuZHNPbk9wZXJhdGlvbklkczogaW5wdXQuZGVwZW5kc09uT3BlcmF0aW9uSWRzID8/IFtdLFxuICAgICAgICB3aXBDbGFzczogaW5wdXQud2lwQ2xhc3MgPz8gJ2ltcGxlbWVudGF0aW9uJyxcbiAgICAgICAgYmxvY2tlZFJlYXNvbjogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZU9wZXJhdGlvbklucHV0KTogUHJvbWlzZTxPcGVyYXRpb25EVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCBvcCA9IG1vY2tPcGVyYXRpb25zLmZpbmQoKG8pID0+IG8uaWQgPT09IGlkKVxuICAgICAgaWYgKCFvcCkgcmV0dXJuIG51bGxcblxuICAgICAgLy8gSW4gbW9jayBtb2RlLCB3ZSBkb24ndCBhY3R1YWxseSBtdXRhdGUgLSBqdXN0IHJldHVybiB1cGRhdGVkIERUT1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ubW9ja1RvRFRPKG9wKSxcbiAgICAgICAgLi4uKGlucHV0LnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIHsgc3RhdHVzOiBpbnB1dC5zdGF0dXMgYXMgT3BlcmF0aW9uRFRPWydzdGF0dXMnXSB9KSxcbiAgICAgICAgLi4uKGlucHV0Lm5vdGVzICE9PSB1bmRlZmluZWQgJiYgeyBub3RlczogaW5wdXQubm90ZXMgfSksXG4gICAgICAgIC4uLihpbnB1dC5ibG9ja2VkUmVhc29uICE9PSB1bmRlZmluZWQgJiYgeyBibG9ja2VkUmVhc29uOiBpbnB1dC5ibG9ja2VkUmVhc29uIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZVN0YXR1c1dpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0dXM6IHN0cmluZyxcbiAgICAgIF9hY3Rvcjogc3RyaW5nXG4gICAgKTogUHJvbWlzZTxTdGF0dXNUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgY29uc3Qgb3AgPSBtb2NrT3BlcmF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09PSBpZClcbiAgICAgIGlmICghb3ApIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHByZXZpb3VzU3RhdHVzID0gb3Auc3RhdHVzXG4gICAgICBjb25zdCBhY3Rpdml0eUlkID0gYGFjdF9tb2NrXyR7RGF0ZS5ub3coKX1gXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9wZXJhdGlvbjoge1xuICAgICAgICAgIC4uLm1vY2tUb0RUTyhvcCksXG4gICAgICAgICAgc3RhdHVzOiBuZXdTdGF0dXMgYXMgT3BlcmF0aW9uRFRPWydzdGF0dXMnXSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICAgIHByZXZpb3VzU3RhdHVzLFxuICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSEVMUEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBidWlsZFdoZXJlKGZpbHRlcnM/OiBPcGVyYXRpb25GaWx0ZXJzKSB7XG4gIGlmICghZmlsdGVycykgcmV0dXJuIHt9XG4gIGNvbnN0IHdoZXJlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gIGlmIChmaWx0ZXJzLndvcmtPcmRlcklkKSB7XG4gICAgd2hlcmUud29ya09yZGVySWQgPSBmaWx0ZXJzLndvcmtPcmRlcklkXG4gIH1cbiAgaWYgKGZpbHRlcnMuc3RhdHVzKSB7XG4gICAgd2hlcmUuc3RhdHVzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXR1cykgPyB7IGluOiBmaWx0ZXJzLnN0YXR1cyB9IDogZmlsdGVycy5zdGF0dXNcbiAgfVxuICBpZiAoZmlsdGVycy5zdGF0aW9uKSB7XG4gICAgd2hlcmUuc3RhdGlvbiA9IEFycmF5LmlzQXJyYXkoZmlsdGVycy5zdGF0aW9uKSA/IHsgaW46IGZpbHRlcnMuc3RhdGlvbiB9IDogZmlsdGVycy5zdGF0aW9uXG4gIH1cbiAgcmV0dXJuIHdoZXJlXG59XG5cbmZ1bmN0aW9uIHRvRFRPKHJvdzoge1xuICBpZDogc3RyaW5nXG4gIHdvcmtPcmRlcklkOiBzdHJpbmdcbiAgc3RhdGlvbjogc3RyaW5nXG4gIHRpdGxlOiBzdHJpbmdcbiAgbm90ZXM6IHN0cmluZyB8IG51bGxcbiAgc3RhdHVzOiBzdHJpbmdcbiAgYXNzaWduZWVBZ2VudElkczogc3RyaW5nXG4gIGRlcGVuZHNPbk9wZXJhdGlvbklkczogc3RyaW5nXG4gIHdpcENsYXNzOiBzdHJpbmdcbiAgYmxvY2tlZFJlYXNvbjogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59KTogT3BlcmF0aW9uRFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHdvcmtPcmRlcklkOiByb3cud29ya09yZGVySWQsXG4gICAgc3RhdGlvbjogcm93LnN0YXRpb24sXG4gICAgdGl0bGU6IHJvdy50aXRsZSxcbiAgICBub3Rlczogcm93Lm5vdGVzLFxuICAgIHN0YXR1czogcm93LnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgIGFzc2lnbmVlQWdlbnRJZHM6IEpTT04ucGFyc2Uocm93LmFzc2lnbmVlQWdlbnRJZHMpLFxuICAgIGRlcGVuZHNPbk9wZXJhdGlvbklkczogSlNPTi5wYXJzZShyb3cuZGVwZW5kc09uT3BlcmF0aW9uSWRzKSxcbiAgICB3aXBDbGFzczogcm93LndpcENsYXNzLFxuICAgIGJsb2NrZWRSZWFzb246IHJvdy5ibG9ja2VkUmVhc29uLFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkQXQsXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKG9wOiB0eXBlb2YgbW9ja09wZXJhdGlvbnNbbnVtYmVyXSk6IE9wZXJhdGlvbkRUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IG9wLmlkLFxuICAgIHdvcmtPcmRlcklkOiBvcC53b3JrT3JkZXJJZCxcbiAgICBzdGF0aW9uOiBvcC5zdGF0aW9uLFxuICAgIHRpdGxlOiBvcC50aXRsZSxcbiAgICBub3Rlczogb3Aubm90ZXMgPz8gbnVsbCxcbiAgICBzdGF0dXM6IG9wLnN0YXR1cyBhcyBPcGVyYXRpb25EVE9bJ3N0YXR1cyddLFxuICAgIGFzc2lnbmVlQWdlbnRJZHM6IG9wLmFzc2lnbmVlQWdlbnRJZHMsXG4gICAgZGVwZW5kc09uT3BlcmF0aW9uSWRzOiBvcC5kZXBlbmRzT25PcGVyYXRpb25JZHMsXG4gICAgd2lwQ2xhc3M6IG9wLndpcENsYXNzLFxuICAgIGJsb2NrZWRSZWFzb246IG9wLmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiBvcC5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiBvcC51cGRhdGVkQXQsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJtb2NrT3BlcmF0aW9ucyIsImNyZWF0ZURiT3BlcmF0aW9uc1JlcG8iLCJsaXN0IiwiZmlsdGVycyIsIndoZXJlIiwiYnVpbGRXaGVyZSIsInJvd3MiLCJvcGVyYXRpb24iLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJ1cGRhdGVkQXQiLCJtYXAiLCJ0b0RUTyIsImdldEJ5SWQiLCJpZCIsInJvdyIsImZpbmRVbmlxdWUiLCJsaXN0Rm9yV29ya09yZGVyIiwid29ya09yZGVySWQiLCJjcmVhdGVkQXQiLCJjb3VudEJ5U3RhdHVzIiwiZ3JvdXBzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnIiwic3RhdHVzIiwiY3JlYXRlIiwiaW5wdXQiLCJkYXRhIiwic3RhdGlvbiIsInRpdGxlIiwibm90ZXMiLCJhc3NpZ25lZUFnZW50SWRzIiwiZGVwZW5kc09uT3BlcmF0aW9uSWRzIiwiSlNPTiIsInN0cmluZ2lmeSIsIndpcENsYXNzIiwidXBkYXRlIiwiZXhpc3RpbmciLCJ1bmRlZmluZWQiLCJibG9ja2VkUmVhc29uIiwidXBkYXRlU3RhdHVzV2l0aEFjdGl2aXR5IiwibmV3U3RhdHVzIiwiYWN0b3IiLCIkdHJhbnNhY3Rpb24iLCJ0eCIsInByZXZpb3VzU3RhdHVzIiwiYWN0aXZpdHlJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzbGljZSIsImFjdGl2aXR5IiwidHMiLCJ0eXBlIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VtbWFyeSIsInBheWxvYWRKc29uIiwiY3JlYXRlTW9ja09wZXJhdGlvbnNSZXBvIiwicmVzdWx0IiwiZmlsdGVyIiwib3AiLCJzdGF0dXNlcyIsIkFycmF5IiwiaXNBcnJheSIsImluY2x1ZGVzIiwic3RhdGlvbnMiLCJtb2NrVG9EVE8iLCJmaW5kIiwibyIsImNvdW50cyIsIl9hY3RvciIsImluIiwicGFyc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/operations.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:360:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbReceiptsRepo: () => (/* binding */ createDbReceiptsRepo),\n/* harmony export */   createMockReceiptsRepo: () => (/* binding */ createMockReceiptsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _pubsub__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pubsub */ \"(instrument)/./lib/pubsub.ts\");\n/**\n * Receipts Repository\n *\n * Provides data access for receipts (command execution logs) with both DB and mock implementations.\n * Publishes receipt events to the pub/sub system for SSE streaming.\n */ \n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbReceiptsRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where,\n                orderBy: {\n                    startedAt: 'desc'\n                },\n                take: 100\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async listForWorkOrder (workOrderId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    workOrderId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listForOperation (operationId) {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    operationId\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listRunning () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findMany({\n                where: {\n                    endedAt: null\n                },\n                orderBy: {\n                    startedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.create({\n                data: {\n                    workOrderId: input.workOrderId,\n                    operationId: input.operationId ?? null,\n                    kind: input.kind,\n                    commandName: input.commandName,\n                    commandArgsJson: JSON.stringify(input.commandArgs ?? {}),\n                    startedAt: new Date()\n                }\n            });\n            return toDTO(row);\n        },\n        async append (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            // Append to the appropriate excerpt\n            const field = input.stream === 'stdout' ? 'stdoutExcerpt' : 'stderrExcerpt';\n            const currentValue = existing[field];\n            const newValue = currentValue + input.chunk;\n            // Keep only the last 10KB as excerpt\n            const maxLength = 10 * 1024;\n            const truncatedValue = newValue.length > maxLength ? '...(truncated)\\n' + newValue.slice(-maxLength) : newValue;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    [field]: truncatedValue\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return toDTO(row);\n        },\n        async finalize (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.receipt.update({\n                where: {\n                    id\n                },\n                data: {\n                    exitCode: input.exitCode,\n                    durationMs: input.durationMs,\n                    parsedJson: input.parsedJson ? JSON.stringify(input.parsedJson) : null,\n                    endedAt: new Date()\n                }\n            });\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return toDTO(row);\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst mockReceipts = [];\nfunction createMockReceiptsRepo() {\n    return {\n        async list (_filters) {\n            return [\n                ...mockReceipts\n            ].sort((a, b)=>b.startedAt.getTime() - a.startedAt.getTime());\n        },\n        async getById (id) {\n            return mockReceipts.find((r)=>r.id === id) ?? null;\n        },\n        async listForWorkOrder (workOrderId) {\n            return mockReceipts.filter((r)=>r.workOrderId === workOrderId);\n        },\n        async listForOperation (operationId) {\n            return mockReceipts.filter((r)=>r.operationId === operationId);\n        },\n        async listRunning () {\n            return mockReceipts.filter((r)=>r.endedAt === null);\n        },\n        async create (input) {\n            const receipt = {\n                id: `rcpt_mock_${Date.now()}`,\n                workOrderId: input.workOrderId,\n                operationId: input.operationId ?? null,\n                kind: input.kind,\n                commandName: input.commandName,\n                commandArgsJson: input.commandArgs ?? {},\n                exitCode: null,\n                durationMs: null,\n                stdoutExcerpt: '',\n                stderrExcerpt: '',\n                parsedJson: null,\n                startedAt: new Date(),\n                endedAt: null\n            };\n            mockReceipts.push(receipt);\n            return receipt;\n        },\n        async append (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            if (input.stream === 'stdout') {\n                receipt.stdoutExcerpt += input.chunk;\n            } else {\n                receipt.stderrExcerpt += input.chunk;\n            }\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptChunk)(id, input.stream, input.chunk);\n            return receipt;\n        },\n        async finalize (id, input) {\n            const receipt = mockReceipts.find((r)=>r.id === id);\n            if (!receipt) return null;\n            receipt.exitCode = input.exitCode;\n            receipt.durationMs = input.durationMs;\n            receipt.parsedJson = input.parsedJson ?? null;\n            receipt.endedAt = new Date();\n            // Publish to SSE stream\n            (0,_pubsub__WEBPACK_IMPORTED_MODULE_1__.publishReceiptFinalized)(id, input.exitCode, input.durationMs);\n            return receipt;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.workOrderId) {\n        where.workOrderId = filters.workOrderId;\n    }\n    if (filters.operationId) {\n        where.operationId = filters.operationId;\n    }\n    if (filters.kind) {\n        where.kind = Array.isArray(filters.kind) ? {\n            in: filters.kind\n        } : filters.kind;\n    }\n    if (filters.running !== undefined) {\n        where.endedAt = filters.running ? null : {\n            not: null\n        };\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        workOrderId: row.workOrderId,\n        operationId: row.operationId,\n        kind: row.kind,\n        commandName: row.commandName,\n        commandArgsJson: JSON.parse(row.commandArgsJson),\n        exitCode: row.exitCode,\n        durationMs: row.durationMs,\n        stdoutExcerpt: row.stdoutExcerpt,\n        stderrExcerpt: row.stderrExcerpt,\n        parsedJson: row.parsedJson ? JSON.parse(row.parsedJson) : null,\n        startedAt: row.startedAt,\n        endedAt: row.endedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSS9ELFFBQVF3QixJQUFJO1FBQUMsSUFBSXhCLFFBQVF3QixJQUFJO0lBQ2hGO0lBQ0EsSUFBSXhCLFFBQVFnRSxPQUFPLEtBQUtDLFdBQVc7UUFDakNoRSxNQUFNbUIsT0FBTyxHQUFHcEIsUUFBUWdFLE9BQU8sR0FBRyxPQUFPO1lBQUVFLEtBQUs7UUFBSztJQUN2RDtJQUNBLE9BQU9qRTtBQUNUO0FBRUEsU0FBU1MsTUFBTUcsR0FjZDtJQUNDLE9BQU87UUFDTEQsSUFBSUMsSUFBSUQsRUFBRTtRQUNWSSxhQUFhSCxJQUFJRyxXQUFXO1FBQzVCRSxhQUFhTCxJQUFJSyxXQUFXO1FBQzVCTSxNQUFNWCxJQUFJVyxJQUFJO1FBQ2RDLGFBQWFaLElBQUlZLFdBQVc7UUFDNUJDLGlCQUFpQkMsS0FBS3dDLEtBQUssQ0FBQ3RELElBQUlhLGVBQWU7UUFDL0NrQixVQUFVL0IsSUFBSStCLFFBQVE7UUFDdEJDLFlBQVloQyxJQUFJZ0MsVUFBVTtRQUMxQmEsZUFBZTdDLElBQUk2QyxhQUFhO1FBQ2hDQyxlQUFlOUMsSUFBSThDLGFBQWE7UUFDaENiLFlBQVlqQyxJQUFJaUMsVUFBVSxHQUFHbkIsS0FBS3dDLEtBQUssQ0FBQ3RELElBQUlpQyxVQUFVLElBQUk7UUFDMUR2QyxXQUFXTSxJQUFJTixTQUFTO1FBQ3hCYSxTQUFTUCxJQUFJTyxPQUFPO0lBQ3RCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vcmVjZWlwdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSZWNlaXB0cyBSZXBvc2l0b3J5XG4gKlxuICogUHJvdmlkZXMgZGF0YSBhY2Nlc3MgZm9yIHJlY2VpcHRzIChjb21tYW5kIGV4ZWN1dGlvbiBsb2dzKSB3aXRoIGJvdGggREIgYW5kIG1vY2sgaW1wbGVtZW50YXRpb25zLlxuICogUHVibGlzaGVzIHJlY2VpcHQgZXZlbnRzIHRvIHRoZSBwdWIvc3ViIHN5c3RlbSBmb3IgU1NFIHN0cmVhbWluZy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IHB1Ymxpc2hSZWNlaXB0Q2h1bmssIHB1Ymxpc2hSZWNlaXB0RmluYWxpemVkIH0gZnJvbSAnLi4vcHVic3ViJ1xuaW1wb3J0IHR5cGUgeyBSZWNlaXB0RFRPLCBSZWNlaXB0RmlsdGVycyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlUmVjZWlwdElucHV0IHtcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAga2luZDogJ3BsYXlib29rX3N0ZXAnIHwgJ2Nyb25fcnVuJyB8ICdhZ2VudF9ydW4nIHwgJ21hbnVhbCdcbiAgY29tbWFuZE5hbWU6IHN0cmluZ1xuICBjb21tYW5kQXJncz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBwZW5kUmVjZWlwdElucHV0IHtcbiAgc3RyZWFtOiAnc3Rkb3V0JyB8ICdzdGRlcnInXG4gIGNodW5rOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGaW5hbGl6ZVJlY2VpcHRJbnB1dCB7XG4gIGV4aXRDb2RlOiBudW1iZXJcbiAgZHVyYXRpb25NczogbnVtYmVyXG4gIHBhcnNlZEpzb24/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VpcHRzUmVwbyB7XG4gIGxpc3QoZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+XG4gIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPlxuICBsaXN0Rm9yT3BlcmF0aW9uKG9wZXJhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT5cbiAgbGlzdFJ1bm5pbmcoKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+XG4gIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPlxuICBhcHBlbmQoaWQ6IHN0cmluZywgaW5wdXQ6IEFwcGVuZFJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+XG4gIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERBVEFCQVNFIElNUExFTUVOVEFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEYlJlY2VpcHRzUmVwbygpOiBSZWNlaXB0c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoZmlsdGVycz86IFJlY2VpcHRGaWx0ZXJzKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgc3RhcnRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogMTAwLFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBsaXN0Rm9yV29ya09yZGVyKHdvcmtPcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgd29ya09yZGVySWQgfSxcbiAgICAgICAgb3JkZXJCeTogeyBzdGFydGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdEZvck9wZXJhdGlvbihvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxSZWNlaXB0RFRPW10+IHtcbiAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IG9wZXJhdGlvbklkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgc3RhcnRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RSdW5uaW5nKCk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBlbmRlZEF0OiBudWxsIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgc3RhcnRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcm93cy5tYXAodG9EVE8pXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd29ya09yZGVySWQ6IGlucHV0LndvcmtPcmRlcklkLFxuICAgICAgICAgIG9wZXJhdGlvbklkOiBpbnB1dC5vcGVyYXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIGtpbmQ6IGlucHV0LmtpbmQsXG4gICAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICAgIGNvbW1hbmRBcmdzSnNvbjogSlNPTi5zdHJpbmdpZnkoaW5wdXQuY29tbWFuZEFyZ3MgPz8ge30pLFxuICAgICAgICAgIHN0YXJ0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyBhcHBlbmQoaWQ6IHN0cmluZywgaW5wdXQ6IEFwcGVuZFJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIC8vIEFwcGVuZCB0byB0aGUgYXBwcm9wcmlhdGUgZXhjZXJwdFxuICAgICAgY29uc3QgZmllbGQgPSBpbnB1dC5zdHJlYW0gPT09ICdzdGRvdXQnID8gJ3N0ZG91dEV4Y2VycHQnIDogJ3N0ZGVyckV4Y2VycHQnXG4gICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBleGlzdGluZ1tmaWVsZF1cbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY3VycmVudFZhbHVlICsgaW5wdXQuY2h1bmtcblxuICAgICAgLy8gS2VlcCBvbmx5IHRoZSBsYXN0IDEwS0IgYXMgZXhjZXJwdFxuICAgICAgY29uc3QgbWF4TGVuZ3RoID0gMTAgKiAxMDI0XG4gICAgICBjb25zdCB0cnVuY2F0ZWRWYWx1ZSA9XG4gICAgICAgIG5ld1ZhbHVlLmxlbmd0aCA+IG1heExlbmd0aFxuICAgICAgICAgID8gJy4uLih0cnVuY2F0ZWQpXFxuJyArIG5ld1ZhbHVlLnNsaWNlKC1tYXhMZW5ndGgpXG4gICAgICAgICAgOiBuZXdWYWx1ZVxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEucmVjZWlwdC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7IFtmaWVsZF06IHRydW5jYXRlZFZhbHVlIH0sXG4gICAgICB9KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0Q2h1bmsoaWQsIGlucHV0LnN0cmVhbSwgaW5wdXQuY2h1bmspXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmFsaXplKGlkOiBzdHJpbmcsIGlucHV0OiBGaW5hbGl6ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBleGl0Q29kZTogaW5wdXQuZXhpdENvZGUsXG4gICAgICAgICAgZHVyYXRpb25NczogaW5wdXQuZHVyYXRpb25NcyxcbiAgICAgICAgICBwYXJzZWRKc29uOiBpbnB1dC5wYXJzZWRKc29uID8gSlNPTi5zdHJpbmdpZnkoaW5wdXQucGFyc2VkSnNvbikgOiBudWxsLFxuICAgICAgICAgIGVuZGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0RmluYWxpemVkKGlkLCBpbnB1dC5leGl0Q29kZSwgaW5wdXQuZHVyYXRpb25NcylcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgbW9ja1JlY2VpcHRzOiBSZWNlaXB0RFRPW10gPSBbXVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1JlY2VpcHRzUmVwbygpOiBSZWNlaXB0c1JlcG8ge1xuICByZXR1cm4ge1xuICAgIGFzeW5jIGxpc3QoX2ZpbHRlcnM/OiBSZWNlaXB0RmlsdGVycyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tSZWNlaXB0c10uc29ydChcbiAgICAgICAgKGEsIGIpID0+IGIuc3RhcnRlZEF0LmdldFRpbWUoKSAtIGEuc3RhcnRlZEF0LmdldFRpbWUoKVxuICAgICAgKVxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICByZXR1cm4gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKSA/PyBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JXb3JrT3JkZXIod29ya09yZGVySWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICByZXR1cm4gbW9ja1JlY2VpcHRzLmZpbHRlcigocikgPT4gci53b3JrT3JkZXJJZCA9PT0gd29ya09yZGVySWQpXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RGb3JPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICByZXR1cm4gbW9ja1JlY2VpcHRzLmZpbHRlcigocikgPT4gci5vcGVyYXRpb25JZCA9PT0gb3BlcmF0aW9uSWQpXG4gICAgfSxcblxuICAgIGFzeW5jIGxpc3RSdW5uaW5nKCk6IFByb21pc2U8UmVjZWlwdERUT1tdPiB7XG4gICAgICByZXR1cm4gbW9ja1JlY2VpcHRzLmZpbHRlcigocikgPT4gci5lbmRlZEF0ID09PSBudWxsKVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZVJlY2VpcHRJbnB1dCk6IFByb21pc2U8UmVjZWlwdERUTz4ge1xuICAgICAgY29uc3QgcmVjZWlwdDogUmVjZWlwdERUTyA9IHtcbiAgICAgICAgaWQ6IGByY3B0X21vY2tfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHdvcmtPcmRlcklkOiBpbnB1dC53b3JrT3JkZXJJZCxcbiAgICAgICAgb3BlcmF0aW9uSWQ6IGlucHV0Lm9wZXJhdGlvbklkID8/IG51bGwsXG4gICAgICAgIGtpbmQ6IGlucHV0LmtpbmQsXG4gICAgICAgIGNvbW1hbmROYW1lOiBpbnB1dC5jb21tYW5kTmFtZSxcbiAgICAgICAgY29tbWFuZEFyZ3NKc29uOiBpbnB1dC5jb21tYW5kQXJncyA/PyB7fSxcbiAgICAgICAgZXhpdENvZGU6IG51bGwsXG4gICAgICAgIGR1cmF0aW9uTXM6IG51bGwsXG4gICAgICAgIHN0ZG91dEV4Y2VycHQ6ICcnLFxuICAgICAgICBzdGRlcnJFeGNlcnB0OiAnJyxcbiAgICAgICAgcGFyc2VkSnNvbjogbnVsbCxcbiAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBlbmRlZEF0OiBudWxsLFxuICAgICAgfVxuICAgICAgbW9ja1JlY2VpcHRzLnB1c2gocmVjZWlwdClcbiAgICAgIHJldHVybiByZWNlaXB0XG4gICAgfSxcblxuICAgIGFzeW5jIGFwcGVuZChpZDogc3RyaW5nLCBpbnB1dDogQXBwZW5kUmVjZWlwdElucHV0KTogUHJvbWlzZTxSZWNlaXB0RFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgcmVjZWlwdCA9IG1vY2tSZWNlaXB0cy5maW5kKChyKSA9PiByLmlkID09PSBpZClcbiAgICAgIGlmICghcmVjZWlwdCkgcmV0dXJuIG51bGxcblxuICAgICAgaWYgKGlucHV0LnN0cmVhbSA9PT0gJ3N0ZG91dCcpIHtcbiAgICAgICAgcmVjZWlwdC5zdGRvdXRFeGNlcnB0ICs9IGlucHV0LmNodW5rXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZWNlaXB0LnN0ZGVyckV4Y2VycHQgKz0gaW5wdXQuY2h1bmtcbiAgICAgIH1cblxuICAgICAgLy8gUHVibGlzaCB0byBTU0Ugc3RyZWFtXG4gICAgICBwdWJsaXNoUmVjZWlwdENodW5rKGlkLCBpbnB1dC5zdHJlYW0sIGlucHV0LmNodW5rKVxuXG4gICAgICByZXR1cm4gcmVjZWlwdFxuICAgIH0sXG5cbiAgICBhc3luYyBmaW5hbGl6ZShpZDogc3RyaW5nLCBpbnB1dDogRmluYWxpemVSZWNlaXB0SW5wdXQpOiBQcm9taXNlPFJlY2VpcHREVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByZWNlaXB0ID0gbW9ja1JlY2VpcHRzLmZpbmQoKHIpID0+IHIuaWQgPT09IGlkKVxuICAgICAgaWYgKCFyZWNlaXB0KSByZXR1cm4gbnVsbFxuXG4gICAgICByZWNlaXB0LmV4aXRDb2RlID0gaW5wdXQuZXhpdENvZGVcbiAgICAgIHJlY2VpcHQuZHVyYXRpb25NcyA9IGlucHV0LmR1cmF0aW9uTXNcbiAgICAgIHJlY2VpcHQucGFyc2VkSnNvbiA9IGlucHV0LnBhcnNlZEpzb24gPz8gbnVsbFxuICAgICAgcmVjZWlwdC5lbmRlZEF0ID0gbmV3IERhdGUoKVxuXG4gICAgICAvLyBQdWJsaXNoIHRvIFNTRSBzdHJlYW1cbiAgICAgIHB1Ymxpc2hSZWNlaXB0RmluYWxpemVkKGlkLCBpbnB1dC5leGl0Q29kZSwgaW5wdXQuZHVyYXRpb25NcylcblxuICAgICAgcmV0dXJuIHJlY2VpcHRcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogUmVjZWlwdEZpbHRlcnMpIHtcbiAgaWYgKCFmaWx0ZXJzKSByZXR1cm4ge31cbiAgY29uc3Qgd2hlcmU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbiAgaWYgKGZpbHRlcnMud29ya09yZGVySWQpIHtcbiAgICB3aGVyZS53b3JrT3JkZXJJZCA9IGZpbHRlcnMud29ya09yZGVySWRcbiAgfVxuICBpZiAoZmlsdGVycy5vcGVyYXRpb25JZCkge1xuICAgIHdoZXJlLm9wZXJhdGlvbklkID0gZmlsdGVycy5vcGVyYXRpb25JZFxuICB9XG4gIGlmIChmaWx0ZXJzLmtpbmQpIHtcbiAgICB3aGVyZS5raW5kID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLmtpbmQpID8geyBpbjogZmlsdGVycy5raW5kIH0gOiBmaWx0ZXJzLmtpbmRcbiAgfVxuICBpZiAoZmlsdGVycy5ydW5uaW5nICE9PSB1bmRlZmluZWQpIHtcbiAgICB3aGVyZS5lbmRlZEF0ID0gZmlsdGVycy5ydW5uaW5nID8gbnVsbCA6IHsgbm90OiBudWxsIH1cbiAgfVxuICByZXR1cm4gd2hlcmVcbn1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgd29ya09yZGVySWQ6IHN0cmluZ1xuICBvcGVyYXRpb25JZDogc3RyaW5nIHwgbnVsbFxuICBraW5kOiBzdHJpbmdcbiAgY29tbWFuZE5hbWU6IHN0cmluZ1xuICBjb21tYW5kQXJnc0pzb246IHN0cmluZ1xuICBleGl0Q29kZTogbnVtYmVyIHwgbnVsbFxuICBkdXJhdGlvbk1zOiBudW1iZXIgfCBudWxsXG4gIHN0ZG91dEV4Y2VycHQ6IHN0cmluZ1xuICBzdGRlcnJFeGNlcnB0OiBzdHJpbmdcbiAgcGFyc2VkSnNvbjogc3RyaW5nIHwgbnVsbFxuICBzdGFydGVkQXQ6IERhdGVcbiAgZW5kZWRBdDogRGF0ZSB8IG51bGxcbn0pOiBSZWNlaXB0RFRPIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIHdvcmtPcmRlcklkOiByb3cud29ya09yZGVySWQsXG4gICAgb3BlcmF0aW9uSWQ6IHJvdy5vcGVyYXRpb25JZCxcbiAgICBraW5kOiByb3cua2luZCBhcyBSZWNlaXB0RFRPWydraW5kJ10sXG4gICAgY29tbWFuZE5hbWU6IHJvdy5jb21tYW5kTmFtZSxcbiAgICBjb21tYW5kQXJnc0pzb246IEpTT04ucGFyc2Uocm93LmNvbW1hbmRBcmdzSnNvbiksXG4gICAgZXhpdENvZGU6IHJvdy5leGl0Q29kZSxcbiAgICBkdXJhdGlvbk1zOiByb3cuZHVyYXRpb25NcyxcbiAgICBzdGRvdXRFeGNlcnB0OiByb3cuc3Rkb3V0RXhjZXJwdCxcbiAgICBzdGRlcnJFeGNlcnB0OiByb3cuc3RkZXJyRXhjZXJwdCxcbiAgICBwYXJzZWRKc29uOiByb3cucGFyc2VkSnNvbiA/IEpTT04ucGFyc2Uocm93LnBhcnNlZEpzb24pIDogbnVsbCxcbiAgICBzdGFydGVkQXQ6IHJvdy5zdGFydGVkQXQsXG4gICAgZW5kZWRBdDogcm93LmVuZGVkQXQsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJwdWJsaXNoUmVjZWlwdENodW5rIiwicHVibGlzaFJlY2VpcHRGaW5hbGl6ZWQiLCJjcmVhdGVEYlJlY2VpcHRzUmVwbyIsImxpc3QiLCJmaWx0ZXJzIiwid2hlcmUiLCJidWlsZFdoZXJlIiwicm93cyIsInJlY2VpcHQiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJzdGFydGVkQXQiLCJ0YWtlIiwibWFwIiwidG9EVE8iLCJnZXRCeUlkIiwiaWQiLCJyb3ciLCJmaW5kVW5pcXVlIiwibGlzdEZvcldvcmtPcmRlciIsIndvcmtPcmRlcklkIiwibGlzdEZvck9wZXJhdGlvbiIsIm9wZXJhdGlvbklkIiwibGlzdFJ1bm5pbmciLCJlbmRlZEF0IiwiY3JlYXRlIiwiaW5wdXQiLCJkYXRhIiwia2luZCIsImNvbW1hbmROYW1lIiwiY29tbWFuZEFyZ3NKc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbW1hbmRBcmdzIiwiRGF0ZSIsImFwcGVuZCIsImV4aXN0aW5nIiwiZmllbGQiLCJzdHJlYW0iLCJjdXJyZW50VmFsdWUiLCJuZXdWYWx1ZSIsImNodW5rIiwibWF4TGVuZ3RoIiwidHJ1bmNhdGVkVmFsdWUiLCJsZW5ndGgiLCJzbGljZSIsInVwZGF0ZSIsImZpbmFsaXplIiwiZXhpdENvZGUiLCJkdXJhdGlvbk1zIiwicGFyc2VkSnNvbiIsIm1vY2tSZWNlaXB0cyIsImNyZWF0ZU1vY2tSZWNlaXB0c1JlcG8iLCJfZmlsdGVycyIsInNvcnQiLCJhIiwiYiIsImdldFRpbWUiLCJmaW5kIiwiciIsImZpbHRlciIsIm5vdyIsInN0ZG91dEV4Y2VycHQiLCJzdGRlcnJFeGNlcnB0IiwicHVzaCIsIkFycmF5IiwiaXNBcnJheSIsImluIiwicnVubmluZyIsInVuZGVmaW5lZCIsIm5vdCIsInBhcnNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/receipts.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:390:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbStationsRepo: () => (/* binding */ createDbStationsRepo),\n/* harmony export */   createMockStationsRepo: () => (/* binding */ createMockStationsRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/**\n * Stations Repository\n *\n * Provides data access for stations with both DB and mock implementations.\n */ \n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbStationsRepo() {\n    return {\n        async list () {\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findMany({\n                orderBy: [\n                    {\n                        sortOrder: 'asc'\n                    },\n                    {\n                        name: 'asc'\n                    }\n                ]\n            });\n            return rows.map(toDTO);\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByName (name) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    name\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async create (input) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.create({\n                data: {\n                    id: input.id,\n                    name: input.name,\n                    icon: input.icon,\n                    description: input.description ?? null,\n                    color: input.color ?? null,\n                    sortOrder: input.sortOrder ?? 0\n                }\n            });\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.name !== undefined && {\n                        name: input.name\n                    },\n                    ...input.icon !== undefined && {\n                        icon: input.icon\n                    },\n                    ...input.description !== undefined && {\n                        description: input.description\n                    },\n                    ...input.color !== undefined && {\n                        color: input.color\n                    },\n                    ...input.sortOrder !== undefined && {\n                        sortOrder: input.sortOrder\n                    }\n                }\n            });\n            return toDTO(row);\n        },\n        async delete (id) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return false;\n            await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.station.delete({\n                where: {\n                    id\n                }\n            });\n            return true;\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nconst DEFAULT_STATIONS = [\n    {\n        id: 'spec',\n        name: 'spec',\n        icon: 'file-text',\n        description: 'Planning & specifications',\n        color: null,\n        sortOrder: 10\n    },\n    {\n        id: 'build',\n        name: 'build',\n        icon: 'hammer',\n        description: 'Implementation',\n        color: null,\n        sortOrder: 20\n    },\n    {\n        id: 'qa',\n        name: 'qa',\n        icon: 'check-circle',\n        description: 'Quality assurance',\n        color: null,\n        sortOrder: 30\n    },\n    {\n        id: 'ops',\n        name: 'ops',\n        icon: 'settings',\n        description: 'Operations',\n        color: null,\n        sortOrder: 40\n    }\n];\nconst mockStations = DEFAULT_STATIONS.map((s)=>({\n        ...s,\n        createdAt: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        updatedAt: new Date()\n    }));\nfunction createMockStationsRepo() {\n    return {\n        async list () {\n            return [\n                ...mockStations\n            ].sort((a, b)=>a.sortOrder - b.sortOrder || a.name.localeCompare(b.name));\n        },\n        async getById (id) {\n            return mockStations.find((s)=>s.id === id) ?? null;\n        },\n        async getByName (name) {\n            return mockStations.find((s)=>s.name === name) ?? null;\n        },\n        async create (input) {\n            const now = new Date();\n            const dto = {\n                id: input.id,\n                name: input.name,\n                icon: input.icon,\n                description: input.description ?? null,\n                color: input.color ?? null,\n                sortOrder: input.sortOrder ?? 0,\n                createdAt: now,\n                updatedAt: now\n            };\n            mockStations.push(dto);\n            return dto;\n        },\n        async update (id, input) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return null;\n            const existing = mockStations[idx];\n            const updated = {\n                ...existing,\n                ...input.name !== undefined && {\n                    name: input.name\n                },\n                ...input.icon !== undefined && {\n                    icon: input.icon\n                },\n                ...input.description !== undefined && {\n                    description: input.description ?? null\n                },\n                ...input.color !== undefined && {\n                    color: input.color ?? null\n                },\n                ...input.sortOrder !== undefined && {\n                    sortOrder: input.sortOrder\n                },\n                updatedAt: new Date()\n            };\n            mockStations[idx] = updated;\n            return updated;\n        },\n        async delete (id) {\n            const idx = mockStations.findIndex((s)=>s.id === id);\n            if (idx === -1) return false;\n            mockStations.splice(idx, 1);\n            return true;\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        name: row.name,\n        icon: row.icon,\n        description: row.description,\n        color: row.color,\n        sortOrder: row.sortOrder,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVBLE1BQU1sQixRQUFPZCxFQUFVO1lBQ3JCLE1BQU04QixNQUFNZCxhQUFhZSxTQUFTLENBQUMsQ0FBQ2QsSUFBTUEsRUFBRWpCLEVBQUUsS0FBS0E7WUFDbkQsSUFBSThCLFFBQVEsQ0FBQyxHQUFHLE9BQU87WUFDdkJkLGFBQWFpQixNQUFNLENBQUNILEtBQUs7WUFDekIsT0FBTztRQUNUO0lBQ0Y7QUFDRjtBQUVBLCtFQUErRTtBQUMvRSxVQUFVO0FBQ1YsK0VBQStFO0FBRS9FLFNBQVNoQyxNQUFNRyxHQVNkO0lBQ0MsT0FBTztRQUNMRCxJQUFJQyxJQUFJRCxFQUFFO1FBQ1ZKLE1BQU1LLElBQUlMLElBQUk7UUFDZFksTUFBTVAsSUFBSU8sSUFBSTtRQUNkQyxhQUFhUixJQUFJUSxXQUFXO1FBQzVCQyxPQUFPVCxJQUFJUyxLQUFLO1FBQ2hCZixXQUFXTSxJQUFJTixTQUFTO1FBQ3hCdUIsV0FBV2pCLElBQUlpQixTQUFTO1FBQ3hCRyxXQUFXcEIsSUFBSW9CLFNBQVM7SUFDMUI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3Nhdm9yZ3NlcnZlci9jbGF3ZC9wcm9qZWN0cy9zYXZPUkcvYXBwcy9jbGF3Y29udHJvbC9saWIvcmVwby9zdGF0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0YXRpb25zIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igc3RhdGlvbnMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB0eXBlIHsgU3RhdGlvbkRUTyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFJFUE9TSVRPUlkgSU5URVJGQUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlU3RhdGlvbklucHV0IHtcbiAgLyoqIFN0YWJsZSwgdXNlci1mYWNpbmcgaWQgKGtlYmFiLWNhc2Ugc2x1ZykuICovXG4gIGlkOiBzdHJpbmdcbiAgbmFtZTogc3RyaW5nXG4gIGljb246IHN0cmluZ1xuICBkZXNjcmlwdGlvbj86IHN0cmluZyB8IG51bGxcbiAgY29sb3I/OiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcj86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZVN0YXRpb25JbnB1dCB7XG4gIG5hbWU/OiBzdHJpbmdcbiAgaWNvbj86IHN0cmluZ1xuICBkZXNjcmlwdGlvbj86IHN0cmluZyB8IG51bGxcbiAgY29sb3I/OiBzdHJpbmcgfCBudWxsXG4gIHNvcnRPcmRlcj86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpb25zUmVwbyB7XG4gIGxpc3QoKTogUHJvbWlzZTxTdGF0aW9uRFRPW10+XG4gIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+XG4gIGdldEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPlxuICBjcmVhdGUoaW5wdXQ6IENyZWF0ZVN0YXRpb25JbnB1dCk6IFByb21pc2U8U3RhdGlvbkRUTz5cbiAgdXBkYXRlKGlkOiBzdHJpbmcsIGlucHV0OiBVcGRhdGVTdGF0aW9uSW5wdXQpOiBQcm9taXNlPFN0YXRpb25EVE8gfCBudWxsPlxuICBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREFUQUJBU0UgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURiU3RhdGlvbnNSZXBvKCk6IFN0YXRpb25zUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdCgpOiBQcm9taXNlPFN0YXRpb25EVE9bXT4ge1xuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS5zdGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogW3sgc29ydE9yZGVyOiAnYXNjJyB9LCB7IG5hbWU6ICdhc2MnIH1dLFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIHJldHVybiByb3cgPyB0b0RUTyhyb3cpIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IG5hbWUgfSB9KVxuICAgICAgcmV0dXJuIHJvdyA/IHRvRFRPKHJvdykgOiBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6IGlucHV0LmlkLFxuICAgICAgICAgIG5hbWU6IGlucHV0Lm5hbWUsXG4gICAgICAgICAgaWNvbjogaW5wdXQuaWNvbixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgICBjb2xvcjogaW5wdXQuY29sb3IgPz8gbnVsbCxcbiAgICAgICAgICBzb3J0T3JkZXI6IGlucHV0LnNvcnRPcmRlciA/PyAwLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuc3RhdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLnN0YXRpb24udXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC4uLihpbnB1dC5uYW1lICE9PSB1bmRlZmluZWQgJiYgeyBuYW1lOiBpbnB1dC5uYW1lIH0pLFxuICAgICAgICAgIC4uLihpbnB1dC5pY29uICE9PSB1bmRlZmluZWQgJiYgeyBpY29uOiBpbnB1dC5pY29uIH0pLFxuICAgICAgICAgIC4uLihpbnB1dC5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkICYmIHsgZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uIH0pLFxuICAgICAgICAgIC4uLihpbnB1dC5jb2xvciAhPT0gdW5kZWZpbmVkICYmIHsgY29sb3I6IGlucHV0LmNvbG9yIH0pLFxuICAgICAgICAgIC4uLihpbnB1dC5zb3J0T3JkZXIgIT09IHVuZGVmaW5lZCAmJiB7IHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyIH0pLFxuICAgICAgICB9LFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRvRFRPKHJvdylcbiAgICB9LFxuXG4gICAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLnN0YXRpb24uZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSlcbiAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBmYWxzZVxuICAgICAgYXdhaXQgcHJpc21hLnN0YXRpb24uZGVsZXRlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PQ0sgSU1QTEVNRU5UQVRJT05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgREVGQVVMVF9TVEFUSU9OUzogQXJyYXk8T21pdDxTdGF0aW9uRFRPLCAnY3JlYXRlZEF0JyB8ICd1cGRhdGVkQXQnPj4gPSBbXG4gIHtcbiAgICBpZDogJ3NwZWMnLFxuICAgIG5hbWU6ICdzcGVjJyxcbiAgICBpY29uOiAnZmlsZS10ZXh0JyxcbiAgICBkZXNjcmlwdGlvbjogJ1BsYW5uaW5nICYgc3BlY2lmaWNhdGlvbnMnLFxuICAgIGNvbG9yOiBudWxsLFxuICAgIHNvcnRPcmRlcjogMTAsXG4gIH0sXG4gIHtcbiAgICBpZDogJ2J1aWxkJyxcbiAgICBuYW1lOiAnYnVpbGQnLFxuICAgIGljb246ICdoYW1tZXInLFxuICAgIGRlc2NyaXB0aW9uOiAnSW1wbGVtZW50YXRpb24nLFxuICAgIGNvbG9yOiBudWxsLFxuICAgIHNvcnRPcmRlcjogMjAsXG4gIH0sXG4gIHtcbiAgICBpZDogJ3FhJyxcbiAgICBuYW1lOiAncWEnLFxuICAgIGljb246ICdjaGVjay1jaXJjbGUnLFxuICAgIGRlc2NyaXB0aW9uOiAnUXVhbGl0eSBhc3N1cmFuY2UnLFxuICAgIGNvbG9yOiBudWxsLFxuICAgIHNvcnRPcmRlcjogMzAsXG4gIH0sXG4gIHtcbiAgICBpZDogJ29wcycsXG4gICAgbmFtZTogJ29wcycsXG4gICAgaWNvbjogJ3NldHRpbmdzJyxcbiAgICBkZXNjcmlwdGlvbjogJ09wZXJhdGlvbnMnLFxuICAgIGNvbG9yOiBudWxsLFxuICAgIHNvcnRPcmRlcjogNDAsXG4gIH0sXG5dXG5cbmNvbnN0IG1vY2tTdGF0aW9uczogU3RhdGlvbkRUT1tdID0gREVGQVVMVF9TVEFUSU9OUy5tYXAoKHMpID0+ICh7XG4gIC4uLnMsXG4gIGNyZWF0ZWRBdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG59KSlcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tTdGF0aW9uc1JlcG8oKTogU3RhdGlvbnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KCk6IFByb21pc2U8U3RhdGlvbkRUT1tdPiB7XG4gICAgICByZXR1cm4gWy4uLm1vY2tTdGF0aW9uc10uc29ydCgoYSwgYikgPT4gKGEuc29ydE9yZGVyIC0gYi5zb3J0T3JkZXIpIHx8IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrU3RhdGlvbnMuZmluZCgocykgPT4gcy5pZCA9PT0gaWQpID8/IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8U3RhdGlvbkRUTyB8IG51bGw+IHtcbiAgICAgIHJldHVybiBtb2NrU3RhdGlvbnMuZmluZCgocykgPT4gcy5uYW1lID09PSBuYW1lKSA/PyBudWxsXG4gICAgfSxcblxuICAgIGFzeW5jIGNyZWF0ZShpbnB1dDogQ3JlYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPPiB7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICBjb25zdCBkdG86IFN0YXRpb25EVE8gPSB7XG4gICAgICAgIGlkOiBpbnB1dC5pZCxcbiAgICAgICAgbmFtZTogaW5wdXQubmFtZSxcbiAgICAgICAgaWNvbjogaW5wdXQuaWNvbixcbiAgICAgICAgZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uID8/IG51bGwsXG4gICAgICAgIGNvbG9yOiBpbnB1dC5jb2xvciA/PyBudWxsLFxuICAgICAgICBzb3J0T3JkZXI6IGlucHV0LnNvcnRPcmRlciA/PyAwLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgICB9XG4gICAgICBtb2NrU3RhdGlvbnMucHVzaChkdG8pXG4gICAgICByZXR1cm4gZHRvXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlU3RhdGlvbklucHV0KTogUHJvbWlzZTxTdGF0aW9uRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3QgaWR4ID0gbW9ja1N0YXRpb25zLmZpbmRJbmRleCgocykgPT4gcy5pZCA9PT0gaWQpXG4gICAgICBpZiAoaWR4ID09PSAtMSkgcmV0dXJuIG51bGxcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbW9ja1N0YXRpb25zW2lkeF1cbiAgICAgIGNvbnN0IHVwZGF0ZWQ6IFN0YXRpb25EVE8gPSB7XG4gICAgICAgIC4uLmV4aXN0aW5nLFxuICAgICAgICAuLi4oaW5wdXQubmFtZSAhPT0gdW5kZWZpbmVkICYmIHsgbmFtZTogaW5wdXQubmFtZSB9KSxcbiAgICAgICAgLi4uKGlucHV0Lmljb24gIT09IHVuZGVmaW5lZCAmJiB7IGljb246IGlucHV0Lmljb24gfSksXG4gICAgICAgIC4uLihpbnB1dC5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkICYmIHsgZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uID8/IG51bGwgfSksXG4gICAgICAgIC4uLihpbnB1dC5jb2xvciAhPT0gdW5kZWZpbmVkICYmIHsgY29sb3I6IGlucHV0LmNvbG9yID8/IG51bGwgfSksXG4gICAgICAgIC4uLihpbnB1dC5zb3J0T3JkZXIgIT09IHVuZGVmaW5lZCAmJiB7IHNvcnRPcmRlcjogaW5wdXQuc29ydE9yZGVyIH0pLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9XG4gICAgICBtb2NrU3RhdGlvbnNbaWR4XSA9IHVwZGF0ZWRcbiAgICAgIHJldHVybiB1cGRhdGVkXG4gICAgfSxcblxuICAgIGFzeW5jIGRlbGV0ZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICBjb25zdCBpZHggPSBtb2NrU3RhdGlvbnMuZmluZEluZGV4KChzKSA9PiBzLmlkID09PSBpZClcbiAgICAgIGlmIChpZHggPT09IC0xKSByZXR1cm4gZmFsc2VcbiAgICAgIG1vY2tTdGF0aW9ucy5zcGxpY2UoaWR4LCAxKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gdG9EVE8ocm93OiB7XG4gIGlkOiBzdHJpbmdcbiAgbmFtZTogc3RyaW5nXG4gIGljb246IHN0cmluZ1xuICBkZXNjcmlwdGlvbjogc3RyaW5nIHwgbnVsbFxuICBjb2xvcjogc3RyaW5nIHwgbnVsbFxuICBzb3J0T3JkZXI6IG51bWJlclxuICBjcmVhdGVkQXQ6IERhdGVcbiAgdXBkYXRlZEF0OiBEYXRlXG59KTogU3RhdGlvbkRUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICBpY29uOiByb3cuaWNvbixcbiAgICBkZXNjcmlwdGlvbjogcm93LmRlc2NyaXB0aW9uLFxuICAgIGNvbG9yOiByb3cuY29sb3IsXG4gICAgc29ydE9yZGVyOiByb3cuc29ydE9yZGVyLFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRBdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkQXQsXG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbInByaXNtYSIsImNyZWF0ZURiU3RhdGlvbnNSZXBvIiwibGlzdCIsInJvd3MiLCJzdGF0aW9uIiwiZmluZE1hbnkiLCJvcmRlckJ5Iiwic29ydE9yZGVyIiwibmFtZSIsIm1hcCIsInRvRFRPIiwiZ2V0QnlJZCIsImlkIiwicm93IiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiZ2V0QnlOYW1lIiwiY3JlYXRlIiwiaW5wdXQiLCJkYXRhIiwiaWNvbiIsImRlc2NyaXB0aW9uIiwiY29sb3IiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImRlbGV0ZSIsIkRFRkFVTFRfU1RBVElPTlMiLCJtb2NrU3RhdGlvbnMiLCJzIiwiY3JlYXRlZEF0IiwiRGF0ZSIsIm5vdyIsInVwZGF0ZWRBdCIsImNyZWF0ZU1vY2tTdGF0aW9uc1JlcG8iLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwiZmluZCIsImR0byIsInB1c2giLCJpZHgiLCJmaW5kSW5kZXgiLCJ1cGRhdGVkIiwic3BsaWNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/stations.ts\n");
apps/clawcontrol/.next/dev/server/_instrument_lib_sync-agents_ts.js:400:eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDbWorkOrdersRepo: () => (/* binding */ createDbWorkOrdersRepo),\n/* harmony export */   createMockWorkOrdersRepo: () => (/* binding */ createMockWorkOrdersRepo)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db */ \"(instrument)/./lib/db.ts\");\n/* harmony import */ var _db_fts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/fts */ \"(instrument)/./lib/db/fts.ts\");\n/* harmony import */ var _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clawcontrol/core */ \"(instrument)/../../packages/core/src/index.ts\");\n/**\n * Work Orders Repository\n *\n * Provides data access for work orders with both DB and mock implementations.\n */ \n\n\n// ============================================================================\n// DATABASE IMPLEMENTATION\n// ============================================================================\nfunction createDbWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                }\n            });\n            return rows.map(toDTO);\n        },\n        async listWithOps (filters) {\n            const where = buildWhere(filters);\n            const rows = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findMany({\n                where,\n                orderBy: {\n                    updatedAt: 'desc'\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        }\n                    }\n                }\n            });\n            return rows.map((row)=>({\n                    ...toDTO(row),\n                    operations: row.operations.map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async getByCode (code) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    code\n                }\n            });\n            return row ? toDTO(row) : null;\n        },\n        async countByState () {\n            const groups = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.groupBy({\n                by: [\n                    'state'\n                ],\n                _count: {\n                    id: true\n                }\n            });\n            return Object.fromEntries(groups.map((g)=>[\n                    g.state,\n                    g._count.id\n                ]));\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.count({\n                where: {\n                    state: 'shipped',\n                    shippedAt: {\n                        gte: today\n                    }\n                }\n            });\n        },\n        async getByIdWithOps (id) {\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    operations: {\n                        select: {\n                            id: true,\n                            status: true\n                        },\n                        orderBy: {\n                            createdAt: 'asc'\n                        }\n                    }\n                }\n            });\n            if (!row) return null;\n            return {\n                ...toDTO(row),\n                operations: row.operations.map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate next code\n            const lastWo = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findFirst({\n                orderBy: {\n                    code: 'desc'\n                },\n                select: {\n                    code: true\n                }\n            });\n            const lastNum = lastWo ? parseInt(lastWo.code.replace('WO-', ''), 10) : 0;\n            const code = `WO-${String(lastNum + 1).padStart(3, '0')}`;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.create({\n                data: {\n                    code,\n                    title: input.title,\n                    goalMd: input.goalMd,\n                    state: 'planned',\n                    priority: input.priority || 'P2',\n                    owner: input.owner || 'user',\n                    routingTemplate: input.routingTemplate || 'default_routing'\n                }\n            });\n            // Index for search\n            await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            return toDTO(row);\n        },\n        async update (id, input) {\n            const existing = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!existing) return null;\n            const row = await _db__WEBPACK_IMPORTED_MODULE_0__.prisma.workOrder.update({\n                where: {\n                    id\n                },\n                data: {\n                    ...input.title !== undefined && {\n                        title: input.title\n                    },\n                    ...input.goalMd !== undefined && {\n                        goalMd: input.goalMd\n                    },\n                    ...input.state !== undefined && {\n                        state: input.state\n                    },\n                    ...input.priority !== undefined && {\n                        priority: input.priority\n                    },\n                    ...input.owner !== undefined && {\n                        owner: input.owner\n                    },\n                    ...input.blockedReason !== undefined && {\n                        blockedReason: input.blockedReason\n                    },\n                    ...input.state === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                }\n            });\n            // Re-index for search if title or goal changed\n            if (input.title !== undefined || input.goalMd !== undefined) {\n                await (0,_db_fts__WEBPACK_IMPORTED_MODULE_1__.indexWorkOrder)(row.id, row.code, row.title, row.goalMd);\n            }\n            return toDTO(row);\n        },\n        async updateStateWithActivity (id, newState, actor) {\n            return _db__WEBPACK_IMPORTED_MODULE_0__.prisma.$transaction(async (tx)=>{\n                // Get current state\n                const existing = await tx.workOrder.findUnique({\n                    where: {\n                        id\n                    }\n                });\n                if (!existing) return null;\n                const previousState = existing.state;\n                // Update work order\n                const row = await tx.workOrder.update({\n                    where: {\n                        id\n                    },\n                    data: {\n                        state: newState,\n                        ...newState === 'shipped' && {\n                            shippedAt: new Date()\n                        }\n                    }\n                });\n                // Create activity record\n                const activityId = `act_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n                await tx.activity.create({\n                    data: {\n                        id: activityId,\n                        ts: new Date(),\n                        type: 'work_order.state_changed',\n                        actor,\n                        entityType: 'work_order',\n                        entityId: id,\n                        summary: `Work order transitioned to ${newState}`,\n                        payloadJson: JSON.stringify({\n                            previousState,\n                            newState\n                        })\n                    }\n                });\n                return {\n                    workOrder: toDTO(row),\n                    previousState,\n                    activityId\n                };\n            });\n        }\n    };\n}\n// ============================================================================\n// MOCK IMPLEMENTATION\n// ============================================================================\nfunction createMockWorkOrdersRepo() {\n    return {\n        async list (filters) {\n            let result = [\n                ..._clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders\n            ];\n            if (filters?.state) {\n                const states = Array.isArray(filters.state) ? filters.state : [\n                    filters.state\n                ];\n                result = result.filter((wo)=>states.includes(wo.state));\n            }\n            if (filters?.priority) {\n                const priorities = Array.isArray(filters.priority) ? filters.priority : [\n                    filters.priority\n                ];\n                result = result.filter((wo)=>priorities.includes(wo.priority));\n            }\n            if (filters?.owner) {\n                result = result.filter((wo)=>wo.owner === filters.owner);\n            }\n            return result.map(mockToDTO);\n        },\n        async listWithOps (filters) {\n            const workOrders = await this.list(filters);\n            return workOrders.map((wo)=>({\n                    ...wo,\n                    operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === wo.id).map((op)=>({\n                            id: op.id,\n                            status: op.status\n                        }))\n                }));\n        },\n        async getById (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async getByCode (code) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.code === code);\n            return wo ? mockToDTO(wo) : null;\n        },\n        async countByState () {\n            const counts = {};\n            for (const wo of _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders){\n                counts[wo.state] = (counts[wo.state] || 0) + 1;\n            }\n            return counts;\n        },\n        async countShippedToday () {\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            return _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.filter((wo)=>wo.state === 'shipped' && wo.shippedAt && wo.shippedAt >= today).length;\n        },\n        async getByIdWithOps (id) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            return {\n                ...mockToDTO(wo),\n                operations: _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockOperations.filter((op)=>op.workOrderId === id).map((op)=>({\n                        id: op.id,\n                        status: op.status\n                    }))\n            };\n        },\n        async create (input) {\n            // Generate mock ID and code\n            const id = `wo_mock_${Date.now()}`;\n            const code = `WO-${String(_clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.length + 1).padStart(3, '0')}`;\n            const now = new Date();\n            const newWo = {\n                id,\n                code,\n                title: input.title,\n                goalMd: input.goalMd,\n                state: 'planned',\n                priority: input.priority || 'P2',\n                owner: input.owner || 'user',\n                routingTemplate: input.routingTemplate || 'default_routing',\n                blockedReason: null,\n                createdAt: now,\n                updatedAt: now,\n                shippedAt: null\n            };\n            // In mock mode, we don't persist - just return the DTO\n            return mockToDTO(newWo);\n        },\n        async update (id, input) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            // In mock mode, we don't actually mutate - just return updated DTO\n            return {\n                ...mockToDTO(wo),\n                ...input.title !== undefined && {\n                    title: input.title\n                },\n                ...input.goalMd !== undefined && {\n                    goalMd: input.goalMd\n                },\n                ...input.state !== undefined && {\n                    state: input.state\n                },\n                ...input.priority !== undefined && {\n                    priority: input.priority\n                },\n                ...input.owner !== undefined && {\n                    owner: input.owner\n                },\n                ...input.blockedReason !== undefined && {\n                    blockedReason: input.blockedReason\n                },\n                updatedAt: new Date()\n            };\n        },\n        async updateStateWithActivity (id, newState, _actor) {\n            const wo = _clawcontrol_core__WEBPACK_IMPORTED_MODULE_2__.mockWorkOrders.find((w)=>w.id === id);\n            if (!wo) return null;\n            const previousState = wo.state;\n            const activityId = `act_mock_${Date.now()}`;\n            return {\n                workOrder: {\n                    ...mockToDTO(wo),\n                    state: newState,\n                    updatedAt: new Date(),\n                    ...newState === 'shipped' && {\n                        shippedAt: new Date()\n                    }\n                },\n                previousState,\n                activityId\n            };\n        }\n    };\n}\n// ============================================================================\n// HELPERS\n// ============================================================================\nfunction buildWhere(filters) {\n    if (!filters) return {};\n    const where = {};\n    if (filters.state) {\n        where.state = Array.isArray(filters.state) ? {\n            in: filters.state\n        } : filters.state;\n    }\n    if (filters.priority) {\n        where.priority = Array.isArray(filters.priority) ? {\n            in: filters.priority\n        } : filters.priority;\n    }\n    if (filters.owner) {\n        where.owner = filters.owner;\n    }\n    return where;\n}\nfunction toDTO(row) {\n    return {\n        id: row.id,\n        code: row.code,\n        title: row.title,\n        goalMd: row.goalMd,\n        state: row.state,\n        priority: row.priority,\n        owner: row.owner,\n        routingTemplate: row.routingTemplate,\n        blockedReason: row.blockedReason,\n        createdAt: row.createdAt,\n        updatedAt: row.updatedAt,\n        shippedAt: row.shippedAt\n    };\n}\nfunction mockToDTO(wo) {\n    return {\n        id: wo.id,\n        code: wo.code,\n        title: wo.title,\n        goalMd: wo.goalMd,\n        state: wo.state,\n        priority: wo.priority,\n        owner: wo.owner,\n        routingTemplate: wo.routingTemplate,\n        blockedReason: wo.blockedReason,\n        createdAt: wo.createdAt,\n        updatedAt: wo.updatedAt,\n        shippedAt: wo.shippedAt\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aEMsZUFBZTtRQUNuQ0ksZUFBZTRCLEdBQUc1QixhQUFhO1FBQy9CbkIsV0FBVytDLEdBQUcvQyxTQUFTO1FBQ3ZCaEMsV0FBVytFLEdBQUcvRSxTQUFTO1FBQ3ZCNkIsV0FBV2tELEdBQUdsRCxTQUFTO0lBQ3pCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYXZvcmdzZXJ2ZXIvY2xhd2QvcHJvamVjdHMvc2F2T1JHL2FwcHMvY2xhd2NvbnRyb2wvbGliL3JlcG8vd29ya09yZGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFdvcmsgT3JkZXJzIFJlcG9zaXRvcnlcbiAqXG4gKiBQcm92aWRlcyBkYXRhIGFjY2VzcyBmb3Igd29yayBvcmRlcnMgd2l0aCBib3RoIERCIGFuZCBtb2NrIGltcGxlbWVudGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9kYidcbmltcG9ydCB7IGluZGV4V29ya09yZGVyIH0gZnJvbSAnLi4vZGIvZnRzJ1xuaW1wb3J0IHsgbW9ja1dvcmtPcmRlcnMsIG1vY2tPcGVyYXRpb25zIH0gZnJvbSAnQGNsYXdjb250cm9sL2NvcmUnXG5pbXBvcnQgdHlwZSB7XG4gIFdvcmtPcmRlckRUTyxcbiAgV29ya09yZGVyV2l0aE9wc0RUTyxcbiAgV29ya09yZGVyRmlsdGVycyxcbn0gZnJvbSAnLi90eXBlcydcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUkVQT1NJVE9SWSBJTlRFUkZBQ0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVXb3JrT3JkZXJJbnB1dCB7XG4gIHRpdGxlOiBzdHJpbmdcbiAgZ29hbE1kOiBzdHJpbmdcbiAgcHJpb3JpdHk/OiBzdHJpbmdcbiAgb3duZXI/OiBzdHJpbmdcbiAgcm91dGluZ1RlbXBsYXRlPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlV29ya09yZGVySW5wdXQge1xuICB0aXRsZT86IHN0cmluZ1xuICBnb2FsTWQ/OiBzdHJpbmdcbiAgc3RhdGU/OiBzdHJpbmdcbiAgcHJpb3JpdHk/OiBzdHJpbmdcbiAgb3duZXI/OiBzdHJpbmdcbiAgYmxvY2tlZFJlYXNvbj86IHN0cmluZyB8IG51bGxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdGF0ZVRyYW5zaXRpb25SZXN1bHQge1xuICB3b3JrT3JkZXI6IFdvcmtPcmRlckRUT1xuICBwcmV2aW91c1N0YXRlOiBzdHJpbmdcbiAgYWN0aXZpdHlJZDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya09yZGVyc1JlcG8ge1xuICBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT5cbiAgbGlzdFdpdGhPcHMoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE9bXT5cbiAgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPlxuICBnZXRCeUlkV2l0aE9wcyhpZDogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJXaXRoT3BzRFRPIHwgbnVsbD5cbiAgZ2V0QnlDb2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD5cbiAgY291bnRCeVN0YXRlKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj5cbiAgLyoqIENvdW50IHdvcmsgb3JkZXJzIHNoaXBwZWQgc2luY2Ugc3RhcnQgb2YgdG9kYXkgKGxvY2FsIHRpbWUpICovXG4gIGNvdW50U2hpcHBlZFRvZGF5KCk6IFByb21pc2U8bnVtYmVyPlxuICBjcmVhdGUoaW5wdXQ6IENyZWF0ZVdvcmtPcmRlcklucHV0KTogUHJvbWlzZTxXb3JrT3JkZXJEVE8+XG4gIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+XG4gIC8qKiBBdG9taWNhbGx5IHVwZGF0ZSBzdGF0ZSBhbmQgd3JpdGUgYWN0aXZpdHkgcmVjb3JkIGluIGEgdHJhbnNhY3Rpb24gKi9cbiAgdXBkYXRlU3RhdGVXaXRoQWN0aXZpdHkoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBuZXdTdGF0ZTogc3RyaW5nLFxuICAgIGFjdG9yOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTdGF0ZVRyYW5zaXRpb25SZXN1bHQgfCBudWxsPlxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBEQVRBQkFTRSBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGJXb3JrT3JkZXJzUmVwbygpOiBXb3JrT3JkZXJzUmVwbyB7XG4gIHJldHVybiB7XG4gICAgYXN5bmMgbGlzdChmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycyk6IFByb21pc2U8V29ya09yZGVyRFRPW10+IHtcbiAgICAgIGNvbnN0IHdoZXJlID0gYnVpbGRXaGVyZShmaWx0ZXJzKVxuICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IHByaXNtYS53b3JrT3JkZXIuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgb3JkZXJCeTogeyB1cGRhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSlcbiAgICAgIHJldHVybiByb3dzLm1hcCh0b0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFdpdGhPcHMoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE9bXT4ge1xuICAgICAgY29uc3Qgd2hlcmUgPSBidWlsZFdoZXJlKGZpbHRlcnMpXG4gICAgICBjb25zdCByb3dzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IHVwZGF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBvcGVyYXRpb25zOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJvd3MubWFwKChyb3cpID0+ICh7XG4gICAgICAgIC4uLnRvRFRPKHJvdyksXG4gICAgICAgIG9wZXJhdGlvbnM6IHJvdy5vcGVyYXRpb25zLm1hcCgob3ApID0+ICh7XG4gICAgICAgICAgaWQ6IG9wLmlkLFxuICAgICAgICAgIHN0YXR1czogb3Auc3RhdHVzLFxuICAgICAgICB9KSksXG4gICAgICB9KSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlDb2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgY29kZSB9IH0pXG4gICAgICByZXR1cm4gcm93ID8gdG9EVE8ocm93KSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRCeVN0YXRlKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5ncm91cEJ5KHtcbiAgICAgICAgYnk6IFsnc3RhdGUnXSxcbiAgICAgICAgX2NvdW50OiB7IGlkOiB0cnVlIH0sXG4gICAgICB9KVxuICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgZ3JvdXBzLm1hcCgoZykgPT4gW2cuc3RhdGUsIGcuX2NvdW50LmlkXSlcbiAgICAgIClcbiAgICB9LFxuXG4gICAgYXN5bmMgY291bnRTaGlwcGVkVG9kYXkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuICAgICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgcmV0dXJuIHByaXNtYS53b3JrT3JkZXIuY291bnQoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHN0YXRlOiAnc2hpcHBlZCcsXG4gICAgICAgICAgc2hpcHBlZEF0OiB7IGd0ZTogdG9kYXkgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGFzeW5jIGdldEJ5SWRXaXRoT3BzKGlkOiBzdHJpbmcpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgb3BlcmF0aW9uczoge1xuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBzdGF0dXM6IHRydWUgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnYXNjJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgaWYgKCFyb3cpIHJldHVybiBudWxsXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi50b0RUTyhyb3cpLFxuICAgICAgICBvcGVyYXRpb25zOiByb3cub3BlcmF0aW9ucy5tYXAoKG9wKSA9PiAoe1xuICAgICAgICAgIGlkOiBvcC5pZCxcbiAgICAgICAgICBzdGF0dXM6IG9wLnN0YXR1cyxcbiAgICAgICAgfSkpLFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZVdvcmtPcmRlcklucHV0KTogUHJvbWlzZTxXb3JrT3JkZXJEVE8+IHtcbiAgICAgIC8vIEdlbmVyYXRlIG5leHQgY29kZVxuICAgICAgY29uc3QgbGFzdFdvID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kRmlyc3Qoe1xuICAgICAgICBvcmRlckJ5OiB7IGNvZGU6ICdkZXNjJyB9LFxuICAgICAgICBzZWxlY3Q6IHsgY29kZTogdHJ1ZSB9LFxuICAgICAgfSlcbiAgICAgIGNvbnN0IGxhc3ROdW0gPSBsYXN0V28gPyBwYXJzZUludChsYXN0V28uY29kZS5yZXBsYWNlKCdXTy0nLCAnJyksIDEwKSA6IDBcbiAgICAgIGNvbnN0IGNvZGUgPSBgV08tJHtTdHJpbmcobGFzdE51bSArIDEpLnBhZFN0YXJ0KDMsICcwJyl9YFxuXG4gICAgICBjb25zdCByb3cgPSBhd2FpdCBwcmlzbWEud29ya09yZGVyLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBjb2RlLFxuICAgICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgICBnb2FsTWQ6IGlucHV0LmdvYWxNZCxcbiAgICAgICAgICBzdGF0ZTogJ3BsYW5uZWQnLFxuICAgICAgICAgIHByaW9yaXR5OiBpbnB1dC5wcmlvcml0eSB8fCAnUDInLFxuICAgICAgICAgIG93bmVyOiBpbnB1dC5vd25lciB8fCAndXNlcicsXG4gICAgICAgICAgcm91dGluZ1RlbXBsYXRlOiBpbnB1dC5yb3V0aW5nVGVtcGxhdGUgfHwgJ2RlZmF1bHRfcm91dGluZycsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICAvLyBJbmRleCBmb3Igc2VhcmNoXG4gICAgICBhd2FpdCBpbmRleFdvcmtPcmRlcihyb3cuaWQsIHJvdy5jb2RlLCByb3cudGl0bGUsIHJvdy5nb2FsTWQpXG5cbiAgICAgIHJldHVybiB0b0RUTyhyb3cpXG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBpbnB1dDogVXBkYXRlV29ya09yZGVySW5wdXQpOiBQcm9taXNlPFdvcmtPcmRlckRUTyB8IG51bGw+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KVxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIG51bGxcblxuICAgICAgY29uc3Qgcm93ID0gYXdhaXQgcHJpc21hLndvcmtPcmRlci51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uKGlucHV0LnRpdGxlICE9PSB1bmRlZmluZWQgJiYgeyB0aXRsZTogaW5wdXQudGl0bGUgfSksXG4gICAgICAgICAgLi4uKGlucHV0LmdvYWxNZCAhPT0gdW5kZWZpbmVkICYmIHsgZ29hbE1kOiBpbnB1dC5nb2FsTWQgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnN0YXRlICE9PSB1bmRlZmluZWQgJiYgeyBzdGF0ZTogaW5wdXQuc3RhdGUgfSksXG4gICAgICAgICAgLi4uKGlucHV0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQgJiYgeyBwcmlvcml0eTogaW5wdXQucHJpb3JpdHkgfSksXG4gICAgICAgICAgLi4uKGlucHV0Lm93bmVyICE9PSB1bmRlZmluZWQgJiYgeyBvd25lcjogaW5wdXQub3duZXIgfSksXG4gICAgICAgICAgLi4uKGlucHV0LmJsb2NrZWRSZWFzb24gIT09IHVuZGVmaW5lZCAmJiB7IGJsb2NrZWRSZWFzb246IGlucHV0LmJsb2NrZWRSZWFzb24gfSksXG4gICAgICAgICAgLi4uKGlucHV0LnN0YXRlID09PSAnc2hpcHBlZCcgJiYgeyBzaGlwcGVkQXQ6IG5ldyBEYXRlKCkgfSksXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICAvLyBSZS1pbmRleCBmb3Igc2VhcmNoIGlmIHRpdGxlIG9yIGdvYWwgY2hhbmdlZFxuICAgICAgaWYgKGlucHV0LnRpdGxlICE9PSB1bmRlZmluZWQgfHwgaW5wdXQuZ29hbE1kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYXdhaXQgaW5kZXhXb3JrT3JkZXIocm93LmlkLCByb3cuY29kZSwgcm93LnRpdGxlLCByb3cuZ29hbE1kKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdG9EVE8ocm93KVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0ZTogc3RyaW5nLFxuICAgICAgYWN0b3I6IHN0cmluZ1xuICAgICk6IFByb21pc2U8U3RhdGVUcmFuc2l0aW9uUmVzdWx0IHwgbnVsbD4ge1xuICAgICAgcmV0dXJuIHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIEdldCBjdXJyZW50IHN0YXRlXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdHgud29ya09yZGVyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0ZSA9IGV4aXN0aW5nLnN0YXRlXG5cbiAgICAgICAgLy8gVXBkYXRlIHdvcmsgb3JkZXJcbiAgICAgICAgY29uc3Qgcm93ID0gYXdhaXQgdHgud29ya09yZGVyLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdGF0ZTogbmV3U3RhdGUsXG4gICAgICAgICAgICAuLi4obmV3U3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSByZWNvcmRcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IGBhY3RfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWBcbiAgICAgICAgYXdhaXQgdHguYWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogJ3dvcmtfb3JkZXIuc3RhdGVfY2hhbmdlZCcsXG4gICAgICAgICAgICBhY3RvcixcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICd3b3JrX29yZGVyJyxcbiAgICAgICAgICAgIGVudGl0eUlkOiBpZCxcbiAgICAgICAgICAgIHN1bW1hcnk6IGBXb3JrIG9yZGVyIHRyYW5zaXRpb25lZCB0byAke25ld1N0YXRlfWAsXG4gICAgICAgICAgICBwYXlsb2FkSnNvbjogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICBwcmV2aW91c1N0YXRlLFxuICAgICAgICAgICAgICBuZXdTdGF0ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB3b3JrT3JkZXI6IHRvRFRPKHJvdyksXG4gICAgICAgICAgcHJldmlvdXNTdGF0ZSxcbiAgICAgICAgICBhY3Rpdml0eUlkLFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTU9DSyBJTVBMRU1FTlRBVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1dvcmtPcmRlcnNSZXBvKCk6IFdvcmtPcmRlcnNSZXBvIHtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyBsaXN0KGZpbHRlcnM/OiBXb3JrT3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxXb3JrT3JkZXJEVE9bXT4ge1xuICAgICAgbGV0IHJlc3VsdCA9IFsuLi5tb2NrV29ya09yZGVyc11cbiAgICAgIGlmIChmaWx0ZXJzPy5zdGF0ZSkge1xuICAgICAgICBjb25zdCBzdGF0ZXMgPSBBcnJheS5pc0FycmF5KGZpbHRlcnMuc3RhdGUpID8gZmlsdGVycy5zdGF0ZSA6IFtmaWx0ZXJzLnN0YXRlXVxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKCh3bykgPT4gc3RhdGVzLmluY2x1ZGVzKHdvLnN0YXRlKSlcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzPy5wcmlvcml0eSkge1xuICAgICAgICBjb25zdCBwcmlvcml0aWVzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnByaW9yaXR5KSA/IGZpbHRlcnMucHJpb3JpdHkgOiBbZmlsdGVycy5wcmlvcml0eV1cbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcigod28pID0+IHByaW9yaXRpZXMuaW5jbHVkZXMod28ucHJpb3JpdHkpKVxuICAgICAgfVxuICAgICAgaWYgKGZpbHRlcnM/Lm93bmVyKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoKHdvKSA9PiB3by5vd25lciA9PT0gZmlsdGVycy5vd25lcilcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQubWFwKG1vY2tUb0RUTylcbiAgICB9LFxuXG4gICAgYXN5bmMgbGlzdFdpdGhPcHMoZmlsdGVycz86IFdvcmtPcmRlckZpbHRlcnMpOiBQcm9taXNlPFdvcmtPcmRlcldpdGhPcHNEVE9bXT4ge1xuICAgICAgY29uc3Qgd29ya09yZGVycyA9IGF3YWl0IHRoaXMubGlzdChmaWx0ZXJzKVxuICAgICAgcmV0dXJuIHdvcmtPcmRlcnMubWFwKCh3bykgPT4gKHtcbiAgICAgICAgLi4ud28sXG4gICAgICAgIG9wZXJhdGlvbnM6IG1vY2tPcGVyYXRpb25zXG4gICAgICAgICAgLmZpbHRlcigob3ApID0+IG9wLndvcmtPcmRlcklkID09PSB3by5pZClcbiAgICAgICAgICAubWFwKChvcCkgPT4gKHsgaWQ6IG9wLmlkLCBzdGF0dXM6IG9wLnN0YXR1cyB9KSksXG4gICAgICB9KSlcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgcmV0dXJuIHdvID8gbW9ja1RvRFRPKHdvKSA6IG51bGxcbiAgICB9LFxuXG4gICAgYXN5bmMgZ2V0QnlDb2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8V29ya09yZGVyRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmNvZGUgPT09IGNvZGUpXG4gICAgICByZXR1cm4gd28gPyBtb2NrVG9EVE8od28pIDogbnVsbFxuICAgIH0sXG5cbiAgICBhc3luYyBjb3VudEJ5U3RhdGUoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgICBjb25zdCBjb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fVxuICAgICAgZm9yIChjb25zdCB3byBvZiBtb2NrV29ya09yZGVycykge1xuICAgICAgICBjb3VudHNbd28uc3RhdGVdID0gKGNvdW50c1t3by5zdGF0ZV0gfHwgMCkgKyAxXG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnRzXG4gICAgfSxcblxuICAgIGFzeW5jIGNvdW50U2hpcHBlZFRvZGF5KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKClcbiAgICAgIHRvZGF5LnNldEhvdXJzKDAsIDAsIDAsIDApXG5cbiAgICAgIHJldHVybiBtb2NrV29ya09yZGVycy5maWx0ZXIoXG4gICAgICAgICh3bykgPT4gd28uc3RhdGUgPT09ICdzaGlwcGVkJyAmJiB3by5zaGlwcGVkQXQgJiYgd28uc2hpcHBlZEF0ID49IHRvZGF5XG4gICAgICApLmxlbmd0aFxuICAgIH0sXG5cbiAgICBhc3luYyBnZXRCeUlkV2l0aE9wcyhpZDogc3RyaW5nKTogUHJvbWlzZTxXb3JrT3JkZXJXaXRoT3BzRFRPIHwgbnVsbD4ge1xuICAgICAgY29uc3Qgd28gPSBtb2NrV29ya09yZGVycy5maW5kKCh3KSA9PiB3LmlkID09PSBpZClcbiAgICAgIGlmICghd28pIHJldHVybiBudWxsXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5tb2NrVG9EVE8od28pLFxuICAgICAgICBvcGVyYXRpb25zOiBtb2NrT3BlcmF0aW9uc1xuICAgICAgICAgIC5maWx0ZXIoKG9wKSA9PiBvcC53b3JrT3JkZXJJZCA9PT0gaWQpXG4gICAgICAgICAgLm1hcCgob3ApID0+ICh7IGlkOiBvcC5pZCwgc3RhdHVzOiBvcC5zdGF0dXMgfSkpLFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyBjcmVhdGUoaW5wdXQ6IENyZWF0ZVdvcmtPcmRlcklucHV0KTogUHJvbWlzZTxXb3JrT3JkZXJEVE8+IHtcbiAgICAgIC8vIEdlbmVyYXRlIG1vY2sgSUQgYW5kIGNvZGVcbiAgICAgIGNvbnN0IGlkID0gYHdvX21vY2tfJHtEYXRlLm5vdygpfWBcbiAgICAgIGNvbnN0IGNvZGUgPSBgV08tJHtTdHJpbmcobW9ja1dvcmtPcmRlcnMubGVuZ3RoICsgMSkucGFkU3RhcnQoMywgJzAnKX1gXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG5cbiAgICAgIGNvbnN0IG5ld1dvID0ge1xuICAgICAgICBpZCxcbiAgICAgICAgY29kZSxcbiAgICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgICBnb2FsTWQ6IGlucHV0LmdvYWxNZCxcbiAgICAgICAgc3RhdGU6ICdwbGFubmVkJyBhcyBjb25zdCxcbiAgICAgICAgcHJpb3JpdHk6IChpbnB1dC5wcmlvcml0eSB8fCAnUDInKSBhcyAnUDAnIHwgJ1AxJyB8ICdQMicgfCAnUDMnLFxuICAgICAgICBvd25lcjogKGlucHV0Lm93bmVyIHx8ICd1c2VyJykgYXMgJ3VzZXInIHwgJ2NsYXdjb250cm9sY2VvJyxcbiAgICAgICAgcm91dGluZ1RlbXBsYXRlOiBpbnB1dC5yb3V0aW5nVGVtcGxhdGUgfHwgJ2RlZmF1bHRfcm91dGluZycsXG4gICAgICAgIGJsb2NrZWRSZWFzb246IG51bGwsXG4gICAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICAgICAgc2hpcHBlZEF0OiBudWxsLFxuICAgICAgfVxuXG4gICAgICAvLyBJbiBtb2NrIG1vZGUsIHdlIGRvbid0IHBlcnNpc3QgLSBqdXN0IHJldHVybiB0aGUgRFRPXG4gICAgICByZXR1cm4gbW9ja1RvRFRPKG5ld1dvKVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgaW5wdXQ6IFVwZGF0ZVdvcmtPcmRlcklucHV0KTogUHJvbWlzZTxXb3JrT3JkZXJEVE8gfCBudWxsPiB7XG4gICAgICBjb25zdCB3byA9IG1vY2tXb3JrT3JkZXJzLmZpbmQoKHcpID0+IHcuaWQgPT09IGlkKVxuICAgICAgaWYgKCF3bykgcmV0dXJuIG51bGxcblxuICAgICAgLy8gSW4gbW9jayBtb2RlLCB3ZSBkb24ndCBhY3R1YWxseSBtdXRhdGUgLSBqdXN0IHJldHVybiB1cGRhdGVkIERUT1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ubW9ja1RvRFRPKHdvKSxcbiAgICAgICAgLi4uKGlucHV0LnRpdGxlICE9PSB1bmRlZmluZWQgJiYgeyB0aXRsZTogaW5wdXQudGl0bGUgfSksXG4gICAgICAgIC4uLihpbnB1dC5nb2FsTWQgIT09IHVuZGVmaW5lZCAmJiB7IGdvYWxNZDogaW5wdXQuZ29hbE1kIH0pLFxuICAgICAgICAuLi4oaW5wdXQuc3RhdGUgIT09IHVuZGVmaW5lZCAmJiB7IHN0YXRlOiBpbnB1dC5zdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10gfSksXG4gICAgICAgIC4uLihpbnB1dC5wcmlvcml0eSAhPT0gdW5kZWZpbmVkICYmIHsgcHJpb3JpdHk6IGlucHV0LnByaW9yaXR5IGFzIFdvcmtPcmRlckRUT1sncHJpb3JpdHknXSB9KSxcbiAgICAgICAgLi4uKGlucHV0Lm93bmVyICE9PSB1bmRlZmluZWQgJiYgeyBvd25lcjogaW5wdXQub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddIH0pLFxuICAgICAgICAuLi4oaW5wdXQuYmxvY2tlZFJlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHsgYmxvY2tlZFJlYXNvbjogaW5wdXQuYmxvY2tlZFJlYXNvbiB9KSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhc3luYyB1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eShcbiAgICAgIGlkOiBzdHJpbmcsXG4gICAgICBuZXdTdGF0ZTogc3RyaW5nLFxuICAgICAgX2FjdG9yOiBzdHJpbmdcbiAgICApOiBQcm9taXNlPFN0YXRlVHJhbnNpdGlvblJlc3VsdCB8IG51bGw+IHtcbiAgICAgIGNvbnN0IHdvID0gbW9ja1dvcmtPcmRlcnMuZmluZCgodykgPT4gdy5pZCA9PT0gaWQpXG4gICAgICBpZiAoIXdvKSByZXR1cm4gbnVsbFxuXG4gICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gd28uc3RhdGVcbiAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBgYWN0X21vY2tfJHtEYXRlLm5vdygpfWBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd29ya09yZGVyOiB7XG4gICAgICAgICAgLi4ubW9ja1RvRFRPKHdvKSxcbiAgICAgICAgICBzdGF0ZTogbmV3U3RhdGUgYXMgV29ya09yZGVyRFRPWydzdGF0ZSddLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAuLi4obmV3U3RhdGUgPT09ICdzaGlwcGVkJyAmJiB7IHNoaXBwZWRBdDogbmV3IERhdGUoKSB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgcHJldmlvdXNTdGF0ZSxcbiAgICAgICAgYWN0aXZpdHlJZCxcbiAgICAgIH1cbiAgICB9LFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhFTFBFUlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gYnVpbGRXaGVyZShmaWx0ZXJzPzogV29ya09yZGVyRmlsdGVycykge1xuICBpZiAoIWZpbHRlcnMpIHJldHVybiB7fVxuICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuICBpZiAoZmlsdGVycy5zdGF0ZSkge1xuICAgIHdoZXJlLnN0YXRlID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnN0YXRlKSA/IHsgaW46IGZpbHRlcnMuc3RhdGUgfSA6IGZpbHRlcnMuc3RhdGVcbiAgfVxuICBpZiAoZmlsdGVycy5wcmlvcml0eSkge1xuICAgIHdoZXJlLnByaW9yaXR5ID0gQXJyYXkuaXNBcnJheShmaWx0ZXJzLnByaW9yaXR5KSA/IHsgaW46IGZpbHRlcnMucHJpb3JpdHkgfSA6IGZpbHRlcnMucHJpb3JpdHlcbiAgfVxuICBpZiAoZmlsdGVycy5vd25lcikge1xuICAgIHdoZXJlLm93bmVyID0gZmlsdGVycy5vd25lclxuICB9XG4gIHJldHVybiB3aGVyZVxufVxuXG5mdW5jdGlvbiB0b0RUTyhyb3c6IHtcbiAgaWQ6IHN0cmluZ1xuICBjb2RlOiBzdHJpbmdcbiAgdGl0bGU6IHN0cmluZ1xuICBnb2FsTWQ6IHN0cmluZ1xuICBzdGF0ZTogc3RyaW5nXG4gIHByaW9yaXR5OiBzdHJpbmdcbiAgb3duZXI6IHN0cmluZ1xuICByb3V0aW5nVGVtcGxhdGU6IHN0cmluZ1xuICBibG9ja2VkUmVhc29uOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRBdDogRGF0ZVxuICB1cGRhdGVkQXQ6IERhdGVcbiAgc2hpcHBlZEF0OiBEYXRlIHwgbnVsbFxufSk6IFdvcmtPcmRlckRUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBjb2RlOiByb3cuY29kZSxcbiAgICB0aXRsZTogcm93LnRpdGxlLFxuICAgIGdvYWxNZDogcm93LmdvYWxNZCxcbiAgICBzdGF0ZTogcm93LnN0YXRlIGFzIFdvcmtPcmRlckRUT1snc3RhdGUnXSxcbiAgICBwcmlvcml0eTogcm93LnByaW9yaXR5IGFzIFdvcmtPcmRlckRUT1sncHJpb3JpdHknXSxcbiAgICBvd25lcjogcm93Lm93bmVyIGFzIFdvcmtPcmRlckRUT1snb3duZXInXSxcbiAgICByb3V0aW5nVGVtcGxhdGU6IHJvdy5yb3V0aW5nVGVtcGxhdGUsXG4gICAgYmxvY2tlZFJlYXNvbjogcm93LmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LFxuICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRBdCxcbiAgICBzaGlwcGVkQXQ6IHJvdy5zaGlwcGVkQXQsXG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ja1RvRFRPKHdvOiB0eXBlb2YgbW9ja1dvcmtPcmRlcnNbbnVtYmVyXSk6IFdvcmtPcmRlckRUTyB7XG4gIHJldHVybiB7XG4gICAgaWQ6IHdvLmlkLFxuICAgIGNvZGU6IHdvLmNvZGUsXG4gICAgdGl0bGU6IHdvLnRpdGxlLFxuICAgIGdvYWxNZDogd28uZ29hbE1kLFxuICAgIHN0YXRlOiB3by5zdGF0ZSBhcyBXb3JrT3JkZXJEVE9bJ3N0YXRlJ10sXG4gICAgcHJpb3JpdHk6IHdvLnByaW9yaXR5IGFzIFdvcmtPcmRlckRUT1sncHJpb3JpdHknXSxcbiAgICBvd25lcjogd28ub3duZXIgYXMgV29ya09yZGVyRFRPWydvd25lciddLFxuICAgIHJvdXRpbmdUZW1wbGF0ZTogd28ucm91dGluZ1RlbXBsYXRlLFxuICAgIGJsb2NrZWRSZWFzb246IHdvLmJsb2NrZWRSZWFzb24sXG4gICAgY3JlYXRlZEF0OiB3by5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiB3by51cGRhdGVkQXQsXG4gICAgc2hpcHBlZEF0OiB3by5zaGlwcGVkQXQsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJpbmRleFdvcmtPcmRlciIsIm1vY2tXb3JrT3JkZXJzIiwibW9ja09wZXJhdGlvbnMiLCJjcmVhdGVEYldvcmtPcmRlcnNSZXBvIiwibGlzdCIsImZpbHRlcnMiLCJ3aGVyZSIsImJ1aWxkV2hlcmUiLCJyb3dzIiwid29ya09yZGVyIiwiZmluZE1hbnkiLCJvcmRlckJ5IiwidXBkYXRlZEF0IiwibWFwIiwidG9EVE8iLCJsaXN0V2l0aE9wcyIsImluY2x1ZGUiLCJvcGVyYXRpb25zIiwic2VsZWN0IiwiaWQiLCJzdGF0dXMiLCJyb3ciLCJvcCIsImdldEJ5SWQiLCJmaW5kVW5pcXVlIiwiZ2V0QnlDb2RlIiwiY29kZSIsImNvdW50QnlTdGF0ZSIsImdyb3VwcyIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZyIsInN0YXRlIiwiY291bnRTaGlwcGVkVG9kYXkiLCJ0b2RheSIsIkRhdGUiLCJzZXRIb3VycyIsImNvdW50Iiwic2hpcHBlZEF0IiwiZ3RlIiwiZ2V0QnlJZFdpdGhPcHMiLCJjcmVhdGVkQXQiLCJjcmVhdGUiLCJpbnB1dCIsImxhc3RXbyIsImZpbmRGaXJzdCIsImxhc3ROdW0iLCJwYXJzZUludCIsInJlcGxhY2UiLCJTdHJpbmciLCJwYWRTdGFydCIsImRhdGEiLCJ0aXRsZSIsImdvYWxNZCIsInByaW9yaXR5Iiwib3duZXIiLCJyb3V0aW5nVGVtcGxhdGUiLCJ1cGRhdGUiLCJleGlzdGluZyIsInVuZGVmaW5lZCIsImJsb2NrZWRSZWFzb24iLCJ1cGRhdGVTdGF0ZVdpdGhBY3Rpdml0eSIsIm5ld1N0YXRlIiwiYWN0b3IiLCIkdHJhbnNhY3Rpb24iLCJ0eCIsInByZXZpb3VzU3RhdGUiLCJhY3Rpdml0eUlkIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic2xpY2UiLCJhY3Rpdml0eSIsInRzIiwidHlwZSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInN1bW1hcnkiLCJwYXlsb2FkSnNvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJjcmVhdGVNb2NrV29ya09yZGVyc1JlcG8iLCJyZXN1bHQiLCJzdGF0ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJ3byIsImluY2x1ZGVzIiwicHJpb3JpdGllcyIsIm1vY2tUb0RUTyIsIndvcmtPcmRlcnMiLCJ3b3JrT3JkZXJJZCIsImZpbmQiLCJ3IiwiY291bnRzIiwibGVuZ3RoIiwibmV3V28iLCJfYWN0b3IiLCJpbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(instrument)/./lib/repo/workOrders.ts\n");
apps/clawcontrol/.next/dev/logs/next-development.log:610:[00:37:09.633] Server  LOG     prisma:error "\nInvalid `prisma.receipt.create()` invocation:\n\n\nForeign key constraint violated: `foreign key`"
apps/clawcontrol/.next/dev/logs/next-development.log:612:Invalid `prisma.receipt.create()` invocation:
apps/clawcontrol/lib/openclaw/sessions.ts:81:    await prisma.agentSession.upsert({
apps/clawcontrol/lib/openclaw/sessions.ts:184:    await prisma.agentSession.upsert({
apps/clawcontrol/lib/repo/workOrders.ts:158:      const row = await prisma.workOrder.create({
apps/clawcontrol/lib/repo/workOrders.ts:180:      const row = await prisma.workOrder.update({
apps/clawcontrol/lib/repo/stations.ts:65:      const row = await prisma.station.create({
apps/clawcontrol/lib/repo/stations.ts:82:      const row = await prisma.station.update({
apps/clawcontrol/lib/repo/operations.ts:90:      const row = await prisma.operation.create({
apps/clawcontrol/lib/repo/operations.ts:109:      const row = await prisma.operation.update({
apps/clawcontrol/lib/repo/agents.ts:90:      const row = await prisma.agent.create({
apps/clawcontrol/lib/repo/agents.ts:122:      const row = await prisma.agent.update({
apps/clawcontrol/lib/repo/approvals.ts:69:      const row = await prisma.approval.create({
apps/clawcontrol/lib/repo/approvals.ts:85:      const row = await prisma.approval.update({
apps/clawcontrol/lib/repo/receipts.ts:92:      const row = await prisma.receipt.create({
apps/clawcontrol/lib/repo/receipts.ts:121:      const row = await prisma.receipt.update({
apps/clawcontrol/lib/repo/receipts.ts:136:      const row = await prisma.receipt.update({
apps/clawcontrol/lib/repo/activities.ts:74:      const row = await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:155:    await prisma.operation.update({
apps/clawcontrol/lib/services/manager.ts:160:    await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:181:    await prisma.operation.update({
apps/clawcontrol/lib/services/manager.ts:186:    await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:315:      await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:344:      await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:359:    await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:406:      await prisma.operation.update({
apps/clawcontrol/lib/services/manager.ts:411:      await prisma.activity.create({
apps/clawcontrol/lib/services/manager.ts:430:      await prisma.operation.update({
apps/clawcontrol/lib/services/manager.ts:435:      await prisma.activity.create({
